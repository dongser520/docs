<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>eggjs后台超级管理员自定义表单新增修改（以网站配置为例） | 睿晨网</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/assets/img/favicon.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="#icon-pengyouquan" href="/icons/iconfont.svg" color="#3eaf7c">
    <meta name="description" content="睿晨网|睿晨编程|零基础学做网站、app、小程序就从这里开始">
    <meta name="keywords" content="睿晨网,睿晨编程,零基础学做网站,零基础学app,零基础学小程序">
    <meta name="author" content="睿晨网,睿晨编程,阿东老师">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.0c241f14.css" as="style"><link rel="preload" href="/assets/js/app.4c1fa2f2.js" as="script"><link rel="preload" href="/assets/js/10.a1858127.js" as="script"><link rel="preload" href="/assets/js/2.641709ae.js" as="script"><link rel="preload" href="/assets/js/51.c48be90d.js" as="script"><link rel="preload" href="/assets/js/4.68f7b7e9.js" as="script"><link rel="prefetch" href="/assets/js/100.18619803.js"><link rel="prefetch" href="/assets/js/101.795bb579.js"><link rel="prefetch" href="/assets/js/102.b2af91e0.js"><link rel="prefetch" href="/assets/js/103.addaf7eb.js"><link rel="prefetch" href="/assets/js/104.9cadff90.js"><link rel="prefetch" href="/assets/js/105.78b9c2c5.js"><link rel="prefetch" href="/assets/js/106.2e311b0f.js"><link rel="prefetch" href="/assets/js/107.719537c8.js"><link rel="prefetch" href="/assets/js/108.ee801dcb.js"><link rel="prefetch" href="/assets/js/109.7be9e3da.js"><link rel="prefetch" href="/assets/js/11.e11c94df.js"><link rel="prefetch" href="/assets/js/110.bef17d75.js"><link rel="prefetch" href="/assets/js/111.ae05aad1.js"><link rel="prefetch" href="/assets/js/112.348a918b.js"><link rel="prefetch" href="/assets/js/113.0377bb8f.js"><link rel="prefetch" href="/assets/js/114.7ce59f50.js"><link rel="prefetch" href="/assets/js/115.73763f96.js"><link rel="prefetch" href="/assets/js/116.8c4955c8.js"><link rel="prefetch" href="/assets/js/117.f57f0ca7.js"><link rel="prefetch" href="/assets/js/118.ac987a87.js"><link rel="prefetch" href="/assets/js/119.191506f9.js"><link rel="prefetch" href="/assets/js/12.77b4f171.js"><link rel="prefetch" href="/assets/js/120.a9d0f345.js"><link rel="prefetch" href="/assets/js/121.74ec567e.js"><link rel="prefetch" href="/assets/js/122.9e1dbf90.js"><link rel="prefetch" href="/assets/js/123.2ae10c73.js"><link rel="prefetch" href="/assets/js/124.1e2930d5.js"><link rel="prefetch" href="/assets/js/125.bd54db16.js"><link rel="prefetch" href="/assets/js/126.501951f4.js"><link rel="prefetch" href="/assets/js/127.78e8444c.js"><link rel="prefetch" href="/assets/js/128.4e853ac8.js"><link rel="prefetch" href="/assets/js/129.b8b424a4.js"><link rel="prefetch" href="/assets/js/13.06be6eff.js"><link rel="prefetch" href="/assets/js/130.97044db5.js"><link rel="prefetch" href="/assets/js/131.a16e7627.js"><link rel="prefetch" href="/assets/js/132.1de37703.js"><link rel="prefetch" href="/assets/js/133.d99212b9.js"><link rel="prefetch" href="/assets/js/134.92f94379.js"><link rel="prefetch" href="/assets/js/135.e4a78e00.js"><link rel="prefetch" href="/assets/js/136.4977877f.js"><link rel="prefetch" href="/assets/js/137.4c4703c5.js"><link rel="prefetch" href="/assets/js/138.c199cd62.js"><link rel="prefetch" href="/assets/js/139.3ae48ccb.js"><link rel="prefetch" href="/assets/js/14.f75e8140.js"><link rel="prefetch" href="/assets/js/140.41d910b1.js"><link rel="prefetch" href="/assets/js/141.c93ed5fd.js"><link rel="prefetch" href="/assets/js/142.a30bcabf.js"><link rel="prefetch" href="/assets/js/143.8b1aaf58.js"><link rel="prefetch" href="/assets/js/144.f9b2970c.js"><link rel="prefetch" href="/assets/js/145.7363c390.js"><link rel="prefetch" href="/assets/js/146.1d5c8a1d.js"><link rel="prefetch" href="/assets/js/147.e121f839.js"><link rel="prefetch" href="/assets/js/148.add78a99.js"><link rel="prefetch" href="/assets/js/149.f27cc0ff.js"><link rel="prefetch" href="/assets/js/15.f10318c8.js"><link rel="prefetch" href="/assets/js/150.ced8ecaa.js"><link rel="prefetch" href="/assets/js/151.0bf12333.js"><link rel="prefetch" href="/assets/js/152.40f21e31.js"><link rel="prefetch" href="/assets/js/153.b262de48.js"><link rel="prefetch" href="/assets/js/154.50c64325.js"><link rel="prefetch" href="/assets/js/155.426015ec.js"><link rel="prefetch" href="/assets/js/156.4b9bf962.js"><link rel="prefetch" href="/assets/js/157.95c0b8d1.js"><link rel="prefetch" href="/assets/js/158.74450c14.js"><link rel="prefetch" href="/assets/js/159.cc9c20a2.js"><link rel="prefetch" href="/assets/js/16.49a0cfe4.js"><link rel="prefetch" href="/assets/js/160.01c4a8c7.js"><link rel="prefetch" href="/assets/js/161.d4c19dfb.js"><link rel="prefetch" href="/assets/js/162.42a1c4fb.js"><link rel="prefetch" href="/assets/js/163.d3b4d63d.js"><link rel="prefetch" href="/assets/js/164.f9f007d4.js"><link rel="prefetch" href="/assets/js/165.9f7441e0.js"><link rel="prefetch" href="/assets/js/166.1d96f480.js"><link rel="prefetch" href="/assets/js/167.5856d771.js"><link rel="prefetch" href="/assets/js/168.dd367256.js"><link rel="prefetch" href="/assets/js/169.cf1362a6.js"><link rel="prefetch" href="/assets/js/17.9cf0aeef.js"><link rel="prefetch" href="/assets/js/170.aca266de.js"><link rel="prefetch" href="/assets/js/171.599ff2d4.js"><link rel="prefetch" href="/assets/js/172.9e0826cc.js"><link rel="prefetch" href="/assets/js/173.d30914b5.js"><link rel="prefetch" href="/assets/js/174.d7494b91.js"><link rel="prefetch" href="/assets/js/175.b32a1bb2.js"><link rel="prefetch" href="/assets/js/176.decc27de.js"><link rel="prefetch" href="/assets/js/177.c0b71cf9.js"><link rel="prefetch" href="/assets/js/178.4e28a1ff.js"><link rel="prefetch" href="/assets/js/179.f6a019b1.js"><link rel="prefetch" href="/assets/js/18.f506f436.js"><link rel="prefetch" href="/assets/js/180.f853a887.js"><link rel="prefetch" href="/assets/js/181.b2de00b7.js"><link rel="prefetch" href="/assets/js/182.22b42a53.js"><link rel="prefetch" href="/assets/js/183.4d3486a4.js"><link rel="prefetch" href="/assets/js/184.25831409.js"><link rel="prefetch" href="/assets/js/185.d01fcfd3.js"><link rel="prefetch" href="/assets/js/186.49c41f4f.js"><link rel="prefetch" href="/assets/js/187.34eb1a96.js"><link rel="prefetch" href="/assets/js/188.651bcdfa.js"><link rel="prefetch" href="/assets/js/189.e75e375d.js"><link rel="prefetch" href="/assets/js/19.f216d96e.js"><link rel="prefetch" href="/assets/js/190.1ec83dea.js"><link rel="prefetch" href="/assets/js/191.bbb68c4d.js"><link rel="prefetch" href="/assets/js/192.1e4bd575.js"><link rel="prefetch" href="/assets/js/193.c560196e.js"><link rel="prefetch" href="/assets/js/194.ea7c96fd.js"><link rel="prefetch" href="/assets/js/195.279e9c3a.js"><link rel="prefetch" href="/assets/js/196.79b5d677.js"><link rel="prefetch" href="/assets/js/197.78f10001.js"><link rel="prefetch" href="/assets/js/198.d665ee5a.js"><link rel="prefetch" href="/assets/js/199.37013295.js"><link rel="prefetch" href="/assets/js/20.c9849598.js"><link rel="prefetch" href="/assets/js/200.2347a83a.js"><link rel="prefetch" href="/assets/js/201.19063bbd.js"><link rel="prefetch" href="/assets/js/202.32e5ace2.js"><link rel="prefetch" href="/assets/js/203.1f87638d.js"><link rel="prefetch" href="/assets/js/204.03cf582a.js"><link rel="prefetch" href="/assets/js/205.80fe2051.js"><link rel="prefetch" href="/assets/js/206.a0d9b926.js"><link rel="prefetch" href="/assets/js/207.3502356e.js"><link rel="prefetch" href="/assets/js/208.a4c9af93.js"><link rel="prefetch" href="/assets/js/209.9511055d.js"><link rel="prefetch" href="/assets/js/21.7d11fd8e.js"><link rel="prefetch" href="/assets/js/210.dc1b8bd8.js"><link rel="prefetch" href="/assets/js/211.eec86519.js"><link rel="prefetch" href="/assets/js/212.e26acd4d.js"><link rel="prefetch" href="/assets/js/213.9a9ec01e.js"><link rel="prefetch" href="/assets/js/214.19bf4a95.js"><link rel="prefetch" href="/assets/js/215.ede08fd2.js"><link rel="prefetch" href="/assets/js/216.a9443bde.js"><link rel="prefetch" href="/assets/js/217.845fad4f.js"><link rel="prefetch" href="/assets/js/218.10a24507.js"><link rel="prefetch" href="/assets/js/219.582bf77f.js"><link rel="prefetch" href="/assets/js/22.a81c6dd1.js"><link rel="prefetch" href="/assets/js/220.75958238.js"><link rel="prefetch" href="/assets/js/221.25aa9b7d.js"><link rel="prefetch" href="/assets/js/23.e3f76b3b.js"><link rel="prefetch" href="/assets/js/24.53929924.js"><link rel="prefetch" href="/assets/js/25.6da15d03.js"><link rel="prefetch" href="/assets/js/26.208cb02b.js"><link rel="prefetch" href="/assets/js/27.0055f1bf.js"><link rel="prefetch" href="/assets/js/28.c22d8dbb.js"><link rel="prefetch" href="/assets/js/29.5274de73.js"><link rel="prefetch" href="/assets/js/3.a5ce401d.js"><link rel="prefetch" href="/assets/js/30.0c8e8d20.js"><link rel="prefetch" href="/assets/js/31.dabb2430.js"><link rel="prefetch" href="/assets/js/32.4b69344f.js"><link rel="prefetch" href="/assets/js/33.2a6fe3fa.js"><link rel="prefetch" href="/assets/js/34.b7d7a9a6.js"><link rel="prefetch" href="/assets/js/35.fc527240.js"><link rel="prefetch" href="/assets/js/36.96422d34.js"><link rel="prefetch" href="/assets/js/37.7cd0e507.js"><link rel="prefetch" href="/assets/js/38.adb87b54.js"><link rel="prefetch" href="/assets/js/39.142ea250.js"><link rel="prefetch" href="/assets/js/40.2d6a4bf1.js"><link rel="prefetch" href="/assets/js/41.6dc1c411.js"><link rel="prefetch" href="/assets/js/42.c8355471.js"><link rel="prefetch" href="/assets/js/43.eba2417f.js"><link rel="prefetch" href="/assets/js/44.cdafd4da.js"><link rel="prefetch" href="/assets/js/45.5dfd5868.js"><link rel="prefetch" href="/assets/js/46.4cde5b6f.js"><link rel="prefetch" href="/assets/js/47.1fa112a3.js"><link rel="prefetch" href="/assets/js/48.cc7fe259.js"><link rel="prefetch" href="/assets/js/49.3df09ad7.js"><link rel="prefetch" href="/assets/js/5.6ac3d9b4.js"><link rel="prefetch" href="/assets/js/50.419588dd.js"><link rel="prefetch" href="/assets/js/52.c461b61e.js"><link rel="prefetch" href="/assets/js/53.4f6ab812.js"><link rel="prefetch" href="/assets/js/54.3293f69e.js"><link rel="prefetch" href="/assets/js/55.4d866de2.js"><link rel="prefetch" href="/assets/js/56.31a53067.js"><link rel="prefetch" href="/assets/js/57.19c7e76e.js"><link rel="prefetch" href="/assets/js/58.d8dc7186.js"><link rel="prefetch" href="/assets/js/59.bdfff1b6.js"><link rel="prefetch" href="/assets/js/6.f6f62d21.js"><link rel="prefetch" href="/assets/js/60.17072b43.js"><link rel="prefetch" href="/assets/js/61.035209e3.js"><link rel="prefetch" href="/assets/js/62.0d160a8a.js"><link rel="prefetch" href="/assets/js/63.cf07039a.js"><link rel="prefetch" href="/assets/js/64.4ac28cb2.js"><link rel="prefetch" href="/assets/js/65.c4b56fcb.js"><link rel="prefetch" href="/assets/js/66.fe14252b.js"><link rel="prefetch" href="/assets/js/67.f5182f00.js"><link rel="prefetch" href="/assets/js/68.29ba900b.js"><link rel="prefetch" href="/assets/js/69.8e3c6d8f.js"><link rel="prefetch" href="/assets/js/7.5ecdfcdb.js"><link rel="prefetch" href="/assets/js/70.272781c2.js"><link rel="prefetch" href="/assets/js/71.ba3c0143.js"><link rel="prefetch" href="/assets/js/72.0036a802.js"><link rel="prefetch" href="/assets/js/73.6bd6be40.js"><link rel="prefetch" href="/assets/js/74.d81dedf2.js"><link rel="prefetch" href="/assets/js/75.757237b7.js"><link rel="prefetch" href="/assets/js/76.f5792d24.js"><link rel="prefetch" href="/assets/js/77.d8aadd25.js"><link rel="prefetch" href="/assets/js/78.e4843ab3.js"><link rel="prefetch" href="/assets/js/79.a1f0575e.js"><link rel="prefetch" href="/assets/js/8.f3b4934d.js"><link rel="prefetch" href="/assets/js/80.ea9aa602.js"><link rel="prefetch" href="/assets/js/81.2cd439e3.js"><link rel="prefetch" href="/assets/js/82.9af7b0cb.js"><link rel="prefetch" href="/assets/js/83.77ac7dfb.js"><link rel="prefetch" href="/assets/js/84.17214734.js"><link rel="prefetch" href="/assets/js/85.0775f854.js"><link rel="prefetch" href="/assets/js/86.569d43a8.js"><link rel="prefetch" href="/assets/js/87.74196356.js"><link rel="prefetch" href="/assets/js/88.fa5aad52.js"><link rel="prefetch" href="/assets/js/89.11b2daa6.js"><link rel="prefetch" href="/assets/js/9.4d480772.js"><link rel="prefetch" href="/assets/js/90.3140661f.js"><link rel="prefetch" href="/assets/js/91.3d978faa.js"><link rel="prefetch" href="/assets/js/92.41c51097.js"><link rel="prefetch" href="/assets/js/93.70f92b88.js"><link rel="prefetch" href="/assets/js/94.7d09f78c.js"><link rel="prefetch" href="/assets/js/95.d7859f94.js"><link rel="prefetch" href="/assets/js/96.104638ee.js"><link rel="prefetch" href="/assets/js/97.fa2e330a.js"><link rel="prefetch" href="/assets/js/98.e49c1821.js"><link rel="prefetch" href="/assets/js/99.c5e10809.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0c241f14.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">睿晨网</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/aboutless.html" class="nav-link">
  第一期企业网页开发
</a></div><div class="nav-item"><a href="/secondless/" class="nav-link">
  第二期企业网站开发
</a></div><div class="nav-item"><a href="/thirdless/" class="nav-link">
  第三期移动端(H5/小程序/App)课程
</a></div><div class="nav-item"><a href="/fourthless/" class="nav-link router-link-active">
  第四期web全栈课程
</a></div><div class="nav-item"><a href="/fiveless/" class="nav-link">
  第五期python课程
</a></div><div class="nav-item"><a href="/web/software/" class="nav-link">
  课程软件小案例
</a></div><div class="nav-item"><a href="/web/mysql/" class="nav-link">
  课程案例数据表
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程答疑汇总" class="dropdown-title"><span class="title">课程答疑</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程答疑汇总" class="mobile-dropdown-title"><span class="title">课程答疑</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/answer/课程常见问题.html" class="nav-link">
  课程常见问题
</a></li><li class="dropdown-item"><!----> <a href="/deploy/" class="nav-link">
  项目部署
</a></li><li class="dropdown-item"><!----> <a href="/web/answer/免费部署SSL证书.html" class="nav-link">
  免费部署SSL证书
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程学习网站" class="dropdown-title"><span class="title">课程学习网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程学习网站" class="mobile-dropdown-title"><span class="title">课程学习网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          视频学习网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://study.163.com/provider/480000002289674/index.htm?share=2&amp;shareId=480000002289674" target="_blank" rel="noopener noreferrer" class="nav-link external">
  网易云课堂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://space.bilibili.com/3493114067028034/pugv" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用菜单" class="dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="实用菜单" class="mobile-dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实用方法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/定位相关.html" class="nav-link">
  定位相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/地图相关.html" class="nav-link">
  地图相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/树形结构数据转换.html" class="nav-link">
  树形结构数据转换
</a></li></ul></li><li class="dropdown-item"><h4>
          uni-app专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/uni-app专栏.html" class="nav-link">
  uni-app的UI框架
</a></li><li class="dropdown-subitem"><a href="/web/methods/uni-app如何引入库.html" class="nav-link">
  uni-app如何引入js库
</a></li></ul></li><li class="dropdown-item"><h4>
          Egg.js专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js.html" class="nav-link">
  Egg.js基础
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js基础总结.html" class="nav-link">
  Egg.js基础总结
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js重要知识详细文档.html" class="nav-link">
  Egg.js重要知识详细文档
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/ValParams API 说明.html" class="nav-link">
  Egg.js参数验证说明
</a></li><li class="dropdown-subitem"><a href="/web/mysql/Sequelize数据类型.html" class="nav-link">
  Egg.js迁移文件Sequelize数据类型
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js接口安全防护方案.html" class="nav-link">
  Egg.js接口安全防护方案
</a></li><li class="dropdown-subitem"><a href="/web/answer/课程常见问题.html#_3-eggjs如何重置数据表-保证id每次从1开始计算" class="nav-link">
  Egg.js重置数据表每次ID为1
</a></li></ul></li><li class="dropdown-item"><h4>
          实用网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/实用接口.html" class="nav-link">
  实用接口
</a></li><li class="dropdown-subitem"><a href="/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/web/vue.js/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/web/Vue3+ElementPlus/" class="nav-link">
  Vue3+ElementPlus系统
</a></li><li class="dropdown-subitem"><a href="/web/echarts/" class="nav-link">
  echarts图表
</a></li><li class="dropdown-subitem"><a href="/web/bootstrap/" class="nav-link">
  Bootstrap
</a></li><li class="dropdown-subitem"><a href="/web/IIS/" class="nav-link">
  IIS
</a></li><li class="dropdown-subitem"><a href="/web/github/" class="nav-link">
  Github
</a></li><li class="dropdown-subitem"><a href="/web/Vanta.js/" class="nav-link">
  Vanta.js网页3D背景
</a></li><li class="dropdown-subitem"><a href="/web/shop/" class="nav-link">
  商城系统推荐
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/aboutless.html" class="nav-link">
  第一期企业网页开发
</a></div><div class="nav-item"><a href="/secondless/" class="nav-link">
  第二期企业网站开发
</a></div><div class="nav-item"><a href="/thirdless/" class="nav-link">
  第三期移动端(H5/小程序/App)课程
</a></div><div class="nav-item"><a href="/fourthless/" class="nav-link router-link-active">
  第四期web全栈课程
</a></div><div class="nav-item"><a href="/fiveless/" class="nav-link">
  第五期python课程
</a></div><div class="nav-item"><a href="/web/software/" class="nav-link">
  课程软件小案例
</a></div><div class="nav-item"><a href="/web/mysql/" class="nav-link">
  课程案例数据表
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程答疑汇总" class="dropdown-title"><span class="title">课程答疑</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程答疑汇总" class="mobile-dropdown-title"><span class="title">课程答疑</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/answer/课程常见问题.html" class="nav-link">
  课程常见问题
</a></li><li class="dropdown-item"><!----> <a href="/deploy/" class="nav-link">
  项目部署
</a></li><li class="dropdown-item"><!----> <a href="/web/answer/免费部署SSL证书.html" class="nav-link">
  免费部署SSL证书
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程学习网站" class="dropdown-title"><span class="title">课程学习网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程学习网站" class="mobile-dropdown-title"><span class="title">课程学习网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          视频学习网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://study.163.com/provider/480000002289674/index.htm?share=2&amp;shareId=480000002289674" target="_blank" rel="noopener noreferrer" class="nav-link external">
  网易云课堂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://space.bilibili.com/3493114067028034/pugv" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用菜单" class="dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="实用菜单" class="mobile-dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实用方法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/定位相关.html" class="nav-link">
  定位相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/地图相关.html" class="nav-link">
  地图相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/树形结构数据转换.html" class="nav-link">
  树形结构数据转换
</a></li></ul></li><li class="dropdown-item"><h4>
          uni-app专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/uni-app专栏.html" class="nav-link">
  uni-app的UI框架
</a></li><li class="dropdown-subitem"><a href="/web/methods/uni-app如何引入库.html" class="nav-link">
  uni-app如何引入js库
</a></li></ul></li><li class="dropdown-item"><h4>
          Egg.js专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js.html" class="nav-link">
  Egg.js基础
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js基础总结.html" class="nav-link">
  Egg.js基础总结
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js重要知识详细文档.html" class="nav-link">
  Egg.js重要知识详细文档
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/ValParams API 说明.html" class="nav-link">
  Egg.js参数验证说明
</a></li><li class="dropdown-subitem"><a href="/web/mysql/Sequelize数据类型.html" class="nav-link">
  Egg.js迁移文件Sequelize数据类型
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js接口安全防护方案.html" class="nav-link">
  Egg.js接口安全防护方案
</a></li><li class="dropdown-subitem"><a href="/web/answer/课程常见问题.html#_3-eggjs如何重置数据表-保证id每次从1开始计算" class="nav-link">
  Egg.js重置数据表每次ID为1
</a></li></ul></li><li class="dropdown-item"><h4>
          实用网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/实用接口.html" class="nav-link">
  实用接口
</a></li><li class="dropdown-subitem"><a href="/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/web/vue.js/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/web/Vue3+ElementPlus/" class="nav-link">
  Vue3+ElementPlus系统
</a></li><li class="dropdown-subitem"><a href="/web/echarts/" class="nav-link">
  echarts图表
</a></li><li class="dropdown-subitem"><a href="/web/bootstrap/" class="nav-link">
  Bootstrap
</a></li><li class="dropdown-subitem"><a href="/web/IIS/" class="nav-link">
  IIS
</a></li><li class="dropdown-subitem"><a href="/web/github/" class="nav-link">
  Github
</a></li><li class="dropdown-subitem"><a href="/web/Vanta.js/" class="nav-link">
  Vanta.js网页3D背景
</a></li><li class="dropdown-subitem"><a href="/web/shop/" class="nav-link">
  商城系统推荐
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>eggjs后台超级管理员自定义表单新增修改（以网站配置为例）</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/fourthless/w-a/eggjs.%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%95.html#一、模版" class="sidebar-link">一、模版</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fourthless/w-a/eggjs.%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%95.html#_1-form-html模版" class="sidebar-link">1. _form.html模版</a></li><li class="sidebar-sub-header"><a href="/fourthless/w-a/eggjs.%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%95.html#_2-table-html模版" class="sidebar-link">2. _table.html模版</a></li><li class="sidebar-sub-header"><a href="/fourthless/w-a/eggjs.%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%95.html#_3-新增-diyform-html模版" class="sidebar-link">3. 新增 _diyform.html模版</a></li></ul></li><li><a href="/fourthless/w-a/eggjs.%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%95.html#二、路由" class="sidebar-link">二、路由</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/fourthless/w-a/eggjs.%E8%B6%85%E7%BA%A7%E7%AE%A1%E7%90%86%E5%91%98%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%8D%95.html#三、控制器" class="sidebar-link">三、控制器</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、模版"><a href="#一、模版" class="header-anchor">#</a> 一、模版</h2> <h3 id="_1-form-html模版"><a href="#_1-form-html模版" class="header-anchor">#</a> 1. <code>_form.html</code>模版</h3> <p><code>app/view/admin/layout/_form.html</code></p> <div class="language-html extra-class"><pre class="language-html"><code>{# 定义一个可递归调用的子模板 #}
{% macro renderMenu(items,keyname,type) %}
{% for item in items %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token selector">margin-left:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>item.level * 20<span class="token punctuation">}</span><span class="token punctuation">}</span>px<span class="token punctuation">;</span>
<span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
    <span class="token special-attr"><span class="token attr-name">onmouseover</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'#000000'</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontWeight <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
    <span class="token special-attr"><span class="token attr-name">onmouseout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token string">'#002222'</span><span class="token punctuation">;</span><span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontWeight <span class="token operator">=</span> <span class="token string">'normal'</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
    <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdownItemClick('{{keyname}}','{{item.name}}','{{item.id}}')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {% if type == 'treeDataSelect' %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{keyname}}<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">margin-right</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
        <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.id}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>checkbox-{{keyname}}<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">@click.stop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>treeDataSelectClick('{{keyname}}','{{item.name}}','{{item.id}}','checkbox-{{keyname}}',$event)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {% endif %}
    {{item.name}}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
{# 检查是否存在子菜单项 #}
{% if item.children and item.children.length %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-submenu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {% call renderMenu(item.children,keyname,type) %}
    {# 这里通过调用macro自身实现了递归 #}
    {% endcall %}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
{% endif %}
{% endfor %}
{% endmacro %}

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card-body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mb-4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-light<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-default btn-sm<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript">history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span>
                <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>点击返回上一页<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fa fa-arrow-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> 返回上一页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        {% if form %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{form.action}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>post<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {% for item in form.fields %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-group row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-form-label col-md-2<span class="token punctuation">&quot;</span></span> 
                <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token selector">display:</span> <span class="token punctuation">{</span>% if item.hidekeyData %<span class="token punctuation">}</span><span class="token selector">none</span><span class="token punctuation">{</span>% else %<span class="token punctuation">}</span><span class="token selector">block</span><span class="token punctuation">{</span>% endif %<span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>{{item.label}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-md-10<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    {# 如果是文件类型 #}
                    {% if item.type == 'file' %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.name}}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uploadFile($event,'{{item.name}}')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.{{item.name}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.{{item.name}}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mt-2 p-1 rounded border avatar-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 

                    {# 获取字段值 #}
                    {# 可打印 {{form | dump}} #}
                    {% set fieldValue = form.data[item.name] | safe %}
                    {# 当字段值存在时显示图片 #}
                    {# {% if fieldValue and fieldValue.length &gt; 0 %}
                        {# 通过 split 切割判断文件后缀 #}
                        {# {% set fileExtension = fieldValue.split('.').pop() | lower %} #}
                        {# 如果是 excel 文件则使用固定地址 #}
                        {# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> 
                        <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{% if fileExtension == 'xlsx' %}/public/admin/assets/img/excel.png{% else %}{{ fieldValue }}{% endif %}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mt-2 p-1 rounded border avatar-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> #}
                    {# {% endif %} #} 
                    
                    {# 如果是文件上传到oss云存储里面 #}
                    {% elif item.type == 'fileoss' %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.name}}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>uploadFileoss($event,'{{item.name}}')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.{{item.name}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.{{item.name}}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mt-2 p-1 rounded border avatar-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span> 

                    {# 如果是下拉框类型 #}
                    {% elif item.type == 'dropdown' %}
                    {# {{ item.ortherdata | safe }} #}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown dropdown-maindiv<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ortherdata</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ item.ortherdata }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span>
                            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn dropdown-toggle dropdown-{{item.name}}<span class="token punctuation">&quot;</span></span>
                            <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdownData<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            {{item.placeholder if item.placeholder else '一级分类'}}
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-menu<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 400px<span class="token punctuation">;</span><span class="token property">overflow</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>请选择要放在哪个分类下<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-divider<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                            {# 使用定义好的子模板递归渲染菜单 #}
                            <span class="token comment">&lt;!-- 在上面的代码块之前或之外的合适位置，提前解析item.default为JSON对象 --&gt;</span>
                            {% set itemDefaultParsed = item.default | safe |
                            fromJson %}
                            {# {{item.callback | dump}} #}
                            {% call
                            renderMenu(itemDefaultParsed,item.name,item.type) %}
                            {% endcall %}
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                    {% elif item.type == 'btncheck' %}
                    {# 如果是按钮组选择类型 #}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn-group btn-group-{{item.name}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        {% set itemDefaultParsed = item.default | safe |
                        fromJson %}
                        {% for btn in itemDefaultParsed %}
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span>
                            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn {{'btn-success'  if btn.checked else 'btn-light'}}<span class="token punctuation">&quot;</span></span>
                            <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeBtnStatus('{{item.name}}','btn-group-{{item.name}}','{{btn.value}}','{{ loop.index }}')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{btn.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
                        {% endfor %}

                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                    {# 如果是文本域类型 #}
                    {% elif item.type == 'textarea' %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span> <span class="token attr-name">rows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>5<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.name}}<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.placeholder}}...<span class="token punctuation">&quot;</span></span>
                        <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.{{item.name}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
                    {# 如果是自定义类型组件 #}
                    {% elif item.type == 'diy' %}
                    {% if item.render %}
                    {{ item.render(item) | safe }}
                    {% endif %}
                    {# 如果是富文本编辑器 #}
                    {% elif item.type == 'editor' %}
                    {% include &quot;admin/layout/_editor.html&quot; %}
                    {# 如果循环遍历数组数据到表单 #}
                    {% elif item.type == 'for_form' %}
                    {# {{item.default}} #}
                    {% set forformParsed = item.default | safe | fromJson %}
                    {# {{ forformParsed | dump }} #}
                    {% if forformParsed.length == 0 %}
                        {% set ortherdataParsed = item.ortherdata | safe | fromJson %}
                        {# {{ ortherdataParsed | dump }} #}
                        {# 如果有html字段 #}
                        {% if ortherdataParsed.html %}
                            {{ ortherdataParsed.html | safe }}
                        {% endif %}
                    {% else %}
                        {% if item.id %}
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>param-groups<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                {% for dataItem in forformParsed %}
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>param-group<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ dataItem.id }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    {# 参数{{ loop.index }} #}
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mb-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ dataItem.title }} 参数设置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
                                    {% set params = dataItem.data %}
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                        {% for param in params %}
                                        {# param的值{{ param }} #}
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-lg-3 col-md-4 mb-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ param.name | trim }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ param.name | trim }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">inputId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.id}}<span class="token punctuation">&quot;</span></span>
                                                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span>
                                                    <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ param.value | trim }}<span class="token punctuation">&quot;</span></span>
                                                    <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入{{ param.name | trim }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                        {% endfor %}
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                {% if not loop.last %}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>{% endif %}
                                {% endfor %}
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                        {% else %}
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>param-groups<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                {% for dataItem in forformParsed %}
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>param-group<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ dataItem.id }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    {# 参数{{ loop.index }} #}
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h5</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mb-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ dataItem.name }} 参数设置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h5</span><span class="token punctuation">&gt;</span></span>
                                    {% set params = dataItem.default.split('，') %}
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                        {% for param in params %}
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-lg-3 col-md-4 mb-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-group<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                                {# {{ param | trim }}--{{ dataItem.id }}-{{ loop.index0 }} #}
                                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">data</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ param | trim }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ param | trim }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
                                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
                                                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span>
                                                    <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>请输入{{ param | trim }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                        {% endfor %}
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                                {% if not loop.last %}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">&gt;</span></span>{% endif %}
                                {% endfor %}
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                        {% endif %}
                    {% endif %}
                       
                    {# 商品sku动态表单 #}
                    {% elif item.type == 'for_form_goodsSku' %}
                    {% include &quot;admin/layout/_for_form_goodsSku.html&quot; %}

                    {# 自定义form表单 #}
                    {% elif item.type == 'diyform' %}
                    {% include &quot;admin/layout/_diyform.html&quot; %}

                    {# 如果是树形结构数据选择 #}
                    {% elif item.type == 'treeDataSelect' %}
                        {# 使用定义好的子模板递归渲染菜单 #}
                        <span class="token comment">&lt;!-- 在上面的代码块之前或之外的合适位置，提前解析item.default为JSON对象 --&gt;</span>
                        {% set itemDefaultParsed = item.default | safe | fromJson %}
                        {% call renderMenu(itemDefaultParsed,item.name,item.type) %}
                        {% endcall %}
                    {% else %}
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> 
                        <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token selector">display:</span> <span class="token punctuation">{</span>% if item.hidekeyData %<span class="token punctuation">}</span><span class="token selector">none</span><span class="token punctuation">{</span>% else %<span class="token punctuation">}</span><span class="token selector">block</span><span class="token punctuation">{</span>% endif %<span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
                        <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.type}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control<span class="token punctuation">&quot;</span></span>
                            <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.name}}<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">{%</span> <span class="token attr-name">if</span> <span class="token attr-name">item.disabled</span> <span class="token attr-name">%}disabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>disabled<span class="token punctuation">&quot;</span></span><span class="token attr-name">{%</span> <span class="token attr-name">else</span> <span class="token attr-name">%}{%</span> <span class="token attr-name">endif</span> <span class="token attr-name">%}</span>
                            <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.placeholder}}...<span class="token punctuation">&quot;</span></span>
                            <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form.{{item.name}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    {% endif %}
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            {% endfor %}

            {% if not form.hideSubmit %}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-right mt-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">@click.stop.prevent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>提 交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            {% endif %}
            
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
        {% endif %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    Vueapp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">el</span><span class="token operator">:</span><span class="token string">'#vueapp'</span><span class="token punctuation">,</span>
        <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token keyword">return</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">form</span><span class="token operator">:</span><span class="token punctuation">{</span>
                <span class="token punctuation">{</span><span class="token operator">%</span> <span class="token keyword">for</span> item <span class="token keyword">in</span> form<span class="token punctuation">.</span>fields <span class="token operator">%</span><span class="token punctuation">}</span>
                   <span class="token punctuation">{</span><span class="token punctuation">{</span>item<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">{{ (form.data[item.name]|safe) if form.data[item.name] else  item.default  }}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span><span class="token operator">%</span> endfor <span class="token operator">%</span><span class="token punctuation">}</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token literal-property property">uploadedFiles</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//存储每个item.name对应的已上传文件路径</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'form'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">,</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">.</span>status<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.form-group input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// console.log($(this).val());</span>
                <span class="token keyword">let</span> val <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datavalue'</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token function">getparaminfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.param-groups .param-group'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">let</span> arr_eve <span class="token operator">=</span> <span class="token punctuation">{</span>
                        <span class="token literal-property property">title</span><span class="token operator">:</span>  <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'h5'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 获取标题</span>
                        <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 获取参数</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> paramGroupId <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> formGroups <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.row'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.form-group'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    formGroups<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index1<span class="token punctuation">,</span>element1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        arr_eve<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>element1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'label'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span>element1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'datavalue'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">$</span><span class="token punctuation">(</span>element1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr_eve<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> arr<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// console.log('提交成功',this.form);</span>
                <span class="token comment">// console.log(JSON.parse(this.form.pid.replaceAll('&amp;quot;','&quot;')));</span>
                <span class="token comment">// console.log('下拉框第一项', JSON.parse(this.form.pid.replaceAll('&amp;quot;','&quot;'))[0]);</span>
                <span class="token comment">// console.log('按钮组第一项', JSON.parse(this.form.status.replaceAll('&amp;quot;','&quot;'))[0]);</span>
                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">{</span>
                   <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
                   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'value:'</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">==</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span>  <span class="token operator">&amp;&amp;</span> value<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'&amp;quot;'</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                      <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token string">'paraminfo'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getparaminfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">'&amp;quot;'</span><span class="token punctuation">,</span><span class="token string">'&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token comment">// goods_param表 paraminfo修改的时候单独处理</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>key <span class="token operator">==</span> <span class="token string">'paraminfo'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token comment">// 针对 for-form 类型 写入paraminfo数据</span>
                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'for-form 类型的paraminfo'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getparaminfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// 针对dropdown类型，写入paraminfo数据</span>
                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dropdown 类型的paraminfo'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getparaminfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getparaminfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//提交之前，针对商品多参数的处理，如 paraminfo的处理</span>
                <span class="token comment">// console.log(this.getparaminfo());;</span>
                <span class="token comment">// console.log('提交成功1',this.form);</span>
                <span class="token comment">// return;</span>
                $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> 
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;{{form.action}}?_csrf={{ctx.csrf|safe}}&quot;</span><span class="token punctuation">,</span>
                    <span class="token comment">// contentType:'application/x-www-form-urlencoded',</span>
                    <span class="token comment">// data: {</span>
                    <span class="token comment">//     username:123,</span>
                    <span class="token comment">//     sex:'女'</span>
                    <span class="token comment">// },</span>
                    <span class="token literal-property property">contentType</span><span class="token operator">:</span><span class="token string">'application/json;charset=UTF-8;'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> stutas<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token comment">// msg:response.data || &quot;{{'修改'  if id else '新建' }}成功&quot;,</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">&quot;{{'修改'  if id else '新建' }}成功&quot;</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'success'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">,</span>
                            <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token comment">// 查询当前网址是否有gourl参数</span>
                                <span class="token keyword">let</span> gourl <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">gourl=([^&amp;]*)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                gourl <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>gourl<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span>gourl <span class="token operator">&amp;&amp;</span> gourl<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token comment">// 跳转到gourl对应的页面</span>
                                    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> gourl<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>
                                    <span class="token comment">// 跳转到某个页面</span>
                                    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;{{successUrl}}&quot;</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span>e<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'danger'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">3000</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//如果是文件上传到本地服务器</span>
            <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>name<span class="token punctuation">,</span>callback<span class="token operator">=</span><span class="token keyword">null</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//    console.log('e:', e);</span>
            <span class="token comment">//    console.log('name:',name);</span>
               <span class="token keyword">let</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//    console.log(file);</span>
               <span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'file'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
               $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> 
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/uploadStreamSingleToServerDiy/adminImg?_csrf={{ctx.csrf|safe}}&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 告诉jQuery不要去处理发送的数据</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> formData<span class="token punctuation">,</span>
                    <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>   <span class="token comment">// 告诉jQuery不要去设置Content-Type请求头</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span>  <span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> stutas<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">;</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">&quot;上传图片成功&quot;</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'success'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">,</span>
                            <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 使用$set将上传成功的文件URL添加到uploadedFiles对象</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>uploadedFiles<span class="token punctuation">,</span>name<span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>callback <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                               <span class="token literal-property property">event</span><span class="token operator">:</span> e<span class="token punctuation">,</span>
                               <span class="token literal-property property">name</span><span class="token operator">:</span>name<span class="token punctuation">,</span>
                               <span class="token literal-property property">data</span><span class="token operator">:</span>response<span class="token punctuation">.</span>data
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span>e<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'danger'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">3000</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//如果是文件上传到oss云存储里面</span>
            <span class="token function">uploadFileoss</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>name<span class="token punctuation">,</span>callback<span class="token operator">=</span><span class="token keyword">null</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">//    console.log('e:', e);</span>
            <span class="token comment">//    console.log('name:',name);</span>
               <span class="token keyword">let</span> file <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//    console.log(file);</span>
               <span class="token keyword">let</span> formData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FormData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               formData<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">;</span>
               $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> 
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/shop/admin/image/uploadAliyun?_csrf={{ctx.csrf|safe}}&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">processData</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// 告诉jQuery不要去处理发送的数据</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span> formData<span class="token punctuation">,</span>
                    <span class="token literal-property property">contentType</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>   <span class="token comment">// 告诉jQuery不要去设置Content-Type请求头</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span>  <span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> stutas<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>url<span class="token punctuation">;</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">&quot;上传图片成功&quot;</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'success'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">,</span>
                            <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token comment">// 使用$set将上传成功的文件URL添加到uploadedFiles对象</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>uploadedFiles<span class="token punctuation">,</span>name<span class="token punctuation">,</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>callback <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                               <span class="token literal-property property">event</span><span class="token operator">:</span> e<span class="token punctuation">,</span>
                               <span class="token literal-property property">name</span><span class="token operator">:</span>name<span class="token punctuation">,</span>
                               <span class="token literal-property property">data</span><span class="token operator">:</span>response<span class="token punctuation">.</span>data
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span>e<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'danger'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">3000</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//下拉菜单选中项</span>
            <span class="token function">dropdownItemClick</span><span class="token punctuation">(</span><span class="token parameter">keyname<span class="token punctuation">,</span>name<span class="token punctuation">,</span>id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'keyname'</span><span class="token punctuation">,</span> keyname<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// $('#dropdownData').text(name);</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.dropdown-'</span> <span class="token operator">+</span> keyname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>keyname<span class="token punctuation">]</span> <span class="token operator">=</span> id<span class="token punctuation">;</span>
                <span class="token keyword">let</span> _vue_this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
                
                <span class="token comment">// 如果下拉框有额外值的情况，比如：app/controller/admin/goods.js中的selectGoodsParamBytree()方法</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.dropdown-maindiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'ortherdata'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.dropdown-maindiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.ortherdata'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//如果有额外值，根据情况读取这些额外值</span>
                    <span class="token keyword">let</span> ortherdata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.dropdown-maindiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'ortherdata'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'额外值'</span><span class="token punctuation">,</span>ortherdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> skus <span class="token operator">=</span> ortherdata<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token operator">=&gt;</span> v<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    skus <span class="token operator">=</span> skus<span class="token punctuation">.</span>skus<span class="token punctuation">;</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'skus'</span><span class="token punctuation">,</span>skus<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>skus<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                       <span class="token comment">// let evedata = [];</span>
                       <span class="token comment">// evedata.push(encodeURIComponent(JSON.stringify([{</span>
                       <span class="token comment">//    title: skus[i].name,</span>
                       <span class="token comment">//    data: skus[i].default,</span>
                       <span class="token comment">// }])));</span>
                       <span class="token keyword">let</span> evedata <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
                          <span class="token literal-property property">title</span><span class="token operator">:</span> skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>
                          <span class="token literal-property property">data</span><span class="token operator">:</span> skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>default<span class="token punctuation">,</span>
                          <span class="token literal-property property">id</span><span class="token operator">:</span>skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>
                       <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                       <span class="token keyword">let</span> _str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class=&quot;evedata&quot; 
                       evedata = &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>evedata<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;
                       style=&quot;margin-top:20px;font-size:12px;display:flex;&quot;&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                        _str <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                            &lt;div style=&quot;margin-right:10px;&quot;&gt;
                              &lt;input type=&quot;checkbox&quot; checked class=&quot;evedata-checkbox&quot; data-id=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; /&gt;
                            &lt;/div&gt;
                            &lt;div&gt;
                               &lt;div style=&quot;margin-bottom:10px;&quot;&gt;&lt;span&gt;规格名称&lt;/span&gt;：&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;&lt;/div&gt;
                               &lt;div&gt;&lt;span&gt;规格值&lt;/span&gt;：&lt;span&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>skus<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>default<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/span&gt;&lt;/div&gt;
                            &lt;/div&gt;
                        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                       _str <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                       str <span class="token operator">+=</span> _str<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    str <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;div class=&quot;ortherdata&quot;&gt;</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span> str <span class="token operator">+</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;/div&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.dropdown-maindiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//重新给表单字段赋值</span>
                    <span class="token function">getcheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.evedata-checkbox'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span>getcheck<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">function</span> <span class="token function">getcheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.dropdown-maindiv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.ortherdata'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'.evedata'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>ele</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                            <span class="token keyword">let</span> input <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">//如果input为选中状态</span>
                            <span class="token comment">// console.log('input的个数'+index+'的选中状态',input.prop('checked'));</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token keyword">let</span> evedata <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'evedata'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                evedata <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>evedata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token comment">// console.log('evedata',evedata[0]);</span>
                                arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>evedata<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token comment">// console.log('写进paraminfo的数据',arr);</span>
                            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                                <span class="token keyword">let</span> removeid <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data-id'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                arr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v<span class="token punctuation">,</span>i</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span>id <span class="token operator">==</span> removeid<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                        arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token comment">// console.log('移除之后写进paraminfo的数据',arr);</span>
                            <span class="token punctuation">}</span>
                            <span class="token comment">//最终写进paraminfo的数据</span>
                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'最终写进paraminfo的数据'</span><span class="token punctuation">,</span>arr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// 需要符合paraminfo的数据特性，在改造一下</span>
                            <span class="token keyword">let</span> newarr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token keyword">let</span> _string <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
                                <span class="token comment">// console.log('看一下data',typeof arr[i].data);</span>
                                <span class="token keyword">let</span> _data <span class="token operator">=</span> _string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[,，]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                                <span class="token comment">// console.log('看一下_data',_data);</span>
                                <span class="token keyword">let</span> _arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>_data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
                                       <span class="token literal-property property">name</span><span class="token operator">:</span>_data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span>
                                       <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                                    _arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                                <span class="token comment">// console.log('看一下_arr',_arr);</span>
                                <span class="token comment">// console.log('看一下其中的data',arr[i]['data']);</span>
                                <span class="token comment">// arr[i]['data'] = _arr;</span>
                                <span class="token keyword">let</span> _obj <span class="token operator">=</span> <span class="token punctuation">{</span>
                                    <span class="token literal-property property">title</span><span class="token operator">:</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>
                                    <span class="token literal-property property">data</span><span class="token operator">:</span>_arr<span class="token punctuation">,</span>
                                    <span class="token literal-property property">id</span><span class="token operator">:</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">,</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                                newarr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'看一下写入值'</span><span class="token punctuation">,</span>newarr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            _vue_this<span class="token punctuation">.</span>form<span class="token punctuation">[</span>keyname<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>newarr<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    
                    
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//按钮组选中项</span>
            <span class="token function">changeBtnStatus</span><span class="token punctuation">(</span><span class="token parameter">keyname<span class="token punctuation">,</span>classname<span class="token punctuation">,</span>btnValue<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>keyname<span class="token punctuation">,</span>classname<span class="token punctuation">,</span>btnValue<span class="token punctuation">,</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> classname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>index<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'btn-success'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'btn-success'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'btn-light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>keyname<span class="token punctuation">]</span> <span class="token operator">=</span> btnValue<span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//自定义的按钮组点击效果</span>
            <span class="token function">diyBtnGroup</span><span class="token punctuation">(</span><span class="token parameter">clickbtn_parentClassname<span class="token punctuation">,</span>classname<span class="token punctuation">,</span>index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
               <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> classname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.'</span> <span class="token operator">+</span> clickbtn_parentClassname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'btn-success'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'btn-success'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'btn-light'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">treeDataSelectClick</span><span class="token punctuation">(</span><span class="token parameter">keyname<span class="token punctuation">,</span>name<span class="token punctuation">,</span>id<span class="token punctuation">,</span>classname<span class="token punctuation">,</span>e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// console.log('keyname', keyname);</span>
                <span class="token comment">// console.log('name', name);</span>
                <span class="token comment">// console.log('id', id);</span>
                <span class="token comment">// console.log('classname', classname);</span>
                <span class="token comment">// console.log('事件对象', e);</span>

                <span class="token comment">// 选中上一级下一级所有都选中</span>
                <span class="token comment">// console.log('父级class', $(e.target).parent().parent().attr('class'));</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'dropdown-submenu'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                   <span class="token keyword">let</span> checkbox <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">':checked'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                       checkbox<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                       checkbox<span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span>
                   <span class="token comment">//设置自己</span>
                   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">':checked'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                     <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token comment">//每个级别下的所有多选框数量</span>
                    <span class="token keyword">let</span> all <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
                    <span class="token comment">//当前这个级别下面选了多少个框了</span>
                    <span class="token keyword">let</span> len <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]:checked'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">;</span>
                    <span class="token comment">// console.log('当前级别总共多少框',all);</span>
                    <span class="token comment">// console.log('当前级别选了多少框',len);</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>all <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//设置自己</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token string">':checked'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                        <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">//一个都没有选</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">$</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>

                <span class="token comment">//选取选中的值</span>
                <span class="token comment">// console.log('选取框的长度', $(`input[name=${keyname}]:checked`).length);</span>
                <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token comment">// $(`input[name=${keyname}]:checked`).each(function(index,element){</span>
                <span class="token comment">//      console.log($(element).attr('data'));</span>
                <span class="token comment">//      arr.push(parseInt($(element).attr('data')));</span>
                <span class="token comment">// });</span>
                <span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">input[name=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>keyname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                     <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// console.log('获取权限的id值集合数据',arr);</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写进数据库数据'</span><span class="token punctuation">,</span>arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>form<span class="token punctuation">[</span>keyname<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>


</code></pre></div><h3 id="_2-table-html模版"><a href="#_2-table-html模版" class="header-anchor">#</a> 2. <code>_table.html</code>模版</h3> <p><code>app/view/admin/layout/_table.html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card card-table<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {# 表格上面的按钮 #}
    {% if table.buttons %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {% for item in table.buttons %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{ item.url}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-outline-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.desc}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        {% endfor %}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    {% endif %}
    
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card-body<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>mb-4<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-light<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-default btn-sm<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript">history<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span>
                <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>点击返回上一页<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fa fa-arrow-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span> 返回上一页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        
        {% if table.tabs %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav nav-tabs nav-tabs-top<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            {# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-link <span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#top-tab1<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>全部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-link active<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#top-tab2<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>直播中<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-link<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#top-tab3<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>未开播<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-link<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#top-tab4<span class="token punctuation">&quot;</span></span>
                    <span class="token attr-name">data-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tab<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>已结束<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span> #}
            {% for item in table.tabs %}
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nav-link {{ 'active'  if item.active else '' }}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.url}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    {{item.name}}
                   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
            {% endfor %}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
        {% endif %}
        
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table-responsive<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table table-hover table-center mb-0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
                    {# 表头 #}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                        {# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>管理员账号<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>创建时间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-center<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>100<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>操作<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span> #}
                        {% for item in table.columns %}
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.class}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.width}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                        {% endfor %}

                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span><span class="token punctuation">&gt;</span></span>
                    {% for item in data %}
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                        {% for item2 in table.columns %}
                        {% if item2.key %}
                        {# 如果存在key，说明是渲染数据 #}    
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item2.class}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item2.width}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            
                            {# {{ item[item2.key] == '[object Object]' }} #}
                            {% if item[item2.key] == '[object Object]' %}
                               {% if item2.render %}
                               {{ item2.render(item) | safe }}
                               {% else %}
                               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">color</span><span class="token punctuation">:</span>#ff6600<span class="token punctuation">;</span><span class="token property">font-size</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>是对象数据，请新建一个render函数处理展示这些数据<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                               {% endif %}
                               
                            {% else %}

                                {% if item2.render %}
                                {{ item2.render(item) | safe }}
                                {% endif %}
                                
                                {% if not item2.hidekeyData %}
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>{{ item[item2.key] }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                                {% endif %}  

                            {% endif %}
                            
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                        {# 如果存在render，说明是函数 #}
                        {% elif item2.render %}
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item2.class}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item2.width}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item2.render(item) | safe }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                        {% elif item2.action %}
                        {# 如果存在action 说明是操作 #}   
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item2.class}}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item2.width}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>actions<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                {# 存在修改按钮 #}
                                {% if item2.action.edit %}
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item2.action.edit(item.id,item)}}<span class="token punctuation">&quot;</span></span> 
                                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm bg-success-light mr-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fe fe-pencil<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 修改
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>    
                                {% endif %}
                                {# 存在修改删除 #}
                                {# href=&quot;{{item2.action.delete(item.id)}}&quot;  #}
                                {% if item2.action.delete %}
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm bg-danger-light<span class="token punctuation">&quot;</span></span>
                                <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>del('{{item2.action.delete(item.id,item)}}')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fe fe-trash<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 删除
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                                {% endif %}
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                        {% else %}
                        {# 其他情况 #}    
                        {% endif %}
                           
                        {% endfor %}
                        {# <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table-avatar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar avatar-sm mr-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>
                                        <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>avatar-img rounded-circle<span class="token punctuation">&quot;</span></span>
                                        <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>{{item.avatar}}<span class="token punctuation">&quot;</span></span>
                                        <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>User Image<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.username }}
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span>管理员<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>{{ item.create_time }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>actions<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span>
                                    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm bg-success-light mr-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fe fe-pencil<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 修改
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-sm bg-danger-light<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fe fe-trash<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">&gt;</span></span> 删除
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span> #}
                        
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
                    {% endfor %}
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>card-footer d-flex justify-content-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
         {# 安全起见，egg.js官方默认将代码过滤成字符串，这里我们采用过滤器进行解码 #}
        {{ ctx.locals.pageHtml | safe }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    Vueapp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">el</span><span class="token operator">:</span><span class="token string">'#vueapp'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
            <span class="token function">modal</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span>content</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//调用弹出框</span>
                Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>confirm<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'提示'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span>content<span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span>url<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function">del</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">//调用弹出框</span>
                Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>confirm<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'确认删除'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">content</span><span class="token operator">:</span><span class="token string">'确定要删除吗？'</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span>url<span class="token punctuation">;</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'删除成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//弹出框数据</span>
            <span class="token function">openInfo</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span>title</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// console.log(url);</span>
                $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'get'</span><span class="token punctuation">,</span> 
                    <span class="token literal-property property">url</span><span class="token operator">:</span>url <span class="token operator">+</span> <span class="token string">&quot;?_csrf={{ctx.csrf|safe}}&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">contentType</span><span class="token operator">:</span><span class="token string">'application/json;charset=UTF-8;'</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> stutas<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>confirm<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">title</span><span class="token operator">:</span>title<span class="token punctuation">,</span>
                            <span class="token literal-property property">isconfirm</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
                            <span class="token comment">// ...response.data,</span>
                            <span class="token literal-property property">ths</span><span class="token operator">:</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>ths<span class="token punctuation">,</span>
                            <span class="token literal-property property">data</span><span class="token operator">:</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span>e<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'danger'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">3000</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Vueapp.$refs.confirm.show({</span>
                <span class="token comment">//     title:title,</span>
                <span class="token comment">//     isconfirm:false,</span>
                <span class="token comment">//     ths:[ //表头数据</span>
                <span class="token comment">//             {fieldname:'username', title:'用户名'},</span>
                <span class="token comment">//             {fieldname:'create_time',title:'观看时间'},</span>
                <span class="token comment">//     ],</span>
                <span class="token comment">//     data:[//数据</span>
                <span class="token comment">//         {username:'王菲',create_time:'2019-01-01'},</span>
                <span class="token comment">//         {username:'张杰',create_time:'2019-01-02'},</span>
                <span class="token comment">//     ],</span>
                <span class="token comment">// });    </span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//点击按钮组</span>
            <span class="token function">changeBtnStatus</span><span class="token punctuation">(</span><span class="token parameter">keyname<span class="token punctuation">,</span>classname<span class="token punctuation">,</span>btnValue<span class="token punctuation">,</span>index<span class="token punctuation">,</span>id<span class="token punctuation">,</span>keytable<span class="token punctuation">,</span>model</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token comment">// console.log(keyname,classname,btnValue,index,id,keytable,model);</span>
                <span class="token comment">// return;</span>
                $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span> 
                    <span class="token comment">// url: &quot;/admin/category/updateStatus?_csrf={{ctx.csrf|safe}}&quot;,</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/admin/commonUpdateById?_csrf={{ctx.csrf|safe}}&quot;</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">contentType</span><span class="token operator">:</span><span class="token string">'application/json;charset=UTF-8;'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                        <span class="token literal-property property">id</span><span class="token operator">:</span>id<span class="token punctuation">,</span>
                        <span class="token comment">// status:btnValue</span>
                        <span class="token literal-property property">keyname</span><span class="token operator">:</span>keyname<span class="token punctuation">,</span>
                        <span class="token literal-property property">keyvalue</span><span class="token operator">:</span>btnValue<span class="token punctuation">,</span>
                        <span class="token literal-property property">model</span><span class="token operator">:</span>model
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response<span class="token punctuation">,</span> stutas<span class="token punctuation">,</span> xhr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token string">&quot;修改成功&quot;</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'success'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">1000</span><span class="token punctuation">,</span>
                            <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                <span class="token comment">// 跳转到某个页面</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span>keytable<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'/admin/'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> keytable<span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                                    window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/admin/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>keytable<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/index</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                                
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
                        Vueapp<span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>toast<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                            <span class="token literal-property property">msg</span><span class="token operator">:</span>e<span class="token punctuation">.</span>responseJSON<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'danger'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">delay</span><span class="token operator">:</span><span class="token number">3000</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.btn-group'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index<span class="token punctuation">,</span>element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span>ele</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token comment">// console.log('每一个button的data', $(ele).attr('data'));</span>
                    <span class="token comment">// console.log('每一个button的value', $(ele).attr('value'));</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">$</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                        <span class="token function">$</span><span class="token punctuation">(</span>ele<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'btn-light'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'btn-success'</span><span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_3-新增-diyform-html模版"><a href="#_3-新增-diyform-html模版" class="header-anchor">#</a> 3. 新增 <code>_diyform.html</code>模版</h3> <p><code>app/view/admin/layout/_diyform.html</code></p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>diyform<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add-form<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>alert-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary mb-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>addFormField<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>加字段<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 初始字段模板 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>field-item row<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token property">margin</span><span class="token punctuation">:</span> 10px 0<span class="token punctuation">;</span> <span class="token property">gap</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span><span class="token property">margin-left</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span><span class="token property">margin-right</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>字段说明，如：地址<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control col-md-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>字段名称，如：address<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control  col-md-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">required</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-secondary dropdown-toggle type-selector<span class="token punctuation">&quot;</span></span> 
                            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> 
                            <span class="token attr-name">data-bs-toggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown<span class="token punctuation">&quot;</span></span>
                            <span class="token attr-name">data-field-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        选择组件类型
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-menu<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>文本框<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>number<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>数字文本框<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textarea<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>多行文本框<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btncheck<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>按钮组选择类型组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>下拉框类型组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上传服务器文件组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fileoss<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>上传阿里云文件组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>editor<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>富文本编辑器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>treeDataSelect<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>树形结构数据选择组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>dropdown-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">data-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>diy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>自定义类型组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>default<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>默认值<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control col-md-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>placeholder<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>提示语，如：请输入地址<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>form-control col-md-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-danger delete-btn <span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>删除<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-success mt-3<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submitForm<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>提交表单配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fieldList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.field-list'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> baseId <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化第一个字段</span>
    <span class="token function">initField</span><span class="token punctuation">(</span>fieldList<span class="token punctuation">.</span>children<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 添加新字段</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'addFormField'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> template <span class="token operator">=</span> fieldList<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.field-item'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> newField <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> fieldId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">field-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token operator">++</span>baseId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

        <span class="token comment">// 重置字段值</span>
        newField<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">input</span> <span class="token operator">=&gt;</span> input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> typeBtn <span class="token operator">=</span> newField<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.type-selector'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        typeBtn<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'选择组件类型'</span><span class="token punctuation">;</span>
        typeBtn<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>fieldType <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 设置唯一ID</span>
        <span class="token keyword">const</span> dropdown <span class="token operator">=</span> newField<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.dropdown-menu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        typeBtn<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fieldId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-btn</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        dropdown<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'aria-labelledby'</span><span class="token punctuation">,</span> typeBtn<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 插入到列表底部</span>
        fieldList<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newField<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initField</span><span class="token punctuation">(</span>newField<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 初始化单个字段</span>
    <span class="token keyword">function</span> <span class="token function">initField</span><span class="token punctuation">(</span><span class="token parameter">field</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> dropdown <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bootstrap<span class="token punctuation">.</span>Dropdown</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.type-selector'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 类型选择事件</span>
        field<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.dropdown-item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">const</span> type <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>type<span class="token punctuation">;</span>
                <span class="token keyword">const</span> btn <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.type-selector'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                btn<span class="token punctuation">.</span>textContent <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
                btn<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>fieldType <span class="token operator">=</span> type<span class="token punctuation">;</span>
                dropdown<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 删除事件</span>
        field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.delete-btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fieldList<span class="token punctuation">.</span>children<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                field<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">showAlert</span><span class="token punctuation">(</span><span class="token string">'至少保留一个字段'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 表单提交</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'submitForm'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> isValid <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.field-item'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">field<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> label <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;label&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> name <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;name&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> type <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.type-selector'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>fieldType<span class="token punctuation">;</span>

            <span class="token comment">// 验证必填项</span>
            field<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'.is-invalid'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=&gt;</span> el<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">'is-invalid'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>label<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;label&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'is-invalid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                isValid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;name&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'is-invalid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                isValid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.type-selector'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'is-invalid'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                isValid <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                label<span class="token punctuation">,</span>
                name<span class="token punctuation">,</span>
                type<span class="token punctuation">,</span>
                <span class="token keyword">default</span><span class="token operator">:</span> field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;default&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">placeholder</span><span class="token operator">:</span> field<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'[name=&quot;placeholder&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isValid<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">showAlert</span><span class="token punctuation">(</span><span class="token string">'请填写所有红色边框的必填字段'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'表单数据：'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 将结果转为JSON字符串</span>
            <span class="token keyword">const</span> jsonStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 对JSON字符串进行URI编码，确保Unicode字符正确处理</span>
            <span class="token keyword">const</span> uriEncoded <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 转换为Base64并进行URL安全处理</span>
            <span class="token keyword">const</span> base64 <span class="token operator">=</span> <span class="token function">btoa</span><span class="token punctuation">(</span>uriEncoded<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">=+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 跳转URL</span>
            window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">&quot;{{successUrl}}&quot;</span> <span class="token operator">+</span> <span class="token string">'?f='</span> <span class="token operator">+</span> base64<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">showAlert</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> alertDiv <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        alertDiv<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'alert alert-danger'</span><span class="token punctuation">;</span>
        alertDiv<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.alert-container'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>alertDiv<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            alertDiv<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.field-item</span> <span class="token punctuation">{</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> #f8f9fa<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.form-control</span> <span class="token punctuation">{</span>
    <span class="token property">min-width</span><span class="token punctuation">:</span> 180px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.is-invalid</span> <span class="token punctuation">{</span>
    <span class="token property">border-color</span><span class="token punctuation">:</span> #dc3545 <span class="token important">!important</span><span class="token punctuation">;</span>
    <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 0 0.2rem <span class="token function">rgba</span><span class="token punctuation">(</span>220<span class="token punctuation">,</span> 53<span class="token punctuation">,</span> 69<span class="token punctuation">,</span> 0.25<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.alert</span> <span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> fixed<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translateX</span><span class="token punctuation">(</span>-50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">z-index</span><span class="token punctuation">:</span> 1000<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.dropdown-menu a</span><span class="token punctuation">{</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 6px 10px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.dropdown-menu a:hover</span> <span class="token punctuation">{</span>
    <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> #dc3545 <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.add-form</span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.alert-container .alert</span><span class="token punctuation">{</span>
    <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 140px<span class="token punctuation">;</span>
    <span class="token property">top</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span>280px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="二、路由"><a href="#二、路由" class="header-anchor">#</a> 二、路由</h2> <p><code>app/router/admin/admin.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>
    <span class="token comment">//配置列表界面</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/config/index'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 修改配置</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/config/edit/:id'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>edit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 修改配置提交数据</span>
    router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/admin/config/update/:id'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>update<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建配置界面</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/config/create'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>create<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建配置数据</span>
    router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/admin/config/save'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//删除配置</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/config/delete/:id'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>delete<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//自定义创建配置</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/config/diycreateform'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>diycreateform<span class="token punctuation">)</span><span class="token punctuation">;</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/config/diycreate'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>diycreate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/admin/config/diysave'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>diysave<span class="token punctuation">)</span><span class="token punctuation">;</span>
    router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/admin/config/diyedit/:id'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>diyedit<span class="token punctuation">)</span><span class="token punctuation">;</span>
    router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/admin/config/diyupdate/:id'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>config<span class="token punctuation">.</span>diyupdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre></div><h2 id="三、控制器"><a href="#三、控制器" class="header-anchor">#</a> 三、控制器</h2> <p><code>app/controller/admin/config.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node:fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node:path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//留言写入json文件</span>
<span class="token keyword">let</span> paths <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'./data'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">file</span><span class="token operator">:</span> <span class="token string">'./data/siteConfig.json'</span>
    <span class="token comment">//   dir:'./Appdata',</span>
    <span class="token comment">//   file:'./Appdata/data.json'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> Controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controller<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ConfigController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
    <span class="token comment">//配置列表界面</span>
    <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getsiteConfigJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 超级管理员才能操作自定义配置</span>
            <span class="token comment">// console.log('管理员信息',ctx.session.auth);</span>
            <span class="token keyword">let</span> _buttons <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>super <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                _buttons <span class="token operator">=</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/admin/config/diycreateform'</span><span class="token punctuation">,</span><span class="token comment">//新增路径</span>
                        <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'自定义网站配置'</span><span class="token punctuation">,</span><span class="token comment">//新增 //按钮名称</span>
                        <span class="token comment">// icon: 'fa fa-plus fa-lg',//按钮图标</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//渲染公共模版</span>
            <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'网站配置列表'</span><span class="token punctuation">,</span><span class="token comment">//现在网页title,面包屑导航title,页面标题</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> data<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                <span class="token literal-property property">tempType</span><span class="token operator">:</span> <span class="token string">'table'</span><span class="token punctuation">,</span> <span class="token comment">//模板类型：table表格模板 ，form表单模板</span>
                <span class="token literal-property property">table</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token comment">//表格上方按钮,没有不要填buttons</span>
                    <span class="token literal-property property">buttons</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/admin/config/create'</span><span class="token punctuation">,</span><span class="token comment">//新增路径</span>
                            <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'新建网站配置'</span><span class="token punctuation">,</span><span class="token comment">//新增 //按钮名称</span>
                            <span class="token comment">// icon: 'fa fa-plus fa-lg',//按钮图标</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token operator">...</span>_buttons<span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token comment">//表头</span>
                    <span class="token literal-property property">columns</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token punctuation">{</span>
                            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'所属网站'</span><span class="token punctuation">,</span>
                            <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'sitename'</span><span class="token punctuation">,</span>
                            <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'text-center'</span><span class="token punctuation">,</span><span class="token comment">//可选</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'网站配置信息'</span><span class="token punctuation">,</span>
                            <span class="token comment">// key: 'category_id',</span>
                            <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'text-left'</span><span class="token punctuation">,</span><span class="token comment">//可选</span>
                            <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token keyword">let</span> weixinImg <span class="token operator">=</span> item<span class="token punctuation">.</span>weixinImg <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                                <span class="token keyword">if</span><span class="token punctuation">(</span>weixinImg<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                    <span class="token keyword">if</span> <span class="token punctuation">(</span>weixinImg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.jpg'</span><span class="token punctuation">)</span> <span class="token operator">||</span> weixinImg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.jpeg'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                                        weixinImg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.png'</span><span class="token punctuation">)</span> <span class="token operator">||</span> weixinImg<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.gif'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token comment">// &lt;li&gt;微信二维码：${item.weixinImg}&lt;/li&gt;</span>
                                        weixinImg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;li&gt;微信二维码：&lt;img src=&quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weixinImg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; style=&quot;width: 100px; height: 100px;&quot; /&gt;&lt;/li&gt;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                               &lt;h5&gt;公司基本信息&lt;/h5&gt;
                               &lt;ul&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>corporate_name <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;公司名称：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>corporate_name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>corporate_short <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;名称简写：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>corporate_short<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>address <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;地址：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>tel <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;免费咨询电话：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>tel<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>mobile <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;手机号：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>mobile<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>serviceUser <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;联系人：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>serviceUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span><span class="token constant">QQ</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;企业QQ：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span><span class="token constant">QQ</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>weixin <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;联系微信号：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>weixin<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>weixinImg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
                                &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>email <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;联系邮箱：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>email<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                               &lt;/ul&gt;
                               &lt;h5&gt;seo信息&lt;/h5&gt;
                                &lt;ul&gt;
                                    &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>pagetitle <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;网站主页标题：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>pagetitle<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                    &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>description <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;网页描述：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>description<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                    &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>keywords <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;搜素关键字：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>keywords<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;/ul&gt;
                                &lt;h5&gt;其它信息&lt;/h5&gt;
                                &lt;ul&gt;
                                    &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>domain <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;官方网址：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>domain<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                    &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>copyright <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;版权信息：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>copyright<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                    &lt;li style=&quot;display:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>icpNumber <span class="token operator">?</span> <span class="token string">''</span> <span class="token operator">:</span> <span class="token string">'none'</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;&gt;ICP 备案：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>item<span class="token punctuation">.</span>icpNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/li&gt;
                                &lt;/ul&gt;
                            </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                        <span class="token punctuation">{</span>
                            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'操作'</span><span class="token punctuation">,</span>
                            <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'text-right'</span><span class="token punctuation">,</span><span class="token comment">//可选</span>
                            <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                                <span class="token comment">//修改</span>
                                <span class="token function-variable function">edit</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
                                    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">{</span>
                                        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/admin/config/diyedit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">//自定义修改界面</span>
                                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                                        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/admin/config/edit/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">//一般修改界面</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token comment">//删除</span>
                                <span class="token function-variable function">delete</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span>item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/admin/config/delete/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取配置数据</span>
    <span class="token keyword">async</span> <span class="token function">getsiteConfigJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">//先判断是否存在这个json文件或者文件夹</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/admin/config/create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// console.log(__dirname);//D:\【第二学期第3季】课程代码\myegg\app\controller</span>
            <span class="token comment">//D:\【第二学期第3季】课程代码\myegg\data\message.json</span>
            <span class="token comment">// console.log(path.resolve(__dirname,'../../','data/message.json'));</span>
            <span class="token comment">// let data = fs.readFileSync(path.resolve(__dirname, '../../../', 'data/siteConfig.json'), {</span>
            <span class="token comment">//     encoding: 'utf-8'</span>
            <span class="token comment">// });</span>
            <span class="token comment">// let data = fs.readFileSync('./data/siteConfig.json',{</span>
            <span class="token comment">//     encoding: 'utf-8'</span>
            <span class="token comment">// });</span>
            <span class="token keyword">let</span> data <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">'utf-8'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 修改配置</span>
    <span class="token keyword">async</span> <span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>

        <span class="token comment">//看一下有没有网站</span>
        <span class="token keyword">let</span> rolecategory <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Rolecategory<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ctx.body = rolecategory; return;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
           ctx<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'请先创建一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/admin/rolecategory/create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 为哪个网站创建配置</span>
        <span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> sitename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            rolecategory <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 给rolecategory数组里面每个对象加上一个pid属性值为0</span>
            rolecategory<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rolecategory <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">treeify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ctx.body = rolecategory; return;</span>
            sitename <span class="token operator">=</span> rolecategory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            fields <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网站名称'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sitename'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> sitename<span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请输入网站名称',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// 如果一旦填写了网站，则就应该有选择网站这里栏目提示要选择网站</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'选择网站提示'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'select_rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请选择网站',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'放在哪个网站里面'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'dropdown'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">placeholder</span><span class="token operator">:</span> sitename<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span>

        <span class="token keyword">const</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getsiteConfigJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'即将修改渲染的内容'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//渲染公共模版</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            id<span class="token punctuation">,</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">修改</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sitename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">网站配置</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token comment">//现在网页title,面包屑导航title,页面标题</span>
            <span class="token literal-property property">tempType</span><span class="token operator">:</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token comment">//模板类型：table表格模板 ，form表单模板</span>
            <span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">//修改配置提交地址</span>
                <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'/admin/config/update/'</span> <span class="token operator">+</span> id<span class="token punctuation">,</span>
                <span class="token comment">//  字段</span>
                <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token operator">...</span>fields<span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'公司名称'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'corporate_name'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入公司名称'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'名称简写'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'corporate_short'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入名称简写'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'地址'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'address'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入公司地址'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'免费咨询电话'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tel'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入免费咨询电话'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'mobile'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入手机号'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'联系人'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'serviceUser'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入联系人'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'企业QQ'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入企业QQ'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'联系微信号'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'weixin'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入联系微信号'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'微信二维码'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'weixinImg'</span><span class="token punctuation">,</span>
                        <span class="token comment">//placeholder: '',</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'联系邮箱'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入联系邮箱'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网站主页标题'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'pagetitle'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'网站主页标题'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网页描述'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textarea'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'description'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入网页描述'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'搜素关键字'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'keywords'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入搜素关键字，逗号隔开'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'官方网址'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'domain'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入官方网址'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'版权信息'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'copyright'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入版权信息'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'ICP 备案'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'icpNumber'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入ICP 备案号'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'cnzz统计代码'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textarea'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'cnzz'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入cnzz统计代码'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token comment">//修改内容默认值</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> data<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//修改成功之后跳转到哪个页面</span>
            <span class="token literal-property property">successUrl</span><span class="token operator">:</span> <span class="token string">'/admin/config/index'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//修改配置提交数据到json</span>
    <span class="token keyword">async</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">//1.参数验证</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'int'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'配置id'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">corporate_name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>  <span class="token comment">//参数类型</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否必须</span>
                <span class="token comment">// defValue: '', </span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'公司名称'</span> <span class="token comment">//字段含义</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">corporate_short</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'名称简写'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'地址'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">tel</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'免费咨询电话'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">mobile</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'手机号'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">serviceUser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'联系人'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token constant">QQ</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'企业QQ'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">weixin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'联系微信号'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">weixinImg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'微信二维码'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'联系邮箱'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">pagetitle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网站主页标题'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网页描述'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">keywords</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'搜素关键字'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'官方网址'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">copyright</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'版权信息'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">icpNumber</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'ICP 备案'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cnzz</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'cnzz统计代码'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">sitename</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网站名称'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">rolecategory_id</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'int'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网站id'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">select_rolecategory_id</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'int'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'要选择一个网站提示'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getsiteConfigJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'该数据不存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 有rolecategory_id</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> rolecategory_id<span class="token punctuation">,</span> select_rolecategory_id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>select_rolecategory_id <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rolecategory_id<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'请选择一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        

        <span class="token keyword">let</span> params <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        params<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改的数据'</span><span class="token punctuation">,</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'修改json文件的数组元素索引'</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'原json文件数据'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入json文件的最终所有数据'</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token comment">//创建配置界面</span>
    <span class="token keyword">async</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">//看一下有没有网站</span>
        <span class="token keyword">let</span> rolecategory <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Rolecategory<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ctx.body = rolecategory; return;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
           ctx<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'请先创建一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/admin/rolecategory/create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 为哪个网站创建配置</span>
        <span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> sitename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            rolecategory <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 给rolecategory数组里面每个对象加上一个pid属性值为0</span>
            rolecategory<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rolecategory <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">treeify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ctx.body = rolecategory; return;</span>
            sitename <span class="token operator">=</span> rolecategory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            fields <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网站名称'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sitename'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> sitename<span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请输入网站名称',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// 如果一旦填写了网站，则就应该有选择网站这里栏目提示要选择网站</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'选择网站提示'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'select_rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请选择网站',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'放在哪个网站里面'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'dropdown'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请选择网站'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//渲染公共模版</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">创建</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sitename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">网站配置界面</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token comment">//现在网页title,面包屑导航title,页面标题</span>
            <span class="token literal-property property">tempType</span><span class="token operator">:</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token comment">//模板类型：table表格模板 ，form表单模板</span>
            <span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">//提交地址</span>
                <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;/admin/config/save&quot;</span><span class="token punctuation">,</span>
                <span class="token comment">//  字段</span>
                <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token operator">...</span>fields<span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'公司名称'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'corporate_name'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入公司名称'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'名称简写'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'corporate_short'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入名称简写'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'地址'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'address'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入公司地址'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'免费咨询电话'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'tel'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入免费咨询电话'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'手机号'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'mobile'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入手机号'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'联系人'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'serviceUser'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入联系人'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'企业QQ'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'QQ'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入企业QQ'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'联系微信号'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'weixin'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入联系微信号'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'微信二维码'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'file'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'weixinImg'</span><span class="token punctuation">,</span>
                        <span class="token comment">//placeholder: '',</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'联系邮箱'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'email'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入联系邮箱'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网站主页标题'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'pagetitle'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'网站主页标题'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网页描述'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textarea'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'description'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入网页描述'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'搜素关键字'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'keywords'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入搜素关键字，逗号隔开'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'官方网址'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'domain'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入官方网址'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'版权信息'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'copyright'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入版权信息'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'ICP 备案'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'icpNumber'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入ICP 备案号'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'cnzz统计代码'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'textarea'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'cnzz'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请输入cnzz统计代码'</span><span class="token punctuation">,</span>
                        <span class="token comment">// default:'默认值测试', //新增时候默认值，可选</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//新增成功之后跳转到哪个页面</span>
            <span class="token literal-property property">successUrl</span><span class="token operator">:</span> <span class="token string">'/admin/config/index'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//创建配置提交数据</span>
    <span class="token keyword">async</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//1.参数验证</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">corporate_name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>  <span class="token comment">//参数类型</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否必须</span>
                <span class="token comment">// defValue: '', </span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'公司名称'</span> <span class="token comment">//字段含义</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">corporate_short</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'名称简写'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'地址'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">tel</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'免费咨询电话'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">mobile</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'手机号'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">serviceUser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'联系人'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token constant">QQ</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'企业QQ'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">weixin</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'联系微信号'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">weixinImg</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'微信二维码'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'联系邮箱'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">pagetitle</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网站主页标题'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网页描述'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">keywords</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'搜素关键字'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">domain</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'官方网址'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">copyright</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'版权信息'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">icpNumber</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'ICP 备案'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cnzz</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'cnzz统计代码'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">sitename</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网站名称'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">rolecategory_id</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'int'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'网站id'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">select_rolecategory_id</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'int'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                <span class="token literal-property property">defValue</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'要选择一个网站提示'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 有rolecategory_id</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> rolecategory_id<span class="token punctuation">,</span> select_rolecategory_id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>select_rolecategory_id <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rolecategory_id<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'请选择一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//写入数据</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addconfig</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> paths<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//配置写入json文件</span>
    <span class="token keyword">async</span> <span class="token function">addconfig</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> paths</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//创建一个文件夹data</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>dir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fs<span class="token punctuation">.</span><span class="token function">mkdirSync</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">//判断json文件是否存在，存在说明之前写入过了，先读一下</span>
        <span class="token keyword">let</span> flag <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//存在先读取一下</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">readconfig</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">//不存在，首次直接写</span>
            <span class="token keyword">let</span> ms <span class="token operator">=</span> data<span class="token punctuation">;</span>
            ms<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">//加入时间,所在地等等</span>
            <span class="token comment">// ms.timestamp = new Date().getTime();</span>
            <span class="token comment">// console.log(ms);</span>
            <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            o<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            o<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ms<span class="token punctuation">)</span><span class="token punctuation">;</span>
            o<span class="token punctuation">.</span>total <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            o<span class="token punctuation">.</span>currentId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log(o);</span>
            <span class="token comment">// console.log(JSON.stringify(o));</span>
            <span class="token comment">//写入内容,同步异步promise,以及可写流</span>
            <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">writeconfig</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//存在先读取一下</span>
    <span class="token keyword">async</span> <span class="token function">readconfig</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//读取内容,同步异步promise,以及可写流</span>
        fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token string">'r'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">encoding</span><span class="token operator">:</span> <span class="token string">'utf-8'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> oldmessage</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            oldmessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>oldmessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldmessage<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//处理数据</span>
            data<span class="token punctuation">.</span>id <span class="token operator">=</span> oldmessage<span class="token punctuation">.</span>currentId <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token comment">//加入时间,所在地等等</span>
            <span class="token comment">// data.timestamp = new Date().getTime();</span>
            <span class="token comment">//大对象</span>
            oldmessage<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
            oldmessage<span class="token punctuation">.</span>total <span class="token operator">=</span> oldmessage<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
            oldmessage<span class="token punctuation">.</span>currentId <span class="token operator">=</span> data<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oldmessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//写入内容,同步异步promise,以及可写流</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">writeconfig</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> oldmessage<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//写入配置</span>
    <span class="token keyword">async</span> <span class="token function">writeconfig</span><span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//删除配置</span>
    <span class="token keyword">async</span> <span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getsiteConfigJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'该数据不存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span>total <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">writeconfig</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//提示</span>
        ctx<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'删除配置成功'</span><span class="token punctuation">,</span> <span class="token string">'success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//跳转</span>
        ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/admin/config/index'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//自定义创建配置</span>
    <span class="token comment">// 自定义表单</span>
    <span class="token keyword">async</span> <span class="token function">diycreateform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log('管理员信息',ctx.session.auth);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>super <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'您没有权限操作此项内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'自定义创建网站配置'</span><span class="token punctuation">,</span><span class="token comment">//现在网页title,面包屑导航title,页面标题</span>
            <span class="token literal-property property">tempType</span><span class="token operator">:</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token comment">//模板类型：table表格模板 ，form表单模板,for_form循环模版</span>
            <span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">//提交地址</span>
                <span class="token comment">// action: &quot;/admin/config/diycreate&quot;,</span>
                <span class="token comment">//  字段</span>
                <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'自定义创建网站配置表单'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'diyform'</span><span class="token punctuation">,</span> <span class="token comment">//自定义form表单</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token comment">//隐藏提交按钮，用模版里面的提交按钮</span>
                <span class="token literal-property property">hideSubmit</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//新增成功之后跳转到哪个页面</span>
            <span class="token literal-property property">successUrl</span><span class="token operator">:</span> <span class="token string">&quot;/admin/config/diycreate&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 生成自定义表单页面</span>
    <span class="token keyword">async</span> <span class="token function">diycreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log('管理员信息',ctx.session.auth);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>super <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'您没有权限操作此项内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 前戏开始</span>
        <span class="token comment">//1.参数验证</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">validate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">f</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'string'</span><span class="token punctuation">,</span>  <span class="token comment">//参数类型</span>
                <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否必须</span>
                <span class="token comment">// defValue: '', </span>
                <span class="token literal-property property">desc</span><span class="token operator">:</span> <span class="token string">'表单参数'</span> <span class="token comment">//字段含义</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> f <span class="token punctuation">}</span> <span class="token operator">=</span> ctx<span class="token punctuation">.</span>query<span class="token punctuation">;</span>
        <span class="token comment">//解码f参数</span>
        <span class="token keyword">let</span> _fields <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">decode_f</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ctx.body = _fields; return;</span>
        <span class="token comment">// 前戏结束</span>

        <span class="token comment">// 具体业务处理开始</span>
        <span class="token comment">//看一下有没有网站</span>
        <span class="token keyword">let</span> rolecategory <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Rolecategory<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ctx.body = rolecategory; return;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
           ctx<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'请先创建一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/admin/rolecategory/create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 为哪个网站创建配置</span>
        <span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> sitename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            rolecategory <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 给rolecategory数组里面每个对象加上一个pid属性值为0</span>
            rolecategory<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rolecategory <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">treeify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ctx.body = rolecategory; return;</span>
            sitename <span class="token operator">=</span> rolecategory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            fields <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网站名称'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sitename'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> sitename<span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请输入网站名称',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// 如果一旦填写了网站，则就应该有选择网站这里栏目提示要选择网站</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'选择网站提示'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'select_rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请选择网站',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'放在哪个网站里面'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'dropdown'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token string">'请选择网站'</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 具体业务处理结束</span>

        <span class="token comment">//渲染</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">创建</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sitename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">网站配置界面</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token comment">//现在网页title,面包屑导航title,页面标题</span>
            <span class="token literal-property property">tempType</span><span class="token operator">:</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token comment">//模板类型：table表格模板 ，form表单模板,for_form循环模版</span>
            <span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">//提交地址</span>
                <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">&quot;/admin/config/diysave&quot;</span><span class="token punctuation">,</span>
                <span class="token comment">//  字段</span>
                <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token operator">...</span>fields<span class="token punctuation">,</span>
                    <span class="token operator">...</span>_fields<span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                        <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'自定义所有表单字段'</span><span class="token punctuation">,</span>
                        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'f'</span><span class="token punctuation">,</span>
                        <span class="token keyword">default</span><span class="token operator">:</span> f<span class="token punctuation">,</span> <span class="token comment">// 用于自定义修改用，必传过去</span>
                        <span class="token comment">// placeholder: '',</span>
                        <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token comment">//隐藏提交按钮，用模版里面的提交按钮</span>
                <span class="token comment">// hideSubmit:true,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//新增成功之后跳转到哪个页面</span>
            <span class="token literal-property property">successUrl</span><span class="token operator">:</span> <span class="token string">&quot;/admin/config/index&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//生成自定义表单提交数据</span>
    <span class="token keyword">async</span> <span class="token function">diysave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log('管理员信息',ctx.session.auth);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>super <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'您没有权限操作此项内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//具体业务</span>
        <span class="token comment">// 有rolecategory_id</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> rolecategory_id<span class="token punctuation">,</span> select_rolecategory_id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>select_rolecategory_id <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rolecategory_id<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'请选择一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//写入数据</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token comment">//写入json文件或者数据库</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入的数据'</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addconfig</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> paths<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token punctuation">}</span>

    <span class="token comment">// 解码f参数</span>
    <span class="token function">decode_f</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
       <span class="token keyword">let</span> _fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token comment">//解码参数</span>
       <span class="token keyword">const</span> base64Param <span class="token operator">=</span> f
       <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">-</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">)</span> <span class="token comment">// 将-换回+</span>
       <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">_</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将_换回/</span>

       <span class="token comment">// 补足Base64末尾的等号</span>
       <span class="token keyword">let</span> padded <span class="token operator">=</span> base64Param<span class="token punctuation">;</span>
       <span class="token keyword">while</span> <span class="token punctuation">(</span>padded<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">4</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           padded <span class="token operator">+=</span> <span class="token string">'='</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       <span class="token keyword">try</span> <span class="token punctuation">{</span>
           <span class="token comment">// 解码Base64得到URI编码的字符串</span>
           <span class="token keyword">const</span> uriEncoded <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>padded<span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// URI解码获取原始JSON字符串</span>
           <span class="token keyword">const</span> jsonStr <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>uriEncoded<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token comment">// 解析JSON</span>
           _fields <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> _fields<span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
           <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'无效的参数格式'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 自定义修改界面</span>
    <span class="token keyword">async</span> <span class="token function">diyedit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log('管理员信息',ctx.session.auth);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>super <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'您没有权限操作此项内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//一般业务处理开始</span>
        <span class="token comment">//看一下有没有网站</span>
        <span class="token keyword">let</span> rolecategory <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Rolecategory<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">where</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">1</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ctx.body = rolecategory; return;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
           ctx<span class="token punctuation">.</span><span class="token function">toast</span><span class="token punctuation">(</span><span class="token string">'请先创建一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/admin/rolecategory/create'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 为哪个网站创建配置</span>
        <span class="token keyword">let</span> fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">let</span> sitename <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            rolecategory <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 给rolecategory数组里面每个对象加上一个pid属性值为0</span>
            rolecategory<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                item<span class="token punctuation">.</span>pid <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            rolecategory <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">treeify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ctx.body = rolecategory; return;</span>
            sitename <span class="token operator">=</span> rolecategory<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
            fields <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'网站名称'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'sitename'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> sitename<span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请输入网站名称',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token comment">// 如果一旦填写了网站，则就应该有选择网站这里栏目提示要选择网站</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'选择网站提示'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'select_rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
                    <span class="token comment">// placeholder: '请选择网站',</span>
                    <span class="token literal-property property">hidekeyData</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//隐藏这一项，但是值会提交过去</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span>
                    <span class="token literal-property property">label</span><span class="token operator">:</span> <span class="token string">'放在哪个网站里面'</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'dropdown'</span><span class="token punctuation">,</span> <span class="token comment">//下拉框</span>
                    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'rolecategory_id'</span><span class="token punctuation">,</span>
                    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>rolecategory<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">placeholder</span><span class="token operator">:</span> sitename<span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span>
        <span class="token comment">//一般业务处理结束</span>

        <span class="token comment">//数据处理</span>
        <span class="token keyword">const</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getsiteConfigJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>data <span class="token operator">||</span> <span class="token operator">!</span>data<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'记录不存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ctx.body = data; return;</span>
        <span class="token keyword">let</span> _fields <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">decode_f</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            _fields <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">decode_f</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// ctx.body = _fields; return;</span>

        <span class="token comment">//渲染公共模版</span>
        <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">renderTemplate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            id<span class="token punctuation">,</span>
            <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">修改</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sitename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">网站配置</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><span class="token comment">//现在网页title,面包屑导航title,页面标题</span>
            <span class="token literal-property property">tempType</span><span class="token operator">:</span> <span class="token string">'form'</span><span class="token punctuation">,</span> <span class="token comment">//模板类型：table表格模板 ，form表单模板</span>
            <span class="token literal-property property">form</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">//修改配置提交地址</span>
                <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'/admin/config/diyupdate/'</span> <span class="token operator">+</span> id<span class="token punctuation">,</span>
                <span class="token comment">//  字段</span>
                <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token operator">...</span>fields<span class="token punctuation">,</span>
                    <span class="token operator">...</span>_fields<span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token comment">//修改内容默认值</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> data<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token comment">//修改成功之后跳转到哪个页面</span>
            <span class="token literal-property property">successUrl</span><span class="token operator">:</span> <span class="token string">'/admin/config/index'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 自定义修改提交数据</span>
    <span class="token keyword">async</span> <span class="token function">diyupdate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>  
        <span class="token comment">// console.log('管理员信息',ctx.session.auth);</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>auth<span class="token punctuation">.</span>super <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'您没有权限操作此项内容'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">//不用参数验证</span>
        <span class="token comment">//数据处理</span>
        <span class="token keyword">const</span> id <span class="token operator">=</span> ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getsiteConfigJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> _data <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>_data <span class="token operator">||</span> <span class="token operator">!</span>_data<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'记录不存在'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> index <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">findIndex</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>id <span class="token operator">==</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ctx.body = _data; return;</span>
        <span class="token comment">// let _fields = [];</span>
        <span class="token comment">// if(this.decode_f(_data.f)){</span>
        <span class="token comment">//     _fields = this.decode_f(_data.f);</span>
        <span class="token comment">// }</span>

        <span class="token comment">// 有rolecategory_id</span>
        <span class="token keyword">let</span> <span class="token punctuation">{</span> rolecategory_id<span class="token punctuation">,</span> select_rolecategory_id <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>select_rolecategory_id <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rolecategory_id<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">apiFail</span><span class="token punctuation">(</span><span class="token string">'请选择一个网站'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        

        <span class="token keyword">let</span> params <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
        params<span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
        params<span class="token punctuation">.</span>f <span class="token operator">=</span> _data<span class="token punctuation">.</span>f<span class="token punctuation">;</span>
        <span class="token comment">// console.log('修改的数据', params);</span>
        <span class="token comment">// console.log('修改json文件的数组元素索引', index);</span>
        <span class="token comment">// console.log('原json文件数据', data);</span>
        data<span class="token punctuation">.</span>data<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> params<span class="token punctuation">;</span>
        <span class="token comment">// console.log('写入json文件的最终所有数据', data);</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>paths<span class="token punctuation">.</span>file<span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ConfigController<span class="token punctuation">;</span>

</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2025年5月16日星期五晚上10点20分</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.4c1fa2f2.js" defer></script><script src="/assets/js/10.a1858127.js" defer></script><script src="/assets/js/2.641709ae.js" defer></script><script src="/assets/js/51.c48be90d.js" defer></script><script src="/assets/js/4.68f7b7e9.js" defer></script>
  </body>
</html>
