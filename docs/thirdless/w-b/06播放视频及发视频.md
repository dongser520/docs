---
navbar: true
sidebar: auto
title: ç« èŠ‚6.æ’­æ”¾è§†é¢‘åŠå‘è§†é¢‘
---

## ä¸€ã€æ¶ˆæ¯é¡µè§†é¢‘æ’­æ”¾å°é¢å¼€å‘
ç´ æå‡†å¤‡ï¼Œç»™å¤§å®¶æä¾›ä¸€ä¸‹è§†é¢‘ç´ æå’Œå°é¢ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥ç”¨è‡ªå·±çš„ç´ ææµ‹è¯•
1. è§†é¢‘ç´ æï¼š `https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4`
2. è§†é¢‘å°é¢ç´ æï¼š `https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg`

### 1. é¡µé¢è¡¥å……æ•°æ®
åœ¨é¡µé¢ `/pages/chat/chat.nvue`
```js
...
{
    avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
    nickname: 'å°äºŒå“¥',
    chat_time: 1750148999,
    data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg',
    otherData:{
        duration:'1:18', // æ—¶é•¿
        poster:"https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg",
        videoData:"https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4",
    },
    user_id: 2,
    type:'video', //image,video
    isremove:false,
},
```

### 2. ç»„ä»¶æ–°å¢è§†é¢‘æ’­æ”¾æƒ…å†µ
åœ¨ç»„ä»¶ `/components/chat-item/chat-item.vue`
```vue
<!-- æƒ…å†µ4: è§†é¢‘  -->
<view v-else-if="item.type == 'video'">
    <chat-item-video-poster :item="item" :index="index">
    </chat-item-video-poster>
</view>
```

### 3. æ–°å¢è§†é¢‘å°é¢ç»„ä»¶
æ–°å¢ `/components/chat-item-video-poster/chat-item-video-poster.vue`
```vue
<template>
	<view class="position-relative" @click="openVideoShow">
		<!-- è§†é¢‘å°é¢ -->
		<chat-item-image :item="item" :index="index"
		imageClass="rounded"
		:maxWidth="300" :maxHeight="400"></chat-item-image>
		<!-- è’™ç‰ˆ -->
		<view class="position-absolute left-0 right-0 top-0 bottom-0 rounded"
		style="z-index: 98;background-color: rgba(0, 0, 0, 0.4);"></view>
		<!-- æ—¶é•¿ -->
		<view class="position-absolute left-0 top-0 right-0 bottom-0 flex flex-row align-end justify-end mr-1 mb-1" style="z-index: 99;">
			<text class="font-sm text-white">{{item.otherData.duration}}</text>
		</view>
		<!-- æ’­æ”¾å›¾æ ‡ -->
		<view class="position-absolute left-0 top-0 right-0 bottom-0 flex flex-row align-center justify-center" style="z-index: 100;">
			<text class="iconfont text-white"
			:style="videoPlayIconStyle">&#xe710;</text>
		</view>
	</view>
</template>

<script>
	export default{
		name:"chat-item-video-poster",
		props:{
			item:Object,
			index:Number,
		},
		data(){
			return {
				// æ’­æ”¾å›¾ç‰‡å¤§å°é»˜è®¤70rpx
				videoPlayIcon:70,
			}
		},
		methods:{
			openVideoShow(){
				// æ‰“å¼€è§†é¢‘
				const videoUrl = this.item.otherData.videoData;
				const title = encodeURIComponent(this.item.otherData.title || 'è§†é¢‘');
				const poster = encodeURIComponent(this.item.otherData.poster || '');
				
				uni.navigateTo({
					url:`/pages/videoShow/videoShow?videoUrl=${videoUrl}&title=${title}&poster=${poster}`,
					animationType:'zoom-fade-out',
				})
			},
		},
		computed:{
			videoPlayIconStyle(){
				return `font-size: ${this.videoPlayIcon}rpx;`;
			}
		}
	}
</script>

<style>
	/* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>
```

## äºŒã€è§†é¢‘æ’­æ”¾é¡µå¼€å‘
### 1. æ–°å»ºé¡µé¢åŠé…ç½®
1. æ–°å»ºé¡µé¢  `/pages/videoShow/videoShow.nvue`
2. é…ç½®é¡µé¢ `pages.json`ä¸­
```json
{
	"path" : "pages/videoShow/videoShow",
	"style" : {
		"navigationBarTitleText":"è§†é¢‘æ’­æ”¾",
		"app-plus":{
			"scrollIndicator":"none",
			"titleNView":false
		},
		"navigationStyle":"custom"
	}
}
```

### 2. è¿›å…¥é¡µé¢ä¼ é€’å‚æ•°
ä»ç»„ä»¶ `/components/chat-item-video-poster/chat-item-video-poster.vue` è¿›å…¥
```js
    methods:{
		openVideoShow(){
			// æ‰“å¼€è§†é¢‘
			const videoUrl = this.item.otherData.videoData;
			const title = encodeURIComponent(this.item.otherData.title || 'è§†é¢‘');
			const poster = encodeURIComponent(this.item.otherData.poster || '');
			
			uni.navigateTo({
				url:`/pages/videoShow/videoShow?videoUrl=${videoUrl}&title=${title}&poster=${poster}`,
				animationType:'zoom-fade-out',
			})
		},
	},
```

### 3. é¡µé¢è§†é¢‘æ’­æ”¾
åœ¨é¡µé¢ `/pages/videoShow/videoShow.nvue`
ç”¨åˆ°uni-appæä¾›çš„`<video>`ç»„ä»¶ï¼š<https://uniapp.dcloud.net.cn/component/video.html>
```vue
<template>
	<view class="position-relative bg-dark">
		<video :src="video_url"  autoplay loop  :controls="true" 
		page-gesture show-progress
		enable-play-gesture  :http-cache="true" 
		:show-fullscreen-btn="false"
		x5-video-player-type='h5-page'
		:poster="posterUrl"
		style="width: 750rpx;" :style="'height:'+windowHeight+'px;'" 
		:direction="0" id="myVideo" :title="titleText"
		@ended="videoEnd" 
		@fullscreenchange="fullscreenchange"
		@fullscreenclick="fullscreenclick" 
		@controlstoggle="controlstoggle"
		@loadedmetadata="loadedmetadata">
		    <!-- #ifndef MP -->
		    <cover-view class="text-white position-absolute font-lg" 
			@click="navigateBack"
			style="left: 30rpx;bottom: 140rpx;">
			    <view style="background-color: rgba(255,255,220,0.2);
				height: 60rpx;border-radius: 35rpx;" 
				class="py-1 px-2 justify-center align-center flex flex-row">
					<u-icon name="close" size="18" color="#f9f9f9"></u-icon>
					<text class="font text-white ml-1">å…³é—­è§†é¢‘</text>
				</view>
			</cover-view>
			<!-- #endif -->
		</video>
		<!-- #ifdef MP -->
		<view class="position-absolute" @click="navigateBack"
		style="left: 30rpx;bottom: 140rpx;">
		    <view style="background-color: rgba(255,255,220,0.2);
			height: 60rpx;border-radius: 35rpx;"
		    class="py-1 px-2 justify-center align-center flex flex-row">
		        <u-icon name="close" size="18" color="#f9f9f9"></u-icon>
		    	<text class="font text-white ml-1">å…³é—­è§†é¢‘</text>
		    </view>
		</view>
		<!-- #endif -->
	</view>
</template>

<script>
	import toolJs from '@/common/mixins/tool.js'; 
	export default {
		mixins:[toolJs],
		data() {
			return {
				//é¿å…propså†²çª
				//uni-appä¼šè‡ªåŠ¨å°†URLå‚æ•°æ³¨å…¥ä¸ºé¡µé¢propsï¼Œä½¿ç”¨åŒåå˜é‡ä¼šå¯¼è‡´å†²çª
				//é€šè¿‡é‡å‘½åå˜é‡ï¼Œæ˜ç¡®åŒºåˆ†URLå‚æ•°å’Œæœ¬åœ°æ•°æ®
				//éµå¾ªVueæ•°æ®æµè§„èŒƒï¼š
				//ä¸ç›´æ¥ä¿®æ”¹propsï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å˜é‡å­˜å‚¨éœ€è¦ä¿®æ”¹çš„æ•°æ®
				//ä¿æŒå•å‘æ•°æ®æµï¼Œé¿å…ä¸å¯é¢„æµ‹çš„è¡Œä¸º
				windowHeight:500,
				// ä½¿ç”¨æœ¬åœ°å˜é‡å­˜å‚¨URLå‚æ•°
				//å°† videoUrl æ”¹ä¸º video_url
				//å°† title æ”¹ä¸º titleText
				//å°† poster æ”¹ä¸º posterUrl
				video_url: '',      // è§†é¢‘URL
				posterUrl: '',     // å°é¢URL
				titleText: '',     // æ ‡é¢˜æ–‡æœ¬
			}
		},
		onReady(){
			//åŠ¨æ€è·å–é«˜åº¦
			let res=uni.getSystemInfoSync()
			this.windowHeight=res.windowHeight;
		},
		onLoad(e) {
			//åœ¨ onLoad ä¸­å°†URLå‚æ•°èµ‹å€¼ç»™æœ¬åœ°å˜é‡ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å¯èƒ½ä½œä¸ºpropæ³¨å…¥çš„å˜é‡
			console.log('åˆ°äº†è§†é¢‘ç•Œé¢', e);
			if(!e.videoUrl || e.videoUrl === ''){
				this.navigateBack();
				return uni.showToast({
					title:'éæ³•è§†é¢‘',
					icon:'none'
				})
			}
			// å°†URLå‚æ•°èµ‹å€¼ç»™æœ¬åœ°å˜é‡
			this.video_url = e.videoUrl;
			
			if(e.title){
				this.titleText = decodeURIComponent(e.title);
				uni.setNavigationBarTitle({
					title:this.titleText,
				})
			}
			
			if(e.poster){
				this.posterUrl = decodeURIComponent(e.poster)
				console.log('å°é¢åœ°å€',this.posterUrl);
			}
		},
		methods: {
			videoEnd(){
				console.log('è§†é¢‘æ’­æ”¾å®Œäº†');
			},
			fullscreenchange(e){
				console.log('å½“è§†é¢‘è¿›å…¥å’Œé€€å‡ºå…¨å±æ—¶è§¦å‘',e);
			},
			fullscreenclick(e){
				console.log('è§†é¢‘æ’­æ”¾å…¨å±æ’­æ”¾æ—¶ç‚¹å‡»äº‹ä»¶',e);
			},
			controlstoggle(e){
				console.log('åˆ‡æ¢ controls æ˜¾ç¤ºéšè—æ—¶è§¦å‘',e.detail);
			},
			loadedmetadata(e){
				console.log('è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆæ—¶è§¦å‘',e.detail);
			}
		}
	}
</script>

<style>
	/* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>
```

## ä¸‰ã€ç›¸å†Œé€‰æ‹©è§†é¢‘å‘é€
### 1. èŠå¤©é¡µåŠ å·èœå•åŠŸèƒ½æ•°æ®è°ƒæ•´å’Œä»£ç åˆ†ç¦»
æˆ‘ä»¬çš„`chat.nvue`é¡µé¢ä»£ç å¤ªå¤šäº†ï¼Œå¯ä»¥é‡‡ç”¨mixinsæ–¹æ³•å°†é¡µé¢ä»£ç åˆ†ç¦»ä¸€éƒ¨åˆ†å¤„ç†
1. æ–°å»ºjsæ–‡ä»¶  `/pages/chat/plusIconAction.js`
```js
import UniPermission from '@/common/mixins/uni_permission.js';

// H5ç«¯è·å–è§†é¢‘å°é¢:videoPath æ˜¯è§†é¢‘åœ°å€
function getH5VideoThumbnail(videoPath) {
    return new Promise((resolve) => {
        // H5ç«¯ç›´æ¥ä½¿ç”¨è§†é¢‘è·¯å¾„åˆ›å»ºvideoå…ƒç´ 
        const video = document.createElement('video');
        video.src = videoPath;
        video.crossOrigin = 'anonymous';
        video.addEventListener('loadeddata', function() {
            video.currentTime = 0.1; // è®¾ç½®åˆ°0.1ç§’è·å–å°é¢
            
            video.addEventListener('seeked', function() {
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // è·å–å°é¢å›¾
                const thumbnail = canvas.toDataURL('image/jpeg');
                resolve(thumbnail);
            });
        });
    });
}



export default{
	data(){
		return {
			videoPlaceHolderPoster:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/video_placeholder.jpg',
			recorderIcon:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/audio-icon/recorder.gif',
			iconMenus:[
				{ name:"å¾®ç¬‘", icon:"/static/tabbar/index.png",
				iconType:"image", eventType:"smile" },
				{ name:"å˜¿å˜¿", icon:"ğŸ˜€",
				iconType:"emoji", eventType:"heihei" },
				{ name: "å—¯ï¼Œå“¼", icon: "https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/iconMenus/en.gif", iconType: "image", eventType: "enheng" },
				{ name:"å˜»å˜»", icon:"ğŸ˜",
				iconType:"emoji", eventType:"xixi" },
				{ name:"ç¬‘å“­äº†", icon:"ğŸ˜‚",
				iconType:"emoji", eventType:"xiaokule" },
				{ name:"å“ˆå“ˆ", icon:"ğŸ˜ƒ",
				iconType:"emoji", eventType:"haha" },
				{ name:"å¤§ç¬‘", icon:"ğŸ˜„",
				iconType:"emoji", eventType:"daxiao" },
				{ name:"è‹¦ç¬‘", icon:"ğŸ˜…",
				iconType:"emoji", eventType:"kuxiao" },
				{ name:"æ–œçœ¼ç¬‘", icon:"ğŸ˜†",
				iconType:"emoji", eventType:"xieyanxiao" },
				{ name:"å¾®ç¬‘å¤©ä½¿", icon:"ğŸ˜‡",
				iconType:"emoji", eventType:"weixiaotianshi" },
				{ name:"çœ¨çœ¼", icon:"ğŸ˜‰",
				iconType:"emoji", eventType:"zhayan" },
				{ name:"ç¾æ¶©å¾®ç¬‘", icon:"ğŸ˜Š",
				iconType:"emoji", eventType:"xiuseweixiao" },
				{ name:"å‘µå‘µ", icon:"ğŸ™‚",
				iconType:"emoji", eventType:"hehe" },
				{ name:"å€’è„¸", icon:"ğŸ™ƒ",
				iconType:"emoji", eventType:"daolian" },
				{ name:"ç¬‘å¾—æ»¡åœ°æ‰“æ»š", icon:"ğŸ¤£",
				iconType:"emoji", eventType:"xiaodemandidagun" },
			],
			plusMenus:[ // åŠ å·æ‰©å±•èœå•æ ç›®
				{ name:"ç›¸å†Œç…§ç‰‡", icon:"photo", iconType:"uview", eventType:"photo" },
			    { name:"æ‹ç…§ç‰‡", icon:"\ue62c", iconType:"custom", eventType:"cameraPhoto" },
			    { name:"æ‹è§†é¢‘", icon:"\ue682", iconType:"custom", eventType:"cameraVideo" },
				{ name:"ç›¸å†Œè§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
				{ name:"ä½ç½®", icon:"map", iconType:"uview", eventType:"map" },
			    { name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
				// { name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
				// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
				// { name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
				// { name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
				// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
				// { name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
			],
			chatDataList:[
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
					nickname: 'å½¦ç¥–',
					chat_time: 1750148439,
					data: 'è€å¸ˆä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹æœ¬å­£è¯¾ç¨‹ï¼Œå¦‚æœæˆ‘ä¸å­¦ä¹ ä¸Šä¸€ä¸ªå­£åº¦ï¼Œå¯ä»¥ç›´æ¥å­¦ä¹ æœ¬å­£åº¦å—ï¼Ÿ',
					user_id: 1,
					type:'text', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					chat_time: 1750148449,
					data: 'åŒå­¦ä½ å¥½ï¼Œå¦‚æœä¸å­¦ä¹ ä¸Šä¸€ä¸ªå­£åº¦è¯¾ç¨‹ï¼Œå¦‚æœä½ æœ‰vueçš„åŸºç¡€å’Œjsçš„åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥å­¦ä¹ æœ¬å­£åº¦è¯¾ç¨‹',
					user_id: 2,
					type:'text', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
					nickname: 'å½¦ç¥–',
					chat_time: 1750148759,
					data: 'å¥½çš„ï¼Œæˆ‘äº†è§£äº†ï¼Œè°¢è°¢è€å¸ˆ',
					user_id: 1,
					type:'text', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					chat_time: 1750148859,
					data: 'ä¸ç”¨è°¢',
					user_id: 2,
					type:'text', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
					nickname: 'å½¦ç¥–',
					chat_time: 1750148879,
					data: 'ok',
					user_id: 1,
					type:'text', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
					nickname: 'å½¦ç¥–',
					chat_time: 1750148879,
					data: 'å“ˆå“ˆå“ˆ',
					user_id: 1,
					type:'text', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
					nickname: 'å½¦ç¥–',
					chat_time: 1750148879,
					data: 'å—¯å•¦',
					user_id: 1,
					type:'text', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					chat_time: 1750148889,
					data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/kalong.mp3',
					otherData:{
						duration:60, // å•ä½ç§’
					},
					user_id: 2,
					type:'audio', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					chat_time: 1750148899,
					data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/weixinYuYing.mp3',
					otherData:{
						duration:3, // å•ä½ç§’
					},
					user_id: 2,
					type:'audio', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
					nickname: 'å½¦ç¥–',
					chat_time: 1750148999,
					data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/kalong.mp3',
					otherData:{
						duration:43, // å•ä½ç§’
					},
					user_id: 1,
					type:'audio', //image,video
					isremove:false,
				},
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					chat_time: 1750148999,
					data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg',
					otherData:{
						duration:'1:18', // è§†é¢‘æ—¶é•¿
						poster:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg',
						videoData:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4',
					},
					user_id: 2,
					type:'video', //image,video
					isremove:false,
				},
			],
										
		}
	},
	methods:{
		//ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹
		async swiperItemClick(item, itemIndex) {
			console.log('ç‚¹å‡»èœå•é¡¹å¤„ç†',item);
			if (!item) return; // é˜²æ­¢undefinedé”™è¯¯
			if (this.sendMessageMode === 'icon') {
				if (item.iconType === 'emoji') {
					this.insertEmoji(item); // emojiæ’å…¥è¾“å…¥æ¡†
				} else {
					this.sendMessage('iconMenus', item); // å…¶ä»–ç±»å‹ç›´æ¥å‘é€
				}
			} else {
				console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
				switch (item.eventType){
					case 'photo':
					    await this.handlePermission({
							permission:{
								name:'photo',
								title:'æœ¬åŠŸèƒ½éœ€è¦æ‚¨æ‰“å¼€ç›¸å†Œ',
								desc:'éœ€è¦è®¿é—®æ‚¨çš„ç›¸å†Œæ¥é€‰æ‹©å›¾ç‰‡',
								grantedText:'ç”¨æˆ·å·²æˆæƒå¼€å¯ç›¸å†Œï¼Œå¯ä»¥é€‰æ‹©ç…§ç‰‡äº†',
								nograntedText:'æ‚¨æ²¡æœ‰æˆæƒå¼€å¯ç›¸å†Œï¼Œæ— æ³•å‘å›¾ç‰‡',
							},
							methodsName:'chooseImage',
						});
						break;
					case 'video':
					    await this.handlePermission({
					    	permission:{
					    		name:'photo',
					    		title:'æœ¬åŠŸèƒ½éœ€è¦æ‚¨æ‰“å¼€ç›¸å†Œ',
					    		desc:'éœ€è¦è®¿é—®æ‚¨çš„ç›¸å†Œæ¥é€‰æ‹©è§†é¢‘',
					    		grantedText:'ç”¨æˆ·å·²æˆæƒå¼€å¯ç›¸å†Œï¼Œå¯ä»¥é€‰æ‹©è§†é¢‘äº†',
					    		nograntedText:'æ‚¨æ²¡æœ‰æˆæƒå¼€å¯ç›¸å†Œï¼Œæ— æ³•å‘è§†é¢‘',
					    	},
					    	methodsName:'chooseVideo',
					    });
						break;
					case 'map':
						break;
					case 'camera':
						break;
					case 'mingpian':
						break;
					
				}
			}
		},
		// å‘ç›¸å†Œå›¾ç‰‡|å‘ç›¸å†Œè§†é¢‘ æƒé™ç”³è¯·
		async handlePermission(options){
			try{
			   const permission = new UniPermission();
			   const granted =  await permission.requestPermission(options.permission.name,
			   options.permission.desc,options.permission.title);
			   if(granted){
				   console.log(options.permission.grantedText);
				   this[options.methodsName]();
			   }else{
				   uni.showToast({
					  title: options.permission.nograntedText,
					  icon:'none',
					  duration:3000
				   });
			   }
			}catch(error){
				console.error('æƒé™ç”³è¯·å¼‚å¸¸ï¼š' + error);
				uni.showToast({
					title:'æƒé™ç”³è¯·å¤±è´¥ï¼š' + error.message,
					icon:'none',
					duration:3000
				});
			}
		},
		//é€‰æ‹©ç›¸å†Œè§†é¢‘å‘é€
		async chooseVideo(){
			uni.chooseVideo({
				sourceType:['album'],
				// extension:['mp4'],
				compressed:true,
				maxDuration:60,
				camera:'back',
				success: async (res) => {
					console.log('é€‰æ‹©ç›¸å†Œè§†é¢‘res',res);
					if(res.tempFilePath){
						// å‘é€è§†é¢‘åˆ°æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨ï¼ˆå¦‚ï¼šé˜¿é‡Œäº‘ossï¼‰
						// æˆåŠŸå‘é€ä¹‹å ç”±æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨è¿”å›ä¿¡æ¯å¦‚
						// è§†é¢‘åœ°å€ã€è§†é¢‘å°é¢ç­‰
						// å¾—åˆ°è¿”å›çš„ä¿¡æ¯è¿›è¡Œé¡µé¢æ¸²æŸ“
						let poster = '';
						let durationFormatted = '';
						// #ifdef H5
						try{
							// h5å°é¢
							poster = await getH5VideoThumbnail(res.tempFilePath);
							durationFormatted = this.formatVideoDuration(res.duration);
						}catch(e){
							console.log('H5è·å–å°é¢å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						// #ifdef MP
						try{
							// å°ç¨‹åºå°é¢
							poster = res.thumbTempFilePath;
							durationFormatted = this.formatVideoDuration(res.duration);
						}catch(e){
							console.log('å°ç¨‹åºè·å–å°é¢å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						// #ifdef APP
						try{
							// APPå°é¢
							//å¼•å…¥æ’ä»¶
							// if(uni.getSystemInfoSync().platform === "android"){
							// 	// å®‰å“æ‰‹æœºè·å–å°é¢
							// 	const plug=uni.requireNativePlugin("Html5app-VideoCover");
							// 	plug.setVideoPath({
							// 		'url':res.tempFilePath,
							// 		'time':1,
							// 	},ret=>{
							// 		console.log('å®‰å“æ‰‹æœºè·å–å°é¢çš„ç»“æœ',ret);
							// 	});
							// }
							poster = this.videoPlaceHolderPoster;
							durationFormatted = this.formatVideoDuration(res.duration);
						}catch(e){
							console.log('APPå°é¢è·å–å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						
						// å‘è§†é¢‘
						this.sendMessage('video',{
							...res,
							videoPath:res.tempFilePath,
							poster:poster,
							duration:durationFormatted
						});
						
					}
				},
				fail: (err) => {
					console.error('é€‰æ‹©è§†é¢‘å¤±è´¥ï¼š', err);
					let errorMsg = 'é€‰æ‹©è§†é¢‘å¤±è´¥';
					if(err.errMsg.includes('permission')){
						errorMsg = 'ç›¸å†Œè®¿é—®æƒé™ä¸è¶³';
					}else if(err.errMsg.includes('cancel')){
						return; // ç”¨æˆ·ä¸æˆæƒä¸æç¤º
					}
					uni.showToast({
						title:errorMsg,icon:'none',duration:3000
					});
				}
			});
		},
		//é€‰æ‹©ç›¸å†Œç…§ç‰‡å‘é€
		chooseImage(){
			uni.chooseImage({
				count:9,
				//sizeType:['original','compressed'],
				sourceType:['album'],
				success: (res) => {
					console.log('é€‰æ‹©ç…§ç‰‡res',res);
					if(res.tempFilePaths && res.tempFilePaths.length){
						// å‘é€åˆ°æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨
						// é¡µé¢æ•ˆæœæ¸²æŸ“æ•ˆæœ
						//å•å¼ 
						//this.sendMessage('image',{path:res.tempFilePaths[0]});
						// å¤šå¼ 
						res.tempFilePaths.forEach(item=>{
							this.sendMessage('image',{path:item});
						});
					}
				},
				fail: (err) => {
					console.error('é€‰æ‹©å›¾ç‰‡å¤±è´¥ï¼š', err);
					let errorMsg = 'é€‰æ‹©å›¾ç‰‡å¤±è´¥';
					if(err.errMsg.includes('permission')){
						errorMsg = 'ç›¸å†Œè®¿é—®æƒé™ä¸è¶³';
					}else if(err.errMsg.includes('cancel')){
						return; // ç”¨æˆ·ä¸æˆæƒä¸æç¤º
					}
					uni.showToast({
						title:errorMsg,icon:'none',duration:3000
					});
				}
			});
		},
		//é¢„è§ˆå¤šå¼ å›¾ç‰‡
		previewImages(e){
			console.log('é¢„è§ˆå¤šå¼ å›¾ç‰‡åœ¨é¡µé¢',e);
			uni.previewImage({
				urls:this.previewImagesList,
				current:e.item.data,
				indicator:'default',
			});
		},
		//å‘é€æ¶ˆæ¯
		sendMessage(msgType, option = {}){
			console.log('å‘é€æ¶ˆæ¯',msgType);
			let msg = {
				avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
				nickname: 'å°äºŒå“¥',
				user_id: 2,
				chat_time: (new Date()).getTime(),
				data: '',
				type:msgType, //image,video
				isremove:false,
			};
			switch (msgType){
				case 'text':
				    msg.data = this.messageValue;
				    break;
				case 'iconMenus':
				    console.log('iconMenusçš„æ•°æ®',option);
				    msg.data = option.icon;
					msg.dataType = option.iconType;
				    break;
				case 'image':
				    console.log('imageçš„æ•°æ®',option);
					msg.data = option.path;
				    break;
				case 'audio':
				    console.log('audioçš„æ•°æ®',option);
					msg.data = option.tempFilePath;
					msg.otherData = {
						duration: Math.round(option.duration / 1000),
					}
				    break;
				case 'video':
				    console.log('videoçš„æ•°æ®',option);
					msg.data = option.poster;
					msg.otherData = {
						duration:option.duration, // è§†é¢‘æ—¶é•¿
						poster:option.poster,
						videoData:option.videoPath,
					};
				    break;
			}
			this.chatDataList.push(msg);
			// æ¸…ç©ºå‘é€çš„å†…å®¹ç„¶åè¿˜è¦æ»šåŠ¨åˆ°åº•éƒ¨
			if(msgType == 'text') this.messageValue = '';
			this.chatContentToBottom();
		},
		//æ ¼å¼åŒ–è§†é¢‘æ—¶é•¿
		formatVideoDuration(duration) {
			// ç¡®ä¿durationæ˜¯æ•°å­—ç±»å‹
			const seconds = typeof duration === 'number' ? duration : parseFloat(duration) || 0;
			const minutes = Math.floor(seconds / 60);
			const remainingSeconds = Math.floor(seconds % 60);
			return `${minutes}:${remainingSeconds < 10 ? '0' + remainingSeconds : remainingSeconds}`;
		},
	},
}
```

2. é¡µé¢ `/pages/chat/chat.nvue`
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		<chat-navbar title="èŠå¤©" :fixed="true"
		:showPlus="false" :showUser="false"
		:showBack="true" navbarClass="bg-light"
		:h5WeiXinNeedNavbar="h5WeiXinNeedNavbar">
		    <chat-navbar-icon-button slot="right"
			@click="openMore" >
		    	<text class="iconfont font-lg">&#xe626;</text>
		    </chat-navbar-icon-button>
		</chat-navbar>
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		<scroll-view scroll-y class="bg-light position-fixed left-0 right-0"
		:style="chatContentStyle" :show-scrollbar="false" @scroll="onScroll"
		:scroll-into-view="scrollIntoViewId" >
			<!-- å¯¹è¯éƒ¨åˆ† -->
			<view v-for="(item,index) in chatDataList" :key="index"
			:id="'chat-item-'+index">
				<chat-item :item="item" :index="index"
				:prevTime="index>0 ? chatDataList[index-1].chat_time : 0"
				ref="chatItem" @previewImages="previewImages"></chat-item>
			</view>
		</scroll-view>
		<!-- é’ˆå¯¹æˆ‘ä»¬çš„appç«¯ç‚¹å‡»èŠå¤©åŒºåŸŸæˆæƒåŠ å·æ‰©å±•èœå• -->
		<!-- #ifdef APP -->
		<view v-if="sendMessageMode == 'plus' || sendMessageMode == 'icon'"
		class="position-fixed left-0 right-0"
		:style="chatContentStyle"
		@click="scrollViewClick"></view>
		<!-- #endif -->
		
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ --><!-- ä¿®æ”¹ï¼šæ·»åŠ refè·å–textareaå®ä¾‹ -->
		<view class="position-fixed bottom-0 border-top
		flex flex-row align-center justify-between"
		style="background-color: #f7f7f7;width: 750rpx;
		min-height: 90rpx;max-height: 320rpx;
		padding-top: 12rpx;"
		:style="chatBottomStyle">
			<view class="flex align-center">
				<!-- åˆ‡æ¢å‘è¯­éŸ³ -->
				<!-- é”®ç›˜å›¾æ ‡ -->
				<chat-navbar-icon-button v-if="sendMessageMode == 'audio'"
				@click="changeAudioOrText('text')">
					<text class="iconfont font-lg">&#xe644;</text>
				</chat-navbar-icon-button>
				<!-- è¯­éŸ³å›¾æ ‡ -->
				<chat-navbar-icon-button v-else
				@click="changeAudioOrText('audio')">
					<text class="iconfont font-lg">&#xe643;</text>
				</chat-navbar-icon-button>
				<view class="flex align-center font-sm px-2 py-1 border rounded"
				:class="[recorderStatus ? 'bg-hover-light' : 'bg-white']">
				    <!-- å‘è¯­éŸ³  æŒ‰ä½è¯´è¯ -->
					<view v-if="sendMessageMode == 'audio'"
					class="flex flex-row align-center justify-center rounded"
					style="width: 440rpx;height: 60rpx;"
					@touchstart="recorderTouchstart"
					@touchend="recorderTouchend"
					@touchcancel="recorderTouchcancel"
					@touchmove="recorderTouchmove"
					>
						<text class="font mr-2" v-if="!recorderStatus">æŒ‰ä½</text>
						<text class="font" v-if="!recorderStatus">è¯´è¯</text>
						<text class="font mr-2" v-if="recorderStatus">æ¾å¼€</text>
						<text class="font" v-if="recorderStatus">å‘é€</text>
					</view>
				    <!-- å‘æ–‡å­— -->
					<textarea v-else
					ref="textarea" fixed auto-height :maxlength="-1"
					style="width: 440rpx;min-height: 60rpx;
					max-height: 274rpx;overflow-y: scroll;
					text-align: justify;"
					:adjust-position="false"
					v-model="messageValue"
					@focus="textareaFocus"
					@input="onTextareaInput" 
					@blur="onTextareaBlur" ><!-- æ–°å¢ï¼šç›‘å¬å¤±ç„¦äº‹ä»¶ --><!-- æ–°å¢ï¼šç›‘å¬è¾“å…¥äº‹ä»¶ -->
					</textarea>
				</view>
			</view>
			<view class="flex align-center">
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openIcon">
					<text class="iconfont font-lg">&#xe642;</text>
				</chat-navbar-icon-button>
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openPlus">
					<text class="iconfont font-lg">&#xe637;</text>
				</chat-navbar-icon-button>
				<view v-if="messageValue"
				class="rounded bg-success px-2 py-1 mr-4"
				hover-class="bg-hover-success" 
				@click="sendMessage('text')">
				   <text class="font text-white">å‘é€</text>
				</view>
			</view>
		</view>
	
	
	     <!-- å¼¹å‡ºèœå• --><!-- ä¸»è¦ä¿®æ”¹åŒºåŸŸ -->
		 <chat-tooltip ref="tooltipPlus" :mask="chatTooltipMask" 
		 :maskTransparent="true" :isBottom="true" 
		 :tooltipWidth="750"
		 :tooltipHeight="tooltipHeight"
		 transformOrigin = "center bottom"
		 tooltipClass ="bg-light border-0 rounded-0"
		 @hideTooltip="hideTooltip">
			<view class="border-top border-light-secondary">
				<!-- è¡¨æƒ…èœå• -->
				<swiper v-if="sendMessageMode === 'icon'" 
				:indicator-dots="groupedIconMenus.length > 1" 
				:duration="1000"
				:style="tooltipPlusMenuStyle"
				@change="handleSwiperChange"><!-- æ·»åŠ åˆ†é¡µåˆ‡æ¢äº‹ä»¶ -->
					<!-- ç¬¬ä¸€é¡µï¼šemojiè¡¨æƒ…ï¼ˆæ»šåŠ¨æ˜¾ç¤ºï¼‰ -->
					<swiper-item v-if="emojiPageItems.length > 0">
						<scroll-view scroll-y style="height: 100%;">
							<view class="flex flex-row flex-wrap justify-start">
								<view v-for="(item,itemIndex) in emojiPageItems" 
								:key="itemIndex"
								class="flex flex-column justify-center align-center"
								style="width: 12.5%; height: 120rpx; padding: 10rpx;"
								@click="insertEmoji(item)">
									<text style="font-size: 50rpx;">{{item.icon}}</text>
								</view>
							</view>
						</scroll-view>
					</swiper-item>
					
					<!-- å…¶ä»–ç±»å‹è¡¨æƒ…åˆ†é¡µæ˜¾ç¤º -->
					<swiper-item v-for="(page,pageIndex) in otherPages" 
					:key="pageIndex">
						<view class="flex flex-row flex-wrap justify-start">
							<view v-for="(item,itemIndex) in page" 
							:key="pageIndex+itemIndex"
							class="col-3 flex flex-column justify-center align-center"
							style="height: 260rpx;"
							@click="item ? swiperItemClick(item,itemIndex) : null"
							><!-- å°ç¨‹åºæ·»åŠ ç©ºå€¼æ£€æŸ¥ -->
								<view class="bg-white rounded-lg flex flex-row 
								align-center justify-center mb-2"
								style="width:120rpx;height: 120rpx;">
									<u--image v-if="item.iconType == 'image'"
									:src="item.icon" mode="aspectFit"
									width="120rpx" height="120rpx" radius="0rpx"></u--image>
									<text v-if="item.iconType == 'emoji'"
									style="font-size: 40px;color: #222222;">{{item.icon}}</text>
									<text v-if="item.iconType == 'custom'"
									class="iconfont"
									style="font-size: 26px;color: #222222;">{{item.icon}}</text>
									<u-icon v-if="item.iconType == 'uview'"
									:name="item.icon" color="#222222" size="26"></u-icon>
								</view>
								<text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
				
				<!-- åŠ å·èœå•ï¼ˆä¿æŒä¸å˜ï¼‰ -->
				<swiper v-else-if="sendMessageMode === 'plus'"
				:indicator-dots="pageCount > 1" :duration="1000"
				:style="tooltipPlusMenuStyle">
					<swiper-item v-for="(page,index) in groupedPlusMenus" :key="index">
						<view class="flex flex-row justify-start flex-wrap"
						:style="swiperItemStyle">
							<view class="col-3 flex flex-column justify-center align-center"
							style="height: 260rpx;"
							v-for="(item,itemIndex) in page" :key="itemIndex"
							@click="swiperItemClick(item,itemIndex)">
								<view class="bg-white rounded-lg 
								flex flex-row align-center justify-center mb-2"
								style="width:120rpx;height: 120rpx;">
									<u--image v-if="item.iconType == 'image'"
									:src="item.icon" mode="aspectFit"
									width="120rpx" height="120rpx" radius="0rpx"></u--image>
									<text v-if="item.iconType == 'emoji'"
									style="font-size: 40px;color: #222222;">{{item.icon}}</text>
									<text v-if="item.iconType == 'custom'"
									class="iconfont"
									style="font-size: 26px;color: #222222;">{{item.icon}}</text>
									<u-icon v-if="item.iconType == 'uview'"
									:name="item.icon" color="#222222" size="26"></u-icon>
								</view>
								<text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
			</view>
		 </chat-tooltip>	
		 
		 <!-- æç¤ºç”¨æˆ·æ­£åœ¨å½•éŸ³çš„ç•Œé¢ -->
		 <view v-if="recorderStatus"
		 class="position-fixed left-0 right-0 flex flex-row align-center justify-center"
		 :style="chatContentStyle">
			 <view style="width: 400rpx;height: 400rpx;background-color: rgba(0, 0, 0, 0.6);"
			 class="rounded-lg flex flex-column align-center justify-center">
			     <image :src="recorderIcon" style="width: 300rpx;height: 300rpx;"></image>
				 <text class="font-sm text-white mt-1">{{isRecorderCancel ? 'æ¾å¼€æ‰‹æŒ‡ å–æ¶ˆå‘é€' 
				 : 'å·²å½•' + recorderDuration + 'ç§’  æ‰‹æŒ‡ä¸Šåˆ’ å–æ¶ˆå‘é€'}}</text>
			 </view>
		 </view>
		 
	</view>
</template>

<script>
    import toolJs from '@/common/mixins/tool.js';
	import plusIconActionJs from '@/pages/chat/plusIconAction.js';
	import UniPermission from '@/common/mixins/uni_permission.js';
	import {mapState,mapGetters,mapMutations,mapActions} from 'vuex';
	export default {
		mixins:[toolJs,plusIconActionJs],
		data() {
			return {
				
				isRecorderCancel:false, // æ˜¯å¦å–æ¶ˆå½•éŸ³å‘é€
				recorderTouchstartY:0, // å½•éŸ³å¼€å§‹æ‰‹æŒ‡çºµåæ ‡
				recorderStatus:false, // æ˜¯å¦æ­£åœ¨å½•éŸ³
				cursorPos: 0, // æ–°å¢ï¼šè®°å½•textareaå…‰æ ‡ä½ç½®
				h5WeiXinNeedNavbar:false, // h5ç«¯å¾®ä¿¡ä¸Šæ˜¯å¦éœ€è¦å¯¼èˆªæ 
				statusBarHeight:0,//çŠ¶æ€æ é«˜åº¦åŠ¨æ€è®¡ç®—
				fixedHeight:0, //å ä½ï¼šçŠ¶æ€æ +å¯¼èˆªæ 
				bottomSafeAreaHeight:0, // åº•éƒ¨å®‰å…¨è·ç¦»
				KeyboardHeight:0, //é”®ç›˜é«˜åº¦
				scrollIntoViewId:'', // æ»šåŠ¨åˆ°æŒ‡å®šçš„å…ƒç´ id
				messageValue:'', // å‘é€çš„å†…å®¹ä¿¡æ¯
				tooltipHeight:600, // åŠ å·å¼¹å‡ºèœå•çš„é«˜åº¦rpx
				sendMessageMode:"text",//å‘é€æ¶ˆæ¯çš„æƒ…å†µï¼šæ–‡å­—|è¯­éŸ³|åŠ å·|è¡¨æƒ…
				// #ifdef MP || H5
				chatTooltipMask:true,
				// #endif
				// #ifdef APP
				chatTooltipMask:false,
				// #endif
			}
		},
		mounted() {
			let info = uni.getSystemInfoSync();
			this.statusBarHeight = info.statusBarHeight;
			this.fixedHeight = this.statusBarHeight + uni.upx2px(90);
			this.bottomSafeAreaHeight = info.safeAreaInsets.bottom;
			// ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–
			uni.onKeyboardHeightChange(res=>{
				console.log('é”®ç›˜é«˜åº¦å˜åŒ–',res);
				// #ifdef H5 || MP
				this.KeyboardHeight = res.height;
				// #endif
				// #ifdef APP
				console.log('æ­¤æ—¶çš„è¾“å…¥æ¨¡å¼', this.sendMessageMode);
				if(this.sendMessageMode != 'plus' && this.sendMessageMode != 'icon'){
					this.KeyboardHeight = res.height;
				}
				// #endif
				if(this.KeyboardHeight){
					this.chatContentToBottom();
				}
			});
			// é¡µé¢åŠ è½½å®Œäº†ä¹‹åå°±åº”è¯¥æ»šåŠ¨åˆ°åº•éƒ¨
			this.$nextTick(()=>{
				this.chatContentToBottom();
			});
			
			
			// å…¨å±€ç›‘å¬ å…¨å±€æ³¨å†Œä¸€ä¸ªå‘é€è¯­éŸ³çš„äº‹ä»¶ï¼Œç„¶åå…¨å±€
			this.regSendMessage(res=>{
				if(!this.isRecorderCancel){
					res.duration = this.recorderDuration * 1000;
					this.sendMessage('audio',res);
				}
			});
			
		},
		computed:{
			...mapState({
				recorderManager:state=>state.Audio.recorderManager,
				recorderDuration:state=>state.Audio.recorderDuration,
			}),
			chatContentStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				let bottom = pbottom + uni.upx2px(90 + 12) + this.KeyboardHeight;
				//å¦‚æœæ˜¯h5ç«¯ç”¨å¾®ä¿¡æ‰“å¼€å¹¶ä¸”ä¸éœ€è¦å¯¼èˆªæ çš„æ—¶å€™
				if(this.isWeixinBrowser() && !this.h5WeiXinNeedNavbar){
					this.fixedHeight = this.statusBarHeight + 0;
					uni.setNavigationBarTitle({
						title:'é˜¿ç¥–'
					});
				}
				// #ifdef APP || MP
				if(this.KeyboardHeight){
					bottom = uni.upx2px(90 + 12 + 12) + this.KeyboardHeight;
				}
				// #endif
				return `top:${this.fixedHeight}px;bottom:${bottom}px;`;
			},
			chatBottomStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				// #ifdef APP || MP
				if(this.KeyboardHeight){
					pbottom = uni.upx2px(12);
				}
				// #endif
				return `padding-bottom: ${pbottom}px;bottom:${this.KeyboardHeight}px;`;
			},
			//åŠ å·èœå•æ¯é¡µçš„æ»‘åŠ¨æ ·å¼
			tooltipPlusMenuStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				// #ifdef APP || MP
				pbottom = this.bottomSafeAreaHeight;
				// #endif
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			//åŠ å·èœå•æ¯é¡µçš„å¸ƒå±€æ ·å¼
			swiperItemStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			// åŠ å·èœå•åˆ†é¡µ
			// groupedPlusMenus(){
			// 	const perPage = 8; // æ¯é¡µ8ä¸ª
			// 	const result = [];
			// 	// å°†æ•°ç»„plusMenusæˆ–è€…iconMenusæ¯é¡µ8ä¸ªåˆ†ç»„
			// 	for(let i=0;i<this.tooltipPlusMenusOrIconMenus.length; i += perPage){
			// 		result.push(this.tooltipPlusMenusOrIconMenus.slice(i, i + perPage))
			// 	}
			// 	return result;
			// },
			//è®¡ç®—æ€»é¡µæ•°
			// pageCount(){
			// 	return Math.ceil(this.tooltipPlusMenusOrIconMenus.length / 8);
			// },
			// æ‰©å±•èœå•æˆ–è€…è¡¨æƒ…åŒ…æ•°æ®æº
			tooltipPlusMenusOrIconMenus(){
				if(this.sendMessageMode == 'plus' || this.sendMessageMode == 'icon'){
					return this[`${this.sendMessageMode}Menus`]
				}
				return [];
			},
			// ä¿®æ”¹ï¼šåŠ å·èœå•åˆ†é¡µè®¡ç®—
			groupedPlusMenus() {
				const perPage = 8; // æ¯é¡µ8ä¸ªï¼ˆ2è¡Œï¼‰
				const result = [];
				for (let i = 0; i < this.plusMenus.length; i += perPage) {
					result.push(this.plusMenus.slice(i, i + perPage));
				}
				return result;
			},
			// ä¿®æ”¹ï¼šè®¡ç®—æ€»é¡µæ•°ï¼ˆåˆ†åˆ«å¤„ç†ä¸¤ç§èœå•ï¼‰
			pageCount() {
				if (this.sendMessageMode === 'plus') {
					return Math.ceil(this.plusMenus.length / 8);
				} else if (this.sendMessageMode === 'icon') {
					return this.groupedIconMenus.length;
				}
				return 0;
			},
			// æ–°å¢ï¼šè¡¨æƒ…èœå•è®¡ç®—å±æ€§
			emojiList() {
				return this.iconMenus.filter(item => item.iconType === 'emoji');
			},
			otherList() {
				return this.iconMenus.filter(item => item.iconType !== 'emoji');
			},
			emojiPageItems() {
				return this.emojiList; // æ‰€æœ‰emojiè¡¨æƒ…æ”¾åœ¨ç¬¬ä¸€é¡µ
			},
			otherPages() {
				const perPage = 8; // æ¯é¡µ8ä¸ªï¼ˆ2è¡Œï¼‰
				const pages = [];
				for (let i = 0; i < this.otherList.length; i += perPage) {
					pages.push(this.otherList.slice(i, i + perPage));
				}
				return pages;
			},
			groupedIconMenus() {
				// æ€»é¡µæ•° = 1 (emojié¡µ) + å…¶ä»–ç±»å‹é¡µæ•°
				const pages = [];
				if (this.emojiPageItems.length > 0) {
					pages.push(this.emojiPageItems); // ç¬¬ä¸€é¡µæ”¾emoji
				}
				return pages.concat(this.otherPages);
			},
			// å¤šå›¾é¢„è§ˆå›¾ç‰‡åœ°å€çš„æ•°ç»„é›†åˆ
			previewImagesList(){
				let arr = [];
				this.chatDataList.forEach(item=>{
					if(item.type == 'image' || (item.type == 'iconMenus' &&
				       item.dataType && item.dataType == 'image')){
						arr.push(item.data);
					}
				});
				return arr;
			},
		},
		methods: {
			...mapMutations(['regSendMessage']),
			// æ‰‹æŒ‡æŒ‰ä¸Šå»
			async recorderTouchstart(e){
				// æŸ¥çœ‹ä¸€ä¸‹å½•éŸ³æƒé™æƒ…å†µ
				try{
				   const permission = new UniPermission();
				   const granted =  await permission.requestPermission('microphone',
				   'éœ€è¦æ‚¨æ‰“å¼€éº¦å…‹é£æ¥å½•åˆ¶è¯­éŸ³','æœ¬åŠŸèƒ½éœ€è¦æ‚¨æ‰“å¼€éº¦å…‹é£');
				   if(granted){
					   console.log('ç”¨æˆ·å·²æˆæƒå¼€å¯éº¦å…‹é£ï¼Œå¯ä»¥å½•éŸ³äº†');
					   console.log('æ‰‹æŒ‡æŒ‰ä¸Šå»',e);
					   this.recorderStatus = true;
					   // #ifdef H5 || MP
					   this.recorderTouchstartY = e.changedTouches[0].clientY;
					   // #endif
					   // #ifdef APP
					   this.recorderTouchstartY = e.changedTouches[0].screenY;
					   // #endif
					   
					   // å¯èƒ½æ­£åœ¨å½•éŸ³æ¥ç”µè¯äº† isRecorderCancelä¸ºtrue,è¦æ”¹æˆfalse
					   this.isRecorderCancel = false;
					   // å¼€å§‹å½•éŸ³
					   this.recorderManager.start({
						   duration:60000, // æ¯«ç§’
						   format:'mp3',
					   });
					   
				   }else{
					   uni.showToast({
						  title: 'æ‚¨æ²¡æœ‰æˆæƒæ‰“å¼€éº¦å…‹é£ï¼Œæ— æ³•å½•åˆ¶è¯­éŸ³',
						  icon:'none',
						  duration:3000
					   });
				   }
				}catch(error){
					console.error('æƒé™ç”³è¯·å¼‚å¸¸ï¼š' + error);
					uni.showToast({
						title:'æƒé™ç”³è¯·å¤±è´¥ï¼š' + error.message,
						icon:'none',
						duration:3000
					});
				}
			},
			// æ‰‹æŒ‡æ¾å¼€äº†
			recorderTouchend(){
				console.log('æ‰‹æŒ‡æ¾å¼€äº†');
				this.recorderStatus = false;
				
				//åœæ­¢å½•éŸ³
				this.recorderManager.stop();
			},
			// è§¦æ‘¸å–æ¶ˆ æ¥ç‚¹æ‰“æ–­äº† æ‰‹æœºæ²¡ç”µäº†
			recorderTouchcancel(){
				console.log('è§¦æ‘¸å–æ¶ˆ');
				this.recorderStatus = false;
				this.isRecorderCancel = true;
				//åœæ­¢å½•éŸ³
				this.recorderManager.stop();
			},
			// æ‰‹æŒ‡ç§»åŠ¨
			recorderTouchmove(e){
				console.log('æ‰‹æŒ‡ç§»åŠ¨',e);
				let y = 0;
				// #ifdef H5 || MP
				y = e.changedTouches[0].clientY;
				// #endif
				// #ifdef APP
				y = e.changedTouches[0].screenY;
				// #endif
				// åˆ¤æ–­æ‰‹æŒ‡ä¸Šç§» ç§»å‡ºå½•éŸ³åŒºåŸŸçš„è·ç¦»
				let move = Math.abs(y - this.recorderTouchstartY);
				console.log('æ‰‹æŒ‡ä¸Šç§»è·ç¦»',move);
				this.isRecorderCancel = move > 55 ? true : false;
				
			},
			// åˆ‡æ¢æ–‡å­—è¾“å…¥æˆ–è€…è¯­éŸ³
			changeAudioOrText(sendMessageMode){
				this.sendMessageMode = sendMessageMode;
			},
			// æ–°å¢ï¼štextareaè¾“å…¥äº‹ä»¶è®°å½•å…‰æ ‡ä½ç½®
			onTextareaInput(e) {
				// #ifdef H5 || APP
				this.cursorPos = e.detail.cursor;
				// #endif
			},
			// æ–°å¢ï¼štextareaå¤±ç„¦äº‹ä»¶è®°å½•å…‰æ ‡ä½ç½®
			onTextareaBlur(e) {
				this.cursorPos = e.detail.cursor || this.messageValue.length;
			},
						
			// æ–°å¢ï¼šæ’å…¥è¡¨æƒ…åˆ°textarea
			insertEmoji(item) {
				if (!item || !item.icon) return;
				
				const emoji = item.icon;
				const text = this.messageValue || '';
				
				// æ’å…¥åˆ°å½“å‰å…‰æ ‡ä½ç½®
				const newText = text.substring(0, this.cursorPos) + 
							   emoji + 
							   text.substring(this.cursorPos);
				
				this.messageValue = newText;
				
				// æ›´æ–°å…‰æ ‡ä½ç½®ï¼ˆåœ¨æ’å…¥çš„è¡¨æƒ…åé¢ï¼‰
				const newCursorPos = this.cursorPos + emoji.length;
				this.cursorPos = newCursorPos;
				
				// è®¾ç½®å…‰æ ‡ä½ç½®ï¼ˆH5/APPæ”¯æŒï¼‰
				this.$nextTick(() => {
					if (!this.$refs.textarea) return;
					
					let textarea;
					
					// å¤„ç† H5 å¹³å°çš„ç‰¹æ®Šæƒ…å†µ
					// #ifdef H5
					textarea = this.$refs.textarea.$el; // è·å–åŸç”Ÿ DOM å…ƒç´ 
					// #endif
					
					// #ifndef H5
					textarea = this.$refs.textarea;
					// #endif
					
					if (textarea) {
						// å°è¯•è®¾ç½®å…‰æ ‡ä½ç½®
						if (typeof textarea.setSelectionRange === 'function') {
							try {
								textarea.setSelectionRange(newCursorPos, newCursorPos);
							} catch (e) {
								console.warn('è®¾ç½®å…‰æ ‡ä½ç½®å¤±è´¥', e);
							}
						}
						
						// ç¡®ä¿è¾“å…¥æ¡†èšç„¦
						if (typeof textarea.focus === 'function') {
							try {
								textarea.focus();
							} catch (e) {
								console.warn('èšç„¦è¾“å…¥æ¡†å¤±è´¥', e);
							}
						}
					}
				});
			},
			handleSwiperChange(e) {
			    console.log('åˆ†é¡µåˆ‡æ¢', e.detail.current);
			    // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†åˆ†é¡µåˆ‡æ¢é€»è¾‘
			},
			//ç‚¹å‡»èŠå¤©åŒºåŸŸ
			scrollViewClick(){
				// #ifdef APP
				console.log('ç‚¹å‡»èŠå¤©åŒºåŸŸ');
				this.KeyboardHeight = 0;
				uni.hideKeyboard();
				this.$refs.tooltipPlus.hide();
				this.sendMessageMode = "text";
				// #endif
			},
			// æ–‡æœ¬è¾“å…¥æ¡†èšç„¦
			textareaFocus(){
				// #ifdef APP
				this.sendMessageMode = "text";
				// #endif
			},
			//ç‚¹å‡»ç¬‘è„¸å›¾æ ‡
			openIcon(){
				console.log('ç‚¹å‡»äº†ç¬‘è„¸');
				// #ifdef APP
				this.sendMessageMode = "icon";
				uni.hideKeyboard();
				// #endif
				// #ifdef H5 || MP
				this.sendMessageMode = "icon";
				// #endif
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
			},
			//ç‚¹å‡»äº†åŠ å·
			openPlus(){
				console.log('ç‚¹å‡»äº†åŠ å·');
				// #ifdef APP
				this.sendMessageMode = "plus";
				uni.hideKeyboard();
				// #endif
				// #ifdef H5 || MP
				this.sendMessageMode = "plus";
				// #endif
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
			},
			// å¼¹å‡ºæ¡†éšè—äº†
			hideTooltip(){
				console.log('å¼¹å‡ºæ¡†éšè—äº†');
				// #ifdef APP || MP || H5
				this.KeyboardHeight = 0;
				this.chatContentToBottom();
				// #endif
			},
			
			//ç‚¹å‡»äº†ä¸‰ä¸ªç‚¹å›¾æ ‡
			openMore(){
				console.log('ç‚¹å‡»äº†ä¸‰ä¸ªç‚¹å›¾æ ‡');
			},
			//èŠå¤©å†…å®¹æ»šåˆ°åˆ°åº•éƒ¨
			chatContentToBottom(){
				// #ifdef APP
				let chatItems =  this.$refs.chatItem;
				let lastIndex = chatItems.length - 1 == 0 ? 0 : chatItems.length - 1;
				let last = chatItems[lastIndex];
				const dom =  weex.requireModule('dom');
				dom.scrollToElement(last, {});
				// #endif
				// #ifdef MP || H5
				if(this.chatDataList.length == 0) return;
				const lastIndex = this.chatDataList.length - 1;
				this.scrollIntoViewId = `chat-item-${lastIndex}`;
				setTimeout(()=>{
					this.scrollIntoViewId = '';
					this.$nextTick(()=>{
						this.scrollIntoViewId = `chat-item-${lastIndex}`;
					});
				},100)
				// #endif
			},
			onScroll(){
				console.log('é¡µé¢å‘ç”Ÿäº†æ»šåŠ¨');
			}
		},
		watch:{
			// ç›‘å¬èŠå¤©è®°å½•æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
			chatDataList:{
				handler(){
					this.$nextTick(()=>{
						this.chatContentToBottom();
					});
				},
				deep:true
			},
			sendMessageMode(newVal,oldVal){
				// #ifdef APP
				console.log('ç›‘å¬å‘é€æ¨¡å¼',newVal);
				if(newVal != 'plus' && newVal != 'icon'){
					this.$refs.tooltipPlus.hide();
				}
				// #endif
			},
		},
	}
</script>

<style>
    /* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
	
	
</style>
```



### 2. è·å–è§†é¢‘å°é¢å›¾
ä¸€ã€æ­£å¸¸æ–¹å¼æ˜¯ï¼š`è§†é¢‘å‘é€åˆ°æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨ï¼ˆå¦‚é˜¿é‡Œäº‘OSSï¼‰åï¼Œç”±æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨ç”Ÿæˆå°é¢å›¾ã€è§†é¢‘åœ°å€ç­‰æ•°æ®ï¼Œå¹¶è¿”å›ç»™å®¢æˆ·ç«¯è¿›è¡Œæ˜¾ç¤º` <br/>
äºŒã€ç‰¹æ®Šéœ€æ±‚ï¼šè‹¥å¸Œæœ›åœ¨æœ¬åœ°ç”Ÿæˆè§†é¢‘å°é¢ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æ–¹æ¡ˆï¼š<br/>
### â‘  é’ˆå¯¹H5ç«¯ï¼ˆæ¯”è¾ƒç®€å•ï¼Œé‡‡ç”¨`video``canvas`ï¼‰å³å¯
```js
// H5ç«¯è·å–è§†é¢‘å°é¢:videoPath æ˜¯è§†é¢‘åœ°å€
function getH5VideoThumbnail(videoPath) {
    return new Promise((resolve) => {
        // H5ç«¯ç›´æ¥ä½¿ç”¨è§†é¢‘è·¯å¾„åˆ›å»ºvideoå…ƒç´ 
        const video = document.createElement('video');
        video.src = videoPath;
        video.crossOrigin = 'anonymous';
        video.addEventListener('loadeddata', function() {
            video.currentTime = 0.1; // è®¾ç½®åˆ°0.1ç§’è·å–å°é¢
            
            video.addEventListener('seeked', function() {
                const canvas = document.createElement('canvas');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                
                // è·å–å°é¢å›¾
                const thumbnail = canvas.toDataURL('image/jpeg');
                resolve(thumbnail);
            });
        });
    });
}
```

### â‘¡ å°ç¨‹åºç«¯ï¼ˆåœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸Šé€‰æ‹©è§†é¢‘åï¼Œå¯ç›´æ¥è¿”å›è§†é¢‘å°é¢ï¼Œä½†æ˜¯çœŸæœºè°ƒè¯•æ— æ³•è¿”å›è§†é¢‘å°é¢ï¼‰ï¼Œæœ‰ä»¥ä¸‹è§£å†³æ–¹æ¡ˆï¼š<br/><br/>
æ–¹æ¡ˆ1ï¼šåœ¨å°ç¨‹åºçœŸæœºç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`wx.getVideoInfo API`æ¥è·å–
```js
//é€‰æ‹©è§†é¢‘å‘é€
async chooseVideo() {
    uni.chooseVideo({
        sourceType: ['album'],
        compressed: true,
        maxDuration: 60,
        camera: 'back',
        success: async (res) => {
            if (res.tempFilePath) {
                let poster = '';
                let durationFormatted = '';
                
                // #ifdef MP
                // å°ç¨‹åºç«¯å¤„ç†
                if (res.thumbTempFilePath) {
                    // å¼€å‘è€…å·¥å…·æœ‰å°é¢
                    poster = res.thumbTempFilePath;
                } else {
                    // çœŸæœºç¯å¢ƒéœ€è¦é¢å¤–è·å–
                    try {
                        const videoInfo = await new Promise((resolve, reject) => {
                            wx.getVideoInfo({
                                src: res.tempFilePath,
                                success: resolve,
                                fail: reject
                            });
                        });
                        poster = videoInfo.thumbTempFilePath;
                    } catch (e) {
                        console.error('å°ç¨‹åºè·å–è§†é¢‘ä¿¡æ¯å¤±è´¥:', e);
                        poster = this.videoPlaceHolderPoster;
                    }
                }
                durationFormatted = this.formatVideoDuration(res.duration);
                // #endif
                
                // ... å…¶ä»–å¹³å°ä»£ç ä¿æŒä¸å˜
                
                // å‘é€è§†é¢‘æ¶ˆæ¯
                this.sendMessage('video', {
                    ...res,
                    videoPath: res.tempFilePath,
                    poster: poster,
                    duration: durationFormatted
                });
            }
        },
        fail: (err) => {
            // é”™è¯¯å¤„ç†ä¿æŒä¸å˜
        }
    });
}
```

æ–¹æ¡ˆ2ï¼šä½¿ç”¨`wx.createVideoContext`å’Œ`canvas`ç»„åˆæ–¹æ¡ˆï¼ˆé¡µé¢ç»„ä»¶ï¼‰
> â‘  å°ç¨‹åºç«¯å°é¢è·å–æ–¹æ³•
> ```js
> // å°ç¨‹åºç«¯å°é¢è·å–æ–¹æ³•
> async function getMpVideoThumbnail(videoPath) {
>     return new Promise((resolve) => {
>         // #ifdef MP
>         try {
>             // åˆ›å»ºéšè—videoç»„ä»¶
>             const videoId = `video-${Date.now()}`;
>             const video = wx.createVideoContext(videoId, this);
>             
>             // åˆ›å»ºcanvas
>             const canvasId = `canvas-${Date.now()}`;
>             const ctx = wx.createCanvasContext(canvasId);
>             
>             // ç›‘å¬è§†é¢‘é¦–å¸§åŠ è½½
>             video.seek(0);
>             setTimeout(() => {
>                 video.snapshot({
>                     success: (res) => {
>                         resolve(res.tempImagePath);
>                     },
>                     fail: (err) => {
>                         console.error('è§†é¢‘å¿«ç…§å¤±è´¥:', err);
>                         resolve('');
>                     }
>                 });
>             }, 500);
>             
>             // ä¸´æ—¶åˆ›å»ºvideoå’Œcanvaså…ƒç´ 
>             this.$set(this, '_tempVideoId', videoId);
>             this.$set(this, '_tempCanvasId', canvasId);
>         } catch (e) {
>             console.error('å°ç¨‹åºå°é¢ç”Ÿæˆå¤±è´¥:', e);
>             resolve('');
>         }
>         // #endif
>     });
> }
> ```
> â‘¡ ä¿®æ”¹`chooseVideo`æ–¹æ³•æ•´åˆ
> ```js
> async chooseVideo() {
> 	// é€‰æ‹©ç›¸å†Œè§†é¢‘å‘é€
>     uni.chooseVideo({
>         sourceType: ['album'],
>         compressed: true,
>         maxDuration: 60,
>         camera: 'back',
>         success: async (res) => {
>             if (res.tempFilePath) {
>                 let poster = '';
>                 let durationFormatted = '';
>                 
>                 // å¹³å°ç‰¹å®šå¤„ç†
>                 // #ifdef MP
>                 poster = res.thumbTempFilePath || await getMpVideoThumbnail.call(this, res.tempFilePath);
>                 durationFormatted = this.formatVideoDuration(res.duration);
>                 // #endif
>                 
>                 // #ifdef H5
>                 ...
>                 // #endif
>                 
>                 // #ifdef APP
>                 ...
>                 // #endif
>                 
>                 // å‘é€è§†é¢‘æ¶ˆæ¯
>                 this.sendMessage('video', {
>                     ...res,
>                     videoPath: res.tempFilePath,
>                     poster: poster,
>                     duration: durationFormatted
>                 });
>             }
>         },
>         fail: (err) => {
>             // é”™è¯¯å¤„ç†ä¿æŒä¸å˜
>         }
>     });
> }
> ```
> â‘¢ åœ¨`chat.nvue`é¡µé¢ä¸­æ·»åŠ éšè—å…ƒç´ æ”¯æŒ
> ```vue
> <!-- åœ¨templateåº•éƒ¨æ·»åŠ  -->
> <template>
>   <!-- ...å…¶ä»–å†…å®¹... -->
>   
>   <!-- éšè—çš„å°ç¨‹åºvideoå’Œcanvas -->
>   <!-- #ifdef MP -->
>   <video 
>     :id="_tempVideoId" 
>     :src="tempVideoPath" 
>     style="position:absolute;width:1px;height:1px;opacity:0;"
>     v-if="tempVideoPath"
>   ></video>
>   <canvas 
>     :id="_tempCanvasId" 
>     style="position:absolute;width:1px;height:1px;"
>   ></canvas>
>   <!-- #endif -->
> </template>
> 
> //åœ¨dataä¸­æ·»åŠ ä¸´æ—¶å˜é‡
> data() {
>   return {
>     // ...å…¶ä»–æ•°æ®...
>     _tempVideoId: '',
>     _tempCanvasId: '',
>     tempVideoPath: ''
>   }
> }
> ```

æ–¹æ¡ˆ3ï¼šæ•´åˆæ–¹æ¡ˆ1å’Œæ–¹æ¡ˆ2
> â‘  å°ç¨‹åºå°é¢è·å–æ–¹æ³• åœ¨ `plusIconAction.js` ä¸­
> ```js
> // å°ç¨‹åºç«¯å°é¢è·å–æ–¹æ³•
> async function getMpVideoThumbnail(videoPath) {
>     return new Promise((resolve) => {
>         // #ifdef MP
>         try {
>             // æ–¹æ¡ˆ1ï¼šå°è¯•ä½¿ç”¨ wx.getVideoInfo
>             if (typeof wx.getVideoInfo === 'function') {
>                 wx.getVideoInfo({
>                     src: videoPath,
>                     success: (res) => {
>                         if (res.thumbTempFilePath) {
>                             resolve(res.thumbTempFilePath);
>                         } else {
>                             // å¦‚æœè·å–ä¸åˆ°ï¼Œä½¿ç”¨é»˜è®¤å°é¢
>                             resolve(this.videoPlaceHolderPoster);
>                         }
>                     },
>                     fail: (err) => {
>                         console.error('wx.getVideoInfoå¤±è´¥:', err);
>                         resolve(this.videoPlaceHolderPoster);
>                     }
>                 });
>             } 
>             // æ–¹æ¡ˆ2ï¼šå¦‚æœ wx.getVideoInfo ä¸å¯ç”¨ï¼Œå°è¯•ä½¿ç”¨ createVideoContext
>             else if (typeof wx.createVideoContext === 'function') {
>                 // åˆ›å»ºéšè—videoç»„ä»¶
>                 const videoId = `video-${Date.now()}`;
>                 this.$set(this, '_tempVideoId', videoId);
>                 this.tempVideoPath = videoPath;
>                 
>                 this.$nextTick(() => {
>                     const video = wx.createVideoContext(videoId, this);
>                     
>                     // æ£€æŸ¥ snapshot æ–¹æ³•æ˜¯å¦å­˜åœ¨
>                     if (video.snapshot) {
>                         // ç›‘å¬è§†é¢‘é¦–å¸§åŠ è½½
>                         video.seek(0);
>                         setTimeout(() => {
>                             video.snapshot({
>                                 success: (res) => {
>                                     resolve(res.tempImagePath);
>                                 },
>                                 fail: (err) => {
>                                     console.error('è§†é¢‘å¿«ç…§å¤±è´¥:', err);
>                                     resolve(this.videoPlaceHolderPoster);
>                                 }
>                             });
>                         }, 500);
>                     } else {
>                         console.warn('snapshotæ–¹æ³•ä¸å¯ç”¨');
>                         resolve(this.videoPlaceHolderPoster);
>                     }
>                 });
>             }
>             // æ–¹æ¡ˆ3ï¼šéƒ½ä¸æ”¯æŒï¼Œä½¿ç”¨é»˜è®¤å°é¢
>             else {
>                 resolve(this.videoPlaceHolderPoster);
>             }
>         } catch (e) {
>             console.error('å°ç¨‹åºå°é¢ç”Ÿæˆå¤±è´¥:', e);
>             resolve(this.videoPlaceHolderPoster);
>         }
>         // #endif
>     });
> }
> ```
> â‘¡ ä¿®æ”¹ `chooseVideo` æ–¹æ³•ä¸­çš„å°ç¨‹åºéƒ¨åˆ†
> ```js
> // #ifdef MP
> // å°ç¨‹åºç«¯å¤„ç†
> if (res.thumbTempFilePath) {
>     // å¦‚æœ chooseVideo è¿”å›äº† thumbTempFilePathï¼Œç›´æ¥ä½¿ç”¨
>     poster = res.thumbTempFilePath;
> } else {
>     // å¦åˆ™è°ƒç”¨ getMpVideoThumbnail
>     poster = await getMpVideoThumbnail.call(this, res.tempFilePath);
> }
> durationFormatted = this.formatVideoDuration(res.duration);
> // #endif
> ```
> â‘¢ åœ¨ `plusIconAction.js` çš„ data ä¸­æ·»åŠ  tempVideoPath
> ```js
> data(){
>     return {
>         _tempVideoId: '',
>         _tempCanvasId: '',
>         tempVideoPath: '', // æ·»åŠ è¿™ä¸€è¡Œ
>         // ...å…¶ä»–æ•°æ®...
>     }
> }
> ```
> â‘£  åœ¨ `chat.nvue` é¡µé¢ä¸­ä¿®æ”¹éšè—çš„ video ç»„ä»¶
> ```vue
> <!-- éšè—çš„å°ç¨‹åºvideoå’Œcanvas -->
> <!-- #ifdef MP -->
> <video 
>     :id="_tempVideoId" 
>     :src="tempVideoPath" 
>     style="position:absolute;width:1px;height:1px;opacity:0;"
>     v-if="tempVideoPath"
> </video>
> <canvas 
>     :id="_tempCanvasId" 
>     style="position:absolute;width:1px;height:1px;"
> ></canvas>
> <!-- #endif -->
> ```

æ–¹æ¡ˆ4ï¼šä½¿ç”¨`wx.createVideoContext`å’Œ`canvas`ç»„åˆæ–¹æ¡ˆï¼ˆjså†…åŠ¨æ€åˆ›å»ºç»„ä»¶å’Œç»˜åˆ¶ï¼‰
```js
// å°ç¨‹åºç«¯å°é¢è·å–æ–¹æ³•
async function getMpVideoThumbnail(videoPath) {
    return new Promise((resolve, reject) => {
        // #ifdef MP
        console.log('å¼€å§‹è·å–å°ç¨‹åºè§†é¢‘å°é¢');
        
        // 1. åˆ›å»ºä¸´æ—¶videoç»„ä»¶
        const videoId = 'tempVideo_' + Date.now();
        const videoContext = wx.createVideoContext(videoId, this);
        
        // 2. åŠ¨æ€æ·»åŠ videoç»„ä»¶åˆ°é¡µé¢
        const systemInfo = wx.getSystemInfoSync();
        this.$set(this, videoId, {
            src: videoPath,
            id: videoId,
            style: `position:absolute;left:-9999px;width:1px;height:1px;`,
            controls: false,
            autoplay: false,
            showCenterPlayBtn: false
        });
		
		console.log('åŠ¨æ€æ·»åŠ videoç»„ä»¶åˆ°é¡µé¢');
        
        // 3. ç­‰å¾…ç»„ä»¶æ¸²æŸ“å®Œæˆ
        this.$nextTick(() => {
            // 4. ç›‘å¬è§†é¢‘åŠ è½½å®Œæˆäº‹ä»¶
            videoContext.onLoadedMetadata(() => {
                console.log('è§†é¢‘å…ƒæ•°æ®åŠ è½½å®Œæˆ');
                
                // 5. è·³è½¬åˆ°0.1ç§’ä½ç½®
                videoContext.seek(0.1);
                
                // 6. ç›‘å¬è·³è½¬å®Œæˆäº‹ä»¶
                videoContext.onSeeked(() => {
                    console.log('è§†é¢‘è·³è½¬å®Œæˆ');
                    
                    // 7. åˆ›å»ºcanvasç»˜åˆ¶å°é¢
                    const canvasId = 'tempCanvas_' + Date.now();
                    const canvasContext = wx.createCanvasContext(canvasId, this);
                    
                    // 8. ç»˜åˆ¶è§†é¢‘å¸§åˆ°canvas
                    setTimeout(() => {
                        canvasContext.drawImage(videoPath, 0, 0, 100, 100);
                        canvasContext.draw(false, () => {
                            console.log('canvasç»˜åˆ¶å®Œæˆ');
                            
                            // 9. è·å–ä¸´æ—¶æ–‡ä»¶è·¯å¾„
                            wx.canvasToTempFilePath({
                                canvasId: canvasId,
                                success: (res) => {
                                    console.log('è·å–å°é¢æˆåŠŸ', res.tempFilePath);
                                    resolve(res.tempFilePath);
                                    
                                    // 10. æ¸…ç†ä¸´æ—¶ç»„ä»¶
                                    this.$set(this, videoId, null);
                                    this.$set(this, canvasId, null);
                                },
                                fail: reject
                            });
                        });
                    }, 300);
                });
            });
            
            // 11. å¼€å§‹åŠ è½½è§†é¢‘
            videoContext.play();
        });
        // #endif
        
        // éå°ç¨‹åºç¯å¢ƒè¿”å›ç©ºå­—ç¬¦ä¸²
        resolve('');
    });
}

// 2. è°ƒç”¨
// #ifdef MP
// å°ç¨‹åºç«¯è·å–å°é¢å’Œæ—¶é•¿
try {
	poster = res.thumbTempFilePath || 
	await getMpVideoThumbnail.call(this, res.tempFilePath);
	durationFormatted = this.formatVideoDuration(res.duration);
} catch(e) {
	console.error('å°ç¨‹åºè·å–å°é¢å¤±è´¥:', e);
	poster = this.videoPlaceHolderPoster;
	durationFormatted = '0:00';
}
// #endif

//3. åœ¨é¡µé¢çš„ data ä¸­æ·»åŠ ä¸€ä¸ªç”¨äºå­˜å‚¨ä¸´æ—¶ç»„ä»¶çš„å¯¹è±¡
data() {
    return {
        // ...
        tempComponents: {} // ç”¨äºå­˜å‚¨ä¸´æ—¶ç»„ä»¶
    }
}

//4. åœ¨é¡µé¢ä¸­æ·»åŠ ä¸€ä¸ªç”¨äºæ¸²æŸ“ä¸´æ—¶ç»„ä»¶çš„å®¹å™¨ï¼š
<view v-for="(comp, id) in tempComponents" :key="id" :style="comp.style">
    <video v-if="comp.id.includes('tempVideo')" 
           :id="comp.id" 
           :src="comp.src" 
           :controls="comp.controls"
           :autoplay="comp.autoplay"
           :show-center-play-btn="comp.showCenterPlayBtn"></video>
    <canvas v-if="comp.id.includes('tempCanvas')" 
            :id="comp.id" 
            canvas-id="comp.id" 
            style="width:100px;height:100px;"></canvas>
</view>

```

æ€»ç»“ï¼šä»¥ä¸Šæ–¹æ¡ˆå¯å®ç°è·å–è§†é¢‘å°é¢ï¼Œä½†å‡å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ï¼Œè·Ÿå¾®ä¿¡ç‰ˆæœ¬å’Œuniappç‰ˆæœ¬æœ‰å…³ï¼Œä»¥ä¸Šæ–¹æ³•ä½œä¸ºå‚è€ƒå­¦ä¹ çŸ¥è¯†æ‰€ç”¨ã€‚

### â‘¢ é’ˆå¯¹appç«¯
appç«¯å¯å°è¯•çš„æ–¹æ³• <br/>
> â‘  å…ˆå°è¯•ä½¿ç”¨`plus.media.getVideoInfo`è·å–å°é¢
> ```js
> // APPç«¯è·å–è§†é¢‘å°é¢
> function getAppVideoThumbnail(videoPath) {
>     return new Promise((resolve) => {
>         // 1. å…ˆå°è¯•ä½¿ç”¨plus.media.getVideoInfoè·å–å°é¢
>         plus.media.getVideoInfo({
>             filePath: videoPath,
>             success: (res) => {
>                 console.log('APPç«¯ä½¿ç”¨plus.media.getVideoInfoè·å–è§†é¢‘ä¿¡æ¯æˆåŠŸ:', res);
>                 if (res.cover && res.cover !== '') {
>                     resolve(res.cover);
>                 } else {
>                     console.log('APPç«¯è·å–è§†é¢‘ä¿¡æ¯æˆåŠŸï¼Œä½†æ²¡æœ‰å°é¢ï¼Œå°è¯•createThumbnail');
>                     // 2. å¦‚æœæ²¡æœ‰å°é¢ï¼Œå°è¯•ä½¿ç”¨createThumbnailåˆ›å»ºç¼©ç•¥å›¾
>                     createVideoThumbnail(videoPath).then(cover => {
>                         resolve(cover || '');
>                     });
>                 }
>             },
>             fail: (err) => {
>                 console.error('APPç«¯ä½¿ç”¨plus.media.getVideoInfoè·å–è§†é¢‘ä¿¡æ¯å¤±è´¥:', err);
>                 // 3. å¦‚æœgetVideoInfoå¤±è´¥ï¼Œç›´æ¥å°è¯•createThumbnail
>                 createVideoThumbnail(videoPath).then(cover => {
>                     resolve(cover || '');
>                 });
>             }
>         });
>     });
> }
> ```
> 
> â‘¡ åœ¨â‘ æ— æ•ˆçš„æƒ…å†µä¸‹å°è¯•`createThumbnail`åˆ›å»ºç¼©ç•¥å›¾
> ```js
> // APPç«¯åˆ›å»ºè§†é¢‘ç¼©ç•¥å›¾
> function createVideoThumbnail(videoPath) {
>     return new Promise((resolve) => {
>         plus.media.createThumbnail({
>             src: videoPath,
>             position: 1, // 1ç§’å¤„
>             width: 200,
>             height: 200,
>             format: 'jpg'
>         }, (thumb) => {
>             console.log('åˆ›å»ºè§†é¢‘ç¼©ç•¥å›¾æˆåŠŸ:', thumb);
>             resolve(thumb);
>         }, (err) => {
>             console.error('åˆ›å»ºè§†é¢‘ç¼©ç•¥å›¾å¤±è´¥:', err);
>             resolve('');
>         });
>     });
> }
> ```
`ç»æµ‹è¯•ä»¥ä¸Šæ–¹æ³•åœ¨å®‰å“æŸäº›æœºå‹ä¸Šå­˜åœ¨å…¼å®¹é—®é¢˜`<br/>
> â‘¢ åœ¨APPç«¯ä½¿ç”¨HTML5çš„`<video>`å’Œ`<canvas>`æ–¹æ¡ˆ
> ```js
> // APPç«¯å°é¢è·å–æ–¹æ³•
> async function getAppVideoThumbnail(videoPath) {
>     return new Promise(async (resolve) => {
>         // #ifdef APP
>         try {
>             // è½¬æ¢è·¯å¾„ä¸ºå¯è®¿é—®çš„URL
>             const convertedPath = await new Promise((resolve) => {
>                 plus.io.resolveLocalFileSystemURL(videoPath, (entry) => {
>                     resolve(entry.toLocalURL());
>                 }, (err) => {
>                     console.error('è·¯å¾„è½¬æ¢å¤±è´¥:', err);
>                     resolve(videoPath);
>                 });
>             });
>
>             console.log('è§†é¢‘è½¬æ¢è·¯å¾„ä¸ºå¯è®¿é—®çš„URL',convertedPath);
>             
>             // åˆ›å»ºä¸´æ—¶webviewè·å–å°é¢
>             const webview = plus.webview.create('', 'video-cover-webview', {
>                 background: 'transparent',
>                 height: '0px',
>                 width: '0px'
>             });
>             
>             webview.addEventListener('loaded', async () => {
>                 try {
>                     const cover = await webview.evalJS(`
>                         new Promise(resolve => {
>                             const video = document.createElement('video');
>                             video.src = "${convertedPath}";
>                             video.crossOrigin = 'anonymous';
>                             
>                             video.addEventListener('loadeddata', () => {
>                                 video.currentTime = 0.1;
>                             });
>                             
>                             video.addEventListener('seeked', () => {
>                                 const canvas = document.createElement('canvas');
>                                 canvas.width = video.videoWidth;
>                                 canvas.height = video.videoHeight;
>                                 const ctx = canvas.getContext('2d');
>                                 ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
>                                 
>                                 // è·å–å°é¢å›¾
>                                 const thumbnail = canvas.toDataURL('image/jpeg');
>                                 resolve(thumbnail);
>                             });
>                             
>                             video.addEventListener('error', () => {
>                                 resolve('');
>                             });
>                         })
>                     `);
>                     
>                     resolve(cover || '');
>                 } catch (e) {
>                     console.error('APPå°é¢ç”Ÿæˆå¤±è´¥:', e);
>                     resolve('');
>                 } finally {
>                     setTimeout(() => webview.close(), 100);
>                 }
>             });
>             
>             webview.show('none');
>         } catch (e) {
>             console.error('APPå°é¢å¤„ç†å¼‚å¸¸:', e);
>             resolve('');
>         }
>         // #endif
>     });
> }
> ```
`ç»æµ‹è¯•ä»¥ä¸Šæ–¹æ³•åœ¨å®‰å“æŸäº›æœºå‹ä¸Šå­˜åœ¨å…¼å®¹é—®é¢˜`<br/>
> â‘£ åœ¨appç«¯ä½¿ç”¨`5+App`çš„`plus.io.getVideoInfo` <https://www.html5plus.org/doc/zh_cn/io.html#plus.io.getVideoInfo>ä½†æ˜¯åœ¨æŸäº›æœºå‹ä¸Šæ²¡æœ‰è¿”å›å°é¢å›¾ä¿¡æ¯ï¼Œç„¶ååœ¨ä½¿ç”¨APPçš„`Webview`ç¯å¢ƒä¸­`æ‰§è¡ŒH5å°é¢ç”Ÿæˆæ–¹æ³•`
ä½¿ç”¨`plus.webview`å’Œ`plus.bridge`åœ¨åŸç”Ÿå’ŒWebviewé—´é€šä¿¡å¹¶åŒ…å«æœ¬åœ°æ–‡ä»¶è·¯å¾„è½¬æ¢é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯â‘¢çš„æ–¹æ³•
> ```js
> // appè·å–è§†é¢‘å°é¢
> async function getAppVideoThumbnail(videoPath) {
>     return new Promise((resolve) => {
>         // #ifdef APP
>         try {
>             // 1. å°è¯•ä½¿ç”¨plus.io.getVideoInfo
>             if (typeof plus.io.getVideoInfo === 'function') {
>                 plus.io.getVideoInfo({
>                     filePath: videoPath,
>                     success: (res) => {
>                         console.log('plus.io.getVideoInfoæˆåŠŸ:', res);
>                         if (res && res.coverPath) {
>                             resolve(res.coverPath);
>                         } else {
>                             // å°è¯•å¤‡é€‰æ–¹æ¡ˆ
>                             this.tryAlternativeAppCover(videoPath).then(resolve);
>                         }
>                     },
>                     fail: (err) => {
>                         console.error('plus.io.getVideoInfoå¤±è´¥:', err);
>                         // å°è¯•å¤‡é€‰æ–¹æ¡ˆ
>                         this.tryAlternativeAppCover(videoPath).then(resolve);
>                     }
>                 });
>             } else {
>                 console.warn('plus.io.getVideoInfoä¸å¯ç”¨');
>                 // å°è¯•å¤‡é€‰æ–¹æ¡ˆ
>                 this.tryAlternativeAppCover(videoPath).then(resolve);
>             }
>         } catch (e) {
>             console.error('getAppVideoThumbnailå¼‚å¸¸:', e);
>             this.tryAlternativeAppCover(videoPath).then(resolve);
>         }
>         // #else
>         resolve('');
>         // #endif
>     });
> }
> 
> // å¤‡é€‰æ–¹æ¡ˆï¼šä½¿ç”¨H5æ–¹æ³•ï¼ˆåœ¨APPçš„Webviewç¯å¢ƒä¸­ï¼‰
> async function tryAlternativeAppCover(videoPath) {
>     return new Promise(async (resolve) => {
>         try {
>             // è½¬æ¢è·¯å¾„ä¸ºå¯è®¿é—®çš„URL
>             const convertedPath = await this.convertLocalFilePath(videoPath);
>             
>             // åœ¨APPçš„Webviewç¯å¢ƒä¸­æ‰§è¡ŒH5æ–¹æ³•
>             const cover = await this.executeInWebviewContext(`
>                 new Promise(resolve => {
>                     const video = document.createElement('video');
>                     video.src = "${convertedPath}";
>                     video.crossOrigin = 'anonymous';
>                     
>                     video.addEventListener('loadeddata', () => {
>                         video.currentTime = 0.1;
>                     });
>                     
>                     video.addEventListener('seeked', () => {
>                         const canvas = document.createElement('canvas');
>                         canvas.width = video.videoWidth;
>                         canvas.height = video.videoHeight;
>                         const ctx = canvas.getContext('2d');
>                         ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
>                         
>                         // è·å–å°é¢å›¾
>                         const thumbnail = canvas.toDataURL('image/jpeg');
>                         resolve(thumbnail);
>                     });
>                     
>                     video.addEventListener('error', () => {
>                         resolve('');
>                     });
>                 })
>             `);
>             
>             resolve(cover || this.videoPlaceHolderPoster);
>         } catch (e) {
>             console.error('å¤‡é€‰æ–¹æ¡ˆå¤±è´¥:', e);
>             resolve(this.videoPlaceHolderPoster);
>         }
>     });
> }
> 
> // è½¬æ¢æœ¬åœ°æ–‡ä»¶è·¯å¾„ä¸ºå¯è®¿é—®çš„URL
> function convertLocalFilePath(filePath) {
>     return new Promise((resolve) => {
>         // #ifdef APP
>         if (filePath.startsWith('file://')) {
>             resolve(filePath);
>             return;
>         }
>         
>         plus.io.resolveLocalFileSystemURL(filePath, (entry) => {
>             resolve(entry.toLocalURL());
>         }, (err) => {
>             console.error('è·¯å¾„è½¬æ¢å¤±è´¥:', err);
>             resolve(filePath);
>         });
>         // #else
>         resolve(filePath);
>         // #endif
>     });
> }
> 
> // åœ¨Webviewä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä»£ç 
> function executeInWebviewContext(script) {
>     return new Promise((resolve) => {
>         // #ifdef APP
>         const callbackId = `callback_${Date.now()}`;
>         const webview = plus.webview.currentWebview();
>         
>         // æ³¨å†Œå›è°ƒå‡½æ•°
>         plus.bridge.callbackFromWebview(webview.id, callbackId, (result) => {
>             resolve(result);
>         });
>         
>         // æ‰§è¡Œè„šæœ¬
>         webview.evalJS(`
>             (${script})
>             .then(result => {
>                 plus.bridge.callbackToWebview({
>                     id: '${callbackId}',
>                     data: result
>                 });
>             })
>             .catch(error => {
>                 console.error('Webviewæ‰§è¡Œé”™è¯¯:', error);
>                 plus.bridge.callbackToWebview({
>                     id: '${callbackId}',
>                     data: ''
>                 });
>             });
>         `);
>         // #else
>         resolve('');
>         // #endif
>     });
> }
> ```
`ç»æµ‹è¯•åœ¨å®‰å“æŸäº›æœºå‹ä¸Šå­˜åœ¨å…¼å®¹é—®é¢˜`
ä»¥ä¸Šæ–¹å¼è™½ç„¶å­˜åœ¨å…¼å®¹é—®é¢˜ï¼Œä½†æ˜¯å¤§å®¶å¯ä»¥æ ¹æ®ä»£ç å­¦ä¹ ä¸€ä¸‹ä¸€äº›æ€è·¯å’Œè§£å†³æ–¹æ³•<br/>

â‘¤ appç«¯è·å–è§†é¢‘å°é¢çš„ç»ˆææ–¹æ¡ˆï¼š`å»uni-appæ’ä»¶å¸‚åœºé€‰æ‹©ä¸€ä¸ªæ’ä»¶å¼•å…¥å³å¯`ï¼Œåœ¨æ’ä»¶å¸‚åœºæœç´¢ï¼š`è§†é¢‘å°é¢` <https://ext.dcloud.net.cn/search?q=%E8%A7%86%E9%A2%91%E5%B0%81%E9%9D%A2> ï¼Œä½†æ˜¯æœ‰äº›æ’ä»¶å¥½ç”¨å´å­˜åœ¨ä¸€äº›é—®é¢˜
1. æ¯”å¦‚ï¼Œå¥½ç”¨çš„æ’ä»¶æ”¶è´¹ï¼ˆä¸æ”¶è´¹çš„æ’ä»¶ä¹Ÿæœ‰å¥½ç”¨çš„ï¼Œä½†éœ€è¦è‡ªå·±æ‰¾ä¸€ä¸‹ï¼‰
2. å¦‚æœæ’ä»¶ä¸‹æ¶ï¼Œåˆ™å½±å“åˆ°é¡¹ç›®ï¼ˆè™½ç„¶è¿™ç§å¯èƒ½æ€§å¾ˆå°ï¼‰<br/><br/>
åœ¨çº¿æ’ä»¶éœ€è¦ç»‘å®šåŒ…åï¼Œå³éœ€è¦ç”³è¯·å®‰å“å’Œiosè¯ä¹¦å…ˆï¼Œå› æ­¤ä¸ºäº†æ•™å­¦ï¼Œæˆ‘ç›´æ¥ç»™æ‰“å¼€æä¾›ä¸€ä¸ªæˆ‘è‡ªå·±ç¼–å†™çš„æœ¬åœ°æ’ä»¶åŒ…ï¼Œæ–¹ä¾¿å­¦ä¹ è°ƒè¯•ä½¿ç”¨ã€‚



### 3. å‘è§†é¢‘ï¼šè§†é¢‘å ä½å’Œè§†é¢‘å°é¢é…åˆä½¿ç”¨
æœ‰åŒå­¦è¯¾åæå‡ºï¼Œè¯´è€å¸ˆå¦‚æœæˆ‘ä¸æƒ³ç”¨æ’ä»¶è·å–å°é¢å›¾ï¼Œå°±æƒ³ç”¨è§†é¢‘å ä½ï¼Œå¯ä¸å¯ä»¥å°†è§†é¢‘å°é¢å’Œè§†é¢‘é…åˆä½¿ç”¨å‘¢ï¼Ÿ<br/>

#### â‘  `/pages/chat/plusIconAction.js`æ–‡ä»¶
```js
...
export default{
	data(){
		return {
			...,
			chatDataList:[
				...,
				{
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					chat_time: 1750148999,
					data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg',
					otherData:{
						duration:'1:18', // è§†é¢‘æ—¶é•¿
						poster:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg',
						videoData:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4',
						showPoster:true,
					},
					user_id: 2,
					type:'video', //image,video
					isremove:false,
				},
			],
										
		}
	},
	methods:{
		...
		//é€‰æ‹©ç›¸å†Œè§†é¢‘å‘é€
		async chooseVideo(){
			uni.chooseVideo({
				sourceType:['album'],
				// extension:['mp4'],
				compressed:true,
				maxDuration:60,
				camera:'back',
				success: async (res) => {
					console.log('é€‰æ‹©ç›¸å†Œè§†é¢‘res',res);
					if(res.tempFilePath){
						// å‘é€è§†é¢‘åˆ°æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨ï¼ˆå¦‚ï¼šé˜¿é‡Œäº‘ossï¼‰
						// æˆåŠŸå‘é€ä¹‹å ç”±æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨è¿”å›ä¿¡æ¯å¦‚
						// è§†é¢‘åœ°å€ã€è§†é¢‘å°é¢ç­‰
						// å¾—åˆ°è¿”å›çš„ä¿¡æ¯è¿›è¡Œé¡µé¢æ¸²æŸ“
						let poster = '';
						let durationFormatted = '';
						let showPoster = false; // æ˜¯å¦å±•ç¤ºå°é¢
						// #ifdef H5
						try{
							// h5å°é¢
							poster = await getH5VideoThumbnail(res.tempFilePath);
							durationFormatted = this.formatVideoDuration(res.duration);
							showPoster = true;
						}catch(e){
							console.log('H5è·å–å°é¢å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						// #ifdef MP
						try{
							// å°ç¨‹åºå°é¢
							poster = res.thumbTempFilePath;
							durationFormatted = this.formatVideoDuration(res.duration);
							showPoster = poster ? true : false;
						}catch(e){
							console.log('å°ç¨‹åºè·å–å°é¢å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						// #ifdef APP
						try{
							// APPå°é¢
							//å¼•å…¥æ’ä»¶
							// if(uni.getSystemInfoSync().platform === "android"){
							// 	// å®‰å“æ‰‹æœºè·å–å°é¢
							// 	const plug=uni.requireNativePlugin("Html5app-VideoCover");
							// 	plug.setVideoPath({
							// 		'url':res.tempFilePath,
							// 		'time':1,
							// 	},ret=>{
							// 		console.log('å®‰å“æ‰‹æœºè·å–å°é¢çš„ç»“æœ',ret);
							// 	});
							// }
							poster = this.videoPlaceHolderPoster;
							durationFormatted = this.formatVideoDuration(res.duration);
						}catch(e){
							console.log('APPå°é¢è·å–å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						
						// å‘è§†é¢‘
						this.sendMessage('video',{
							...res,
							videoPath:res.tempFilePath,
							poster:poster,
							duration:durationFormatted,
							showPoster:showPoster,
						});
						
					}
				},
				fail: (err) => {
					console.error('é€‰æ‹©è§†é¢‘å¤±è´¥ï¼š', err);
					let errorMsg = 'é€‰æ‹©è§†é¢‘å¤±è´¥';
					if(err.errMsg.includes('permission')){
						errorMsg = 'ç›¸å†Œè®¿é—®æƒé™ä¸è¶³';
					}else if(err.errMsg.includes('cancel')){
						return; // ç”¨æˆ·ä¸æˆæƒä¸æç¤º
					}
					uni.showToast({
						title:errorMsg,icon:'none',duration:3000
					});
				}
			});
		},
		...
		//å‘é€æ¶ˆæ¯
		sendMessage(msgType, option = {}){
			...
			switch (msgType){
				...
				case 'video':
				    console.log('videoçš„æ•°æ®',option);
					msg.data = option.poster;
					msg.otherData = {
						duration:option.duration, // è§†é¢‘æ—¶é•¿
						poster:option.poster,
						videoData:option.videoPath,
						showPoster:option.showPoster, //æ˜¯å¦æ˜¾ç¤ºå°é¢
					};
				    break;
			}
			...
		},
		
	},
}
```

#### â‘¡ ç»„ä»¶ `/components/chat-item-video-poster/chat-item-video-poster.vue`
```vue
<template>
	<view>
		<!-- è§†é¢‘å°é¢å ä½ -->
		<view v-if="item.otherData.showPoster"
		class="position-relative" @click="openVideoShow">
			<!-- è§†é¢‘å°é¢ -->
			<chat-item-image :item="item" :index="index"
			imageClass="rounded"
			:maxWidth="300" :maxHeight="400"></chat-item-image>
			<!-- è’™ç‰ˆ -->
			<view class="position-absolute left-0 right-0 top-0 bottom-0 rounded"
			style="z-index: 98;background-color: rgba(0, 0, 0, 0.4);"></view>
			<!-- è§†é¢‘æ—¶é•¿ -->
			<view class="position-absolute left-0 right-0 top-0 bottom-0 rounded flex flex-row justify-end align-end mr-1 mb-1"   style="z-index: 99;">
				<text class="font-sm text-white">{{item.otherData.duration}}</text>
			</view>
			<!-- æ’­æ”¾æŒ‰é’® -->
			<view class="position-absolute left-0 right-0 top-0 bottom-0 flex flex-row align-center justify-center"
			style="z-index: 100;">
				<text class="iconfont text-white"
				:style="videoPlayIconStyle">&#xe710;</text>
			</view>
		</view>
		<!-- è§†é¢‘å ä½ -->
		<view v-else
		style="width: 200rpx;height: 350rpx;"
		class="position-relative">
			<video :src="item.otherData.videoData"
			style="width: 200rpx;height: 350rpx;"
			muted autoplay
			:initialTime="1" :controls="false"
			object-fit="cover">
			   <!-- #ifndef MP -->
			   <cover-view 
			   class="position-absolute left-0 right-0 top-0 bottom-0 flex flex-column align-center justify-center"
			   style="z-index: 98;background-color: rgba(0, 0, 0, 0.7);"
			   @click="openVideoShow">
                    <text class="font-sm text-white mb-2">è§†é¢‘å·²å‘é€</text>
					<text class="font-sm text-white">50%</text>
			   </cover-view>
			   <!-- #endif -->
			</video>
			<!-- #ifdef MP -->
			<view class="position-absolute left-0 right-0 top-0 bottom-0 flex flex-column align-center justify-center"
			style="z-index: 98;background-color: rgba(0, 0, 0, 0.7);"
			@click="openVideoShow">
			    <text class="font-sm text-white mb-2">è§†é¢‘å·²å‘é€</text>
			    <text class="font-sm text-white">50%</text>
			</view>
			<!-- #endif -->
		</view>
	</view>
</template>

<script>
	export default{
		name:"chat-item-video-poster",
		props: {
			item: Object,
			index: Number,
		},
		data(){
			return {
				// æ’­æ”¾è§†é¢‘å›¾æ ‡å¤§å°é»˜è®¤70rpx
				videoPlayIcon:70,
			}
		},
		computed:{
			videoPlayIconStyle(){
				return `font-size: ${this.videoPlayIcon}rpx;`;
			}
		},
		methods:{
			openVideoShow(){
				// æ‰“å¼€è§†é¢‘
				const videoUrl = this.item.otherData.videoData;
				const title = encodeURIComponent(this.item.otherData.title || 'è§†é¢‘');
				const poster = encodeURIComponent(this.item.otherData.poster || '');
				
				uni.navigateTo({
					url:`/pages/videoShow/videoShow?videoUrl=${videoUrl}&title=${title}&poster=${poster}`,
					animationType:'zoom-fade-out',
				})
			},
		}
	}
</script>

<style>
	/* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>
```

## å››ã€é€šè¿‡ç›¸æœºè¿›è¡Œå‘å›¾ç‰‡ã€å‘è§†é¢‘
åœ¨æ–‡ä»¶ `/pages/chat/plusIconAction.js`
```js
...

export default{
	data(){
		return {
			...		
		}
	},
	methods:{
		//ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹
		async swiperItemClick(item, itemIndex) {
			...
			if (this.sendMessageMode === 'icon') {
				...
			} else {
				console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
				switch (item.eventType){
					...,
					case 'cameraPhoto':
					    await this.handlePermission({
					    	permission:{
					    		name:'camera',
					    		title:'æœ¬åŠŸèƒ½éœ€è¦æ‚¨æ‰“å¼€æ‘„åƒå¤´',
					    		desc:'éœ€è¦è®¿é—®æ‚¨çš„æ‘„åƒå¤´æ¥æ‹æ‘„ç…§ç‰‡',
					    		grantedText:'ç”¨æˆ·å·²æˆæƒæ‰“å¼€æ‘„åƒå¤´ï¼Œå¯ä»¥æ‹æ‘„ç…§ç‰‡äº†',
					    		nograntedText:'æ‚¨æ²¡æœ‰æˆæƒæ‰“å¼€æ‘„åƒå¤´ï¼Œæ— æ³•æ‹æ‘„ç…§ç‰‡',
					    	},
					    	methodsName:'cameraPhoto',
					    });
						break;
					case 'cameraVideo':
					    await this.handlePermission({
					    	permission:{
					    		name:'camera',
					    		title:'æœ¬åŠŸèƒ½éœ€è¦æ‚¨æ‰“å¼€æ‘„åƒå¤´',
					    		desc:'éœ€è¦è®¿é—®æ‚¨çš„æ‘„åƒå¤´æ¥æ‹æ‘„è§†é¢‘',
					    		grantedText:'ç”¨æˆ·å·²æˆæƒæ‰“å¼€æ‘„åƒå¤´ï¼Œå¯ä»¥æ‹æ‘„è§†é¢‘äº†',
					    		nograntedText:'æ‚¨æ²¡æœ‰æˆæƒæ‰“å¼€æ‘„åƒå¤´ï¼Œæ— æ³•æ‹æ‘„è§†é¢‘',
					    	},
					    	methodsName:'cameraVideo',
					    });
						break;
					case 'map':
						break;
					case 'mingpian':
						break;
					
				}
			}
		},
		// æ‹ç…§ç‰‡å‘é€
		cameraPhoto(){
			this.sendPhotoAlbumOrCamera({
				count:1,
				sourceType:'camera',
			});
		},
		// æ‹è§†é¢‘å‘é€
		async cameraVideo(){
			await this.sendVideoAlbumOrCamera({
				sourceType:'camera',
			});
		},
		...,
		//é€‰æ‹©ç›¸å†Œè§†é¢‘å‘é€
		async chooseVideo(){
			await this.sendVideoAlbumOrCamera({
				sourceType:'album',
			});
		},
		//é€‰æ‹©ç›¸å†Œç…§ç‰‡å‘é€
		chooseImage(){
			this.sendPhotoAlbumOrCamera({
				count:9,
				sourceType:'album',
			});
		},
		// å‘ç…§ç‰‡ï¼šç›¸å†Œæˆ–è€…ç›¸æœº
		sendPhotoAlbumOrCamera(option){
			uni.chooseImage({
				count:option.count,
				//sizeType:['original','compressed'],
				sourceType:[option.sourceType],
				success: (res) => {
					console.log('é€‰æ‹©ç…§ç‰‡res',res);
					if(res.tempFilePaths && res.tempFilePaths.length){
						// å‘é€åˆ°æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨
						// é¡µé¢æ•ˆæœæ¸²æŸ“æ•ˆæœ
						if(res.tempFilePaths.length == 1){
							//å•å¼ 
							this.sendMessage('image',{path:res.tempFilePaths[0]});
						}else{
							// å¤šå¼ 
							res.tempFilePaths.forEach(item=>{
								this.sendMessage('image',{path:item});
							});
						}
					}
				},
				fail: (err) => {
					console.error('é€‰æ‹©å›¾ç‰‡å¤±è´¥ï¼š', err);
					let errorMsg = 'é€‰æ‹©å›¾ç‰‡å¤±è´¥';
					if(err.errMsg.includes('permission')){
						errorMsg = 'ç›¸å†Œè®¿é—®æƒé™ä¸è¶³';
					}else if(err.errMsg.includes('cancel')){
						return; // ç”¨æˆ·ä¸æˆæƒä¸æç¤º
					}
					uni.showToast({
						title:errorMsg,icon:'none',duration:3000
					});
				}
			});
		},
		// å‘è§†é¢‘ï¼šç›¸å†Œæˆ–è€…ç›¸æœº
		async sendVideoAlbumOrCamera(option){
			uni.chooseVideo({
				sourceType:[option.sourceType],
				// extension:['mp4'],
				compressed:true,
				maxDuration:60,
				camera:'back',
				success: async (res) => {
					console.log('é€‰æ‹©ç›¸å†Œè§†é¢‘res',res);
					if(res.tempFilePath){
						// å‘é€è§†é¢‘åˆ°æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨ï¼ˆå¦‚ï¼šé˜¿é‡Œäº‘ossï¼‰
						// æˆåŠŸå‘é€ä¹‹å ç”±æœåŠ¡å™¨æˆ–è€…ç¬¬ä¸‰æ–¹äº‘å­˜å‚¨è¿”å›ä¿¡æ¯å¦‚
						// è§†é¢‘åœ°å€ã€è§†é¢‘å°é¢ç­‰
						// å¾—åˆ°è¿”å›çš„ä¿¡æ¯è¿›è¡Œé¡µé¢æ¸²æŸ“
						let poster = '';
						let durationFormatted = '';
						let showPoster = false; // æ˜¯å¦æ˜¾ç¤ºå°é¢
						// #ifdef H5
						try{
							// h5å°é¢
							poster = await getH5VideoThumbnail(res.tempFilePath);
							durationFormatted = this.formatVideoDuration(res.duration);
							showPoster = true;
						}catch(e){
							console.log('H5è·å–å°é¢å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						// #ifdef MP
						try{
							// å°ç¨‹åºå°é¢
							poster = res.thumbTempFilePath;
							durationFormatted = this.formatVideoDuration(res.duration);
							showPoster = poster ? true : false;
						}catch(e){
							console.log('å°ç¨‹åºè·å–å°é¢å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						// #ifdef APP
						try{
							// APPå°é¢
							//å¼•å…¥æ’ä»¶
							// if(uni.getSystemInfoSync().platform === "android"){
							// 	// å®‰å“æ‰‹æœºè·å–å°é¢
							// 	const plug=uni.requireNativePlugin("Html5app-VideoCover");
							// 	plug.setVideoPath({
							// 		'url':res.tempFilePath,
							// 		'time':1,
							// 	},ret=>{
							// 		console.log('å®‰å“æ‰‹æœºè·å–å°é¢çš„ç»“æœ',ret);
							// 	});
							// }
							poster = this.videoPlaceHolderPoster;
							durationFormatted = this.formatVideoDuration(res.duration);
						}catch(e){
							console.log('APPå°é¢è·å–å¤±è´¥',e);
							poster = this.videoPlaceHolderPoster;
							durationFormatted = '0:00';
						}
						// #endif
						
						// å‘è§†é¢‘
						this.sendMessage('video',{
							...res,
							videoPath:res.tempFilePath,
							poster:poster,
							duration:durationFormatted,
							showPoster:showPoster,
						});
						
					}
				},
				fail: (err) => {
					console.error('é€‰æ‹©è§†é¢‘å¤±è´¥ï¼š', err);
					let errorMsg = 'é€‰æ‹©è§†é¢‘å¤±è´¥';
					if(err.errMsg.includes('permission')){
						errorMsg = 'ç›¸å†Œè®¿é—®æƒé™ä¸è¶³';
					}else if(err.errMsg.includes('cancel')){
						return; // ç”¨æˆ·ä¸æˆæƒä¸æç¤º
					}
					uni.showToast({
						title:errorMsg,icon:'none',duration:3000
					});
				}
			});
		},
		...
	},
}
```