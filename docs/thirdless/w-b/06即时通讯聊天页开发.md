---
navbar: true
sidebar: auto
title: 章节6.即时通讯聊天页开发
---

## 一、顶部导航栏开发

1. 新建即时通讯聊天页 `pages/chat/chat.nvue`
在 `pages.json`中
```js
   {
        "path" : "pages/chat/chat",
        "style" : 
        {
            "navigationBarTitleText" : "聊天详情",
            "navigationStyle": "custom"
        }
    }
```

2. 进入聊天即时通讯聊天页 `pages/xiaoxi/xiaoxi.nvue`
```js
    ...
    methods: {
        ...
        openChat(e) {
            console.log('进入聊天详情页', e);
            uni.navigateTo({
                url: '/pages/chat/chat',
            });
        },
        ...
    }
    ...
```

3. `在页面 pages/chat/chat.nvue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		<chat-navbar title="聊天" :fixed="true"
		:showPlus="false" :showUser="false"
		:showBack="true" navbarClass="bg-light">
		    <chat-navbar-icon-button slot="right"
			@click="openMore" >
		    	<text class="iconfont font-md">&#xe626;</text>
		    </chat-navbar-icon-button>
		</chat-navbar>
	</view>
</template>

<script>
	export default {
		data() {
			return {
				
			}
		},
		methods: {
			openMore(){
				console.log('点击打开更多');
			}
		}
	}
</script>

<style>
    /* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>

```

4. 优化顶部导航栏组件 `/components/chat-navbar/chat-navbar.vue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		<view :class="[fixed ? 'fixed-top' : '',navbarClass]">
			<!-- 状态栏 -->
			...
			<!-- 导航 -->
			<!-- #ifdef APP || H5 -->
			<view class="flex justify-between align-center"
			style="height: 90rpx;">
				<!-- 左边 -->
				...
				<!-- 右边 -->
				<view class="flex align-center">
					...
					<slot name="right"></slot>
				</view>
			</view>
			<!-- #endif -->
			<!-- #ifdef MP -->
			...
			<!-- #endif -->
			
		</view>
		<!-- 占位符：占用 状态栏 + 导航栏的高度 -->
		...
		
		<!-- 导航栏点击加号的弹出菜单 -->
		...
		
	</view>
</template>

<script>
	...
	export default {
		...
		props:{
			...
			// 导航栏动态class
			navbarClass:{
				type:String,
				default:'bg-light'
			},
		},
		...
	}
</script>

<style>
	...
</style>
``` 

## 二、 底部聊天输入区域和聊天内容区域开发
在页面 `pages/chat/chat.nvue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		<chat-navbar title="聊天" :fixed="true"
		:showPlus="false" :showUser="false"
		:showBack="true" navbarClass="bg-light">
		    <chat-navbar-icon-button slot="right"
			@click="openMore" >
		    	<text class="iconfont font-lg">&#xe626;</text>
		    </chat-navbar-icon-button>
		</chat-navbar>
		
		<!-- 聊天内容区域 -->
		<scroll-view scroll-y class="bg-primary position-fixed left-0 right-0"
		:style="chatContentStyle">
			<view class="px-3" v-for="i in 5" :key="i">
				<text>第一季课程我们称之为 知识过渡课，前面第一学期、第二学期我们主要面对PC端进行的学习和网站开发，虽然我们开发的网站后台也做的是响应式，可以兼容我们的手机端，但是随着现在移动互联网的到来，客户更多希望他的网站可以在手机微信上进行浏览、可以在小程序上面搜索（小程序包括微信小程序、支付宝小程序、抖音小程序等），甚至有的客户希望他的项目可以做app,可以进行安装。
				</text>
			</view>	
		</scroll-view>
		
		<!-- 底部聊天输入区域 -->
		<view class="position-fixed bottom-0 border-top
		flex flex-row align-center justify-between"
		style="background-color: #f7f7f7;width: 750rpx;
		min-height: 90rpx;max-height: 320rpx;
		padding-top: 12rpx;"
		:style="chatBottomStyle">
		    <!-- 左边 -->
			<view class="flex align-center">
				<!-- 图标 -->
				<chat-navbar-icon-button>
					<text class="iconfont font-lg">&#xe643;</text>
				</chat-navbar-icon-button>
				<!-- 输入框 -->
				<view class="flex align-center font-sm
				bg-white px-2 py-1 border rounded">
					<textarea fixed auto-height :maxlength="-1"
					style="width: 440rpx;min-height: 60rpx;
					max-height: 274rpx;overflow-y: scroll;
					text-align: justify;"></textarea>
				</view>
			</view>
			<!-- 右边 -->
			<view class="flex align-center">
				<chat-navbar-icon-button>
					<text class="iconfont font-lg">&#xe642;</text>
				</chat-navbar-icon-button>
				<chat-navbar-icon-button>
					<text class="iconfont font-lg">&#xe637;</text>
				</chat-navbar-icon-button>
			</view>
		</view>
		
	</view>
</template>

<script>
	export default {
		data() {
			return {
				statusBarHeight:0,//状态栏高度动态计算
				fixedHeight:0, //占位：状态栏+导航栏
				bottomSafeAreaHeight:0, // 底部安全距离
			}
		},
		mounted() {
			let info = uni.getSystemInfoSync();
			this.statusBarHeight = info.statusBarHeight;
			this.fixedHeight = this.statusBarHeight + uni.upx2px(90);
			this.bottomSafeAreaHeight = info.safeAreaInsets.bottom;
		},
		computed:{
			chatContentStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				let bottom = pbottom + uni.upx2px(90 + 12);
				return `top:${this.fixedHeight}px;bottom:${bottom}px;`;
			},
			chatBottomStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				return `padding-bottom: ${pbottom}px;`;
			}
		},
		methods: {
			openMore(){
				console.log('点击了三个点图标');
			}
		}
	}
</script>

<style>
    /* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>

```

## 三、 聊天内容区域开发：聊天气泡和封装组件
在页面 `pages/chat/chat.nvue`
### 1. 聊天气泡样式
```vue
    <!-- 聊天内容区域 -->
	<scroll-view scroll-y 
	class="bg-light position-fixed left-0 right-0 px-3"
	:style="chatContentStyle">
		<!-- 对话部分 -->
		<!-- 左边 -->
		<view class="flex align-start justify-start mb-3 position-relative">
			<!-- 头像 -->
			<u--image
			src="https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png"                    
			mode="widthFix" width="80rpx" height="80rpx" radius="10rpx"></u--image>
			<!-- 气泡 -->
			<!-- 三角标 -->
			<text class="iconfont font-md text-white"
			style="left: 25rpx;top: 20rpx;z-index: 100;">&#xe609;</text>
			<!-- 内容 -->
			<view class="bg-white p-2 rounded ml-1"
			style="max-width: 500rpx;">
				<text class="font" style="text-align: justify;">
					老师你好，我想咨询一下本季课程，如果我不学习上一个季度，可以直接学习本季度吗？
				</text>
			</view>
			
		</view>	
		<!-- 右边 -->
		<view class="flex align-start justify-end mb-3 position-relative">
			<!-- 气泡 -->
			<!-- 内容 -->
			<view class="p-2 rounded mr-1"
			style="max-width: 500rpx;background-color: #95EC69;">
				<text class="font" style="text-align: justify;">
					同学你好，如果不学习上一个季度课程，如果你有vue的基础和js的基础知识，也可以学习本季度课程
				</text>
			</view>
			<!-- 三角标 -->
			<text class="iconfont font-md text-white"
			style="right: 25rpx;top: 20rpx;z-index: 100;color:#95EC69;">&#xe640;</text>
			<!-- 头像 -->
			<u--image
			src="https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-08.png"                    
			mode="widthFix" width="80rpx" height="80rpx" radius="10rpx"></u--image>
			
		</view>
	</scroll-view>
```

### 2. 提取不同样式封装成class类
```vue
    ...
    <!-- 聊天内容区域 -->
	<scroll-view scroll-y 
	class="bg-light position-fixed left-0 right-0 px-3"
	:style="chatContentStyle">
		<!-- 对话部分 -->
		<!-- 左边 -->
		<view class="flex align-start justify-start mb-3 position-relative">
			<!-- 头像 -->
			<u--image
			src="https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png"                    
			mode="widthFix" width="80rpx" height="80rpx" radius="10rpx"></u--image>
			<!-- 气泡 -->
			<!-- 三角标 -->
			<text class="iconfont font-md chat-left-icon">&#xe609;</text>
			<!-- 内容 -->
			<view class="p-2 rounded ml-1 chat-left-content-bg"
			style="max-width: 500rpx;">
				<text class="font" style="text-align: justify;">
					老师你好，我想咨询一下本季课程，如果我不学习上一个季度，可以直接学习本季度吗？
				</text>
			</view>
			
		</view>	
		<!-- 右边 -->
		<view class="flex align-start justify-end mb-3 position-relative">
			<!-- 气泡 -->
			<!-- 内容 -->
			<view class="p-2 rounded mr-1 chat-right-content-bg"
			style="max-width: 500rpx;">
				<text class="font" style="text-align: justify;">
					同学你好，如果不学习上一个季度课程，如果你有vue的基础和js的基础知识，也可以学习本季度课程
				</text>
			</view>
			<!-- 三角标 -->
			<text class="iconfont font-md chat-right-icon">&#xe640;</text>
			<!-- 头像 -->
			<u--image
			src="https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-08.png"                    
			mode="widthFix" width="80rpx" height="80rpx" radius="10rpx"></u--image>
			
		</view>
	</scroll-view>
    ...

	<style>
    ...

	.chat-left-icon{
		left: 25rpx;top: 20rpx;z-index: 100;color: #ffffff;
	}
	.chat-right-icon{
		right: 25rpx;top: 20rpx;z-index: 100;color:#95EC69;
	}
	.chat-left-content-bg{
		background-color: white;
	}
	.chat-right-content-bg{
		background-color: #95EC69;
	}
</style>
```

### 3. 封装聊天气泡
#### 1. 先循环绑定数据
```vue
   ...
   <!-- 聊天内容区域 -->
	<scroll-view scroll-y class="bg-light position-fixed left-0 right-0 px-3"
	:style="chatContentStyle">
		<!-- 对话部分 -->
		<view v-for="(item,index) in chatDataList" :key="index">
			<view class="flex align-start mb-3 position-relative"
			:class="[item.user_id != 2 ? 'justify-start':'justify-end']">
				<!-- 好友 -->
				<!-- 头像 -->
				<u--image v-if="item.user_id != 2"
				:src="item.avatar"  mode="widthFix"
				width="80rpx" height="80rpx" radius="10rpx"></u--image>
				<!-- 三角形 -->
				<text v-if="item.user_id != 2"
				class="iconfont font-md chat-left-icon">&#xe609;</text>
				<!-- 内容 -->
				<view class="p-2 rounded"
				style="max-width: 500rpx;"
				:class="[item.user_id != 2 ? 'chat-left-content-bg ml-1' : 
				'chat-right-content-bg mr-1']">
					<text class="font" style="text-align: justify;">
						{{item.data}}
					</text>
				</view>
				
				<!-- 我 -->
				<text v-if="item.user_id == 2"
				class="iconfont font-md chat-right-icon">&#xe640;</text>
				<u--image v-if="item.user_id == 2"
				:src="item.avatar" 
				mode="widthFix"
				width="80rpx" height="80rpx" radius="10rpx"></u--image>
			</view>
		</view>
		
		<!-- 右边 -->
		<!-- <view class="flex justify-end align-start mb-3 position-relative">
			<view class="chat-right-content-bg p-2 rounded mr-1"
			style="max-width: 500rpx;background-color: #95ec69;">
				<text class="font" style="text-align: justify;">
					同学你好，如果不学习上一个季度课程，如果你有vue的基础和js的基础知识，也可以学习本季度课程
				</text>
			</view>
			<text class="iconfont font-md chat-right-icon">&#xe640;</text>
			<u--image 
			src="https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-08.png" 
			mode="widthFix"
			width="80rpx" height="80rpx" radius="10rpx"></u--image>
			
		</view> -->
	</scroll-view>
	...
	<script>
	export default {
		data() {
			return {
				...
				chatDataList:[
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: '彦祖',
						chat_time: '16:11',
						data: '老师你好，我想咨询一下本季课程，如果我不学习上一个季度，可以直接学习本季度吗？',
						type: 'text', // image,video
						user_id:1,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname: '小二哥',
						chat_time: '16:11',
						data: '同学你好，如果不学习上一个季度课程，如果你有vue的基础和js的基础知识，也可以学习本季度课程',
						type: 'text', // image,video
						user_id:2,
					},
				],
			}
		},
		...
	}
</script>

```

#### 2. 封装成组件
> ##### 1. 创建组件 `/components/chat-item/chat-item.vue`
> ```vue
> <template>
> 	<view class="flex align-start mb-3 position-relative"
> 	:class="[!isMe ? 'justify-start':'justify-end']">
> 		<!-- 好友 -->
> 		<!-- 头像 -->
> 		<u--image v-if="!isMe"
> 		:src="item.avatar"  mode="widthFix"
> 		width="80rpx" height="80rpx" radius="10rpx"></u--image>
> 		<!-- 三角形 -->
> 		<text v-if="!isMe"
> 		class="iconfont font-md chat-left-icon">&#xe609;</text>
> 		<!-- 内容 -->
> 		<view class="p-2 rounded"
> 		style="max-width: 500rpx;"
> 		:class="[!isMe ? 'chat-left-content-bg ml-1' : 
> 		'chat-right-content-bg mr-1']">
> 			<text class="font" style="text-align: justify;">
> 				{{item.data}}
> 			</text>
> 		</view>
> 		
> 		<!-- 我 -->
> 		<text v-if="isMe"
> 		class="iconfont font-md chat-right-icon">&#xe640;</text>
> 		<u--image v-if="isMe"
> 		:src="item.avatar" 
> 		mode="widthFix"
> 		width="80rpx" height="80rpx" radius="10rpx"></u--image>
> 	</view>
> </template>
> 
> <script>
> 	export default{
> 		name:"chat-item",
> 	    props:{
> 			item:Object,
> 			index:Number
> 		},
> 		computed:{
> 			// 我的判断, 假设我的id=2，后期由实际数据在更换
> 			isMe(){
> 				let user_id = 2;
> 				return this.item.user_id === user_id;
> 			}
> 		}
> 	}
> </script>
> 
> <style>
> 	/* #ifdef H5 */
> 	@import '/common/css/common.nvue.vue.css';
> 	/* #endif */
> 	.chat-left-icon{
> 		left: 25rpx;top: 20rpx;z-index: 100;color: #ffffff;
> 	}
> 	.chat-right-icon{
> 		right: 25rpx;top: 20rpx;z-index: 100;color:#95EC69;
> 	}
> 	.chat-left-content-bg{
> 		background-color: #ffffff;
> 	}
> 	.chat-right-content-bg{
> 		background-color: #95ec69;
> 	}
> </style>
> ```
> 
> ##### 2. 在聊天页使用组件 `pages/chat/chat.nvue`
> ```vue
>     <!-- 聊天内容区域 -->
> 	<scroll-view scroll-y class="bg-light position-fixed left-0 right-0 px-3"
> 	:style="chatContentStyle">
> 		<!-- 对话部分 -->
> 		<view v-for="(item,index) in chatDataList" :key="index">
> 			<chat-item :item="item" :index="index"></chat-item>
> 		</view>
> 	</scroll-view>
> ```
