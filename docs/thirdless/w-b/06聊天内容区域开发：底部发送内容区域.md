---
navbar: true
sidebar: auto
title: ç« èŠ‚6.èŠå¤©å†…å®¹åŒºåŸŸå¼€å‘ï¼šåº•éƒ¨å‘é€å†…å®¹åŒºåŸŸ
---

## ä¸€ã€è§£å†³è¾“å…¥å†…å®¹æ—¶é”®ç›˜å¼¹èµ·ï¼Œé¡µé¢æ•´ä½“ä¸Šç§»

### 1. ç¦ç”¨é”®ç›˜å¼¹èµ·æ—¶ï¼Œè‡ªåŠ¨ä¸Šæ¨é¡µé¢
è¯¦è§`textarea`ç»„ä»¶çš„`adjust-position`å±æ€§: <https://uniapp.dcloud.net.cn/component/textarea.html> <br/>
åœ¨é¡µé¢ï¼š `/pages/chat/chat.nvue`
```vue
<textarea ... :adjust-position="false"></textarea>
```

### 2. é‡æ–°å¤„ç†åº•éƒ¨è¾“å…¥æ¡†çš„å¸ƒå±€
#### 1. ç”¨åˆ°ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–çš„äº‹ä»¶
ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–: <https://uniapp.dcloud.net.cn/api/key.html#onkeyboardheightchange>
åœ¨é¡µé¢ï¼š `/pages/chat/chat.nvue`
```vue
<script>
	export default {
		data() {
			return {
				...
				KeyboardHeight:0, // é”®ç›˜é«˜åº¦
			}
		},
		mounted() {
			...
			
			//ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–
			uni.onKeyboardHeightChange(res=>{
				console.log('é”®ç›˜é«˜åº¦å˜åŒ–',res);
				this.KeyboardHeight = res.height;
			});
		},
		computed:{
			chatContentStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				let bottom = pbottom + uni.upx2px(90 + 12) + this.KeyboardHeight;
				return `top:${this.fixedHeight}px;bottom:${bottom}px;`;
			},
			chatBottomStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				return `padding-bottom: ${pbottom}px;bottom:${this.KeyboardHeight}px;`;
			}
		},
		...
	}
</script>
```

#### 2. éšè—æ»šåŠ¨æ¡å¹¶é»˜è®¤æ»šåŠ¨åˆ°èŠå¤©åº•éƒ¨
```vue
<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
<scroll-view ... :show-scrollbar="false"></scroll-view>
```
1. `weex` (app-plus-nvue)é¡µé¢æ»šåŠ¨å‚è€ƒï¼š<https://weexapp.com/zh/docs/modules/dom.html#scrolltoelement> <br/>
2. åœ¨å°ç¨‹åºMPç«¯ï¼Œä½¿ç”¨`scroll-view`ç»„ä»¶çš„`scroll-into-view`å±æ€§ï¼Œå…·ä½“æŸ¥çœ‹å®˜ç½‘ï¼š<https://uniapp.dcloud.net.cn/component/scroll-view.html#scroll-view><br/>
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		<scroll-view ...
		:scroll-into-view="scrollIntoViewId" @scroll="onScroll">
			<!-- å¯¹è¯éƒ¨åˆ† -->
			<view ...
			:id="'chat-item-'+index">
				<chat-item ... :show-scrollbar="false"
				ref="chatItem"></chat-item>
			</view>
		</scroll-view>
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		...
		
	</view>
</template>

<script>
	export default {
		data() {
			return {
				...
				KeyboardHeight:0, // é”®ç›˜é«˜åº¦
				scrollIntoViewId: '', // æ»šåŠ¨åˆ°æŒ‡å®šå…ƒç´ çš„id
				...
			}
		},
		mounted() {
			...
			
			//ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–
			uni.onKeyboardHeightChange(res=>{
				console.log('é”®ç›˜é«˜åº¦å˜åŒ–',res);
				this.KeyboardHeight = res.height;
				if(this.KeyboardHeight){
					this.chatContentToBottom();
				}
			});
			// é¡µé¢åŠ è½½å®Œæˆåæ»šåŠ¨åˆ°åº•éƒ¨
			this.$nextTick(() => {
				this.chatContentToBottom();
			});
		},
		computed:{
			chatContentStyle(){
				...
				let bottom = pbottom + uni.upx2px(90 + 12) + this.KeyboardHeight;
				// #ifdef MP
				if(this.KeyboardHeight){
					bottom = uni.upx2px(90 + 12 + 12) + this.KeyboardHeight;
				}
				// #endif
				return ...;
			},
			chatBottomStyle(){
				...
				// #ifdef MP
				if(this.KeyboardHeight){
					pbottom = uni.upx2px(12);
				}
				// #endif
				return `padding-bottom: ${pbottom}px;bottom:${this.KeyboardHeight}px;`;
			}
		},
		methods: {
			...,
			//èŠå¤©å†…å®¹æ»šåŠ¨åˆ°åº•éƒ¨
			chatContentToBottom(){
				// #ifdef APP
				let chatItems = this.$refs.chatItem;
				let lastIndex = chatItems.length - 1 == 0 ? 0 : chatItems.length - 1;
				let last = chatItems[lastIndex];
				const dom = weex.requireModule('dom');
				dom.scrollToElement(last, {});
				// #endif
				// #ifdef MP
				if (this.chatDataList.length === 0) return;
				const lastIndex = this.chatDataList.length - 1;
				this.scrollIntoViewId = `chat-item-${lastIndex}`;
				setTimeout(() => {
					this.scrollIntoViewId = '';
					this.$nextTick(() => {
						this.scrollIntoViewId = `chat-item-${lastIndex}`;
					});
				}, 100);
				// #endif
			},
			onScroll() {
				// å¯æ·»åŠ æ»šåŠ¨ä½ç½®æ£€æµ‹é€»è¾‘
				// console.log('é¡µé¢å‘ç”Ÿäº†æ»šåŠ¨');
			}
		},
		watch: {
			// ç›‘å¬èŠå¤©æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
			chatDataList: {
				handler() {
					this.$nextTick(() => {
						this.chatContentToBottom();
					});
				},
				deep: true
			}
		}
	}
</script>

<style>
   ...
</style>

```

## äºŒã€èŠå¤©é¡µåº•éƒ¨å‘é€ä¿¡æ¯åŠŸèƒ½ï¼ˆå‘é€æ™®é€šæ–‡å­—ï¼‰åŠŸèƒ½
åœ¨é¡µé¢ï¼š `/pages/chat/chat.nvue`
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		<view ...>
		    <!-- å·¦è¾¹ -->
			<view ...>
				<!-- å›¾æ ‡ -->
				...
				<!-- è¾“å…¥æ¡† -->
				<view ...>
					<textarea ...
					v-model="messageValue"></textarea>
				</view>
			</view>
			<!-- å³è¾¹ -->
			<view ...>
				<!-- è¡¨æƒ… -->
				<chat-navbar-icon-button v-if="!messageValue">
					...
				</chat-navbar-icon-button>
				<!-- åŠ å· -->
				<chat-navbar-icon-button v-if="!messageValue">
					...
				</chat-navbar-icon-button>
				<!-- å‘é€æŒ‰é’® -->
				<view v-if="messageValue"
				class="rounded bg-success px-2 py-1 mr-4"
				hover-class="bg-hover-success"
				@click="sendMessage('text')">
					<text class="text-white font">å‘é€</text>
				</view>
			</view>
		</view>
		
	</view>
</template>

<script>
	export default {
		data() {
			return {
				...
				messageValue:'', //è¾“å…¥çš„æ¶ˆæ¯å†…å®¹
				...
			}
		},
		mounted() {
			...
		},
		computed:{
			...
		},
		methods: {
			// å‘æ¶ˆæ¯
			sendMessage(msgType){
				console.log('å‘é€ä¿¡æ¯',msgType);
				let msg = {
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					user_id: 2,
					chat_time: (new Date()).getTime(),
					data: '',
					type:msgType, //image,video
					isremove:false,
				};
				switch (msgType){
					case 'text':
					    msg.data = this.messageValue;
						break;

				}
				this.chatDataList.push(msg);
				// æ¸…ç©ºåŠæ»šåŠ¨åˆ°åº•éƒ¨
				if(msgType == 'text') this.messageValue = '';
				this.chatContentToBottom();
			},
			...
		},
		...
	}
</script>

<style>
   ...
</style>

```

## ä¸‰ã€åº•éƒ¨è¾“å…¥åŒºåŸŸåŠ å·æ‰©å±•èœå•åŠŸèƒ½
### 1. å…ˆç¡®å®šå¥½æ‰©å±•èœå•çš„é«˜åº¦å’Œä½ç½®
1. åœ¨ç»„ä»¶ï¼š `/components/chat-tooltip/chat-tooltip.vue`ä¸­
```vue
methods: {
	hide() {
		...
		// é€šçŸ¥çˆ¶ç»„ä»¶æˆ–è€…é¡µé¢å¼¹å‡ºç»„ä»¶éšè—äº†
		this.$emit('hideTooltip');
	}
}
```
2. åœ¨é¡µé¢ï¼š `/pages/chat/chat.nvue`ä¸­
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		<view ...>
		    <!-- å·¦è¾¹ -->
			...
			<!-- å³è¾¹ -->
			<view ...>
				<!-- è¡¨æƒ… -->
				...
				<!-- åŠ å· -->
				<chat-navbar-icon-button ...
				@click="openPlus">
					...
				</chat-navbar-icon-button>
				<!-- å‘é€æŒ‰é’® -->
				...
			</view>
		</view>
		
		<!-- åŠ å·æ‰©å±•èœå• -->
		<chat-tooltip ref="tooltipPlus" :mask="true" 
	    :maskTransparent="true" :isBottom="true" 
	    :tooltipWidth="750"
	    :tooltipHeight="tooltipHeight"
		transformOrigin="center bottom"
		tooltipClass="bg-light border-0 rounded-0"
		@hideTooltip="hideTooltip">
			<view class="bg-warning border-top border-light-secondary">
				<swiper :indicator-dots="true" :duration="1000"
				:style="tooltipPlusMenuStyle">
					<!-- ç¬¬ä¸€é¡µ -->
					<swiper-item>
						<view style="background-color: red;"
						:style="swiperItemStyle">
							<text>1</text>
						</view>
					</swiper-item>
				</swiper>
			</view>
		</chat-tooltip>
	</view>
</template>

<script>
	export default {
		data() {
			return {
				tooltipHeight:600, // åŠ å·å¼¹å‡ºèœå•é«˜åº¦rpx
				...
			}
		},
		mounted() {
			...
		},
		computed:{
			...,
			// åŠ å·èœå•æ ·å¼
			tooltipPlusMenuStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				// #ifdef APP || MP
				pbottom = this.bottomSafeAreaHeight;
				// #endif
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			//åŠ å·èœå•æ¯é¡µæ»‘åŠ¨æ ·å¼
			swiperItemStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			
		},
		methods: {
			//ç‚¹å‡»åŠ å·
			openPlus(){
				console.log('ç‚¹å‡»äº†åŠ å·');
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
				
			},
			// å¼¹å‡ºæ¡†éšè—äº†
			hideTooltip(){
				console.log('å¼¹å‡ºæ¡†éšè—äº†');
				// #ifdef APP || MP || H5
				this.KeyboardHeight = 0;
				this.chatContentToBottom();
				// #endif
			},
			...
		},
		...
	}
</script>

<style>
    ...
</style>

```

### 2. åŠ å·æ‰©å±•èœå•å†…å®¹å¸ƒå±€
åœ¨é¡µé¢ï¼š `/pages/chat/chat.nvue`ä¸­
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		...
	
	
	     <!-- å¼¹å‡ºèœå• -->
	     <chat-tooltip ...>
	     	<view ...>
				<!-- åŠ¨æ€è®¾ç½®æŒ‡ç¤ºç‚¹ -->
				<!-- åŠ¨æ€è®¾ç½®æŒ‡ç¤ºç‚¹ -->
				<swiper :indicator-dots="pageCount > 1" :duration="1000"
				:style="tooltipPlusMenuStyle">
				    <!-- åŠ¨æ€ç”Ÿæˆåˆ†é¡µ -->
					<swiper-item v-for="(page, index) in groupedPlusMenus" :key="index">
						<view class="flex flex-row justify-start flex-wrap"
						:style="swiperItemStyle">
						    <!-- æ¯é¡µæ˜¾ç¤º8ä¸ª -->
							<view class="col-3 flex flex-column 
							align-center justify-center" 
							v-for="(item, itemIndex) in page" :key="itemIndex"
							style="height: 260rpx;align-items: center;
							justify-content:center;"
							@click="swiperItemClick(item, itemIndex)">
							   <!-- å›¾æ ‡ -->
							    <view class="bg-white rounded-lg 
							    flex flex-row align-center justify-center mb-2"
							    style="width: 120rpx;height: 120rpx;">
							        <!-- åŒ…å«åæ–œæ \uçš„æ˜¯è‡ªå®šä¹‰å›¾æ ‡ -->
							        <text v-if="item.iconType == 'custom'"
							        class="iconfont" 
									style="font-size: 26px;color:#222222">{{item.icon}}</text>   
							        <!-- å¦åˆ™æ˜¯uViewå›¾æ ‡ -->
							        <u-icon v-if="item.iconType == 'uview'"
							        :name="item.icon" size="26" color="#222222"></u-icon>
							   </view>
							   <!-- æ–‡å­— -->
							   <text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
			</view>
	     </chat-tooltip>	
	</view>
</template>

<script>
	export default {
		data() {
			return {
				...,
				plusMenus:[ //åŠ å·æ‰©å±•èœå•
					{ name:"ç…§ç‰‡", icon:"photo",iconType:"uview", eventType:"photo"},
					{ name:"ä½ç½®", icon:"map", iconType:"uview",eventType:"map"},
					{ name:"æ‹æ‘„", icon:"\ue62c",iconType:"custom", eventType:"camera"},
					{ name:"æˆ‘çš„åç‰‡", icon:"\ue69d",iconType:"custom", eventType:"mingpian"},
					{ name:"è§†é¢‘", icon:"\ue66d",iconType:"custom", eventType:"video"},
					// { name:"æ‹æ‘„", icon:"\ue62c",iconType:"custom", eventType:""},
					// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d",iconType:"custom", eventType:""},
					// { name:"è§†é¢‘", icon:"\ue66d",iconType:"custom", eventType:""},
					// { name:"æ‹æ‘„", icon:"\ue62c",iconType:"custom", eventType:""},
					// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d",iconType:"custom", eventType:""},
					// { name:"è§†é¢‘", icon:"\ue66d",iconType:"custom", eventType:""},
				],
				...,
			}
		},
		...,
		computed:{
			...,
			// æ–°å¢åˆ†é¡µè®¡ç®—å±æ€§
			groupedPlusMenus() {
				const perPage = 8; // æ¯é¡µ8ä¸ª
				const result = [];
				
				// å°†æ•°ç»„æŒ‰æ¯é¡µ8ä¸ªåˆ†ç»„
				for (let i = 0; i < this.plusMenus.length; i += perPage) {
					result.push(this.plusMenus.slice(i, i + perPage));
				}
				
				return result;
			},
			
			// è®¡ç®—æ€»é¡µæ•°
			pageCount() {
				return Math.ceil(this.plusMenus.length / 8);
			}
		},
		methods: {
			//ç‚¹å‡»åŠ å·èœå•çš„æŸä¸€é¡¹
			swiperItemClick(item, itemIndex){
				console.log('ç‚¹å‡»åŠ å·èœå•çš„æŸä¸€é¡¹',item.eventType);
				switch(item.eventType){
					case 'photo':
						break;
					case 'map':
						break;
					case 'camera':
						break;
					case 'mingpian':
						break;
					case 'video':
						break;
				}
			},
			...,
		},
		...
	}
</script>

<style>
    ...
</style>

```

## å››ã€åŠ å·å’Œé”®ç›˜åˆ‡æ¢é—®é¢˜ï¼ˆä¸»è¦é’ˆå¯¹appç«¯ï¼‰
> é’ˆå¯¹appç«¯ï¼šå‡ºç°åŠ å·å’Œè¾“å…¥å†…å®¹æ—¶å€™é”®ç›˜çš„bugï¼Œä¸»è¦åŸå› æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰å¼€å‘çš„æ—¶å€™æ²¡æœ‰è€ƒè™‘åˆ°å¤šç§æ¶ˆæ¯å‘é€æƒ…å†µçš„å„ç§åˆ¤å®šï¼Œå› æ­¤æˆ‘ä»¬è¦åˆ†æåœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œæœ‰å“ªäº›æƒ…å†µï¼Œå¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬å‘é€æ¶ˆæ¯çš„æ—¶å€™æœ‰å››ç§æƒ…å†µï¼š1. å‘é€æ–‡æœ¬æ¶ˆæ¯ 2. ç‚¹å‡»åŠ å·å‘é€æ‰©å±•èœå•çš„å†…å®¹ 3. å‘é€è¡¨æƒ… 4. å‘é€è¯­éŸ³æ¶ˆæ¯ 5. å…¶å®ƒæƒ…å†µã€‚ <br/>

åœ¨é¡µé¢ï¼š `/pages/chat/chat.nvue` ä¸­
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		<!-- é’ˆå¯¹appç«¯ç‚¹å‡»èŠå¤©åŒºåŸŸéšè—åŠ å·æ‰©å±•èœå• -->
		<!-- #ifdef APP -->
		<view v-if="sendMessageMode == 'plus'" @click="scrollViewClick"
		class="position-fixed left-0 right-0 bg-success"
		:style="chatContentStyle"></view>
		<!-- #endif -->
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		<view ...>
		    <!-- å·¦è¾¹ -->
			<view ...>
				<!-- å›¾æ ‡ -->
				...
				<!-- è¾“å…¥æ¡† -->
				<view ...>
					<textarea ...
					@focus="textareaFocus"></textarea>
				</view>
			</view>
			<!-- å³è¾¹ -->
			...
		</view>
	
	
	     <!-- å¼¹å‡ºèœå• -->
	     ...
	</view>
</template>

<script>
	export default {
		data() {
			return {
				...,
				sendMessageMode:"text", //å‘é€æ¶ˆæ¯çš„æƒ…å†µï¼šæ–‡æœ¬|åŠ å·|è¡¨æƒ…|è¯­éŸ³
				// #ifdef MP || H5
				chatTooltipMask:true,
				// #endif
				// #ifdef APP
				chatTooltipMask:false,
				// #endif
				...
			}
		},
		mounted() {
			...
			// ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–
			uni.onKeyboardHeightChange(res=>{
				console.log('é”®ç›˜é«˜åº¦å˜åŒ–',res);
				// #ifdef MP || H5
				this.KeyboardHeight = res.height;
				// #endif
				// #ifdef APP
				console.log('æ­¤æ—¶çš„è¾“å…¥æ¨¡å¼',this.sendMessageMode);
				if(this.sendMessageMode != 'plus'){
					this.KeyboardHeight = res.height;
				}
				// #endif
				if(this.KeyboardHeight){
					this.chatContentToBottom();
				}
			});
			...
		},
		computed:{
			...
		},
		methods: {
			...,
			// ç‚¹å‡»èŠå¤©åŒºåŸŸ
			scrollViewClick(){
				// #ifdef APP
				console.log('ç‚¹å‡»èŠå¤©åŒºåŸŸ');
				this.KeyboardHeight = 0;
				uni.hideKeyboard();
				this.$refs.tooltipPlus.hide();
				this.sendMessageMode = "text";
				// #endif
			},
			// æ–‡æœ¬è¾“å…¥èšç„¦
			textareaFocus(){
				// #ifdef APP
				this.sendMessageMode = "text";
				console.log('è§¦å‘æ–‡æœ¬è¾“å…¥èšç„¦äº‹ä»¶æ¨¡å¼æ˜¯',this.sendMessageMode);
				// #endif
			},
			//ç‚¹å‡»äº†åŠ å·
			openPlus(){
				console.log('ç‚¹å‡»äº†åŠ å·');
				// #ifdef APP
				// æ”¹å˜å‘é€æ¨¡å¼ï¼Œæ”¶èµ·é”®ç›˜
				this.sendMessageMode = "plus";
				uni.hideKeyboard();
				// #endif
				...
			},
			...
		},
		watch:{
			...,
			sendMessageMode(newVal,oldVal){
				// #ifdef APP
				console.log('ç›‘å¬å‘é€æ¨¡å¼',newVal);
				if(newVal != 'plus'){
					this.$refs.tooltipPlus.hide();
				}
				// #endif
			}
		},
	}
</script>

<style>
    ...
</style>

```

## äº”ã€è¡¨æƒ…åŒ…å¼€å‘åŠå‘é€è¡¨æƒ…åŒ…
### 1. è¡¨æƒ…åŒ…å¼€å‘
è¯´æ˜ï¼š<br/>
1. gifåŠ¨ç”»è¡¨æƒ…åŒ…ï¼Œå¤§å®¶å¯ä»¥åœ¨ç½‘ä¸Šè‡ªè¡Œä¸‹è½½ä½ å–œæ¬¢çš„ï¼Œå¦‚ <https://www.fabiaoqing.com/>ï¼Œç„¶åæ”¾åœ¨æœ¬åœ°æ–‡ä»¶static/emojiæ–‡ä»¶å¤¹ä¸‹æˆ–è€…æ”¾åœ¨é˜¿é‡Œäº‘ossäº‘å­˜å‚¨ä¸Šï¼Œç„¶åå°±å¯ä»¥å¼•å…¥ä½¿ç”¨äº† 
2. emoji æ–‡å­—è¡¨æƒ…åŒ…ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ä¸ªç½‘ç«™é€‰æ‹©ä½ å–œæ¬¢çš„ <https://www.emojiall.com/zh-hans/all-emojis> <br/><br/>
åœ¨é¡µé¢ï¼š `/pages/chat/chat.nvue` ä¸­
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		<!-- é’ˆå¯¹æˆ‘ä»¬çš„appç«¯ç‚¹å‡»èŠå¤©åŒºåŸŸæˆæƒåŠ å·æ‰©å±•èœå• -->
		<!-- #ifdef APP -->
		<view v-if="sendMessageMode == 'plus' || sendMessageMode == 'icon'"
		class="position-fixed left-0 right-0"
		:style="chatContentStyle"
		@click="scrollViewClick"></view>
		<!-- #endif -->
		
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		<view ...>
		    <!-- å·¦è¾¹ -->
			...
			<!-- å³è¾¹ -->
			<view class="flex align-center">
				<!-- è¡¨æƒ… -->
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openIcon">
					<text class="iconfont font-lg">&#xe642;</text>
				</chat-navbar-icon-button>
				<!-- åŠ å· -->
				...
				<!-- å‘é€æŒ‰é’® -->
				...
			</view>
		</view>
	
	
	     <!-- å¼¹å‡ºèœå• -->
	     <chat-tooltip ...>
	     	<view ...>
				<swiper ...>
				    <!-- åŠ¨æ€åˆ†é¡µ -->
					<swiper-item ...>
						<view ...>
						    <!-- æ¯é¡µæ˜¾ç¤º8ä¸ª -->
							<view ...>
								<!-- å›¾æ ‡ -->
								<view ...>
								    <!-- å›¾ç‰‡ç±»å‹å›¾æ ‡ -->
								    <image v-if="item.iconType === 'image'" :src="item.icon" 
								    style="width:100%;height:100%;" mode="aspectFit" />
									<!-- emojiç±»å‹å›¾æ ‡ -->
									<text v-if="item.iconType === 'emoji'"
									style="font-size: 40px;color: #222222;">
										{{item.icon}}
									</text>
								    <!-- è‡ªå®šä¹‰å›¾æ ‡ -->
									...
									<!-- uviewUiæ¡†æ¶çš„å›¾æ ‡ -->
									...
								</view>
								<!-- åç§° -->
								...
							</view>
						</view>
					</swiper-item>
				</swiper>
			</view>
	     </chat-tooltip>	
	</view>
</template>

<script>
	export default {
		data() {
			return {
				...
				iconMenus:[
					// { name: "å¾®ç¬‘", icon: "/static/tabbar/index.png", 
					// iconType: "image", eventType: "smile" },
					{ name: "å˜¿å˜¿", icon: "ğŸ˜€",
					iconType: "emoji", eventType: "smile" },
					{ name: "å—¯ï¼Œå“¼", icon: "https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/iconMenus/en.gif", 
					iconType: "image", eventType: "enheng" },
				],
				...,
			}
		},
		mounted() {
			...
			// ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–
			uni.onKeyboardHeightChange(res=>{
				...
				// #ifdef H5 || MP
				...
				// #endif
				// #ifdef APP
				...
				if(this.sendMessageMode != 'plus' && this.sendMessageMode != 'icon'){
					this.KeyboardHeight = res.height;
				}
				// #endif
				...
			});
			...
		},
		computed:{
			...,
			// åŠ å·èœå•åˆ†é¡µ
			groupedPlusMenus(){
				const perPage = 8; // æ¯é¡µ8ä¸ª
				const result = [];
				// å°†æ•°ç»„plusMenusæ¯é¡µ8ä¸ªåˆ†ç»„
				for(let i=0;i<this.tooltipPlusMenusOrIconMenus.length; i += perPage){
					result.push(this.tooltipPlusMenusOrIconMenus.slice(i, i + perPage))
				}
				return result;
			},
			//è®¡ç®—æ€»é¡µæ•°
			pageCount(){
				return Math.ceil(this.tooltipPlusMenusOrIconMenus.length / 8);
			},
			// æ‰©å±•èœå•æˆ–è¡¨æƒ…åŒ…æ•°æ®æº
			tooltipPlusMenusOrIconMenus(){
				if(this.sendMessageMode == 'plus' || this.sendMessageMode == 'icon'){
					return this[`${this.sendMessageMode}Menus`]
				}
				return [];
			},
		},
		methods: {
			//ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹
			swiperItemClick(item,itemIndex){
				if (this.sendMessageMode === 'icon') {
					// è¡¨æƒ…åŒ…ç‚¹å‡»å¤„ç†
					// this.messageValue += `[${item.name}]`; // åœ¨è¾“å…¥æ¡†ä¸­æ·»åŠ è¡¨æƒ…æ ‡è®°
					console.log('ç‚¹å‡»äº†è¡¨æƒ…åŒ…');
				}else {
					// åŠ å·èœå•ç‚¹å‡»å¤„ç†
					console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
					...
				}
			},
			//ç‚¹å‡»äº†ç¬‘è„¸
			openIcon(){
				console.log('ç‚¹å‡»äº†ç¬‘è„¸');
				// #ifdef APP
				this.sendMessageMode = "icon";
				uni.hideKeyboard();
				// #endif
				// #ifdef H5 || MP
				this.sendMessageMode = 'icon';
				// #endif
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
			},
			...,
		},
		watch:{
			...,
			sendMessageMode(newVal,oldVal){
				// #ifdef APP
				console.log('ç›‘å¬å‘é€æ¨¡å¼',newVal);
				if(newVal != 'plus' && newVal != 'icon'){
					this.$refs.tooltipPlus.hide();
				}
				// #endif
			},
		},
	}
</script>

<style>
   ...
</style>

```

### 2. å‘é€è¡¨æƒ…åŒ…åŠŸèƒ½å®ç°
#### â‘  åœ¨é¡µé¢ `pages/chat/chat.nvue` ä¸­
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		...
	
	    <!-- å¼¹å‡ºèœå• -->
	    ...
	</view>
</template>

<script>
	export default {
		data() {
			return {
				...,
				iconMenus:[
					{ name:"å¾®ç¬‘", icon:"/static/tabbar/index.png", 
					iconType:"image", eventType:"smile" },
					{ name:"å˜¿å˜¿", icon:"ğŸ˜€",
					iconType:"emoji", eventType:"heihei" },
					{ name: "å—¯ï¼Œå“¼", icon: "https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/iconMenus/en.gif", iconType: "image", eventType: "enheng" },
				],
				...,
			}
		},
		mounted() {
			...
		},
		computed:{
			...
		},
		methods: {
			//ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹
			swiperItemClick(item,itemIndex){
				if (this.sendMessageMode === 'icon') {
					// è¡¨æƒ…åŒ…ç‚¹å‡»å¤„ç†
					// this.messageValue += `[${item.name}]`; // åœ¨è¾“å…¥æ¡†ä¸­æ·»åŠ è¡¨æƒ…æ ‡è®°
					console.log('ç‚¹å‡»äº†è¡¨æƒ…åŒ…');
					this.sendMessage('iconMenus', item);
				}else {
					console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
					switch (item.eventType){
						case 'phote':
							break;
						case 'map':
							break;
						case 'camera':
							break;
						case 'mingpian':
							break;
						case 'video':
							break;
					}
				}
			},
			...,
			//å‘é€æ¶ˆæ¯
			sendMessage(msgType,option={}){
				...
				console.log('é¢å¤–å‚æ•°',option);
				...
				switch (msgType){
					case 'text':
					    ...
						break;
					case 'iconMenus':
					    msg.data = option.icon;
						msg.dataType = option.iconType;
					    break;
				}
				...
			},
			...
		},
		watch:{
			...
		},
	}
</script>

<style>
    ...
</style>

```

#### â‘¡ è°ƒæ•´ç»„ä»¶ `/components/chat-item/chat-item.vue` æ˜¾ç¤ºè¡¨æƒ…åŒ…
```vue
<template>
	<view>
		<!-- æ—¶é—´ -->
		...
		<!-- æ’¤å›æ¶ˆæ¯ -->
		...
		<!-- èŠå¤©å†…å®¹ -->
		<view v-else ...>
			<!-- å¥½å‹ -->
			<!-- å¤´åƒ -->
			<u--image ...></u--image>
			<!-- æ°”æ³¡ -->
			<!-- ä¸‰è§’å½¢ -->
			<text v-if="!isMe  && needQipaoClass"
			class="iconfont font-md chat-left-icon">&#xe609;</text>
			<!-- å†…å®¹ -->
			<view class="p-2 rounded"
			style="max-width: 500rpx;"
			:class="[!isMe ? 'ml-1':'mr-1',`chatItem${index}`,
			!isMe && needQipaoClass ? 'chat-left-content-bg pt-2' : 'pt-0',
			isMe && needQipaoClass ? 'chat-right-content-bg pt-2' : 'pt-0',]"
			:ref="'chatItem' + index"
			@longpress="onLongpress($event,index,item)">
			    <!-- æƒ…å†µ1 -->
				<view v-if="item.dataType && item.dataType == 'image'">
					<u--image :src="item.data" mode="widthFix"
					width="200rpx" height="200rpx" radius="10rpx"></u--image>
				</view>
			    <!-- æ–‡å­— -->
				<text v-else
				class="font" style="text-align: justify;">
					{{item.data}}
				</text>
			</view>
			
			<!-- æˆ‘ -->
			<text v-if="isMe && needQipaoClass"
			class="iconfont font-md chat-right-icon">&#xe640;</text>
			<u--image ...></u--image>
		</view>
    
	    <!-- å¼¹å‡ºèœå• -->
	    ...
	
	</view>
</template>

<script>
	...
	export default{
		...,
		computed:{
			...,
			// éœ€è¦æ°”æ³¡æ ·å¼
			needQipaoClass(){
				return this.item.type === 'text' || 
				this.item.type === 'audio' || 
				(this.item.type === 'iconMenus' && this.item.dataType 
				&& this.item.dataType == 'emoji');
			},
		},
		
	}
</script>


```

## å…­ã€è°ƒæ•´åœ¨H5ç«¯è®©é¡µé¢å’Œå¾®ä¿¡æ›´å¥½çš„èåˆ
> æœ‰åŒå­¦æå‡ºï¼Œè¯´åœ¨H5ç«¯çš„é¡µé¢ï¼Œ90%ä»¥ä¸Šçš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡å¾®ä¿¡ä¼ æ’­ç„¶åé€šè¿‡åˆ†äº«é¡µé¢é“¾æ¥æ‰“å¼€çš„ï¼Œå¸Œæœ›è°ƒæ•´ä¸€ä¸‹é¡µé¢çš„æ ·å¼ï¼Œè®©é¡µé¢å’Œå¾®ä¿¡æ›´åŠ èåˆã€‚
### 1. å…ˆè§£å†³ä¸€ä¸ªbug
> åœ¨è‹¹æœæ‰‹æœºä¸Šåœ¨å¾®ä¿¡æ‰“å¼€H5ç«¯é¡µé¢ï¼Œ`å¤åˆ¶æ’¤å›`å¼¹å‡ºèœå•æ²¡æœ‰å®Œå…¨æ¼å‡ºæ¥
è§£å†³ï¼š<br/>
1. æ¥åˆ°é¡µé¢ `/pages/chat/chat.nvue`, æŠŠ `<scroll-view>`çš„classä¸­çš„ `px-3` å»æ‰ï¼›
2. æ¥åˆ°ç»„ä»¶ `/components/chat-item/chat-item.vue` åœ¨æ ¹`view`ä¸Š åŠ ä¸Š `class="px-3"`

### 2. æ¶ˆæ¯é¡µ(æ ¹æ®è‡ªå·±çš„çˆ±å¥½è°ƒæ•´)
1. åœ¨ `/common/mixins/tool.js` ä¸­å†™å‡ ä¸ªæ–¹æ³•ï¼Œå…ˆè¦çŸ¥é“å½“å‰è¿è¡Œçš„ç¯å¢ƒæ˜¯ä¸æ˜¯H5ç«¯ï¼Œå¹¶ä¸”æ˜¯åœ¨å¾®ä¿¡æ‰“å¼€çš„ï¼Œ
å¦‚æœæ˜¯åœ¨æ‰‹æœºæµè§ˆå™¨ï¼šQQæµè§ˆå™¨ã€UCæµè§ˆå™¨ç­‰æ‰“å¼€ï¼Œåˆ™ä¸åšä»€ä¹ˆæ”¹å˜ï¼Œç•Œé¢å’Œå°ç¨‹åºã€appä¸€æ ·ã€‚
```js
export default {
	methods: {
		/**
		 * åˆ¤æ–­å½“å‰H5ç¯å¢ƒæ˜¯å¦åœ¨å¾®ä¿¡å†…ç½®æµè§ˆå™¨æ‰“å¼€
		 * @returns {Boolean} true:å¾®ä¿¡ç¯å¢ƒ false:éå¾®ä¿¡ç¯å¢ƒ
		 */
		isWeixinBrowser() {
			// éH5ç¯å¢ƒç›´æ¥è¿”å›false
			if (process.env.VUE_APP_PLATFORM !== 'h5') return false

			// è·å–æµè§ˆå™¨userAgentå¹¶è½¬æ¢ä¸ºå°å†™
			const ua = navigator.userAgent.toLowerCase()

			// æ£€æµ‹å¾®ä¿¡ç‰¹æœ‰æ ‡è¯†
			return ua.includes('micromessenger')
		},

		/**
		 * æ‰©å±•æ–¹æ³•ï¼šè·å–è¯¦ç»†çš„H5ç¯å¢ƒä¿¡æ¯
		 * @returns {Object} ç¯å¢ƒä¿¡æ¯å¯¹è±¡
		 */
		getBrowserEnv() {
			if (process.env.VUE_APP_PLATFORM !== 'h5') {
				return {
					inWeixin: false,
					inQQ: false,
					inWeibo: false
				}
			}

			const ua = navigator.userAgent.toLowerCase()
			return {
				inWeixin: ua.includes('micromessenger'), // å¾®ä¿¡æµè§ˆå™¨
				inQQ: ua.includes('qq/'), // QQå†…ç½®æµè§ˆå™¨
				inWeibo: ua.includes('weibo'), // å¾®åšå†…ç½®æµè§ˆå™¨
				inAlipay: ua.includes('alipay'), // æ”¯ä»˜å®æµè§ˆå™¨
				inUC: ua.includes('ucbrowser'), // UCæµè§ˆå™¨
				isMobile: /mobile|android|iphone|ipad/.test(ua) // æ˜¯å¦ç§»åŠ¨è®¾å¤‡
			}
		},
		...
	}
}
```
2. åœ¨ `/common/css/common.nvue.vue.css` å…¬å…±æ ·å¼æ·»åŠ ä¸€ä¸ªç½®é¡¶æ ·å¼çš„èƒŒæ™¯è‰² <br/>
è¿™ä¸ªèƒŒæ™¯è‰²å’Œå¾®ä¿¡çš„é¢œè‰²ä¸€è‡´ï¼Œä¾¿äºèåˆç½®é¡¶éƒ¨åˆ†
```css
    .bg-zhiding{
		background-color: #EDEDED;
	}
```
3. åœ¨é¡µé¢ ï¼š `/pages/xiaoxi/xiaoxi.nvue`
```vue
    <!-- å¯¼èˆªæ  -->
    <chat-navbar title="æ¶ˆæ¯ï¼ˆ100ï¼‰" :fixed="true" 
	:h5WeiXinNeedNavbar="false"></chat-navbar>
```

4. åœ¨ç»„ä»¶ `/components/chat-navbar/chat-navbar.vue`
```vue 
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		<view :class="[fixed ? 'fixed-top' : '',weixinClass,navbarClass]"
		v-if="needNavbar">
			...
		</view>
		<!-- å ä½ç¬¦ï¼šå ç”¨ çŠ¶æ€æ  + å¯¼èˆªæ çš„é«˜åº¦ -->
		<view :style="fixedHeightStyle" v-if="fixed && needNavbar"></view>
		
		<!-- å¯¼èˆªæ ç‚¹å‡»åŠ å·çš„å¼¹å‡ºèœå• -->
		...
			
	</view>
</template>

<script>
	import toolJs from '@/common/mixins/tool.js';
	export default {
		...,
		mixins:[toolJs],
		props:{
			...,
			// h5ç«¯åœ¨å¾®ä¿¡æ‰“å¼€æ˜¯å¦éœ€è¦å¯¼èˆªæ 
			h5WeiXinNeedNavbar:{
				type:Boolean,
				default:false
			}
		},
		data() {
			return {
				weixinClass:'', // å¾®ä¿¡ä¸Šå¯¼èˆªæ é¢œè‰²
				needNavbar:true, // æ˜¯å¦éœ€è¦å¯¼èˆªæ 
				...
			}
		},
		mounted() {
			...
			if (this.isWeixinBrowser()) {
			    console.log('è¿è¡Œåœ¨å¾®ä¿¡å†…ç½®æµè§ˆå™¨')
				this.needNavbar = this.h5WeiXinNeedNavbar ? true : false;
				this.weixinClass = this.h5WeiXinNeedNavbar ? 'bg-zhiding': '';
			}
			    
			// è·å–è¯¦ç»†ç¯å¢ƒä¿¡æ¯
			const env = this.getBrowserEnv()
			console.log('ç¯å¢ƒä¿¡æ¯:', env)
		},
		...
	}
</script>
```


5. åœ¨ç»„ä»¶ `/components/chat-chatlist/chat-chatlist.vue` 
```vue
<template>
	<view ... :class="bgClass">
		...
	</view>
</template>

<script>
	import toolJs from '@/common/mixins/tool.js';
	export default{
		...
		mixins:[toolJs],
		...,
		computed:{
			bgClass(){
				/*
				if(this.item.isZhiding){
					if(this.isWeixinBrowser()){
						return 'bg-zhiding'
					}else{
						return 'bg-light';
					}
				}else{
					return 'bg-white';
				}
				*/
			   return  this.item.isZhiding ? this.isWeixinBrowser() ? 
			   'bg-zhiding' : 'bg-light' : 'bg-white';
			}
		}
	}
</script>
```

### 3. èŠå¤©é¡µèåˆåˆ°å¾®ä¿¡ï¼ˆæ ¹æ®è‡ªå·±å–œå¥½è®¾ç½®ï¼‰
åœ¨é¡µé¢ `pages/chat/chat.nvue`
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		<chat-navbar ... :h5WeiXinNeedNavbar="false">
		    ...
		</chat-navbar>
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		...
        <!-- å¼¹å‡ºèœå• -->
	    ...
	</view>
</template>

<script>
	import toolJs from '@/common/mixins/tool.js';
	export default {
		mixins:[toolJs],
		data() {
			return {
				h5WeiXinNeedNavbar:false, // h5ç«¯å¾®ä¿¡ä¸Šæ˜¯å¦éœ€è¦å¯¼èˆªæ 
				...
			}
		},
		...
		computed:{
			chatContentStyle(){
				...
				let bottom = pbottom + uni.upx2px(90 + 12) + this.KeyboardHeight;
				// å¦‚æœæ˜¯H5ç«¯å¾®ä¿¡æ‰“å¼€é¡µé¢
				if(this.isWeixinBrowser() && !this.h5WeiXinNeedNavbar){
					this.fixedHeight = this.statusBarHeight + 0;
					uni.setNavigationBarTitle({
						title:'é˜¿ç¥–'
					});
				}
				// #ifdef APP || MP
				...
				// #endif
				return ...;
			},
			...
		},
		...
	}
</script>
```

## ä¸ƒã€ã€é€‰ä¿®ã€‘è°ƒæ•´è¡¨æƒ…åŒ…æ’å¸ƒï¼ˆæŠŠemojiè¡¨æƒ…æ”¾åœ¨ç¬¬ä¸€é¡µï¼Œemojiå’Œæ–‡å­—ä¸€èµ·å‘é€ï¼‰
åœ¨é¡µé¢ `pages/chat/chat.nvue` å®Œæ•´ä»£ç 
### 1. è°ƒæ•´å‰çš„å®Œæ•´ä»£ç 
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		<chat-navbar title="èŠå¤©" :fixed="true"
		:showPlus="false" :showUser="false"
		:showBack="true" navbarClass="bg-light"
		:h5WeiXinNeedNavbar="h5WeiXinNeedNavbar">
		    <chat-navbar-icon-button slot="right"
			@click="openMore" >
		    	<text class="iconfont font-lg">&#xe626;</text>
		    </chat-navbar-icon-button>
		</chat-navbar>
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		<scroll-view scroll-y class="bg-light position-fixed left-0 right-0"
		:style="chatContentStyle" :show-scrollbar="false" @scroll="onScroll"
		:scroll-into-view="scrollIntoViewId" >
			<!-- å¯¹è¯éƒ¨åˆ† -->
			<view v-for="(item,index) in chatDataList" :key="index"
			:id="'chat-item-'+index">
				<chat-item :item="item" :index="index"
				:prevTime="index>0 ? chatDataList[index-1].chat_time : 0"
				ref="chatItem"></chat-item>
			</view>
		</scroll-view>
		<!-- é’ˆå¯¹æˆ‘ä»¬çš„appç«¯ç‚¹å‡»èŠå¤©åŒºåŸŸæˆæƒåŠ å·æ‰©å±•èœå• -->
		<!-- #ifdef APP -->
		<view v-if="sendMessageMode == 'plus' || sendMessageMode == 'icon'"
		class="position-fixed left-0 right-0"
		:style="chatContentStyle"
		@click="scrollViewClick"></view>
		<!-- #endif -->
		
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ -->
		<view class="position-fixed bottom-0 border-top
		flex flex-row align-center justify-between"
		style="background-color: #f7f7f7;width: 750rpx;
		min-height: 90rpx;max-height: 320rpx;
		padding-top: 12rpx;"
		:style="chatBottomStyle">
		    <!-- å·¦è¾¹ -->
			<view class="flex align-center">
				<!-- å›¾æ ‡ -->
				<chat-navbar-icon-button>
					<text class="iconfont font-lg">&#xe643;</text>
				</chat-navbar-icon-button>
				<!-- è¾“å…¥æ¡† -->
				<view class="flex align-center font-sm
				bg-white px-2 py-1 border rounded">
					<textarea fixed auto-height :maxlength="-1"
					style="width: 440rpx;min-height: 60rpx;
					max-height: 274rpx;overflow-y: scroll;
					text-align: justify;"
					:adjust-position="false"
					v-model="messageValue"
					@focus="textareaFocus"></textarea>
				</view>
			</view>
			<!-- å³è¾¹ -->
			<view class="flex align-center">
				<!-- è¡¨æƒ… -->
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openIcon">
					<text class="iconfont font-lg">&#xe642;</text>
				</chat-navbar-icon-button>
				<!-- åŠ å· -->
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openPlus">
					<text class="iconfont font-lg">&#xe637;</text>
				</chat-navbar-icon-button>
				<!-- å‘é€æŒ‰é’® -->
				<view v-if="messageValue"
				class="rounded bg-success px-2 py-1 mr-4"
				hover-class="bg-hover-success" 
				@click="sendMessage('text')">
				   <text class="font text-white">å‘é€</text>
				</view>
			</view>
		</view>
	
	
	     <!-- å¼¹å‡ºèœå• -->
	     <chat-tooltip ref="tooltipPlus" :mask="chatTooltipMask" 
	     :maskTransparent="true" :isBottom="true" 
	     :tooltipWidth="750"
	     :tooltipHeight="tooltipHeight"
		 transformOrigin = "center bottom"
		 tooltipClass ="bg-light border-0 rounded-0"
		 @hideTooltip="hideTooltip">
	     	<view class="border-top border-light-secondary">
				<swiper :indicator-dots="pageCount > 1" :duration="1000"
				:style="tooltipPlusMenuStyle">
				    <!-- åŠ¨æ€åˆ†é¡µ -->
					<swiper-item v-for="(page,index) in groupedPlusMenus" :key="index">
						<view class="flex flex-row justify-start flex-wrap"
						:style="swiperItemStyle">
						    <!-- æ¯é¡µæ˜¾ç¤º8ä¸ª -->
							<view class="col-3 flex flex-column justify-center align-center"
							style="height: 260rpx;align-items: center;
							justify-content: center;"
							v-for="(item,itemIndex) in page" :key="itemIndex"
							@click="swiperItemClick(item,itemIndex)">
								<!-- å›¾æ ‡ -->
								<view class="bg-white rounded-lg 
								flex flex-row align-center justify-center mb-2"
								style="width:120rpx;height: 120rpx;">
								    <!-- å›¾ç‰‡ -->
									<!-- <image v-if="item.iconType == 'image'"
									:src="item.icon" style="width: 100%;height:100%"
									mode="aspectFit"></image> -->
									<u--image
									:src="item.icon" v-if="item.iconType == 'image'"             
									mode="aspectFit"
									width="120rpx" height="120rpx" 
									radius="0rpx"></u--image>
									<!-- emojiç±»å‹ -->
									<text v-if="item.iconType == 'emoji'"
									style="font-size: 40px;color: #222222;">{{item.icon}}</text>
								    <!-- è‡ªå®šä¹‰å›¾æ ‡ -->
									<text v-if="item.iconType == 'custom'"
									class="iconfont"
									style="font-size: 26px;color: #222222;">{{item.icon}}</text>
									<!-- uviewUiæ¡†æ¶çš„å›¾æ ‡ -->
									<u-icon v-if="item.iconType == 'uview'"
									:name="item.icon" color="#222222" size="26"></u-icon>
								</view>
								<!-- åç§° -->
								<text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
			</view>
	     </chat-tooltip>	
	</view>
</template>

<script>
	import toolJs from '@/common/mixins/tool.js';
	export default {
		mixins:[toolJs],
		data() {
			return {
				h5WeiXinNeedNavbar:false, // h5ç«¯å¾®ä¿¡ä¸Šæ˜¯å¦éœ€è¦å¯¼èˆªæ 
				statusBarHeight:0,//çŠ¶æ€æ é«˜åº¦åŠ¨æ€è®¡ç®—
				fixedHeight:0, //å ä½ï¼šçŠ¶æ€æ +å¯¼èˆªæ 
				bottomSafeAreaHeight:0, // åº•éƒ¨å®‰å…¨è·ç¦»
				KeyboardHeight:0, //é”®ç›˜é«˜åº¦
				scrollIntoViewId:'', // æ»šåŠ¨åˆ°æŒ‡å®šçš„å…ƒç´ id
				messageValue:'', // å‘é€çš„å†…å®¹ä¿¡æ¯
				tooltipHeight:600, // åŠ å·å¼¹å‡ºèœå•çš„é«˜åº¦rpx
				sendMessageMode:"text",//å‘é€æ¶ˆæ¯çš„æƒ…å†µï¼šæ–‡å­—|è¯­éŸ³|åŠ å·|è¡¨æƒ…
				// #ifdef MP || H5
				chatTooltipMask:true,
				// #endif
				// #ifdef APP
				chatTooltipMask:false,
				// #endif
				iconMenus:[
					{ name:"å¾®ç¬‘", icon:"/static/tabbar/index.png", 
					iconType:"image", eventType:"smile" },
					{ name:"å˜¿å˜¿", icon:"ğŸ˜€",
					iconType:"emoji", eventType:"heihei" },
					{ name: "å—¯ï¼Œå“¼", icon: "https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/iconMenus/en.gif", iconType: "image", eventType: "enheng" },
				],
				plusMenus:[ // åŠ å·æ‰©å±•èœå•æ ç›®
					{ name:"ç…§ç‰‡", icon:"photo", iconType:"uview", eventType:"photo" },
					{ name:"ä½ç½®", icon:"map", iconType:"uview", eventType:"map" },
					{ name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
					{ name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
					{ name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
					// { name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
					// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
					// { name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
					// { name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
					// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
					// { name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
				],
				chatDataList:[
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148439,
						data: 'è€å¸ˆä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹æœ¬å­£è¯¾ç¨‹ï¼Œå¦‚æœæˆ‘ä¸å­¦ä¹ ä¸Šä¸€ä¸ªå­£åº¦ï¼Œå¯ä»¥ç›´æ¥å­¦ä¹ æœ¬å­£åº¦å—ï¼Ÿ',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname: 'å°äºŒå“¥',
						chat_time: 1750148449,
						data: 'åŒå­¦ä½ å¥½ï¼Œå¦‚æœä¸å­¦ä¹ ä¸Šä¸€ä¸ªå­£åº¦è¯¾ç¨‹ï¼Œå¦‚æœä½ æœ‰vueçš„åŸºç¡€å’Œjsçš„åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥å­¦ä¹ æœ¬å­£åº¦è¯¾ç¨‹',
						user_id: 2,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148759,
						data: 'å¥½çš„ï¼Œæˆ‘äº†è§£äº†ï¼Œè°¢è°¢è€å¸ˆ',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname: 'å°äºŒå“¥',
						chat_time: 1750148859,
						data: 'ä¸ç”¨è°¢',
						user_id: 2,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148879,
						data: 'ok',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148879,
						data: 'å“ˆå“ˆå“ˆ',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148879,
						data: 'å—¯å•¦',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
				],
			}
		},
		mounted() {
			let info = uni.getSystemInfoSync();
			this.statusBarHeight = info.statusBarHeight;
			this.fixedHeight = this.statusBarHeight + uni.upx2px(90);
			this.bottomSafeAreaHeight = info.safeAreaInsets.bottom;
			// ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–
			uni.onKeyboardHeightChange(res=>{
				console.log('é”®ç›˜é«˜åº¦å˜åŒ–',res);
				// #ifdef H5 || MP
				this.KeyboardHeight = res.height;
				// #endif
				// #ifdef APP
				console.log('æ­¤æ—¶çš„è¾“å…¥æ¨¡å¼', this.sendMessageMode);
				if(this.sendMessageMode != 'plus' && this.sendMessageMode != 'icon'){
					this.KeyboardHeight = res.height;
				}
				// #endif
				if(this.KeyboardHeight){
					this.chatContentToBottom();
				}
			});
			// é¡µé¢åŠ è½½å®Œäº†ä¹‹åå°±åº”è¯¥æ»šåŠ¨åˆ°åº•éƒ¨
			this.$nextTick(()=>{
				this.chatContentToBottom();
			});
		},
		computed:{
			chatContentStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				let bottom = pbottom + uni.upx2px(90 + 12) + this.KeyboardHeight;
				//å¦‚æœæ˜¯h5ç«¯ç”¨å¾®ä¿¡æ‰“å¼€å¹¶ä¸”ä¸éœ€è¦å¯¼èˆªæ çš„æ—¶å€™
				if(this.isWeixinBrowser() && !this.h5WeiXinNeedNavbar){
					this.fixedHeight = this.statusBarHeight + 0;
					uni.setNavigationBarTitle({
						title:'é˜¿ç¥–'
					});
				}
				// #ifdef APP || MP
				if(this.KeyboardHeight){
					bottom = uni.upx2px(90 + 12 + 12) + this.KeyboardHeight;
				}
				// #endif
				return `top:${this.fixedHeight}px;bottom:${bottom}px;`;
			},
			chatBottomStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				// #ifdef APP || MP
				if(this.KeyboardHeight){
					pbottom = uni.upx2px(12);
				}
				// #endif
				return `padding-bottom: ${pbottom}px;bottom:${this.KeyboardHeight}px;`;
			},
			//åŠ å·èœå•æ¯é¡µçš„æ»‘åŠ¨æ ·å¼
			tooltipPlusMenuStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				// #ifdef APP || MP
				pbottom = this.bottomSafeAreaHeight;
				// #endif
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			//åŠ å·èœå•æ¯é¡µçš„å¸ƒå±€æ ·å¼
			swiperItemStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			// åŠ å·èœå•åˆ†é¡µ
			groupedPlusMenus(){
				const perPage = 8; // æ¯é¡µ8ä¸ª
				const result = [];
				// å°†æ•°ç»„plusMenusæˆ–è€…iconMenusæ¯é¡µ8ä¸ªåˆ†ç»„
				for(let i=0;i<this.tooltipPlusMenusOrIconMenus.length; i += perPage){
					result.push(this.tooltipPlusMenusOrIconMenus.slice(i, i + perPage))
				}
				return result;
			},
			//è®¡ç®—æ€»é¡µæ•°
			pageCount(){
				return Math.ceil(this.tooltipPlusMenusOrIconMenus.length / 8);
			},
			// æ‰©å±•èœå•æˆ–è€…è¡¨æƒ…åŒ…æ•°æ®æº
			tooltipPlusMenusOrIconMenus(){
				if(this.sendMessageMode == 'plus' || this.sendMessageMode == 'icon'){
					return this[`${this.sendMessageMode}Menus`]
				}
				return [];
			}
		},
		methods: {
			//ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹
			swiperItemClick(item,itemIndex){
				if(this.sendMessageMode == 'icon'){
					console.log('ç‚¹å‡»äº†è¡¨æƒ…åŒ…é‡Œé¢çš„æŸä¸ªè¡¨æƒ…');
					// this.messageValue +=  `[${item.name}]`;
					this.sendMessage('iconMenus',item)
					
				}else{
					console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
					switch (item.eventType){
						case 'phote':
							break;
						case 'map':
							break;
						case 'camera':
							break;
						case 'mingpian':
							break;
						case 'video':
							break;
					}
				}
			},
			//ç‚¹å‡»èŠå¤©åŒºåŸŸ
			scrollViewClick(){
				// #ifdef APP
				console.log('ç‚¹å‡»èŠå¤©åŒºåŸŸ');
				this.KeyboardHeight = 0;
				uni.hideKeyboard();
				this.$refs.tooltipPlus.hide();
				this.sendMessageMode = "text";
				// #endif
			},
			// æ–‡æœ¬è¾“å…¥æ¡†èšç„¦
			textareaFocus(){
				// #ifdef APP
				this.sendMessageMode = "text";
				// #endif
			},
			//ç‚¹å‡»ç¬‘è„¸å›¾æ ‡
			openIcon(){
				console.log('ç‚¹å‡»äº†ç¬‘è„¸');
				// #ifdef APP
				this.sendMessageMode = "icon";
				uni.hideKeyboard();
				// #endif
				// #ifdef H5 || MP
				this.sendMessageMode = "icon";
				// #endif
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
			},
			//ç‚¹å‡»äº†åŠ å·
			openPlus(){
				console.log('ç‚¹å‡»äº†åŠ å·');
				// #ifdef APP
				this.sendMessageMode = "plus";
				uni.hideKeyboard();
				// #endif
				// #ifdef H5 || MP
				this.sendMessageMode = "plus";
				// #endif
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
			},
			// å¼¹å‡ºæ¡†éšè—äº†
			hideTooltip(){
				console.log('å¼¹å‡ºæ¡†éšè—äº†');
				// #ifdef APP || MP || H5
				this.KeyboardHeight = 0;
				this.chatContentToBottom();
				// #endif
			},
			//å‘é€æ¶ˆæ¯
			sendMessage(msgType, option = {}){
				console.log('å‘é€æ¶ˆæ¯',msgType);
				let msg = {
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					user_id: 2,
					chat_time: (new Date()).getTime(),
					data: '',
					type:msgType, //image,video
					isremove:false,
				};
				switch (msgType){
					case 'text':
					    msg.data = this.messageValue;
					    break;
					case 'iconMenus':
					    console.log('iconMenusçš„æ•°æ®',option);
					    msg.data = option.icon;
						msg.dataType = option.iconType;
					    break;
				}
				this.chatDataList.push(msg);
				// æ¸…ç©ºå‘é€çš„å†…å®¹ç„¶åè¿˜è¦æ»šåŠ¨åˆ°åº•éƒ¨
				if(msgType == 'text') this.messageValue = '';
				this.chatContentToBottom();
			},
			openMore(){
				console.log('ç‚¹å‡»äº†ä¸‰ä¸ªç‚¹å›¾æ ‡');
			},
			//èŠå¤©å†…å®¹æ»šåˆ°åˆ°åº•éƒ¨
			chatContentToBottom(){
				// #ifdef APP
				let chatItems =  this.$refs.chatItem;
				let lastIndex = chatItems.length - 1 == 0 ? 0 : chatItems.length - 1;
				let last = chatItems[lastIndex];
				const dom =  weex.requireModule('dom');
				dom.scrollToElement(last, {});
				// #endif
				// #ifdef MP || H5
				if(this.chatDataList.length == 0) return;
				const lastIndex = this.chatDataList.length - 1;
				this.scrollIntoViewId = `chat-item-${lastIndex}`;
				setTimeout(()=>{
					this.scrollIntoViewId = '';
					this.$nextTick(()=>{
						this.scrollIntoViewId = `chat-item-${lastIndex}`;
					});
				},100)
				// #endif
			},
			onScroll(){
				console.log('é¡µé¢å‘ç”Ÿäº†æ»šåŠ¨');
			}
		},
		watch:{
			// ç›‘å¬èŠå¤©è®°å½•æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
			chatDataList:{
				handler(){
					this.$nextTick(()=>{
						this.chatContentToBottom();
					});
				},
				deep:true
			},
			sendMessageMode(newVal,oldVal){
				// #ifdef APP
				console.log('ç›‘å¬å‘é€æ¨¡å¼',newVal);
				if(newVal != 'plus' && newVal != 'icon'){
					this.$refs.tooltipPlus.hide();
				}
				// #endif
			},
		},
	}
</script>

<style>
    /* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
	
	
</style>

```

### 2. è°ƒæ•´åçš„å®Œæ•´ä»£ç 
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		<chat-navbar title="èŠå¤©" :fixed="true"
		:showPlus="false" :showUser="false"
		:showBack="true" navbarClass="bg-light"
		:h5WeiXinNeedNavbar="h5WeiXinNeedNavbar">
		    <chat-navbar-icon-button slot="right"
			@click="openMore" >
		    	<text class="iconfont font-lg">&#xe626;</text>
		    </chat-navbar-icon-button>
		</chat-navbar>
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		<scroll-view scroll-y class="bg-light position-fixed left-0 right-0"
		:style="chatContentStyle" :show-scrollbar="false" @scroll="onScroll"
		:scroll-into-view="scrollIntoViewId" >
			<!-- å¯¹è¯éƒ¨åˆ† -->
			<view v-for="(item,index) in chatDataList" :key="index"
			:id="'chat-item-'+index">
				<chat-item :item="item" :index="index"
				:prevTime="index>0 ? chatDataList[index-1].chat_time : 0"
				ref="chatItem"></chat-item>
			</view>
		</scroll-view>
		<!-- é’ˆå¯¹æˆ‘ä»¬çš„appç«¯ç‚¹å‡»èŠå¤©åŒºåŸŸæˆæƒåŠ å·æ‰©å±•èœå• -->
		<!-- #ifdef APP -->
		<view v-if="sendMessageMode == 'plus' || sendMessageMode == 'icon'"
		class="position-fixed left-0 right-0"
		:style="chatContentStyle"
		@click="scrollViewClick"></view>
		<!-- #endif -->
		
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ --><!-- ä¿®æ”¹ï¼šæ·»åŠ refè·å–textareaå®ä¾‹ -->
		<view class="position-fixed bottom-0 border-top
		flex flex-row align-center justify-between"
		style="background-color: #f7f7f7;width: 750rpx;
		min-height: 90rpx;max-height: 320rpx;
		padding-top: 12rpx;"
		:style="chatBottomStyle">
			<view class="flex align-center">
				<chat-navbar-icon-button>
					<text class="iconfont font-lg">&#xe643;</text>
				</chat-navbar-icon-button>
				<view class="flex align-center font-sm
				bg-white px-2 py-1 border rounded">
					<textarea ref="textarea" fixed auto-height :maxlength="-1"
					style="width: 440rpx;min-height: 60rpx;
					max-height: 274rpx;overflow-y: scroll;
					text-align: justify;"
					:adjust-position="false"
					v-model="messageValue"
					@focus="textareaFocus"
					@input="onTextareaInput" 
					@blur="onTextareaBlur" ><!-- æ–°å¢ï¼šç›‘å¬å¤±ç„¦äº‹ä»¶ --><!-- æ–°å¢ï¼šç›‘å¬è¾“å…¥äº‹ä»¶ -->
					</textarea>
				</view>
			</view>
			<view class="flex align-center">
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openIcon">
					<text class="iconfont font-lg">&#xe642;</text>
				</chat-navbar-icon-button>
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openPlus">
					<text class="iconfont font-lg">&#xe637;</text>
				</chat-navbar-icon-button>
				<view v-if="messageValue"
				class="rounded bg-success px-2 py-1 mr-4"
				hover-class="bg-hover-success" 
				@click="sendMessage('text')">
				   <text class="font text-white">å‘é€</text>
				</view>
			</view>
		</view>
	
	
	     <!-- å¼¹å‡ºèœå• --><!-- ä¸»è¦ä¿®æ”¹åŒºåŸŸ -->
		 <chat-tooltip ref="tooltipPlus" :mask="chatTooltipMask" 
		 :maskTransparent="true" :isBottom="true" 
		 :tooltipWidth="750"
		 :tooltipHeight="tooltipHeight"
		 transformOrigin = "center bottom"
		 tooltipClass ="bg-light border-0 rounded-0"
		 @hideTooltip="hideTooltip">
			<view class="border-top border-light-secondary">
				<!-- è¡¨æƒ…èœå• -->
				<swiper v-if="sendMessageMode === 'icon'" 
				:indicator-dots="groupedIconMenus.length > 1" 
				:duration="1000"
				:style="tooltipPlusMenuStyle"
				@change="handleSwiperChange"><!-- æ·»åŠ åˆ†é¡µåˆ‡æ¢äº‹ä»¶ -->
					<!-- ç¬¬ä¸€é¡µï¼šemojiè¡¨æƒ…ï¼ˆæ»šåŠ¨æ˜¾ç¤ºï¼‰ -->
					<swiper-item v-if="emojiPageItems.length > 0">
						<scroll-view scroll-y style="height: 100%;">
							<view class="flex flex-row flex-wrap justify-start">
								<view v-for="(item,itemIndex) in emojiPageItems" 
								:key="itemIndex"
								class="flex flex-column justify-center align-center"
								style="width: 12.5%; height: 120rpx; padding: 10rpx;"
								@click="insertEmoji(item)">
									<text style="font-size: 50rpx;">{{item.icon}}</text>
								</view>
							</view>
						</scroll-view>
					</swiper-item>
					
					<!-- å…¶ä»–ç±»å‹è¡¨æƒ…åˆ†é¡µæ˜¾ç¤º -->
					<swiper-item v-for="(page,pageIndex) in otherPages" 
					:key="pageIndex">
						<view class="flex flex-row flex-wrap justify-start">
							<view v-for="(item,itemIndex) in page" 
							:key="pageIndex+itemIndex"
							class="col-3 flex flex-column justify-center align-center"
							style="height: 260rpx;"
							@click="item ? swiperItemClick(item,itemIndex) : null"
							><!-- å°ç¨‹åºæ·»åŠ ç©ºå€¼æ£€æŸ¥ -->
								<view class="bg-white rounded-lg flex flex-row 
								align-center justify-center mb-2"
								style="width:120rpx;height: 120rpx;">
									<u--image v-if="item.iconType == 'image'"
									:src="item.icon" mode="aspectFit"
									width="120rpx" height="120rpx" radius="0rpx"></u--image>
									<text v-if="item.iconType == 'emoji'"
									style="font-size: 40px;color: #222222;">{{item.icon}}</text>
									<text v-if="item.iconType == 'custom'"
									class="iconfont"
									style="font-size: 26px;color: #222222;">{{item.icon}}</text>
									<u-icon v-if="item.iconType == 'uview'"
									:name="item.icon" color="#222222" size="26"></u-icon>
								</view>
								<text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
				
				<!-- åŠ å·èœå•ï¼ˆä¿æŒä¸å˜ï¼‰ -->
				<swiper v-else-if="sendMessageMode === 'plus'"
				:indicator-dots="pageCount > 1" :duration="1000"
				:style="tooltipPlusMenuStyle">
					<swiper-item v-for="(page,index) in groupedPlusMenus" :key="index">
						<view class="flex flex-row justify-start flex-wrap"
						:style="swiperItemStyle">
							<view class="col-3 flex flex-column justify-center align-center"
							style="height: 260rpx;"
							v-for="(item,itemIndex) in page" :key="itemIndex"
							@click="swiperItemClick(item,itemIndex)">
								<view class="bg-white rounded-lg 
								flex flex-row align-center justify-center mb-2"
								style="width:120rpx;height: 120rpx;">
									<u--image v-if="item.iconType == 'image'"
									:src="item.icon" mode="aspectFit"
									width="120rpx" height="120rpx" radius="0rpx"></u--image>
									<text v-if="item.iconType == 'emoji'"
									style="font-size: 40px;color: #222222;">{{item.icon}}</text>
									<text v-if="item.iconType == 'custom'"
									class="iconfont"
									style="font-size: 26px;color: #222222;">{{item.icon}}</text>
									<u-icon v-if="item.iconType == 'uview'"
									:name="item.icon" color="#222222" size="26"></u-icon>
								</view>
								<text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
			</view>
		 </chat-tooltip>	
	</view>
</template>

<script>
	import toolJs from '@/common/mixins/tool.js';
	export default {
		mixins:[toolJs],
		data() {
			return {
				cursorPos: 0, // æ–°å¢ï¼šè®°å½•textareaå…‰æ ‡ä½ç½®
				h5WeiXinNeedNavbar:false, // h5ç«¯å¾®ä¿¡ä¸Šæ˜¯å¦éœ€è¦å¯¼èˆªæ 
				statusBarHeight:0,//çŠ¶æ€æ é«˜åº¦åŠ¨æ€è®¡ç®—
				fixedHeight:0, //å ä½ï¼šçŠ¶æ€æ +å¯¼èˆªæ 
				bottomSafeAreaHeight:0, // åº•éƒ¨å®‰å…¨è·ç¦»
				KeyboardHeight:0, //é”®ç›˜é«˜åº¦
				scrollIntoViewId:'', // æ»šåŠ¨åˆ°æŒ‡å®šçš„å…ƒç´ id
				messageValue:'', // å‘é€çš„å†…å®¹ä¿¡æ¯
				tooltipHeight:600, // åŠ å·å¼¹å‡ºèœå•çš„é«˜åº¦rpx
				sendMessageMode:"text",//å‘é€æ¶ˆæ¯çš„æƒ…å†µï¼šæ–‡å­—|è¯­éŸ³|åŠ å·|è¡¨æƒ…
				// #ifdef MP || H5
				chatTooltipMask:true,
				// #endif
				// #ifdef APP
				chatTooltipMask:false,
				// #endif
				iconMenus:[
					{ name:"å¾®ç¬‘", icon:"/static/tabbar/index.png",
					iconType:"image", eventType:"smile" },
					{ name:"å˜¿å˜¿", icon:"ğŸ˜€",
					iconType:"emoji", eventType:"heihei" },
					{ name: "å—¯ï¼Œå“¼", icon: "https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/iconMenus/en.gif", iconType: "image", eventType: "enheng" },
					{ name:"å˜»å˜»", icon:"ğŸ˜",
					iconType:"emoji", eventType:"xixi" },
					{ name:"ç¬‘å“­äº†", icon:"ğŸ˜‚",
					iconType:"emoji", eventType:"xiaokule" },
					{ name:"å“ˆå“ˆ", icon:"ğŸ˜ƒ",
					iconType:"emoji", eventType:"haha" },
					{ name:"å¤§ç¬‘", icon:"ğŸ˜„",
					iconType:"emoji", eventType:"daxiao" },
					{ name:"è‹¦ç¬‘", icon:"ğŸ˜…",
					iconType:"emoji", eventType:"kuxiao" },
					{ name:"æ–œçœ¼ç¬‘", icon:"ğŸ˜†",
					iconType:"emoji", eventType:"xieyanxiao" },
					{ name:"å¾®ç¬‘å¤©ä½¿", icon:"ğŸ˜‡",
					iconType:"emoji", eventType:"weixiaotianshi" },
					{ name:"çœ¨çœ¼", icon:"ğŸ˜‰",
					iconType:"emoji", eventType:"zhayan" },
					{ name:"ç¾æ¶©å¾®ç¬‘", icon:"ğŸ˜Š",
					iconType:"emoji", eventType:"xiuseweixiao" },
					{ name:"å‘µå‘µ", icon:"ğŸ™‚",
					iconType:"emoji", eventType:"hehe" },
					{ name:"å€’è„¸", icon:"ğŸ™ƒ",
					iconType:"emoji", eventType:"daolian" },
					{ name:"ç¬‘å¾—æ»¡åœ°æ‰“æ»š", icon:"ğŸ¤£",
					iconType:"emoji", eventType:"xiaodemandidagun" },
				],
				plusMenus:[ // åŠ å·æ‰©å±•èœå•æ ç›®
					{ name:"ç…§ç‰‡", icon:"photo", iconType:"uview", eventType:"photo" },
					{ name:"ä½ç½®", icon:"map", iconType:"uview", eventType:"map" },
					{ name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
					{ name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
					{ name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
					// { name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
					// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
					// { name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
					// { name:"æ‹æ‘„", icon:"\ue62c", iconType:"custom", eventType:"camera" },
					// { name:"æˆ‘çš„åç‰‡", icon:"\ue69d", iconType:"custom", eventType:"mingpian" },
					// { name:"è§†é¢‘", icon:"\ue66d", iconType:"custom", eventType:"video" },
				],
				chatDataList:[
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148439,
						data: 'è€å¸ˆä½ å¥½ï¼Œæˆ‘æƒ³å’¨è¯¢ä¸€ä¸‹æœ¬å­£è¯¾ç¨‹ï¼Œå¦‚æœæˆ‘ä¸å­¦ä¹ ä¸Šä¸€ä¸ªå­£åº¦ï¼Œå¯ä»¥ç›´æ¥å­¦ä¹ æœ¬å­£åº¦å—ï¼Ÿ',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname: 'å°äºŒå“¥',
						chat_time: 1750148449,
						data: 'åŒå­¦ä½ å¥½ï¼Œå¦‚æœä¸å­¦ä¹ ä¸Šä¸€ä¸ªå­£åº¦è¯¾ç¨‹ï¼Œå¦‚æœä½ æœ‰vueçš„åŸºç¡€å’Œjsçš„åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿå¯ä»¥å­¦ä¹ æœ¬å­£åº¦è¯¾ç¨‹',
						user_id: 2,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148759,
						data: 'å¥½çš„ï¼Œæˆ‘äº†è§£äº†ï¼Œè°¢è°¢è€å¸ˆ',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname: 'å°äºŒå“¥',
						chat_time: 1750148859,
						data: 'ä¸ç”¨è°¢',
						user_id: 2,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148879,
						data: 'ok',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148879,
						data: 'å“ˆå“ˆå“ˆ',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: 'å½¦ç¥–',
						chat_time: 1750148879,
						data: 'å—¯å•¦',
						user_id: 1,
						type:'text', //image,video
						isremove:false,
					},
				],
			}
		},
		mounted() {
			let info = uni.getSystemInfoSync();
			this.statusBarHeight = info.statusBarHeight;
			this.fixedHeight = this.statusBarHeight + uni.upx2px(90);
			this.bottomSafeAreaHeight = info.safeAreaInsets.bottom;
			// ç›‘å¬é”®ç›˜é«˜åº¦å˜åŒ–
			uni.onKeyboardHeightChange(res=>{
				console.log('é”®ç›˜é«˜åº¦å˜åŒ–',res);
				// #ifdef H5 || MP
				this.KeyboardHeight = res.height;
				// #endif
				// #ifdef APP
				console.log('æ­¤æ—¶çš„è¾“å…¥æ¨¡å¼', this.sendMessageMode);
				if(this.sendMessageMode != 'plus' && this.sendMessageMode != 'icon'){
					this.KeyboardHeight = res.height;
				}
				// #endif
				if(this.KeyboardHeight){
					this.chatContentToBottom();
				}
			});
			// é¡µé¢åŠ è½½å®Œäº†ä¹‹åå°±åº”è¯¥æ»šåŠ¨åˆ°åº•éƒ¨
			this.$nextTick(()=>{
				this.chatContentToBottom();
			});
		},
		computed:{
			chatContentStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				let bottom = pbottom + uni.upx2px(90 + 12) + this.KeyboardHeight;
				//å¦‚æœæ˜¯h5ç«¯ç”¨å¾®ä¿¡æ‰“å¼€å¹¶ä¸”ä¸éœ€è¦å¯¼èˆªæ çš„æ—¶å€™
				if(this.isWeixinBrowser() && !this.h5WeiXinNeedNavbar){
					this.fixedHeight = this.statusBarHeight + 0;
					uni.setNavigationBarTitle({
						title:'é˜¿ç¥–'
					});
				}
				// #ifdef APP || MP
				if(this.KeyboardHeight){
					bottom = uni.upx2px(90 + 12 + 12) + this.KeyboardHeight;
				}
				// #endif
				return `top:${this.fixedHeight}px;bottom:${bottom}px;`;
			},
			chatBottomStyle(){
				let pbottom = this.bottomSafeAreaHeight == 0 ?
				uni.upx2px(12) : this.bottomSafeAreaHeight;
				// #ifdef APP || MP
				if(this.KeyboardHeight){
					pbottom = uni.upx2px(12);
				}
				// #endif
				return `padding-bottom: ${pbottom}px;bottom:${this.KeyboardHeight}px;`;
			},
			//åŠ å·èœå•æ¯é¡µçš„æ»‘åŠ¨æ ·å¼
			tooltipPlusMenuStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				// #ifdef APP || MP
				pbottom = this.bottomSafeAreaHeight;
				// #endif
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			//åŠ å·èœå•æ¯é¡µçš„å¸ƒå±€æ ·å¼
			swiperItemStyle(){
				let pbottom = 0;
				let height = uni.upx2px(this.tooltipHeight - 1) - pbottom;
				return `padding-bottom:${pbottom}px;height:${height}px;`;
			},
			// åŠ å·èœå•åˆ†é¡µ
			// groupedPlusMenus(){
			// 	const perPage = 8; // æ¯é¡µ8ä¸ª
			// 	const result = [];
			// 	// å°†æ•°ç»„plusMenusæˆ–è€…iconMenusæ¯é¡µ8ä¸ªåˆ†ç»„
			// 	for(let i=0;i<this.tooltipPlusMenusOrIconMenus.length; i += perPage){
			// 		result.push(this.tooltipPlusMenusOrIconMenus.slice(i, i + perPage))
			// 	}
			// 	return result;
			// },
			//è®¡ç®—æ€»é¡µæ•°
			// pageCount(){
			// 	return Math.ceil(this.tooltipPlusMenusOrIconMenus.length / 8);
			// },
			// æ‰©å±•èœå•æˆ–è€…è¡¨æƒ…åŒ…æ•°æ®æº
			tooltipPlusMenusOrIconMenus(){
				if(this.sendMessageMode == 'plus' || this.sendMessageMode == 'icon'){
					return this[`${this.sendMessageMode}Menus`]
				}
				return [];
			},
			// ä¿®æ”¹ï¼šåŠ å·èœå•åˆ†é¡µè®¡ç®—
			groupedPlusMenus() {
				const perPage = 8; // æ¯é¡µ8ä¸ªï¼ˆ2è¡Œï¼‰
				const result = [];
				for (let i = 0; i < this.plusMenus.length; i += perPage) {
					result.push(this.plusMenus.slice(i, i + perPage));
				}
				return result;
			},
			// ä¿®æ”¹ï¼šè®¡ç®—æ€»é¡µæ•°ï¼ˆåˆ†åˆ«å¤„ç†ä¸¤ç§èœå•ï¼‰
			pageCount() {
				if (this.sendMessageMode === 'plus') {
					return Math.ceil(this.plusMenus.length / 8);
				} else if (this.sendMessageMode === 'icon') {
					return this.groupedIconMenus.length;
				}
				return 0;
			},
			// æ–°å¢ï¼šè¡¨æƒ…èœå•è®¡ç®—å±æ€§
			emojiList() {
				return this.iconMenus.filter(item => item.iconType === 'emoji');
			},
			otherList() {
				return this.iconMenus.filter(item => item.iconType !== 'emoji');
			},
			emojiPageItems() {
				return this.emojiList; // æ‰€æœ‰emojiè¡¨æƒ…æ”¾åœ¨ç¬¬ä¸€é¡µ
			},
			otherPages() {
				const perPage = 8; // æ¯é¡µ8ä¸ªï¼ˆ2è¡Œï¼‰
				const pages = [];
				for (let i = 0; i < this.otherList.length; i += perPage) {
					pages.push(this.otherList.slice(i, i + perPage));
				}
				return pages;
			},
			groupedIconMenus() {
				// æ€»é¡µæ•° = 1 (emojié¡µ) + å…¶ä»–ç±»å‹é¡µæ•°
				const pages = [];
				if (this.emojiPageItems.length > 0) {
					pages.push(this.emojiPageItems); // ç¬¬ä¸€é¡µæ”¾emoji
				}
				return pages.concat(this.otherPages);
			},
		},
		methods: {
			// æ–°å¢ï¼štextareaè¾“å…¥äº‹ä»¶è®°å½•å…‰æ ‡ä½ç½®
			onTextareaInput(e) {
				// #ifdef H5 || APP
				this.cursorPos = e.detail.cursor;
				// #endif
			},
			// æ–°å¢ï¼štextareaå¤±ç„¦äº‹ä»¶è®°å½•å…‰æ ‡ä½ç½®
			onTextareaBlur(e) {
				this.cursorPos = e.detail.cursor || this.messageValue.length;
			},
						
			// æ–°å¢ï¼šæ’å…¥è¡¨æƒ…åˆ°textarea
			insertEmoji(item) {
				if (!item || !item.icon) return;
				
				const emoji = item.icon;
				const text = this.messageValue || '';
				
				// æ’å…¥åˆ°å½“å‰å…‰æ ‡ä½ç½®
				const newText = text.substring(0, this.cursorPos) + 
							   emoji + 
							   text.substring(this.cursorPos);
				
				this.messageValue = newText;
				
				// æ›´æ–°å…‰æ ‡ä½ç½®ï¼ˆåœ¨æ’å…¥çš„è¡¨æƒ…åé¢ï¼‰
				const newCursorPos = this.cursorPos + emoji.length;
				this.cursorPos = newCursorPos;
				
				// è®¾ç½®å…‰æ ‡ä½ç½®ï¼ˆH5/APPæ”¯æŒï¼‰
				this.$nextTick(() => {
					if (!this.$refs.textarea) return;
					
					let textarea;
					
					// å¤„ç† H5 å¹³å°çš„ç‰¹æ®Šæƒ…å†µ
					// #ifdef H5
					textarea = this.$refs.textarea.$el; // è·å–åŸç”Ÿ DOM å…ƒç´ 
					// #endif
					
					// #ifndef H5
					textarea = this.$refs.textarea;
					// #endif
					
					if (textarea) {
						// å°è¯•è®¾ç½®å…‰æ ‡ä½ç½®
						if (typeof textarea.setSelectionRange === 'function') {
							try {
								textarea.setSelectionRange(newCursorPos, newCursorPos);
							} catch (e) {
								console.warn('è®¾ç½®å…‰æ ‡ä½ç½®å¤±è´¥', e);
							}
						}
						
						// ç¡®ä¿è¾“å…¥æ¡†èšç„¦
						if (typeof textarea.focus === 'function') {
							try {
								textarea.focus();
							} catch (e) {
								console.warn('èšç„¦è¾“å…¥æ¡†å¤±è´¥', e);
							}
						}
					}
				});
			},
			//ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹
			// swiperItemClick(item,itemIndex){
			// 	if(this.sendMessageMode == 'icon'){
			// 		console.log('ç‚¹å‡»äº†è¡¨æƒ…åŒ…é‡Œé¢çš„æŸä¸ªè¡¨æƒ…');
			// 		// this.messageValue +=  `[${item.name}]`;
			// 		this.sendMessage('iconMenus',item)
					
			// 	}else{
			// 		console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
			// 		switch (item.eventType){
			// 			case 'phote':
			// 				break;
			// 			case 'map':
			// 				break;
			// 			case 'camera':
			// 				break;
			// 			case 'mingpian':
			// 				break;
			// 			case 'video':
			// 				break;
			// 		}
			// 	}
			// },
			// ä¿®æ”¹ï¼šç‚¹å‡»èœå•é¡¹å¤„ç†
			swiperItemClick(item, itemIndex) {
				console.log('ç‚¹å‡»èœå•é¡¹å¤„ç†',item);
				if (!item) return; // é˜²æ­¢undefinedé”™è¯¯
				if (this.sendMessageMode === 'icon') {
					if (item.iconType === 'emoji') {
						this.insertEmoji(item); // emojiæ’å…¥è¾“å…¥æ¡†
					} else {
						this.sendMessage('iconMenus', item); // å…¶ä»–ç±»å‹ç›´æ¥å‘é€
					}
				} else {
					console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
					switch (item.eventType){
						case 'phote':
							break;
						case 'map':
							break;
						case 'camera':
							break;
						case 'mingpian':
							break;
						case 'video':
							break;
					}
				}
			},
			handleSwiperChange(e) {
			    console.log('åˆ†é¡µåˆ‡æ¢', e.detail.current);
			    // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†åˆ†é¡µåˆ‡æ¢é€»è¾‘
			},
			//ç‚¹å‡»èŠå¤©åŒºåŸŸ
			scrollViewClick(){
				// #ifdef APP
				console.log('ç‚¹å‡»èŠå¤©åŒºåŸŸ');
				this.KeyboardHeight = 0;
				uni.hideKeyboard();
				this.$refs.tooltipPlus.hide();
				this.sendMessageMode = "text";
				// #endif
			},
			// æ–‡æœ¬è¾“å…¥æ¡†èšç„¦
			textareaFocus(){
				// #ifdef APP
				this.sendMessageMode = "text";
				// #endif
			},
			//ç‚¹å‡»ç¬‘è„¸å›¾æ ‡
			openIcon(){
				console.log('ç‚¹å‡»äº†ç¬‘è„¸');
				// #ifdef APP
				this.sendMessageMode = "icon";
				uni.hideKeyboard();
				// #endif
				// #ifdef H5 || MP
				this.sendMessageMode = "icon";
				// #endif
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
			},
			//ç‚¹å‡»äº†åŠ å·
			openPlus(){
				console.log('ç‚¹å‡»äº†åŠ å·');
				// #ifdef APP
				this.sendMessageMode = "plus";
				uni.hideKeyboard();
				// #endif
				// #ifdef H5 || MP
				this.sendMessageMode = "plus";
				// #endif
				this.$refs.tooltipPlus.show();
				// #ifdef APP || MP || H5
				this.KeyboardHeight = uni.upx2px(this.tooltipHeight);
				this.chatContentToBottom();
				// #endif
			},
			// å¼¹å‡ºæ¡†éšè—äº†
			hideTooltip(){
				console.log('å¼¹å‡ºæ¡†éšè—äº†');
				// #ifdef APP || MP || H5
				this.KeyboardHeight = 0;
				this.chatContentToBottom();
				// #endif
			},
			//å‘é€æ¶ˆæ¯
			sendMessage(msgType, option = {}){
				console.log('å‘é€æ¶ˆæ¯',msgType);
				let msg = {
					avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
					nickname: 'å°äºŒå“¥',
					user_id: 2,
					chat_time: (new Date()).getTime(),
					data: '',
					type:msgType, //image,video
					isremove:false,
				};
				switch (msgType){
					case 'text':
					    msg.data = this.messageValue;
					    break;
					case 'iconMenus':
					    console.log('iconMenusçš„æ•°æ®',option);
					    msg.data = option.icon;
						msg.dataType = option.iconType;
					    break;
				}
				this.chatDataList.push(msg);
				// æ¸…ç©ºå‘é€çš„å†…å®¹ç„¶åè¿˜è¦æ»šåŠ¨åˆ°åº•éƒ¨
				if(msgType == 'text') this.messageValue = '';
				this.chatContentToBottom();
			},
			openMore(){
				console.log('ç‚¹å‡»äº†ä¸‰ä¸ªç‚¹å›¾æ ‡');
			},
			//èŠå¤©å†…å®¹æ»šåˆ°åˆ°åº•éƒ¨
			chatContentToBottom(){
				// #ifdef APP
				let chatItems =  this.$refs.chatItem;
				let lastIndex = chatItems.length - 1 == 0 ? 0 : chatItems.length - 1;
				let last = chatItems[lastIndex];
				const dom =  weex.requireModule('dom');
				dom.scrollToElement(last, {});
				// #endif
				// #ifdef MP || H5
				if(this.chatDataList.length == 0) return;
				const lastIndex = this.chatDataList.length - 1;
				this.scrollIntoViewId = `chat-item-${lastIndex}`;
				setTimeout(()=>{
					this.scrollIntoViewId = '';
					this.$nextTick(()=>{
						this.scrollIntoViewId = `chat-item-${lastIndex}`;
					});
				},100)
				// #endif
			},
			onScroll(){
				console.log('é¡µé¢å‘ç”Ÿäº†æ»šåŠ¨');
			}
		},
		watch:{
			// ç›‘å¬èŠå¤©è®°å½•æ•°æ®å˜åŒ–ï¼Œè‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
			chatDataList:{
				handler(){
					this.$nextTick(()=>{
						this.chatContentToBottom();
					});
				},
				deep:true
			},
			sendMessageMode(newVal,oldVal){
				// #ifdef APP
				console.log('ç›‘å¬å‘é€æ¨¡å¼',newVal);
				if(newVal != 'plus' && newVal != 'icon'){
					this.$refs.tooltipPlus.hide();
				}
				// #endif
			},
		},
	}
</script>

<style>
    /* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
	
	
</style>
```

### 3. è°ƒæ•´åçš„å®Œæ•´ä»£ç æ”¹åŠ¨ç‚¹è¯´æ˜
```vue
<template>
	<view>
		<!-- å¯¼èˆªæ  -->
		...
		
		<!-- èŠå¤©å†…å®¹åŒºåŸŸ -->
		...
		
		
		<!-- åº•éƒ¨èŠå¤©è¾“å…¥åŒºåŸŸ --><!-- ä¿®æ”¹ï¼šæ·»åŠ refè·å–textareaå®ä¾‹ -->
		<view class="position-fixed bottom-0 border-top
		flex flex-row align-center justify-between"
		style="background-color: #f7f7f7;width: 750rpx;
		min-height: 90rpx;max-height: 320rpx;
		padding-top: 12rpx;"
		:style="chatBottomStyle">
			<view class="flex align-center">
				<chat-navbar-icon-button>
					<text class="iconfont font-lg">&#xe643;</text>
				</chat-navbar-icon-button>
				<view class="flex align-center font-sm
				bg-white px-2 py-1 border rounded">
					<textarea ref="textarea" fixed auto-height :maxlength="-1"
					style="width: 440rpx;min-height: 60rpx;
					max-height: 274rpx;overflow-y: scroll;
					text-align: justify;"
					:adjust-position="false"
					v-model="messageValue"
					@focus="textareaFocus"
					@input="onTextareaInput" 
					@blur="onTextareaBlur" ><!-- æ–°å¢ï¼šç›‘å¬å¤±ç„¦äº‹ä»¶ --><!-- æ–°å¢ï¼šç›‘å¬è¾“å…¥äº‹ä»¶ -->
					</textarea>
				</view>
			</view>
			<view class="flex align-center">
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openIcon">
					<text class="iconfont font-lg">&#xe642;</text>
				</chat-navbar-icon-button>
				<chat-navbar-icon-button v-if="!messageValue"
				@click="openPlus">
					<text class="iconfont font-lg">&#xe637;</text>
				</chat-navbar-icon-button>
				<view v-if="messageValue"
				class="rounded bg-success px-2 py-1 mr-4"
				hover-class="bg-hover-success" 
				@click="sendMessage('text')">
				   <text class="font text-white">å‘é€</text>
				</view>
			</view>
		</view>
	
	
	     <!-- å¼¹å‡ºèœå• --><!-- ä¸»è¦ä¿®æ”¹åŒºåŸŸ -->
		 <chat-tooltip ref="tooltipPlus" :mask="chatTooltipMask" 
		 :maskTransparent="true" :isBottom="true" 
		 :tooltipWidth="750"
		 :tooltipHeight="tooltipHeight"
		 transformOrigin = "center bottom"
		 tooltipClass ="bg-light border-0 rounded-0"
		 @hideTooltip="hideTooltip">
			<view class="border-top border-light-secondary">
				<!-- è¡¨æƒ…èœå• -->
				<swiper v-if="sendMessageMode === 'icon'" 
				:indicator-dots="groupedIconMenus.length > 1" 
				:duration="1000"
				:style="tooltipPlusMenuStyle"
				@change="handleSwiperChange"><!-- æ·»åŠ åˆ†é¡µåˆ‡æ¢äº‹ä»¶ -->
					<!-- ç¬¬ä¸€é¡µï¼šemojiè¡¨æƒ…ï¼ˆæ»šåŠ¨æ˜¾ç¤ºï¼‰ -->
					<swiper-item v-if="emojiPageItems.length > 0">
						<scroll-view scroll-y style="height: 100%;">
							<view class="flex flex-row flex-wrap justify-start">
								<view v-for="(item,itemIndex) in emojiPageItems" 
								:key="itemIndex"
								class="flex flex-column justify-center align-center"
								style="width: 12.5%; height: 120rpx; padding: 10rpx;"
								@click="insertEmoji(item)">
									<text style="font-size: 50rpx;">{{item.icon}}</text>
								</view>
							</view>
						</scroll-view>
					</swiper-item>
					
					<!-- å…¶ä»–ç±»å‹è¡¨æƒ…åˆ†é¡µæ˜¾ç¤º -->
					<swiper-item v-for="(page,pageIndex) in otherPages" 
					:key="pageIndex">
						<view class="flex flex-row flex-wrap justify-start">
							<view v-for="(item,itemIndex) in page" 
							:key="pageIndex+itemIndex"
							class="col-3 flex flex-column justify-center align-center"
							style="height: 260rpx;"
							@click="item ? swiperItemClick(item,itemIndex) : null"
							><!-- å°ç¨‹åºæ·»åŠ ç©ºå€¼æ£€æŸ¥ -->
								<view class="bg-white rounded-lg flex flex-row 
								align-center justify-center mb-2"
								style="width:120rpx;height: 120rpx;">
									<u--image v-if="item.iconType == 'image'"
									:src="item.icon" mode="aspectFit"
									width="120rpx" height="120rpx" radius="0rpx"></u--image>
									<text v-if="item.iconType == 'emoji'"
									style="font-size: 40px;color: #222222;">{{item.icon}}</text>
									<text v-if="item.iconType == 'custom'"
									class="iconfont"
									style="font-size: 26px;color: #222222;">{{item.icon}}</text>
									<u-icon v-if="item.iconType == 'uview'"
									:name="item.icon" color="#222222" size="26"></u-icon>
								</view>
								<text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
				
				<!-- åŠ å·èœå•ï¼ˆä¿æŒä¸å˜ï¼‰ -->
				<swiper v-else-if="sendMessageMode === 'plus'"
				:indicator-dots="pageCount > 1" :duration="1000"
				:style="tooltipPlusMenuStyle">
					<swiper-item v-for="(page,index) in groupedPlusMenus" :key="index">
						<view class="flex flex-row justify-start flex-wrap"
						:style="swiperItemStyle">
							<view class="col-3 flex flex-column justify-center align-center"
							style="height: 260rpx;"
							v-for="(item,itemIndex) in page" :key="itemIndex"
							@click="swiperItemClick(item,itemIndex)">
								<view class="bg-white rounded-lg 
								flex flex-row align-center justify-center mb-2"
								style="width:120rpx;height: 120rpx;">
									<u--image v-if="item.iconType == 'image'"
									:src="item.icon" mode="aspectFit"
									width="120rpx" height="120rpx" radius="0rpx"></u--image>
									<text v-if="item.iconType == 'emoji'"
									style="font-size: 40px;color: #222222;">{{item.icon}}</text>
									<text v-if="item.iconType == 'custom'"
									class="iconfont"
									style="font-size: 26px;color: #222222;">{{item.icon}}</text>
									<u-icon v-if="item.iconType == 'uview'"
									:name="item.icon" color="#222222" size="26"></u-icon>
								</view>
								<text class="font-sm text-light-muted">{{item.name}}</text>
							</view>
						</view>
					</swiper-item>
				</swiper>
			</view>
		 </chat-tooltip>	
	</view>
</template>

<script>
	...
	export default {
		...,
		data() {
			return {
				cursorPos: 0, // æ–°å¢ï¼šè®°å½•textareaå…‰æ ‡ä½ç½®
				...,
				iconMenus:[
					{ name:"å¾®ç¬‘", icon:"/static/tabbar/index.png",
					iconType:"image", eventType:"smile" },
					{ name:"å˜¿å˜¿", icon:"ğŸ˜€",
					iconType:"emoji", eventType:"heihei" },
					{ name: "å—¯ï¼Œå“¼", icon: "https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/iconMenus/en.gif", iconType: "image", eventType: "enheng" },
					{ name:"å˜»å˜»", icon:"ğŸ˜",
					iconType:"emoji", eventType:"xixi" },
					{ name:"ç¬‘å“­äº†", icon:"ğŸ˜‚",
					iconType:"emoji", eventType:"xiaokule" },
					{ name:"å“ˆå“ˆ", icon:"ğŸ˜ƒ",
					iconType:"emoji", eventType:"haha" },
					{ name:"å¤§ç¬‘", icon:"ğŸ˜„",
					iconType:"emoji", eventType:"daxiao" },
					{ name:"è‹¦ç¬‘", icon:"ğŸ˜…",
					iconType:"emoji", eventType:"kuxiao" },
					{ name:"æ–œçœ¼ç¬‘", icon:"ğŸ˜†",
					iconType:"emoji", eventType:"xieyanxiao" },
					{ name:"å¾®ç¬‘å¤©ä½¿", icon:"ğŸ˜‡",
					iconType:"emoji", eventType:"weixiaotianshi" },
					{ name:"çœ¨çœ¼", icon:"ğŸ˜‰",
					iconType:"emoji", eventType:"zhayan" },
					{ name:"ç¾æ¶©å¾®ç¬‘", icon:"ğŸ˜Š",
					iconType:"emoji", eventType:"xiuseweixiao" },
					{ name:"å‘µå‘µ", icon:"ğŸ™‚",
					iconType:"emoji", eventType:"hehe" },
					{ name:"å€’è„¸", icon:"ğŸ™ƒ",
					iconType:"emoji", eventType:"daolian" },
					{ name:"ç¬‘å¾—æ»¡åœ°æ‰“æ»š", icon:"ğŸ¤£",
					iconType:"emoji", eventType:"xiaodemandidagun" },
				],
				...
			}
		},
		mounted() {
			...
		},
		computed:{
			...
			// åŠ å·èœå•åˆ†é¡µ
			// groupedPlusMenus(){
			// 	const perPage = 8; // æ¯é¡µ8ä¸ª
			// 	const result = [];
			// 	// å°†æ•°ç»„plusMenusæˆ–è€…iconMenusæ¯é¡µ8ä¸ªåˆ†ç»„
			// 	for(let i=0;i<this.tooltipPlusMenusOrIconMenus.length; i += perPage){
			// 		result.push(this.tooltipPlusMenusOrIconMenus.slice(i, i + perPage))
			// 	}
			// 	return result;
			// },
			//è®¡ç®—æ€»é¡µæ•°
			// pageCount(){
			// 	return Math.ceil(this.tooltipPlusMenusOrIconMenus.length / 8);
			// },
			// ä¿®æ”¹ï¼šåŠ å·èœå•åˆ†é¡µè®¡ç®—
			groupedPlusMenus() {
				const perPage = 8; // æ¯é¡µ8ä¸ªï¼ˆ2è¡Œï¼‰
				const result = [];
				for (let i = 0; i < this.plusMenus.length; i += perPage) {
					result.push(this.plusMenus.slice(i, i + perPage));
				}
				return result;
			},
			// ä¿®æ”¹ï¼šè®¡ç®—æ€»é¡µæ•°ï¼ˆåˆ†åˆ«å¤„ç†ä¸¤ç§èœå•ï¼‰
			pageCount() {
				if (this.sendMessageMode === 'plus') {
					return Math.ceil(this.plusMenus.length / 8);
				} else if (this.sendMessageMode === 'icon') {
					return this.groupedIconMenus.length;
				}
				return 0;
			},
			// æ–°å¢ï¼šè¡¨æƒ…èœå•è®¡ç®—å±æ€§
			emojiList() {
				return this.iconMenus.filter(item => item.iconType === 'emoji');
			},
			otherList() {
				return this.iconMenus.filter(item => item.iconType !== 'emoji');
			},
			emojiPageItems() {
				return this.emojiList; // æ‰€æœ‰emojiè¡¨æƒ…æ”¾åœ¨ç¬¬ä¸€é¡µ
			},
			otherPages() {
				const perPage = 8; // æ¯é¡µ8ä¸ªï¼ˆ2è¡Œï¼‰
				const pages = [];
				for (let i = 0; i < this.otherList.length; i += perPage) {
					pages.push(this.otherList.slice(i, i + perPage));
				}
				return pages;
			},
			groupedIconMenus() {
				// æ€»é¡µæ•° = 1 (emojié¡µ) + å…¶ä»–ç±»å‹é¡µæ•°
				const pages = [];
				if (this.emojiPageItems.length > 0) {
					pages.push(this.emojiPageItems); // ç¬¬ä¸€é¡µæ”¾emoji
				}
				return pages.concat(this.otherPages);
			},
		},
		methods: {
			// æ–°å¢ï¼štextareaè¾“å…¥äº‹ä»¶è®°å½•å…‰æ ‡ä½ç½®
			onTextareaInput(e) {
				// #ifdef H5 || APP
				this.cursorPos = e.detail.cursor;
				// #endif
			},
			// æ–°å¢ï¼štextareaå¤±ç„¦äº‹ä»¶è®°å½•å…‰æ ‡ä½ç½®
			onTextareaBlur(e) {
				this.cursorPos = e.detail.cursor || this.messageValue.length;
			},
						
			// æ–°å¢ï¼šæ’å…¥è¡¨æƒ…åˆ°textarea
			insertEmoji(item) {
				if (!item || !item.icon) return;
				
				const emoji = item.icon;
				const text = this.messageValue || '';
				
				// æ’å…¥åˆ°å½“å‰å…‰æ ‡ä½ç½®
				const newText = text.substring(0, this.cursorPos) + 
							   emoji + 
							   text.substring(this.cursorPos);
				
				this.messageValue = newText;
				
				// æ›´æ–°å…‰æ ‡ä½ç½®ï¼ˆåœ¨æ’å…¥çš„è¡¨æƒ…åé¢ï¼‰
				const newCursorPos = this.cursorPos + emoji.length;
				this.cursorPos = newCursorPos;
				
				// è®¾ç½®å…‰æ ‡ä½ç½®ï¼ˆH5/APPæ”¯æŒï¼‰
				this.$nextTick(() => {
					if (!this.$refs.textarea) return;
					
					let textarea;
					
					// å¤„ç† H5 å¹³å°çš„ç‰¹æ®Šæƒ…å†µ
					// #ifdef H5
					textarea = this.$refs.textarea.$el; // è·å–åŸç”Ÿ DOM å…ƒç´ 
					// #endif
					
					// #ifndef H5
					textarea = this.$refs.textarea;
					// #endif
					
					if (textarea) {
						// å°è¯•è®¾ç½®å…‰æ ‡ä½ç½®
						if (typeof textarea.setSelectionRange === 'function') {
							try {
								textarea.setSelectionRange(newCursorPos, newCursorPos);
							} catch (e) {
								console.warn('è®¾ç½®å…‰æ ‡ä½ç½®å¤±è´¥', e);
							}
						}
						
						// ç¡®ä¿è¾“å…¥æ¡†èšç„¦
						if (typeof textarea.focus === 'function') {
							try {
								textarea.focus();
							} catch (e) {
								console.warn('èšç„¦è¾“å…¥æ¡†å¤±è´¥', e);
							}
						}
					}
				});
			},
			
			// ä¿®æ”¹ï¼šç‚¹å‡»èœå•é¡¹å¤„ç†
			swiperItemClick(item, itemIndex) {
				console.log('ç‚¹å‡»èœå•é¡¹å¤„ç†',item);
				if (!item) return; // é˜²æ­¢undefinedé”™è¯¯
				if (this.sendMessageMode === 'icon') {
					if (item.iconType === 'emoji') {
						this.insertEmoji(item); // emojiæ’å…¥è¾“å…¥æ¡†
					} else {
						this.sendMessage('iconMenus', item); // å…¶ä»–ç±»å‹ç›´æ¥å‘é€
					}
				} else {
					console.log('ç‚¹å‡»åŠ å·æ‰©å±•èœå•çš„æŸä¸€é¡¹',item.eventType);
					switch (item.eventType){
						case 'phote':
							break;
						case 'map':
							break;
						case 'camera':
							break;
						case 'mingpian':
							break;
						case 'video':
							break;
					}
				}
			},
			handleSwiperChange(e) {
			    console.log('åˆ†é¡µåˆ‡æ¢', e.detail.current);
			    // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†åˆ†é¡µåˆ‡æ¢é€»è¾‘
			},
			
			...
		},
		...
	}
</script>
```

## å…«ã€åŠ å·æ‰©å±•èœå•åŠŸèƒ½
å†…å®¹è¿‡å¤šï¼Œåœ¨æ–°é¡µé¢æ‰“å¼€ï¼Œå…·ä½“æŸ¥çœ‹ï¼š<a href="/thirdless/w-b/06åŠ å·æ‰©å±•èœå•åŠŸèƒ½" target="_blank">èŠå¤©é¡µè¾“å…¥åŒºåŸŸï¼šåŠ å·æ‰©å±•èœå•åŠŸèƒ½</a>