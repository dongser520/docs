---
navbar: true
sidebar: auto
title: 章节6.加号扩展菜单功能（发语音）
---

## 一、 发语音界面开发
### 1. 初步开发：发语音和文字输入功能切换
在页面 `/pages/chat/chat.nvue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		...
		
		<!-- 聊天内容区域 -->
		...

		<!-- 底部聊天输入区域 -->
		<view ...>
			<view class="flex align-center">
				<!-- 切换发语音 -->
				<!-- 键盘图标 -->
				<chat-navbar-icon-button v-if="sendMessageMode == 'audio'"
				@click="changeAudioOrText('text')">
					<text class="iconfont font-lg">&#xe644;</text>
				</chat-navbar-icon-button>
				<!-- 语音图标 -->
				<chat-navbar-icon-button v-else
				@click="changeAudioOrText('audio')">
					<text class="iconfont font-lg">&#xe643;</text>
				</chat-navbar-icon-button>
				<view class="flex align-center font-sm
				bg-white px-2 py-1 border rounded">
				    <!-- 按住发语音 -->
					<view v-if="sendMessageMode == 'audio'"
					style="width: 440rpx;height: 60rpx;"
					class="flex align-center justify-center bg-white rounded">
						<text class="font mr-2">按住</text>
						<text class="font">说话</text>
					</view>
				    <!-- 发文字 -->
					<textarea v-else
					...>
					</textarea>
				</view>
			</view>
			<view class="flex align-center">
				...
			</view>
		</view>
	
	</view>
</template>

<script>
	export default {
		...,
		methods: {
			// 切换文字输入或者语音
			changeAudioOrText(sendMessageMode){
				this.sendMessageMode = sendMessageMode;
			},
			...,
		},
	}
</script>

```

### 2. 按住录音状态界面开发
在页面 `/pages/chat/chat.nvue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		...
		
		<!-- 聊天内容区域 -->
		...
			
		<!-- 底部聊天输入区域 -->
		<view ...>
			<view class="flex align-center">
				<!-- 切换发语音 -->
				<!-- 键盘图标 -->
				<chat-navbar-icon-button v-if="sendMessageMode == 'audio'"
				@click="changeAudioOrText('text')">
					<text class="iconfont font-lg">&#xe644;</text>
				</chat-navbar-icon-button>
				<!-- 语音图标 -->
				<chat-navbar-icon-button v-else
				@click="changeAudioOrText('audio')">
					<text class="iconfont font-lg">&#xe643;</text>
				</chat-navbar-icon-button>
				<view class="flex align-center font-sm px-2 py-1 border rounded"
				:class="[recorderStatus?'bg-hover-light':'bg-white',]">
				    <!-- 按住发语音 -->
					<view v-if="sendMessageMode == 'audio'"
					style="width: 440rpx;height: 60rpx;"
					class="flex flex-row align-center justify-center rounded"
					@touchstart="recorderTouchstart"
					@touchend="recorderTouchend"
					@touchcancel="recorderTouchcancel"
					@touchmove="recorderTouchmove">
						<text class="font mr-2" v-if="!recorderStatus">按住</text>
						<text class="font" v-if="!recorderStatus">说话</text>
						<text class="font mr-2" v-if="recorderStatus">松开</text>
						<text class="font" v-if="recorderStatus">发送</text>
					</view>
				    <!-- 发文字 -->
					<textarea v-else
					...>
					</textarea>
				</view>
			</view>
			<view class="flex align-center">
				...
			</view>
		</view>
	
	
	     <!-- 弹出菜单 -->
		 ...
			 
		 <!-- 发语音页面提示 -->	 
		 <view v-if="recorderStatus"
		 class="position-fixed left-0 right-0 flex flex-row align-center justify-center"
		 :style="chatContentStyle">
		     <view style="width: 400rpx;height: 400rpx;
			 background-color: rgba(0, 0, 0, 0.6);"
			 class="rounded-lg"></view>
		</view>
			 
	</view>
</template>

<script>
    ...
	export default {
		...,
		methods: {
			// 手指按上去
			recorderTouchstart(){
				console.log('手指按上去');
				this.recorderStatus = true;
			},
			// 手指松开
			recorderTouchend(){
				console.log('手指松开');
				this.recorderStatus = false;
			},
			// 触摸取消，比如来电话终止
			recorderTouchcancel(){
				console.log('触摸取消');
				this.recorderStatus = false;
			},
			// 手指滑动
			recorderTouchmove(){
				console.log('手指滑动');
			},
			...
		},
	}
</script>

```