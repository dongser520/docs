---
navbar: true
sidebar: auto
title: 章节8.聊天通讯（群组）
---

## 十七、修改群公告
### 1. 修改群公告接口说明
接口文档查看：<a href="/fourthless/w-a/eggjs.即时通讯接口.html#二十六、修改群公告-成功后通过websocket通知群聊用户" target="_blank">二十六、修改群公告（成功后通过webSocket通知群聊用户）</a>

### 2. 修改群公告功能实现
1. 修复上一节课的bug，进入单聊页面标题出错 <br/>
在页面 `/pages/chat/chat.nvue`
```js
onShow() {
    if(this.arg && this.arg.chatType == 'group'){
        this.arg.name = this.groupname || this.pagetitle;
        // #ifdef H5
        document.title = this.groupname || this.pagetitle;
        // #endif
    }
},
```


2. 在页面 `/pages/setpageInfo/setpageInfo.vue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		...
		<!-- 内容 -->
		<view>
			<!-- 聊天相关 -->
			<view v-if="setdata.action == 'chatset'">
				...
			</view>
			<!-- 聊天页设置 -->
			<view v-if="setdata.action == 'chatpageset'">
				<view v-if="chatpageset.id && chatpageset.chatType">
					<!-- 头像部分 -->
					...
					<!-- 群相关设置 -->
					<view v-if="chatpageset.chatType == 'group'">
						<!-- 群名称 -->
						<u-cell-group>
							<u-cell>
								<view slot="title">
									<view class="mb-2">
										<text class="font-weight-bold">群名称</text>
									</view>
									<u-input ...
									customStyle="padding:20rpx;"></u-input>
								</view>
							</u-cell>
						</u-cell-group>
						...
						<!-- 群公告 -->
						<u-cell-group>
							<u-cell>
								<view slot="title">
									<view class="mb-2">
										<text class="font-weight-bold">群公告</text>
									</view>
									<u-textarea v-model="chatpageset.remark"
									border="none" :maxlength="500"
									...
									@confirm="groupremark"></u-textarea>
								</view>
							</u-cell>
						</u-cell-group>
						...
					</view>
					<!-- 查找聊天内容 -->
					...
					<!-- 消息设置 -->
					...
				</view>
			</view>
		</view>
	</view>
</template>

<script>
	...
	export default {
		...,
		methods: {
			// 群公告
			groupremark(){
				const arg = {
					apiurl: '/api/chat/groupremark',
					params:{
						id: this.chatpageset.id,
						remark: this.chatpageset.remark,
					},
				}
				this.groupUpdate(arg).then(res =>{
					uni.showToast({title:'修改群公告成功', icon:'none'});
				});
			},
			// 更新群名称
			groupUpdateName(){
				const arg = {
					apiurl: '/api/chat/groupUpdateName',
					params:{
						id: this.chatpageset.id,
						name: this.chatpageset.name,
					},
				}
				this.groupUpdate(arg).then(res =>{
					uni.showToast({title:'群名称修改成功', icon:'none'});
					// 使用vuex兼容H5端nvue页面标题
					this.$store.dispatch('groupUpdateName',{
						name: this.chatpageset.name
					});
				});
			},
			// 更新群相关信息
			groupUpdate(arg){
				return new Promise((resolve,reject) => {
					uni.$u.http.post(requestUrl.http + `${arg.apiurl}`, arg.params, {
						header: {
							token: this.me.token,
						},
					}).then(res => {
						console.log('服务器返回群名称更新结果', res);
						if(res.data.data == 'ok'){
							resolve();
						}
						
					}).catch(err =>{
						uni.showModal({
							content:err.data.data,
							showCancel:false,
							confirmText:'我知道了'
						});
					});
				});
			},
			...
		}
	}
</script>

```