---
navbar: true
sidebar: auto
title: 章节8.聊天通讯（群组）
---

## 九、聊天页设置界面开发和数据渲染
### 1. 聊天页设置相关信息获取
在类文件 `/common/js/chatClass.js`
```js
...
// 聊天页设置相关信息获取
getChatPageSet(to_id, chatType){
    let xiaoxiList = this.getXiaoXiList();
    // 找到当前聊天
    let index = xiaoxiList.findIndex(v => v.id == to_id && v.chatType == chatType);
    if(index != -1){
        // 找到了
        return xiaoxiList[index];
    }
    return null;
}
```

### 2. 进入设置页面
在页面 `/pages/chat/chat.nvue`
```js
//点击了三个点图标
openMore(){
    console.log('点击了三个点图标',this.arg);
    let op = {
        action:'chatpageset',
        title:'设置',
        id: this.arg.id,
        chatType: this.arg.chatType,
        avatar : this.arg.avatar,
        name : this.arg.name,
    };
    uni.navigateTo({
        url: `/pages/setpageInfo/setpageInfo?action=${op.action}&title=${encodeURIComponent(op.title)}&id=${op.id}&chatType=${op.chatType}&avatar=${encodeURIComponent(op.avatar)}&name=${encodeURIComponent(op.name)}`,
    });
},
```

### 3. 设置页面开发
在页面 `/pages/setpageInfo/setpageInfo.vue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		...
		<!-- 内容 -->
		<view>
			<!-- 聊天相关 -->
			...
			<!-- 聊天页设置 -->
			<view v-if="setdata.action == 'chatpageset'">
				<view v-if="chatpageset.id && chatpageset.chatType">
					<!-- 头像部分 -->
				    <view class="flex flex-wrap p-3">
						<!-- 单聊 -->
						<view v-if="chatpageset.chatType == 'single'"
						class="flex flex-column justify-center align-center mr-2">
							<u-avatar :src="chatpageset.avatar" shape="square"
							customStyle="border:1px solid #eeeeee;"></u-avatar>
							<text class="font-sm mt-1 text-muted">{{chatpageset.name}}</text>
						</view>
						<!-- 群聊 循环头像昵称 -->
						<!-- 加人组群 -->
						<view class="border flex align-center justify-center" 
						style="width: 40px;height: 40px;border-style: dashed;"
						@click="clickCell('加人组群', 'addUserToGroup')">
						   <u-icon name="plus" size="24" color="#999999"></u-icon>
						</view>
						<!-- 删除群聊用户 -->
						<view v-if="chatpageset.chatType == 'group'"
						class="border flex align-center justify-center ml-2" 
						style="width: 40px;height: 40px;border-style: dashed;"
						@click="clickCell('群组删除某个用户', 'deleteUserFromGroup')">
						   <u-icon name="minus" size="24" color="#999999"></u-icon>
						</view>
					</view>
					<u-gap height="10" bgColor="#EDEDED"></u-gap>
					<!-- 查找聊天内容 -->
					<u-cell-group>
						<u-cell title="查找聊天内容"
						:border="false" clickable isLink
						:customStyle="customStyles"
						:iconStyle="iconStyles"
						:titleStyle="titleStyles"
						@click="clickCell('查找聊天内容', 'searchChatData')"></u-cell>
					</u-cell-group>
					<u-gap height="10" bgColor="#EDEDED"></u-gap>
					<!-- 消息设置 -->
					<u-cell-group>
						<u-cell title="消息免打扰"
						:border="false" clickable
						:customStyle="customStyles"
						:iconStyle="iconStyles"
						:titleStyle="titleStyles">
						   <view slot="value">
							   <u-switch v-model="chatpageset.nowarn" @change="switchChange('nowarn')"></u-switch>
						   </view>
						</u-cell>
						<u-cell title="置顶聊天"
						:border="false" clickable
						:customStyle="customStyles"
						:iconStyle="iconStyles"
						:titleStyle="titleStyles">
						   <view slot="value">
							   <u-switch v-model="chatpageset.istop" @change="switchChange('istop')"></u-switch>
						   </view>
						</u-cell>
						<u-cell title="提醒"
						:border="false" clickable
						:customStyle="customStyles"
						:iconStyle="iconStyles"
						:titleStyle="titleStyles">
						   <view slot="value">
							   <u-switch v-model="chatpageset.stongwarn" @change="switchChange('stongwarn')"></u-switch>
						   </view>
						</u-cell>
					</u-cell-group>
					<u-gap height="10" bgColor="#EDEDED"></u-gap>
					<!-- 清空聊天记录 -->
					<u-cell-group>
						<u-cell title="清空聊天记录"
						:border="false" clickable 
						:customStyle="customStyles"
						:iconStyle="iconStyles"
						:titleStyle="titleStyles"
						@click="clickCell('清空聊天记录', 'deleteChatData')"></u-cell>
					</u-cell-group>
					<u-gap height="10" bgColor="#EDEDED"></u-gap>
				</view>
			</view>
		</view>
	</view>
</template>

<script>
	...
	export default {
		mixins:[toolJs],
		data() {
			return {
				...,
				chatpageset:{},
			}
		},
		onLoad(e) {
			...
			// 动态生成数据
			if(e.action){
				this.setdata.action = e.action;
				if(this.setdata.action == 'chatset'){
					...
				}else if(this.setdata.action == 'chatpageset'){
					this.chatpageset.id = e.id;
					this.chatpageset.chatType = e.chatType;
					this.chatpageset.avatar = decodeURIComponent(e.avatar);
					this.chatpageset.name = decodeURIComponent(e.name);
					// 聊天页设置相关信息获取
					let getChatPageSet = this.chatClass.getChatPageSet(this.chatpageset.id,this.chatpageset.chatType);
					console.log('聊天页设置信息', getChatPageSet);
					// 设置相关
					this.chatpageset = {
						...this.chatpageset,
						// 单聊
						istop: getChatPageSet.istop,
						shownickname: getChatPageSet.shownickname ? true : false,
						nowarn: getChatPageSet.nowarn ? true : false,
						stongwarn: getChatPageSet.stongwarn ? true : false,
						// 群聊还有以下字段
						user_id: 0,
						remark:'',
						invite_confirm: 0,
					};
					console.log('设置相关',this.chatpageset);
					
				}
			}
		},
		computed:{
			...mapState({
				me : state => state.Chatuser.regloginUser,
				chatClass : state => state.Chatuser.chatClass,
			}),
			customStyles(){
				return `padding-top:20rpx;padding-bottom:20rpx`;
			},
			iconStyles(){
				return `font-size:52rpx;margin-right:30rpx;color:#5696da`;
			},
			titleStyles(){
				return `font-size:32rpx;`;
			},
		},
		methods: {
			switchChange(key){
				console.log(`switch开关${key}`, this.chatpageset[key]);
			},
			// 点击某一项
			clickCell(title, type){
				console.log(title, type);
			},
			submitSet(){
				...
			}
		}
	}
</script>

<style>

</style>

```
