---
navbar: true
sidebar: auto
title: 章节6.加号扩展菜单功能（发语音）
---

## 一、语音播放
大家可以在网上找一些音频测试，如：<https://aspx.sc.chinaz.com/query.aspx?classid=&keyword=%E5%8D%A1%E5%86%9C> <br/>
给大家准备了几个音频语音测试：
1. 发消息成功音频: `https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/sendMessage.mp3`
2. 接收消息音频： `https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/getMessage.mp3`
3. 卡龙音乐：`https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/kalong.mp3`
4. 微信语音： `https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/weixinYuYing.mp3`

### 1. 在页面补充音频数据并测试音频播放
1. 在页面 `/pages/chat/chat.nvue` 中补充音频数据
```js
{
    avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
    nickname: '小二哥',
    chat_time: 1750148979,
    data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/kalong.mp3',
    user_id: 2,
    type:'audio', //image,video
    isremove:false,
},
{
    avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
    nickname: '小二哥',
    chat_time: 1750148989,
    data: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/weixinYuYing.mp3',
    user_id: 2,
    type:'audio', //image,video
    isremove:false,
},
```
2. 接口API查看  <https://uniapp.dcloud.net.cn/api/#%E5%AA%92%E4%BD%93> <br/>
`播放音频` <https://uniapp.dcloud.net.cn/api/media/audio-context.html> <br/>
在组件 `/components/chat-item/chat-item.vue` <br/>
```js
<!-- 情况3: 语音 -->
<view v-else-if="item.type == 'audio'"
class="flex align-center"
@click="playAudio(item,index)">
    <text class="font">43'</text>
</view>
...
<script>
    export default{
        data(){
            return {
                ...
                // 音频上下文
                innerAudioContext:null,
                
            }
        },
        destroyed() {
            // 销毁音频
            if(this.innerAudioContext){
                this.innerAudioContext.destroy();
                this.innerAudioContext = null;
            }
        },
        methods:{
            // 播放语音
            playAudio(item,index){
                if(!this.innerAudioContext){
                    this.innerAudioContext = uni.createInnerAudioContext();
                    this.innerAudioContext.src = item.data;
                    this.innerAudioContext.play();
                }
            },
        }
    }
</script>
```

### 2. 音频切换播放
1. 需要用到vue中的状态管理：`vuex` (之前讲vue基础的时候没有讲到这块，这里直接通过讲音频切换播放来讲解vuex的使用) <https://uniapp.dcloud.net.cn/tutorial/vue-vuex.html> <br/>
2. `uni-app`官方提供了共享变量和数据的方案，其中就包括 `vuex` <https://uniapp.dcloud.net.cn/tutorial/nvue-api.html#sharevar>

#### ① 学会如何在uni-app中引入和使用vuex的基本用法
##### 1. 组装模块并导出 store 的地方
新建 `/store/index.js`
```js
import Vue from 'vue';
import Vuex from 'vuex';

Vue.use(Vuex);

export default new Vuex.Store({
	// 对应mapState，在computed中使用
	state:{
		testVuex:'即时通讯',
	}
});
```

##### 2. 在 `main.js` 中引入并使用store
```js
import App from './App'

// #ifndef VUE3
import Vue from 'vue'
import Store from './store'; // 引入vuex

Vue.prototype.$store = Store; // 挂载到vue的原型进行共享

// main.js
...
const app = new Vue({
  Store, //vuex
  ...App
})
app.$mount()
// #endif

// #ifdef VUE3
...
// #endif
```

##### 3. 在页面或者组件中使用vuex
如，在组件 `/components/chat-item/chat-item.vue`
```vue
<script>
	...
	import { mapState } from 'vuex';
	export default{
        computed:{
			//vuex的state数据
			...mapState({
				testVuexValue: state => state.testVuex,
			}),
        },
        mounted() {
			console.log('看一下vuex中state的值',this.testVuexValue);
		},
    }
</script>
```