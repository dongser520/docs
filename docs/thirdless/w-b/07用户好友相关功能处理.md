---
navbar: true
sidebar: auto
title: 章节7.用户（好友）相关功能处理
---

## 七、搜索用户
### 1. 搜索用户接口文档
搜索用户接口文档具体查看：<a href="/fourthless/w-a/eggjs.即时通讯接口.html#四、搜索用户" target="_blank" >四、搜索用户</a>
### 2. 搜索用户界面开发
#### ① 新建搜索用户页面 `/pages/search/search.vue` 
在 `pages.json`配置页面
```js
{
    "path" : "pages/search/search",
    "style" : 
    {
        "navigationBarTitleText" : "搜索",
        "navigationStyle": "custom"
    }
}
```
#### ② 在页面 `/pages/wode/wode.nvue` 跳转
```vue
<template>
	<view>
		<!-- 头像昵称 -->
		...
	    <!-- 间隔槽 -->
		...
		<!-- cell 单元格 -->
		<u-cell-group>
			<u-cell v-for="(item,index) in uCellMenus" :key="index"
			:icon="item.icon" :title="item.title"
			:border="false" clickable isLink
			:customStyle="customStyles"
			:iconStyle="iconStyles"
			:titleStyle="titleStyles"
			@click="openCell(item,index)"></u-cell>
		</u-cell-group>
		<!-- 间隔槽 -->
		...
	</view>
</template>

<script>
	...
	export default {
		data() {
			return {
				...
				uCellMenus:[
					{icon:'plus-people-fill',title:'添加朋友',url:'/pages/search/search'},
					{icon:'chat',title:'发起群聊',url:''},
					{icon:'scan',title:'扫一扫',url:''},
				],
			}
		},
		...
		methods: {
			// 点击栏目
			openCell(item,index){
				if(!item.url) return;
				if(!this.user || this.user.role == 'visitor'){
					return uni.navigateTo({
						url: '/pages/loginCenter/loginCenter',
					});
				}
				uni.navigateTo({
					url: item.url,
				});
			},
			...
		}
	}
</script>
```

#### ③ 在页面 `/pages/search/search.vue`
```vue
<template>
	<view class="page">
		<!-- 导航栏 -->
		<!-- #ifdef MP -->
		<chat-navbar  :fixed="true" :showPlus="false" :showUser="false" :showBack="true"
			navbarClass="navbar-bgColor" :h5WeiXinNeedNavbar="false">
		</chat-navbar>
		<!-- #endif -->
		<!-- 搜索框 -->
		<view class="flex align-center p-3">
			<u--input placeholder="搜 索" prefixIcon="search"
			prefixIconStyle="font-size:22px;color:#909399;"
			confirmType="search" v-model="keyword" clearable
			:maxlength="50" showWordLimit focus
			:adjustPosition="false"
			:customStyle="inputStyle"
			@input="searchData"></u--input>
			<text class="font text-primary ml-2" @click="navigateBack">取消</text>
		</view>
		<!-- 搜索结果 -->
		<view v-if="keyword">
			<view v-if="searchResStatus">
				<!-- 搜索用户的结果 -->
				<view v-if="searchRes.length"
				class="flex flex-column justify-center">
				    <u-list @scrolltolower="scrolltolower">
					  <u-list-item v-for="(item, index) in searchRes" :key="index">
						<u-cell :title="item.nickname || item.username">
						  <u-avatar
							slot="icon"
							shape="square"
							size="35"
							:src="item.avatar"
							customStyle="margin: -3px 5px -3px 0"
						  ></u-avatar>
						</u-cell>
					  </u-list-item>
					</u-list>
				</view>
				<view v-else>
					<u-empty mode="search"></u-empty>
				</view>
			</view>
			<view v-else class="flex align-center justify-center mt-3">
				<text class="font text-muted">正在搜索中...</text>
			</view>
		</view>
	</view>
</template>

<script>
	import toolJs from '@/common/mixins/tool.js';
	import {requestUrl} from '@/common/mixins/configData.js';
	import {mapState,mapGetters,mapMutations,mapActions} from 'vuex';
	export default {
		mixins:[toolJs],
		data() {
			return {
				inputStyle:{
					"background-color":"#ffffff",
				},
				chatuser_token: '',
				keyword:'',
				searchResStatus:false, // 搜索结果状态
				searchRes:[],
			}
		},
		computed:{
			...mapState({
				user : state => state.Chatuser.regloginUser,
			}),
		},
		onLoad() {
			this.chatuser_token = uni.getStorageSync('chatuser_token');
			if (!this.chatuser_token || this.user.role == 'visitor') {
				return uni.switchTab({
					url: '/pages/wode/wode'
				});
			}
		},
		methods: {
			searchData(e){
				// console.log('搜索内容',e);
				// console.log('搜索内容',this.keyword);
				this.searchResStatus = false;
				if(this.keyword.length >= 1) this.searchAjax();
			},
			searchAjax(){
				uni.$u.http.post(requestUrl.http + `/api/chat/searchUser`, {
					keyword:this.keyword,
				}, {
					header: {
						token: this.chatuser_token,
					},
				}).then(res => {
					console.log('服务器返回的结果', res);
					this.searchResStatus = true;
					this.searchRes = [];
					if(res.data.data.length){
						this.searchRes = res.data.data;
					}
					
				}).catch(err => {
					console.log('出错', err);
					if (err.data && err.data.data) {
						uni.showToast({
							title: err.data.data,
							icon: 'none',
							duration: 5000
						});
					}
				});
			},
			//加载跟多
			scrolltolower(){
				console.log('滚动条滚动到底部了加载更多搜索内容');
			},
		}
	}
</script>

<style>
    /* 导航栏背景色 */
	.navbar-bgColor {
		background-color: #ededed;
	}
</style>

```


