---
navbar: true
sidebar: auto
title: 章节4.消息页开发
---

## 一、先了解一下uni-app的尺寸单位rpx
具体查看官方文档：<https://uniapp.dcloud.net.cn/tutorial/syntax-css.html#%E5%B0%BA%E5%AF%B8%E5%8D%95%E4%BD%8D>

## 二、消息页顶部导航栏
### 1. 顶部导航栏基本样式
`/pages/xiaoxi/xiaoxi.nvue`
```vue
<template>
	<view class="page">
		<!-- 导航栏 -->
		<!-- #ifdef APP || H5 -->
		<view class="bg-light">
			<!-- 状态栏 -->
			<view :style="'height:' + statusBarHeight + 'px;' "></view>
			<!-- 导航 -->
			<view class="flex flex-row align-center justify-between" 
			style="height: 90rpx;">
			    <!-- 左边 -->
				<view class="flex align-center">
					<!-- 标题 -->
					<text class="font-md ml-3">消息</text>
				</view>
				<!-- 右边 -->
				<view class="flex align-center">
					<!-- 联系人 -->
					<view style="height: 90rpx;width: 90rpx;"
					class="flex align-center justify-center">
						<text class="iconfont font-lg">&#xe650;</text>
					</view>
					<!-- 加号 -->
					<view style="height: 90rpx;width: 90rpx;" 
					class="flex align-center justify-center">
						<text class="iconfont font-md">&#xe637;</text>
					</view>
				</view>
			</view>
		</view>
		<!-- #endif -->
		
	</view>
</template>

<script>
	export default {
		data() {
			return {
				statusBarHeight:0,//状态栏高度动态计算
			}
		},
		onLoad() {
			this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight;
			// console.log('系统信息',uni.getSystemInfoSync());
		},
		methods: {
			
		}
	}
</script>

<style>
@import '/common/css/common.nvue.vue.css';
</style>

```

### 2. 初步学习封装组件：图标按钮组件的简单封装
我们在<a href="https://study.163.com/course/courseMain.htm?courseId=1213780858&share=2&shareId=480000002289674" target="_blank">[第二学期第三季课程]</a>中，已经教大家封装过提示组件了，接下来我们看一下在uni-app中如何封装组件。
#### ① 创建组件
根目录新建文件夹 `components`，然后创建组件，比如：`chat-navbar-icon-button/chat-navbar-icon-button.vue`，文件夹名称和组件名称一样<br/><br/>
<b>好处：</b><br/>
可直接写组件，不用传统方式：
```vue
<script>
	import chatNavbarIconButton from '@/components/chat-navbar-icon-button/chat-navbar-icon-button.vue'
	export default {
		components:{
			chatNavbarIconButton
		},
        ...
    }
</script>
```

#### ② 组件代码
`/components/chat-navbar-icon-button/chat-navbar-icon-button.vue`
```vue
<template>
	<view style="width: 90rpx;height: 90rpx;"
	class="flex align-center justify-center"
	hover-class="bg-hover-light">
		<slot></slot>
	</view>
</template>

<script>
	export default {
		name:'chat-navbar-icon-button',
	}
</script>

<style>
</style>
```

#### ③ 组件使用
`/pages/xiaoxi/xiaoxi.nvue`
```vue
    <!-- 右边 -->
    <view class="flex align-center">
        <!-- 联系人 -->
        <chat-navbar-icon-button >
            <text class="iconfont font-lg">&#xe650;</text>
        </chat-navbar-icon-button>
        <!-- 加号 -->
        <chat-navbar-icon-button >
            <text class="iconfont font-md">&#xe655;</text>
        </chat-navbar-icon-button>
    </view>
```

### 3. 封装消息页顶部导航栏组件
#### ① 创建组件
创建 `/components/chat-navbar/chat-navbar.vue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		<view class="bg-light" :class="[fixed?'fixed-top':'']">
			<!-- 状态栏 -->
			<view :style="'height:' + statusBarHeight + 'px;'"></view>
			<!-- 导航 -->
			<view class="flex justify-between align-center"
			style="height: 90rpx;">
				<!-- 左边 -->
				<view>
					<!-- 标题 -->
					<text class="ml-3" v-if="title">{{title}}</text>
				</view>
				<!-- 右边 -->
				<view class="flex align-center">
					<chat-navbar-icon-button>
						<text class="iconfont font-lg">&#xe650;</text>
					</chat-navbar-icon-button>
					<chat-navbar-icon-button>
						<text class="iconfont font-md">&#xe655;</text>
					</chat-navbar-icon-button>
				</view>
			</view>
		</view>
		<!-- 占位：占位状态栏 + 导航栏-->
		<view :style="fixedHeightStyle" v-if="fixed"></view>
	</view>
</template>

<script>
	export default {
		name:"chat-navbar",
		props:{
			// 标题
			title:{
				type:String,
				default:'',
			},
			// 是否固定在顶部
			fixed:{
				type:Boolean,
				default:true
			}
		},
		data() {
			return {
				statusBarHeight:0,//状态栏高度动态计算
				fixedHeight:0, // 占位状态栏 + 导航栏
			}
		},
		mounted() {
			this.statusBarHeight = uni.getSystemInfoSync().statusBarHeight;
			console.log('系统信息',uni.getSystemInfoSync());
			this.fixedHeight = this.statusBarHeight + uni.upx2px(90);
			console.log('占位高度',this.fixedHeight);
		},
		computed:{
			fixedHeightStyle(){
				return `height:${this.fixedHeight}px;`;
			}
		}
	}
</script>

<style>
	/* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>
```

#### ② 组件使用
`/pages/xiaoxi/xiaoxi.nvue`
```vue
<template>
	<view class="page">
		<!-- 导航栏 -->
		<!-- #ifdef APP || H5 -->
		<chat-navbar title="消息" :fixed="true"></chat-navbar>
		<!-- #endif -->
		
		<!-- 聊天列表 -->
		<view style="height: 4000rpx;">
			<text>聊天列表1</text>
		</view>
		
	</view>
</template>

<script>
	export default {
		data() {
			return {
				
			}
		},
		onLoad() {
			
		},
		methods: {
			
		}
	}
</script>

<style>
/* #ifdef H5 */
@import '/common/css/common.nvue.vue.css';
/* #endif */
</style>

```

## 三、消息列表开发
### 1. 消息列表效果
<br/>
<img src="https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/chatlist.png" alt="消息列表" class="zoom-custom-imgs" style="display:inline-block;width:100px;" /> 

### 2. 消息列表代码
在根目录 `/pages/xiaoxi/xiaoxi.nvue`
```vue
<template>
	<view >
		<!-- 导航栏 -->
		<!-- #ifdef APP || H5 -->
        <chat-navbar title="消息（100）" :fixed="true"></chat-navbar> 
		<!-- #endif -->
		
		<!-- 消息列表 -->
		<view v-for="(item,index) in chatList" :key="index">
			<view class="flex align-center bg-white">
				<!-- 头像 -->
				<view class="flex align-center justify-center"
				style="width: 150rpx;">
					<image :src="item.avatar" 
					mode="widthFix" class="rounded"
					style="width: 90rpx;height: 90rpx;"></image>
				</view>
				<!-- 右边聊天部分 -->
				<view class="flex flex-column border-bottom border-light-secondary flex-1 py-3 pr-3 ">
					<!-- 上面：昵称 时间 -->
					<view class="flex justify-between align-center mb-1">
						<text class="font-md">{{item.nickname}}</text>
						<text class="font-sm text-light-muted">{{item.chat_time}}</text>
					</view>
					<!-- 下面：内容 -->
					<view class="pr-5">
						<text class="font text-light-muted u-line-1">{{item.data}}</text>
					</view>
				</view>
			</view>
		</view>
		
	</view>
</template>

<script>
	export default {
		data() {
			return {
				chatList:[
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-01.png',
						nickname:'晓明哥',
						chat_time:'20:29',
						data:'5月30日我的武汉演唱会记得来给我当助邀嘉宾啊',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-02.png',
						nickname:'热巴',
						chat_time:'20:20',
						data:'我的电影通告设计完成了吗',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-03.png',
						nickname:'GIGI',
						chat_time:'19:27',
						data:'我参加的时光音乐会节目发挥得怎么样',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-04.png',
						nickname:'基仔',
						chat_time:'18:35',
						data:'最近做什么有没有新电影发布',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-05.png',
						nickname:'娜扎',
						chat_time:'17:47',
						data:'最近正在拍一部古装剧，化妆师有点拉，你给我设计一下',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname:'彦祖',
						chat_time:'16:11',
						data:'晚上过来吃饭，我今天在家里下厨，尝一下我的手艺',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname:'力宏哥',
						chat_time:'15:07',
						data:'明天一起出海晒晒太阳，这几天太忙了',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-08.png',
						nickname:'华仔',
						chat_time:'14:20',
						data:'今晚8点记得锁定我直播间啊',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-09.png',
						nickname:'黄奕姐',
						chat_time:'11:59',
						data:'干嘛呢，我的宣传海报还有几天可以给我啊',
					},
					{
						avatar:'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-10.png',
						nickname:'阿帅',
						chat_time:'10:20',
						data:'下午去钓鱼，去不',
					},
				],
			}
		},
		onLoad() {
			
		},
		methods: {
			
		}
	}
</script>

<style>
/* #ifdef H5 */
@import '/common/css/common.nvue.vue.css';
/* #endif */
</style>
```
<b>说明：</b><br/>

> 1. 如果有同学对消息列表中一行文字多出用省略号表示的`.u-line-1`写法感兴趣的，可以调试浏览器查看css的写法； 

## 四、消息列表头像右上角消息数量提示
### 1. 效果图
<br/>
<img src="https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/chatlist-messagecount.png" alt="消息列表" class="zoom-custom-imgs" style="display:inline-block;width:100px;" /> 

### 2. 代码
在根目录 `/pages/xiaoxi/xiaoxi.nvue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		<!-- #ifdef APP || H5 -->
		<chat-navbar title="消息（100）" :fixed="false"></chat-navbar>
		<!-- #endif -->

		<!-- 消息列表 -->
		<view v-for="(item,index) in chatList" :key="index">
			<view class="flex align-stretch">
				<!-- 头像 -->
				<view style="width: 150rpx;" class="flex align-center justify-center 
				position-relative ">
					<!-- 头像地址 -->
					<!-- <image :src="item.avatar" mode="widthFix" style="width: 90rpx;height: 90rpx;" 
					class="rounded">
					</image> -->
					<u--image :src="item.avatar" mode="widthFix"
					width="90rpx" height="90rpx" radius="8rpx"></u--image>
					<!-- 消息数量 角标-->
					<!-- <text class="bg-danger rounded-circle text-white font-sm position-absolute"
					style="padding-left: 14rpx;padding-right: 14rpx;
					padding-top: 2rpx;padding-bottom: 2rpx;
					top: 16rpx;right:10rpx;z-index: 100;">9</text> -->
					<u-badge :isDot="false" :value="item.datacount" 
					absolute :offset="['16rpx','10rpx']"
					max="999" shape="circle" numberType="limit"></u-badge>
				</view>
				<!-- 右边 -->
				<view class="flex flex-column border-bottom border-light-secondary flex-1 py-3 pr-3">
					<!-- 上面：昵称 + 时间 -->
					<view class="flex justify-between align-center mb-1">
						<text class="font-md">{{item.nickname}}</text>
						<text class="font-sm text-light-muted">{{item.chat_time}}</text>
					</view>
					<!-- 下面：聊天内容 -->
					<view class="pr-5">
						<text class="font text-light-muted u-line-1">{{item.data}}</text>
					</view>
				</view>
			</view>
		</view>

	</view>
</template>

<script>
	export default {
		data() {
			return {
				chatList: [{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-01.png',
						nickname: '晓明哥',
						chat_time: '20:29',
						data: '5月30日我的武汉演唱会记得来给我当助邀嘉宾啊',
						datacount:0,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-02.png',
						nickname: '热巴',
						chat_time: '20:20',
						data: '我的电影通告设计完成了吗',
						datacount:9,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-03.png',
						nickname: 'GIGI',
						chat_time: '19:27',
						data: '我参加的时光音乐会节目发挥得怎么样',
						datacount:19,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-04.png',
						nickname: '基仔',
						chat_time: '18:35',
						data: '最近做什么有没有新电影发布',
						datacount:599,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-05.png',
						nickname: '娜扎',
						chat_time: '17:47',
						data: '最近正在拍一部古装剧，化妆师有点拉，你给我设计一下',
						datacount:7991,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: '彦祖',
						chat_time: '16:11',
						data: '晚上过来吃饭，我今天在家里下厨，尝一下我的手艺',
						datacount:79914,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname: '力宏哥',
						chat_time: '15:07',
						data: '明天一起出海晒晒太阳，这几天太忙了',
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-08.png',
						nickname: '华仔',
						chat_time: '14:20',
						data: '今晚8点记得锁定我直播间啊',
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-09.png',
						nickname: '黄奕姐',
						chat_time: '11:59',
						data: '干嘛呢，我的宣传海报还有几天可以给我啊',
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-10.png',
						nickname: '阿帅',
						chat_time: '10:20',
						data: '下午去钓鱼，去不',
					},
				],
			}
		},
		onLoad() {

		},
		methods: {

		}
	}
</script>

<style>
	/* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>
```

<b>说明：</b><br/>

> 1. app端发现当角标写在头像前面时候，就算设置了`z-index`属性，依然头像会盖住角标，说明了：`nvue页面的渲染是从上而下进行渲染的，这是和vue页面比较大的区别，因此在开发nvue页面的时候注意顺序，如果希望某个组件在某个组件之上，你就要写在这个组件之后，也就是越后面层级越高。`；


## 五、对消息列表做一个组件封装并理解父子组件事件传递
### 1. 创建消息列表组件
`/components/chat-chatlist/chat-chatlist.vue`
```vue
<template>
	<view class="flex align-stretch" hover-class="bg-hover-light"
	@click="onClick(item,index)" @longpress="onLongpress">
		<!-- 头像 -->
		<view style="width: 150rpx;" class="flex align-center justify-center 
		position-relative ">
			<!-- 头像地址 -->
			<!-- <image :src="item.avatar" mode="widthFix" style="width: 90rpx;height: 90rpx;" 
			class="rounded">
			</image> -->
			<u--image :src="item.avatar" mode="widthFix"
			width="90rpx" height="90rpx" radius="8rpx"></u--image>
			<!-- 消息数量 角标-->
			<!-- <text class="bg-danger rounded-circle text-white font-sm position-absolute"
			style="padding-left: 14rpx;padding-right: 14rpx;
			padding-top: 2rpx;padding-bottom: 2rpx;
			top: 16rpx;right:10rpx;z-index: 100;">9</text> -->
			<u-badge :isDot="false" :value="item.datacount" 
			absolute :offset="['16rpx','10rpx']"
			max="999" shape="circle" numberType="limit"></u-badge>
		</view>
		<!-- 右边 -->
		<view class="flex flex-column border-bottom border-light-secondary flex-1 py-3 pr-3">
			<!-- 上面：昵称 + 时间 -->
			<view class="flex justify-between align-center mb-1">
				<text class="font-md">{{item.nickname}}</text>
				<text class="font-sm text-light-muted">{{item.chat_time}}</text>
			</view>
			<!-- 下面：聊天内容 -->
			<view class="pr-5">
				<text class="font text-light-muted u-line-1">{{item.data}}</text>
			</view>
		</view>
	</view>
</template>

<script>
	export default{
		name:"chat-chatlist",
		props:{
			item:Object,
			index:Number
		},
		methods:{
			onClick(item,index){
				console.log('点击了列表在组件');
				this.$emit('click',{
					item,
					index
				});
			},
			onLongpress(e){
				console.log(e);
			}
		}
	}
</script>

<style>
	/* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>
```

### 2. 消息页使用组件，理解父子组件事件传递
在根目录 `/pages/xiaoxi/xiaoxi.nvue`
```vue
<template>
	<view>
		<!-- 导航栏 -->
		<!-- #ifdef APP || H5 -->
		<chat-navbar title="消息（100）" :fixed="true"></chat-navbar>
		<!-- #endif -->

		<!-- 消息列表 -->
		<view v-for="(item,index) in chatList" :key="index">
			<chat-chatlist :item="item" :index="index" @click="openChat"></chat-chatlist>
		</view>

	</view>
</template>

<script>
	export default {
		data() {
			return {
				chatList: [{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-01.png',
						nickname: '晓明哥',
						chat_time: '20:29',
						data: '5月30日我的武汉演唱会记得来给我当助邀嘉宾啊',
						datacount:0,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-02.png',
						nickname: '热巴',
						chat_time: '20:20',
						data: '我的电影通告设计完成了吗',
						datacount:9,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-03.png',
						nickname: 'GIGI',
						chat_time: '19:27',
						data: '我参加的时光音乐会节目发挥得怎么样',
						datacount:19,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-04.png',
						nickname: '基仔',
						chat_time: '18:35',
						data: '最近做什么有没有新电影发布',
						datacount:599,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-05.png',
						nickname: '娜扎',
						chat_time: '17:47',
						data: '最近正在拍一部古装剧，化妆师有点拉，你给我设计一下',
						datacount:7991,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png',
						nickname: '彦祖',
						chat_time: '16:11',
						data: '晚上过来吃饭，我今天在家里下厨，尝一下我的手艺',
						datacount:79914,
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png',
						nickname: '力宏哥',
						chat_time: '15:07',
						data: '明天一起出海晒晒太阳，这几天太忙了',
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-08.png',
						nickname: '华仔',
						chat_time: '14:20',
						data: '今晚8点记得锁定我直播间啊',
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-09.png',
						nickname: '黄奕姐',
						chat_time: '11:59',
						data: '干嘛呢，我的宣传海报还有几天可以给我啊',
					},
					{
						avatar: 'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-10.png',
						nickname: '阿帅',
						chat_time: '10:20',
						data: '下午去钓鱼，去不',
					},
				],
			}
		},
		onLoad() {

		},
		methods: {
            openChat(e){
				console.log('点击了列表在页面',e);
			}
		}
	}
</script>

<style>
	/* #ifdef H5 */
	@import '/common/css/common.nvue.vue.css';
	/* #endif */
</style>
```