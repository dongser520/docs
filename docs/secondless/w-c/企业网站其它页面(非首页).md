---
navbar: true
sidebar: auto
title: 企业网站其它页面(非首页)
---

## 一、完成工程案例、资讯中心页面渲染
### 1. 控制器 `app/controller/api/template01/api.js`
```js
const pageType = [
    'piclist', //图片列表展示
    'newslist', //新闻列表展示
    'mixlist', //图文混合列表展示
];
...
//其它页面
async ortherpage() {
    const { ctx, app } = this;

    //页面显示形式pageType
    let  _pageType = ctx.query.pageType;
    //js判断数组中是否包含某个元素
    if(!pageType.includes(_pageType)){
        _pageType = pageType[0];
    }
    //传参获取分类id
    let category_id = parseInt(ctx.params.category_id);
    const data =  await ctx.apiPage('News',{
        category_id:category_id
    });
    //由于多次用到分类相关信息
    let category = await ctx.model.Category.findByPk(category_id);
    console.log('分类信息category',JSON.parse(JSON.stringify(category)));
    await ctx.renderApi({
        tempType: 'ortherpage',
        data,
        pageType:_pageType,
        category,
    }, 'api/template01/main_app.html');
    
}
```
### 2. 模版 `app/view/api/template01/main_app.html`
```html
{% if tempType == 'ortherpage' %}
    {% include "api/template01/_ortherpage.html" %}
{% endif %}
```
### 3. 模版 `app/view/api/template01/_ortherpage.html`
```html
<!-- 内页广告图 -->
<div style="margin-top: 100px;">
    <img src="/public/api/template01/static/image/neibg.jpg" style="width: 100%;height: auto;display: block;">
</div>
<!-- 栏目名称 -->
<div class="column-name flex justify-center">
    <div class="column-name-div">
        <!-- 图标 -->
        <div class="icon-div">
            <span class="iconfont icon-zhuye"></span>
        </div>
        <!-- 栏目名 -->
        <span class="name">{{category.name}}</span>
    </div>
</div>

{{pageType}}

{% if pageType == 'piclist' %}
    {# 图片列表模式 #}
    <!-- 页面内容 -->
    <div class="page-content flex justify-center">
        <div style="width: 1200px;" class="py-40 case-div">
            <!-- 内容 -->
            {% for item in data %}
            <div class="list">
                <!-- 图片 -->
                <div>
                    <img src="{{item.attachment}}" title="{{item.name}}">
                </div>
                <!-- 标题 -->
                <div class="text-center mt-2">
                    <a href="./case_detail.html" target="_blank" class="text-no-underline text-dark lines-1 display-block"
                        title="{{item.name}}">{{item.name}}</a>
                </div>
            </div>    
            {% endfor %}
            <!-- 分页 -->
            <div style="width: 100%;">
                {# 安全起见，egg.js官方默认将代码过滤成字符串，这里我们采用过滤器进行解码 #}
                {{ ctx.locals.apipageHtml | safe }}
            </div>
        </div>
    </div>   
{% endif %}
{% if pageType == 'newslist' %}
    {# 新闻列表展示 #}
    <!-- 页面内容 -->
    <div class="page-content flex justify-center">
        <div style="width: 1200px;" class="py-40">
            <!-- 名称 -->
            <div class="flex align-center">
                <h4 class="mr-2 font-lger text-dark text-center pb-2"
                style="flex:auto;">{{category.name}}</h4>
            </div>
            <!-- 内容 -->
            {% if data.length > 0 %}
            <ul class="news-ul">
                {% for item in data %}
                <li>
                    <a href="./news_detail.html">
                        <span class="mr-1">+</span>
                        <span>{{item.name}}</span>
                        <span class="time">{{item.create_time.split(' ')[0]}}</span>
                    </a> 
                </li>    
                {% endfor %}
            </ul>    
            {% else %}
            <div class="flex align-center justify-center"> <span>当前栏目管理员还没有上传数据！</span></span></div>    
            {% endif %}
            <!-- 分页 -->
            <div style="width: 100%;">
                {# 安全起见，egg.js官方默认将代码过滤成字符串，这里我们采用过滤器进行解码 #}
                {{ ctx.locals.apipageHtml | safe }}
            </div>
            
        </div>
    </div>
{% endif %}
```
### 4. 扩展 `app/extend/context.js`
```js
// 前端分页 -- 模版1分页样式
async apiPage(modelName, where = {}, options = {}) {
    let modeldata = await this.apiModelData(modelName, where, options);
    console.log('modeldata的数据',modeldata);
    ...
    //如果当前就是第一页，就不存在上一页，禁用上一页按钮，下一页同理
    let prevDisabled = (page <= 1) || (totalPage == 0) ? 'disabled' : '';
    let nextDisabled = (page >= totalPage) || (totalPage == 0) ? 'disabled' : '';
    let firstpage = (page == 1) || (totalPage == 0) ? 'disabled' : '';
    let lastpage = (page == totalPage) || (totalPage == 0) ? 'disabled' : '';
    ...
}
```
### 5. 路由 `app/router/api/template01/router.js`
```js
router.get('/api/template/01/cid/:category_id', controller.api.template01.api.ortherpage);
```

## 二、文章详情页数据渲染
### 1. 控制器 `app/controller/api/template01/api.js`
```js
//数据详情页
async pageinfo(){
    const { ctx, app } = this;

    //页面显示形式pageType
    let _pageType = ctx.query.pageType;
    //js判断数组中是否包含某个元素
    if(!pageType.includes(_pageType)){
        _pageType = 'detail';
    }

    let id = parseInt(ctx.params.id);
    let news = await ctx.model.News.findOne({
        where:{
            id,
            status:1
        }
    });
    console.log('新闻内容',JSON.parse(JSON.stringify(news)));
    let category = await ctx.model.Category.findByPk(news.category_id);

    //上一篇下一篇
    const Op = this.app.Sequelize.Op;//拿Op,固定写法
    const prevdata = await ctx.model.News.findOne({
        where:{
            id:{
                [Op.lt]:id
            },
            category_id:news.category_id,
            status:1
        },
        order:[['id','DESC']]
    });
    const nextdata = await ctx.model.News.findOne({
        where:{
            id:{
                [Op.gt]:id
            },
            category_id:news.category_id,
            status:1
        },
        order:[['id','ASC']]
    });

    await ctx.renderApi({
        tempType: 'ortherpage',
        news,
        pageType:_pageType,
        category,
        ortherdata:{
            prevdata,
            nextdata
        }
    }, 'api/template01/main_app.html'); 

}
```
### 2. 路由 `app/router/api/template01/router.js`
```js
router.get('/api/template/01/id/:id', controller.api.template01.api.pageinfo);
```
### 3. 模版 `app/view/api/template01/_ortherpage.html`
```html
{# 信息详情 #}
{% if pageType == 'detail' %}
 <!-- 页面内容 -->
 <div class="page-content flex justify-center">
    <div style="width: 1200px;" class="py-40">
        <!-- 名称 -->
        <div class="flex justify-between border-bottom"
        style="align-items: baseline;">
            <h4 class="mr-2 font-lger text-dark">{{news.name}}</h4>
            <span class="font text-light-muted" style="width: 100px;">{{news.create_time.split(' ')[0]}}</span>
        </div>
        <!-- 内容 -->
        <div>
            {{news.maincontent | safe}}
        </div>
        <!-- 上一篇下一篇 -->
        <ul class="prev-next">
            {% if ortherdata and ortherdata.prevdata %}
            <li>
                <a href="#">
                    <span style="margin-right: 15px;color:#999999;">上一篇</span>
                    <span>{{ortherdata.prevdata.name}}</span>
                    <span>{{ortherdata.prevdata.create_time.split(' ')[0]}}</span>
                </a>
            </li>
            {% endif %}
            {% if ortherdata and ortherdata.nextdata %}
            <li>
                <a href="#">
                    <span style="margin-right: 15px;color:#999999;">下一篇</span>
                    <span>{{ortherdata.nextdata.name}}</span>
                    <span>{{ortherdata.nextdata.create_time.split(' ')[0]}}</span>
                </a>
            </li>
            {% endif %}
        </ul>
        <!-- 返回按钮 -->
        <div class="flex align-center justify-end my-5">
            <a href="#"
            class="py-3 px-5 text-white bg-info bg-hover-info">返回列表</a>
        </div>
        
    </div>
</div>    
{% endif %}
```

## 三、工程案例、资讯中心等文章链接完善，返回列表功能完善
### 1. 控制器 `app/controller/api/template01/api.js`
```js
...
//其它页面
async ortherpage() {
    记得先修改扩展里：面前端分页 -- 模版1分页样式--apiPage函数返回值
    return modeldata.data;
    ...
    //如果分类里面只有一条数据，则直接转到新闻详情
    if(data.count == 1){
        let id = data.rows[0].id;
        ctx.redirect(`/api/template/01/id/${id}?pageType=detail`);
        return;
    }
    ...
    await ctx.renderApi({
        ...
        data:data.rows,
        ...
    }, 'api/template01/main_app.html');
}

...

//数据详情页
async pageinfo() {
    ...
    //看一下该分类下有几篇文章，如果只有一篇，则不显示返回列表按钮
    let categorynews = await ctx.model.News.findAndCountAll({
        where:{
            category_id:news.category_id,
            status:1
        },
        // 主表查询字段限制
        attributes:['id','name'],
    });
    console.log('该分类下有几篇文章',JSON.parse(JSON.stringify(categorynews)));
    ...
    await ctx.renderApi({
        ...
        ortherdata:{
            ...
            categorynewsCount:categorynews.count,//分类下几篇文章
            frompageType:ctx.query.frompageType //返回分类列表的分类页面类型
        }
    }, 'api/template01/main_app.html');
}
...

```

### 2. 模版 `app/view/api/template01/_ortherpage.html`
```html
每个栏目的链接改一下
...
<!-- 标题 -->
<div class="text-center mt-2">
    <a href="/api/template/01/id/{{item.id}}?pageType=detail&frompageType={{pageType}}"  class="text-no-underline text-dark lines-1 display-block"
        title="{{item.name}}">{{item.name}}</a>
</div>
...


<!-- 上一篇下一篇 -->
<li>
    <a href="/api/template/01/id/{{ortherdata.prevdata.id}}?pageType=detail">
        <span style="margin-right: 15px;color: #999999;">上一篇</span>
        <span>{{ortherdata.prevdata.name}}</span>
        <span>{{ortherdata.prevdata.create_time.split(' ')[0]}}</span>
    </a>
</li>  
<li>
    <a href="/api/template/01/id/{{ortherdata.nextdata.id}}?pageType=detail">
        <span style="margin-right: 15px;color: #999999;">下一篇</span>
        <span>{{ortherdata.nextdata.name}}</span>
        <span>{{ortherdata.nextdata.create_time.split(' ')[0]}}</span>
    </a>
</li>

返回列表
<!-- 返回按钮 -->
{% if ortherdata.categorynewsCount > 1 %}
<div class="flex align-center justify-end my-5">
    <a href="/api/template/01/cid/{{category.id}}?pageType={{ortherdata.frompageType}}"
    class="py-3 px-5 text-white bg-info bg-hover-info">返回列表</a>
</div>   
{% endif %}
```