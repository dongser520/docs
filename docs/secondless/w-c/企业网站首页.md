---
navbar: true
sidebar: auto
title: 企业网站首页
---


## 一、数据库数据准备
> 通过模版页面分析网站所需要的分类，并上传测试或者真实数据用于页面展示【具体看课程视频111课】

## 二、读取数据库数据渲染到模版页面（以合作单位为例）
1. 控制器 `app/controller/api/template01/api.js`
```js
async index() {
    const { ctx,app } = this;
    // await ctx.render('api/template01/main_app.html',{
    //    title:'网站首页',
    //    tempType: 'index',
    // });

    //合作单位
    const cooperation_unit = await ctx.model.News.findAll({
        where:{
            category_id: 10,
            status: 1,
        },
        order: [
            ['order', 'asc'],
            ['id', 'DESC'],
        ],
        limit: 4,
        // 关联查询
        include: [
            {
                model: app.model.Category,// 需要查询的模型
                attributes: ['id', 'name', 'enname'],// 查询的字段 
            }
        ],
    });
    console.log('合作单位',JSON.parse(JSON.stringify(cooperation_unit)));

    let arr = [];
    arr.push({
        type:'cooperation_unit',
        sqldata:cooperation_unit
    });

    await ctx.renderApi({
        title:'网站首页',
        tempType: 'index',
        data:arr
    },'api/template01/main_app.html');
}
```
2. 扩展 `app/extend/context.js`
```js
  //前端模版渲染
  /**
   * 
   * @param {Object} params - 用于渲染模板的数据对象。应包含模板所需的所有键值对
   * @param {string} tplname - [tplname='api/template01/main_app.html'] - 模板文件的路径。默认为内置的基础API模板路径，可不填。
   * @returns {Promise<void>} - 返回一个Promise，表示渲染操作的完成状态。无具体返回值。
   * @throws {Error} - 如果模板加载或渲染过程中发生错误，可能会抛出异常。
   */
  async renderApi(params, tplname = 'api/template01/main_app.html') {
    await this.render(tplname,params);
  },
```
3. 模版 `app/view/api/template01/_index.html`
```html
{% for item in data %}
    {% if item.type == 'cooperation_unit' and item.sqldata.length > 0 %}
        <!-- 合作单位 -->
        <div id="cooperation_unit" class="flex justify-center py-5">
            <div style="width: 1200px;">
                <!-- 栏目名称 -->
                <div>
                    <!-- 圆角 -->
                    <div class="flex justify-center">
                        <div class="div-rounded"></div>
                    </div>
                    <!-- 英文 -->
                    <div class="flex justify-center mt-2">
                        <span class="span-en">{{item.sqldata[0].category.enname}}</span>
                    </div>
                    <!-- 中文 -->
                    <div class="flex justify-center">
                        <span class="span-ch">{{item.sqldata[0].category.name}}</span>
                    </div>
                </div>
                <!-- 栏目内容 -->
                <div class="flex justify-between  mt-5">
                    {# <img src="/public/api/template01/static/image/unit/unit01.jpg" >
                    <img src="/public/api/template01/static/image/unit/unit02.jpg" >
                    <img src="/public/api/template01/static/image/unit/unit03.jpg" >
                    <img src="/public/api/template01/static/image/unit/unit04.jpg" > #}
                    {% for item1 in item.sqldata %}
                    <img src="{{item1.attachment}}" >
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
{% endfor %}
```