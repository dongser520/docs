<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>章节6.播放视频及发视频 | 睿晨网</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/assets/img/favicon.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="#icon-pengyouquan" href="/icons/iconfont.svg" color="#3eaf7c">
    <meta name="description" content="睿晨网|睿晨编程|零基础学做网站、app、小程序就从这里开始">
    <meta name="keywords" content="睿晨网,睿晨编程,零基础学做网站,零基础学app,零基础学小程序">
    <meta name="author" content="睿晨网,睿晨编程,阿东老师">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.0c241f14.css" as="style"><link rel="preload" href="/assets/js/app.4c1fa2f2.js" as="script"><link rel="preload" href="/assets/js/10.a1858127.js" as="script"><link rel="preload" href="/assets/js/2.641709ae.js" as="script"><link rel="preload" href="/assets/js/161.d4c19dfb.js" as="script"><link rel="preload" href="/assets/js/4.68f7b7e9.js" as="script"><link rel="prefetch" href="/assets/js/100.18619803.js"><link rel="prefetch" href="/assets/js/101.795bb579.js"><link rel="prefetch" href="/assets/js/102.b2af91e0.js"><link rel="prefetch" href="/assets/js/103.addaf7eb.js"><link rel="prefetch" href="/assets/js/104.9cadff90.js"><link rel="prefetch" href="/assets/js/105.78b9c2c5.js"><link rel="prefetch" href="/assets/js/106.2e311b0f.js"><link rel="prefetch" href="/assets/js/107.719537c8.js"><link rel="prefetch" href="/assets/js/108.ee801dcb.js"><link rel="prefetch" href="/assets/js/109.7be9e3da.js"><link rel="prefetch" href="/assets/js/11.e11c94df.js"><link rel="prefetch" href="/assets/js/110.bef17d75.js"><link rel="prefetch" href="/assets/js/111.ae05aad1.js"><link rel="prefetch" href="/assets/js/112.348a918b.js"><link rel="prefetch" href="/assets/js/113.0377bb8f.js"><link rel="prefetch" href="/assets/js/114.7ce59f50.js"><link rel="prefetch" href="/assets/js/115.73763f96.js"><link rel="prefetch" href="/assets/js/116.8c4955c8.js"><link rel="prefetch" href="/assets/js/117.f57f0ca7.js"><link rel="prefetch" href="/assets/js/118.ac987a87.js"><link rel="prefetch" href="/assets/js/119.191506f9.js"><link rel="prefetch" href="/assets/js/12.77b4f171.js"><link rel="prefetch" href="/assets/js/120.a9d0f345.js"><link rel="prefetch" href="/assets/js/121.74ec567e.js"><link rel="prefetch" href="/assets/js/122.9e1dbf90.js"><link rel="prefetch" href="/assets/js/123.2ae10c73.js"><link rel="prefetch" href="/assets/js/124.1e2930d5.js"><link rel="prefetch" href="/assets/js/125.bd54db16.js"><link rel="prefetch" href="/assets/js/126.501951f4.js"><link rel="prefetch" href="/assets/js/127.78e8444c.js"><link rel="prefetch" href="/assets/js/128.4e853ac8.js"><link rel="prefetch" href="/assets/js/129.b8b424a4.js"><link rel="prefetch" href="/assets/js/13.06be6eff.js"><link rel="prefetch" href="/assets/js/130.97044db5.js"><link rel="prefetch" href="/assets/js/131.a16e7627.js"><link rel="prefetch" href="/assets/js/132.1de37703.js"><link rel="prefetch" href="/assets/js/133.d99212b9.js"><link rel="prefetch" href="/assets/js/134.92f94379.js"><link rel="prefetch" href="/assets/js/135.e4a78e00.js"><link rel="prefetch" href="/assets/js/136.4977877f.js"><link rel="prefetch" href="/assets/js/137.4c4703c5.js"><link rel="prefetch" href="/assets/js/138.c199cd62.js"><link rel="prefetch" href="/assets/js/139.3ae48ccb.js"><link rel="prefetch" href="/assets/js/14.f75e8140.js"><link rel="prefetch" href="/assets/js/140.41d910b1.js"><link rel="prefetch" href="/assets/js/141.c93ed5fd.js"><link rel="prefetch" href="/assets/js/142.a30bcabf.js"><link rel="prefetch" href="/assets/js/143.8b1aaf58.js"><link rel="prefetch" href="/assets/js/144.f9b2970c.js"><link rel="prefetch" href="/assets/js/145.7363c390.js"><link rel="prefetch" href="/assets/js/146.1d5c8a1d.js"><link rel="prefetch" href="/assets/js/147.e121f839.js"><link rel="prefetch" href="/assets/js/148.add78a99.js"><link rel="prefetch" href="/assets/js/149.f27cc0ff.js"><link rel="prefetch" href="/assets/js/15.f10318c8.js"><link rel="prefetch" href="/assets/js/150.ced8ecaa.js"><link rel="prefetch" href="/assets/js/151.0bf12333.js"><link rel="prefetch" href="/assets/js/152.40f21e31.js"><link rel="prefetch" href="/assets/js/153.b262de48.js"><link rel="prefetch" href="/assets/js/154.50c64325.js"><link rel="prefetch" href="/assets/js/155.426015ec.js"><link rel="prefetch" href="/assets/js/156.4b9bf962.js"><link rel="prefetch" href="/assets/js/157.95c0b8d1.js"><link rel="prefetch" href="/assets/js/158.74450c14.js"><link rel="prefetch" href="/assets/js/159.cc9c20a2.js"><link rel="prefetch" href="/assets/js/16.49a0cfe4.js"><link rel="prefetch" href="/assets/js/160.01c4a8c7.js"><link rel="prefetch" href="/assets/js/162.42a1c4fb.js"><link rel="prefetch" href="/assets/js/163.d3b4d63d.js"><link rel="prefetch" href="/assets/js/164.f9f007d4.js"><link rel="prefetch" href="/assets/js/165.9f7441e0.js"><link rel="prefetch" href="/assets/js/166.1d96f480.js"><link rel="prefetch" href="/assets/js/167.5856d771.js"><link rel="prefetch" href="/assets/js/168.dd367256.js"><link rel="prefetch" href="/assets/js/169.cf1362a6.js"><link rel="prefetch" href="/assets/js/17.9cf0aeef.js"><link rel="prefetch" href="/assets/js/170.aca266de.js"><link rel="prefetch" href="/assets/js/171.599ff2d4.js"><link rel="prefetch" href="/assets/js/172.9e0826cc.js"><link rel="prefetch" href="/assets/js/173.d30914b5.js"><link rel="prefetch" href="/assets/js/174.d7494b91.js"><link rel="prefetch" href="/assets/js/175.b32a1bb2.js"><link rel="prefetch" href="/assets/js/176.decc27de.js"><link rel="prefetch" href="/assets/js/177.c0b71cf9.js"><link rel="prefetch" href="/assets/js/178.4e28a1ff.js"><link rel="prefetch" href="/assets/js/179.f6a019b1.js"><link rel="prefetch" href="/assets/js/18.f506f436.js"><link rel="prefetch" href="/assets/js/180.f853a887.js"><link rel="prefetch" href="/assets/js/181.b2de00b7.js"><link rel="prefetch" href="/assets/js/182.22b42a53.js"><link rel="prefetch" href="/assets/js/183.4d3486a4.js"><link rel="prefetch" href="/assets/js/184.25831409.js"><link rel="prefetch" href="/assets/js/185.d01fcfd3.js"><link rel="prefetch" href="/assets/js/186.49c41f4f.js"><link rel="prefetch" href="/assets/js/187.34eb1a96.js"><link rel="prefetch" href="/assets/js/188.651bcdfa.js"><link rel="prefetch" href="/assets/js/189.e75e375d.js"><link rel="prefetch" href="/assets/js/19.f216d96e.js"><link rel="prefetch" href="/assets/js/190.1ec83dea.js"><link rel="prefetch" href="/assets/js/191.bbb68c4d.js"><link rel="prefetch" href="/assets/js/192.1e4bd575.js"><link rel="prefetch" href="/assets/js/193.c560196e.js"><link rel="prefetch" href="/assets/js/194.ea7c96fd.js"><link rel="prefetch" href="/assets/js/195.279e9c3a.js"><link rel="prefetch" href="/assets/js/196.79b5d677.js"><link rel="prefetch" href="/assets/js/197.78f10001.js"><link rel="prefetch" href="/assets/js/198.d665ee5a.js"><link rel="prefetch" href="/assets/js/199.37013295.js"><link rel="prefetch" href="/assets/js/20.c9849598.js"><link rel="prefetch" href="/assets/js/200.2347a83a.js"><link rel="prefetch" href="/assets/js/201.19063bbd.js"><link rel="prefetch" href="/assets/js/202.32e5ace2.js"><link rel="prefetch" href="/assets/js/203.1f87638d.js"><link rel="prefetch" href="/assets/js/204.03cf582a.js"><link rel="prefetch" href="/assets/js/205.80fe2051.js"><link rel="prefetch" href="/assets/js/206.a0d9b926.js"><link rel="prefetch" href="/assets/js/207.3502356e.js"><link rel="prefetch" href="/assets/js/208.a4c9af93.js"><link rel="prefetch" href="/assets/js/209.9511055d.js"><link rel="prefetch" href="/assets/js/21.7d11fd8e.js"><link rel="prefetch" href="/assets/js/210.dc1b8bd8.js"><link rel="prefetch" href="/assets/js/211.eec86519.js"><link rel="prefetch" href="/assets/js/212.e26acd4d.js"><link rel="prefetch" href="/assets/js/213.9a9ec01e.js"><link rel="prefetch" href="/assets/js/214.19bf4a95.js"><link rel="prefetch" href="/assets/js/215.ede08fd2.js"><link rel="prefetch" href="/assets/js/216.a9443bde.js"><link rel="prefetch" href="/assets/js/217.845fad4f.js"><link rel="prefetch" href="/assets/js/218.10a24507.js"><link rel="prefetch" href="/assets/js/219.582bf77f.js"><link rel="prefetch" href="/assets/js/22.a81c6dd1.js"><link rel="prefetch" href="/assets/js/220.75958238.js"><link rel="prefetch" href="/assets/js/221.25aa9b7d.js"><link rel="prefetch" href="/assets/js/23.e3f76b3b.js"><link rel="prefetch" href="/assets/js/24.53929924.js"><link rel="prefetch" href="/assets/js/25.6da15d03.js"><link rel="prefetch" href="/assets/js/26.208cb02b.js"><link rel="prefetch" href="/assets/js/27.0055f1bf.js"><link rel="prefetch" href="/assets/js/28.c22d8dbb.js"><link rel="prefetch" href="/assets/js/29.5274de73.js"><link rel="prefetch" href="/assets/js/3.a5ce401d.js"><link rel="prefetch" href="/assets/js/30.0c8e8d20.js"><link rel="prefetch" href="/assets/js/31.dabb2430.js"><link rel="prefetch" href="/assets/js/32.4b69344f.js"><link rel="prefetch" href="/assets/js/33.2a6fe3fa.js"><link rel="prefetch" href="/assets/js/34.b7d7a9a6.js"><link rel="prefetch" href="/assets/js/35.fc527240.js"><link rel="prefetch" href="/assets/js/36.96422d34.js"><link rel="prefetch" href="/assets/js/37.7cd0e507.js"><link rel="prefetch" href="/assets/js/38.adb87b54.js"><link rel="prefetch" href="/assets/js/39.142ea250.js"><link rel="prefetch" href="/assets/js/40.2d6a4bf1.js"><link rel="prefetch" href="/assets/js/41.6dc1c411.js"><link rel="prefetch" href="/assets/js/42.c8355471.js"><link rel="prefetch" href="/assets/js/43.eba2417f.js"><link rel="prefetch" href="/assets/js/44.cdafd4da.js"><link rel="prefetch" href="/assets/js/45.5dfd5868.js"><link rel="prefetch" href="/assets/js/46.4cde5b6f.js"><link rel="prefetch" href="/assets/js/47.1fa112a3.js"><link rel="prefetch" href="/assets/js/48.cc7fe259.js"><link rel="prefetch" href="/assets/js/49.3df09ad7.js"><link rel="prefetch" href="/assets/js/5.6ac3d9b4.js"><link rel="prefetch" href="/assets/js/50.419588dd.js"><link rel="prefetch" href="/assets/js/51.c48be90d.js"><link rel="prefetch" href="/assets/js/52.c461b61e.js"><link rel="prefetch" href="/assets/js/53.4f6ab812.js"><link rel="prefetch" href="/assets/js/54.3293f69e.js"><link rel="prefetch" href="/assets/js/55.4d866de2.js"><link rel="prefetch" href="/assets/js/56.31a53067.js"><link rel="prefetch" href="/assets/js/57.19c7e76e.js"><link rel="prefetch" href="/assets/js/58.d8dc7186.js"><link rel="prefetch" href="/assets/js/59.bdfff1b6.js"><link rel="prefetch" href="/assets/js/6.f6f62d21.js"><link rel="prefetch" href="/assets/js/60.17072b43.js"><link rel="prefetch" href="/assets/js/61.035209e3.js"><link rel="prefetch" href="/assets/js/62.0d160a8a.js"><link rel="prefetch" href="/assets/js/63.cf07039a.js"><link rel="prefetch" href="/assets/js/64.4ac28cb2.js"><link rel="prefetch" href="/assets/js/65.c4b56fcb.js"><link rel="prefetch" href="/assets/js/66.fe14252b.js"><link rel="prefetch" href="/assets/js/67.f5182f00.js"><link rel="prefetch" href="/assets/js/68.29ba900b.js"><link rel="prefetch" href="/assets/js/69.8e3c6d8f.js"><link rel="prefetch" href="/assets/js/7.5ecdfcdb.js"><link rel="prefetch" href="/assets/js/70.272781c2.js"><link rel="prefetch" href="/assets/js/71.ba3c0143.js"><link rel="prefetch" href="/assets/js/72.0036a802.js"><link rel="prefetch" href="/assets/js/73.6bd6be40.js"><link rel="prefetch" href="/assets/js/74.d81dedf2.js"><link rel="prefetch" href="/assets/js/75.757237b7.js"><link rel="prefetch" href="/assets/js/76.f5792d24.js"><link rel="prefetch" href="/assets/js/77.d8aadd25.js"><link rel="prefetch" href="/assets/js/78.e4843ab3.js"><link rel="prefetch" href="/assets/js/79.a1f0575e.js"><link rel="prefetch" href="/assets/js/8.f3b4934d.js"><link rel="prefetch" href="/assets/js/80.ea9aa602.js"><link rel="prefetch" href="/assets/js/81.2cd439e3.js"><link rel="prefetch" href="/assets/js/82.9af7b0cb.js"><link rel="prefetch" href="/assets/js/83.77ac7dfb.js"><link rel="prefetch" href="/assets/js/84.17214734.js"><link rel="prefetch" href="/assets/js/85.0775f854.js"><link rel="prefetch" href="/assets/js/86.569d43a8.js"><link rel="prefetch" href="/assets/js/87.74196356.js"><link rel="prefetch" href="/assets/js/88.fa5aad52.js"><link rel="prefetch" href="/assets/js/89.11b2daa6.js"><link rel="prefetch" href="/assets/js/9.4d480772.js"><link rel="prefetch" href="/assets/js/90.3140661f.js"><link rel="prefetch" href="/assets/js/91.3d978faa.js"><link rel="prefetch" href="/assets/js/92.41c51097.js"><link rel="prefetch" href="/assets/js/93.70f92b88.js"><link rel="prefetch" href="/assets/js/94.7d09f78c.js"><link rel="prefetch" href="/assets/js/95.d7859f94.js"><link rel="prefetch" href="/assets/js/96.104638ee.js"><link rel="prefetch" href="/assets/js/97.fa2e330a.js"><link rel="prefetch" href="/assets/js/98.e49c1821.js"><link rel="prefetch" href="/assets/js/99.c5e10809.js">
    <link rel="stylesheet" href="/assets/css/0.styles.0c241f14.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">睿晨网</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/aboutless.html" class="nav-link">
  第一期企业网页开发
</a></div><div class="nav-item"><a href="/secondless/" class="nav-link">
  第二期企业网站开发
</a></div><div class="nav-item"><a href="/thirdless/" class="nav-link router-link-active">
  第三期移动端(H5/小程序/App)课程
</a></div><div class="nav-item"><a href="/fourthless/" class="nav-link">
  第四期web全栈课程
</a></div><div class="nav-item"><a href="/fiveless/" class="nav-link">
  第五期python课程
</a></div><div class="nav-item"><a href="/web/software/" class="nav-link">
  课程软件小案例
</a></div><div class="nav-item"><a href="/web/mysql/" class="nav-link">
  课程案例数据表
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程答疑汇总" class="dropdown-title"><span class="title">课程答疑</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程答疑汇总" class="mobile-dropdown-title"><span class="title">课程答疑</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/answer/课程常见问题.html" class="nav-link">
  课程常见问题
</a></li><li class="dropdown-item"><!----> <a href="/deploy/" class="nav-link">
  项目部署
</a></li><li class="dropdown-item"><!----> <a href="/web/answer/免费部署SSL证书.html" class="nav-link">
  免费部署SSL证书
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程学习网站" class="dropdown-title"><span class="title">课程学习网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程学习网站" class="mobile-dropdown-title"><span class="title">课程学习网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          视频学习网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://study.163.com/provider/480000002289674/index.htm?share=2&amp;shareId=480000002289674" target="_blank" rel="noopener noreferrer" class="nav-link external">
  网易云课堂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://space.bilibili.com/3493114067028034/pugv" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用菜单" class="dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="实用菜单" class="mobile-dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实用方法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/定位相关.html" class="nav-link">
  定位相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/地图相关.html" class="nav-link">
  地图相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/树形结构数据转换.html" class="nav-link">
  树形结构数据转换
</a></li></ul></li><li class="dropdown-item"><h4>
          uni-app专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/uni-app专栏.html" class="nav-link">
  uni-app的UI框架
</a></li><li class="dropdown-subitem"><a href="/web/methods/uni-app如何引入库.html" class="nav-link">
  uni-app如何引入js库
</a></li></ul></li><li class="dropdown-item"><h4>
          Egg.js专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js.html" class="nav-link">
  Egg.js基础
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js基础总结.html" class="nav-link">
  Egg.js基础总结
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js重要知识详细文档.html" class="nav-link">
  Egg.js重要知识详细文档
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/ValParams API 说明.html" class="nav-link">
  Egg.js参数验证说明
</a></li><li class="dropdown-subitem"><a href="/web/mysql/Sequelize数据类型.html" class="nav-link">
  Egg.js迁移文件Sequelize数据类型
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js接口安全防护方案.html" class="nav-link">
  Egg.js接口安全防护方案
</a></li><li class="dropdown-subitem"><a href="/web/answer/课程常见问题.html#_3-eggjs如何重置数据表-保证id每次从1开始计算" class="nav-link">
  Egg.js重置数据表每次ID为1
</a></li></ul></li><li class="dropdown-item"><h4>
          实用网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/实用接口.html" class="nav-link">
  实用接口
</a></li><li class="dropdown-subitem"><a href="/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/web/vue.js/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/web/Vue3+ElementPlus/" class="nav-link">
  Vue3+ElementPlus系统
</a></li><li class="dropdown-subitem"><a href="/web/echarts/" class="nav-link">
  echarts图表
</a></li><li class="dropdown-subitem"><a href="/web/bootstrap/" class="nav-link">
  Bootstrap
</a></li><li class="dropdown-subitem"><a href="/web/IIS/" class="nav-link">
  IIS
</a></li><li class="dropdown-subitem"><a href="/web/github/" class="nav-link">
  Github
</a></li><li class="dropdown-subitem"><a href="/web/Vanta.js/" class="nav-link">
  Vanta.js网页3D背景
</a></li><li class="dropdown-subitem"><a href="/web/shop/" class="nav-link">
  商城系统推荐
</a></li></ul></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/aboutless.html" class="nav-link">
  第一期企业网页开发
</a></div><div class="nav-item"><a href="/secondless/" class="nav-link">
  第二期企业网站开发
</a></div><div class="nav-item"><a href="/thirdless/" class="nav-link router-link-active">
  第三期移动端(H5/小程序/App)课程
</a></div><div class="nav-item"><a href="/fourthless/" class="nav-link">
  第四期web全栈课程
</a></div><div class="nav-item"><a href="/fiveless/" class="nav-link">
  第五期python课程
</a></div><div class="nav-item"><a href="/web/software/" class="nav-link">
  课程软件小案例
</a></div><div class="nav-item"><a href="/web/mysql/" class="nav-link">
  课程案例数据表
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程答疑汇总" class="dropdown-title"><span class="title">课程答疑</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程答疑汇总" class="mobile-dropdown-title"><span class="title">课程答疑</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/answer/课程常见问题.html" class="nav-link">
  课程常见问题
</a></li><li class="dropdown-item"><!----> <a href="/deploy/" class="nav-link">
  项目部署
</a></li><li class="dropdown-item"><!----> <a href="/web/answer/免费部署SSL证书.html" class="nav-link">
  免费部署SSL证书
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="课程学习网站" class="dropdown-title"><span class="title">课程学习网站</span> <span class="arrow down"></span></button> <button type="button" aria-label="课程学习网站" class="mobile-dropdown-title"><span class="title">课程学习网站</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          视频学习网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://study.163.com/provider/480000002289674/index.htm?share=2&amp;shareId=480000002289674" target="_blank" rel="noopener noreferrer" class="nav-link external">
  网易云课堂
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://space.bilibili.com/3493114067028034/pugv" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="实用菜单" class="dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow down"></span></button> <button type="button" aria-label="实用菜单" class="mobile-dropdown-title"><span class="title">实用网站和方法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          实用方法
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/定位相关.html" class="nav-link">
  定位相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/地图相关.html" class="nav-link">
  地图相关
</a></li><li class="dropdown-subitem"><a href="/web/methods/树形结构数据转换.html" class="nav-link">
  树形结构数据转换
</a></li></ul></li><li class="dropdown-item"><h4>
          uni-app专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/uni-app专栏.html" class="nav-link">
  uni-app的UI框架
</a></li><li class="dropdown-subitem"><a href="/web/methods/uni-app如何引入库.html" class="nav-link">
  uni-app如何引入js库
</a></li></ul></li><li class="dropdown-item"><h4>
          Egg.js专栏
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js.html" class="nav-link">
  Egg.js基础
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js基础总结.html" class="nav-link">
  Egg.js基础总结
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/egg.js重要知识详细文档.html" class="nav-link">
  Egg.js重要知识详细文档
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/ValParams API 说明.html" class="nav-link">
  Egg.js参数验证说明
</a></li><li class="dropdown-subitem"><a href="/web/mysql/Sequelize数据类型.html" class="nav-link">
  Egg.js迁移文件Sequelize数据类型
</a></li><li class="dropdown-subitem"><a href="/secondless/w-c/Egg.js接口安全防护方案.html" class="nav-link">
  Egg.js接口安全防护方案
</a></li><li class="dropdown-subitem"><a href="/web/answer/课程常见问题.html#_3-eggjs如何重置数据表-保证id每次从1开始计算" class="nav-link">
  Egg.js重置数据表每次ID为1
</a></li></ul></li><li class="dropdown-item"><h4>
          实用网站
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/web/methods/实用接口.html" class="nav-link">
  实用接口
</a></li><li class="dropdown-subitem"><a href="/web/css/" class="nav-link">
  css
</a></li><li class="dropdown-subitem"><a href="/web/vue.js/" class="nav-link">
  Vue.js
</a></li><li class="dropdown-subitem"><a href="/web/Vue3+ElementPlus/" class="nav-link">
  Vue3+ElementPlus系统
</a></li><li class="dropdown-subitem"><a href="/web/echarts/" class="nav-link">
  echarts图表
</a></li><li class="dropdown-subitem"><a href="/web/bootstrap/" class="nav-link">
  Bootstrap
</a></li><li class="dropdown-subitem"><a href="/web/IIS/" class="nav-link">
  IIS
</a></li><li class="dropdown-subitem"><a href="/web/github/" class="nav-link">
  Github
</a></li><li class="dropdown-subitem"><a href="/web/Vanta.js/" class="nav-link">
  Vanta.js网页3D背景
</a></li><li class="dropdown-subitem"><a href="/web/shop/" class="nav-link">
  商城系统推荐
</a></li></ul></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>章节6.播放视频及发视频</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#一、消息页视频播放封面开发" class="sidebar-link">一、消息页视频播放封面开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_1-页面补充数据" class="sidebar-link">1. 页面补充数据</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_2-组件新增视频播放情况" class="sidebar-link">2. 组件新增视频播放情况</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_3-新增视频封面组件" class="sidebar-link">3. 新增视频封面组件</a></li></ul></li><li><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#二、视频播放页开发" class="sidebar-link">二、视频播放页开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_1-新建页面及配置" class="sidebar-link">1. 新建页面及配置</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_2-进入页面传递参数" class="sidebar-link">2. 进入页面传递参数</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_3-页面视频播放" class="sidebar-link">3. 页面视频播放</a></li></ul></li><li><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#三、相册选择视频发送" class="sidebar-link">三、相册选择视频发送</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_1-聊天页加号菜单功能数据调整和代码分离" class="sidebar-link">1. 聊天页加号菜单功能数据调整和代码分离</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_2-获取视频封面图" class="sidebar-link">2. 获取视频封面图</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_1-针对h5端-比较简单-采用video-canvas-即可" class="sidebar-link">① 针对H5端（比较简单，采用videocanvas）即可</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_2-小程序端-在微信开发者工具上选择视频后-可直接返回视频封面-但是真机调试无法返回视频封面-有以下解决方案" class="sidebar-link">② 小程序端（在微信开发者工具上选择视频后，可直接返回视频封面，但是真机调试无法返回视频封面），有以下解决方案：</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_3-针对app端" class="sidebar-link">③ 针对app端</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_3-发视频-视频占位和视频封面配合使用" class="sidebar-link">3. 发视频：视频占位和视频封面配合使用</a></li></ul></li><li><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#四、通过相机进行发图片、发视频" class="sidebar-link">四、通过相机进行发图片、发视频</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_1-方法合并处理" class="sidebar-link">1. 方法合并处理</a></li><li class="sidebar-sub-header"><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#_2-针对h5端的处理" class="sidebar-link">2. 针对H5端的处理</a></li></ul></li><li><a href="/thirdless/w-b/06%E6%92%AD%E6%94%BE%E8%A7%86%E9%A2%91%E5%8F%8A%E5%8F%91%E8%A7%86%E9%A2%91.html#五、加号扩展菜单功能" class="sidebar-link">五、加号扩展菜单功能</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、消息页视频播放封面开发"><a href="#一、消息页视频播放封面开发" class="header-anchor">#</a> 一、消息页视频播放封面开发</h2> <p>素材准备，给大家提供一下视频素材和封面，大家也可以用自己的素材测试</p> <ol><li>视频素材： <code>https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4</code></li> <li>视频封面素材： <code>https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg</code></li></ol> <h3 id="_1-页面补充数据"><a href="#_1-页面补充数据" class="header-anchor">#</a> 1. 页面补充数据</h3> <p>在页面 <code>/pages/chat/chat.nvue</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>
<span class="token punctuation">{</span>
    <span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148999</span><span class="token punctuation">,</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">otherData</span><span class="token operator">:</span><span class="token punctuation">{</span>
        <span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token string">'1:18'</span><span class="token punctuation">,</span> <span class="token comment">// 时长</span>
        <span class="token literal-property property">poster</span><span class="token operator">:</span><span class="token string">&quot;https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">videoData</span><span class="token operator">:</span><span class="token string">&quot;https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'video'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
    <span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_2-组件新增视频播放情况"><a href="#_2-组件新增视频播放情况" class="header-anchor">#</a> 2. 组件新增视频播放情况</h3> <p>在组件 <code>/components/chat-item/chat-item.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 情况4: 视频  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.type == 'video'<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-item-video-poster</span> <span class="token attr-name">:item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-item-video-poster</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_3-新增视频封面组件"><a href="#_3-新增视频封面组件" class="header-anchor">#</a> 3. 新增视频封面组件</h3> <p>新增 <code>/components/chat-item-video-poster/chat-item-video-poster.vue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-relative<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openVideoShow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 视频封面 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-item-image</span> <span class="token attr-name">:item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">imageClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rounded<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">:maxWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:maxHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-item-image</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 蒙版 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 right-0 top-0 bottom-0 rounded<span class="token punctuation">&quot;</span></span>
		<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 98<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 时长 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 top-0 right-0 bottom-0 flex flex-row align-end justify-end mr-1 mb-1<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 99<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-white<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.otherData.duration}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 播放图标 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 top-0 right-0 bottom-0 flex flex-row align-center justify-center<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 100<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont text-white<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>videoPlayIconStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe710;">&amp;#xe710;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;chat-item-video-poster&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">props</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token literal-property property">item</span><span class="token operator">:</span>Object<span class="token punctuation">,</span>
			<span class="token literal-property property">index</span><span class="token operator">:</span>Number<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				<span class="token comment">// 播放图片大小默认70rpx</span>
				<span class="token literal-property property">videoPlayIcon</span><span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token function">openVideoShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// 打开视频</span>
				<span class="token keyword">const</span> videoUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>videoData<span class="token punctuation">;</span>
				<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>title <span class="token operator">||</span> <span class="token string">'视频'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">const</span> poster <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>poster <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					<span class="token literal-property property">url</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pages/videoShow/videoShow?videoUrl=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>videoUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;title=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;poster=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>poster<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token literal-property property">animationType</span><span class="token operator">:</span><span class="token string">'zoom-fade-out'</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token function">videoPlayIconStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">font-size: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlayIcon<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rpx;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
	<span class="token comment">/* #ifdef H5 */</span>
	<span class="token atrule"><span class="token rule">@import</span> <span class="token string">'/common/css/common.nvue.vue.css'</span><span class="token punctuation">;</span></span>
	<span class="token comment">/* #endif */</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="二、视频播放页开发"><a href="#二、视频播放页开发" class="header-anchor">#</a> 二、视频播放页开发</h2> <h3 id="_1-新建页面及配置"><a href="#_1-新建页面及配置" class="header-anchor">#</a> 1. 新建页面及配置</h3> <ol><li>新建页面  <code>/pages/videoShow/videoShow.nvue</code></li> <li>配置页面 <code>pages.json</code>中</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;path&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;pages/videoShow/videoShow&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;style&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;navigationBarTitleText&quot;</span><span class="token operator">:</span><span class="token string">&quot;视频播放&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;app-plus&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token property">&quot;scrollIndicator&quot;</span><span class="token operator">:</span><span class="token string">&quot;none&quot;</span><span class="token punctuation">,</span>
			<span class="token property">&quot;titleNView&quot;</span><span class="token operator">:</span><span class="token boolean">false</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token property">&quot;navigationStyle&quot;</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-进入页面传递参数"><a href="#_2-进入页面传递参数" class="header-anchor">#</a> 2. 进入页面传递参数</h3> <p>从组件 <code>/components/chat-item-video-poster/chat-item-video-poster.vue</code> 进入</p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token function">openVideoShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// 打开视频</span>
			<span class="token keyword">const</span> videoUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>videoData<span class="token punctuation">;</span>
			<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>title <span class="token operator">||</span> <span class="token string">'视频'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> poster <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>poster <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">url</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pages/videoShow/videoShow?videoUrl=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>videoUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;title=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;poster=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>poster<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token literal-property property">animationType</span><span class="token operator">:</span><span class="token string">'zoom-fade-out'</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_3-页面视频播放"><a href="#_3-页面视频播放" class="header-anchor">#</a> 3. 页面视频播放</h3> <p>在页面 <code>/pages/videoShow/videoShow.nvue</code>
用到uni-app提供的<code>&lt;video&gt;</code>组件：<a href="https://uniapp.dcloud.net.cn/component/video.html" target="_blank" rel="noopener noreferrer">https://uniapp.dcloud.net.cn/component/video.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-relative bg-dark<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>video_url<span class="token punctuation">&quot;</span></span>  <span class="token attr-name">autoplay</span> <span class="token attr-name">loop</span>  <span class="token attr-name">:controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> 
		<span class="token attr-name">page-gesture</span> <span class="token attr-name">show-progress</span>
		<span class="token attr-name">enable-play-gesture</span>  <span class="token attr-name">:http-cache</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> 
		<span class="token attr-name">:show-fullscreen-btn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">x5-video-player-type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>h5-page<span class="token punctuation">'</span></span>
		<span class="token attr-name">:poster</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>posterUrl<span class="token punctuation">&quot;</span></span>
		<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 750rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>height:'+windowHeight+'px;'<span class="token punctuation">&quot;</span></span> 
		<span class="token attr-name">:direction</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>myVideo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>titleText<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">@ended</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>videoEnd<span class="token punctuation">&quot;</span></span> 
		<span class="token attr-name">@fullscreenchange</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fullscreenchange<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">@fullscreenclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fullscreenclick<span class="token punctuation">&quot;</span></span> 
		<span class="token attr-name">@controlstoggle</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>controlstoggle<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">@loadedmetadata</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>loadedmetadata<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		    <span class="token comment">&lt;!-- #ifndef MP --&gt;</span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text-white position-absolute font-lg<span class="token punctuation">&quot;</span></span> 
			<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navigateBack<span class="token punctuation">&quot;</span></span>
			<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">left</span><span class="token punctuation">:</span> 30rpx<span class="token punctuation">;</span><span class="token property">bottom</span><span class="token punctuation">:</span> 140rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
			    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>220<span class="token punctuation">,</span>0.2<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token property">height</span><span class="token punctuation">:</span> 60rpx<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> 35rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span> 
				<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>py-1 px-2 justify-center align-center flex flex-row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u-icon</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#f9f9f9<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u-icon</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font text-white ml-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>关闭视频<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cover-view</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- #endif --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- #ifdef MP --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navigateBack<span class="token punctuation">&quot;</span></span>
		<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">left</span><span class="token punctuation">:</span> 30rpx<span class="token punctuation">;</span><span class="token property">bottom</span><span class="token punctuation">:</span> 140rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span>255<span class="token punctuation">,</span>220<span class="token punctuation">,</span>0.2<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token property">height</span><span class="token punctuation">:</span> 60rpx<span class="token punctuation">;</span><span class="token property">border-radius</span><span class="token punctuation">:</span> 35rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
		    <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>py-1 px-2 justify-center align-center flex flex-row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u-icon</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>close<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>18<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#f9f9f9<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u-icon</span><span class="token punctuation">&gt;</span></span>
		    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font text-white ml-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>关闭视频<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- #endif --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">import</span> toolJs <span class="token keyword">from</span> <span class="token string">'@/common/mixins/tool.js'</span><span class="token punctuation">;</span> 
	<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">mixins</span><span class="token operator">:</span><span class="token punctuation">[</span>toolJs<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				<span class="token comment">//避免props冲突</span>
				<span class="token comment">//uni-app会自动将URL参数注入为页面props，使用同名变量会导致冲突</span>
				<span class="token comment">//通过重命名变量，明确区分URL参数和本地数据</span>
				<span class="token comment">//遵循Vue数据流规范：</span>
				<span class="token comment">//不直接修改props，而是使用本地变量存储需要修改的数据</span>
				<span class="token comment">//保持单向数据流，避免不可预测的行为</span>
				<span class="token literal-property property">windowHeight</span><span class="token operator">:</span><span class="token number">500</span><span class="token punctuation">,</span>
				<span class="token comment">// 使用本地变量存储URL参数</span>
				<span class="token comment">//将 videoUrl 改为 video_url</span>
				<span class="token comment">//将 title 改为 titleText</span>
				<span class="token comment">//将 poster 改为 posterUrl</span>
				<span class="token literal-property property">video_url</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>      <span class="token comment">// 视频URL</span>
				<span class="token literal-property property">posterUrl</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>     <span class="token comment">// 封面URL</span>
				<span class="token literal-property property">titleText</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>     <span class="token comment">// 标题文本</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">onReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">//动态获取高度</span>
			<span class="token keyword">let</span> res<span class="token operator">=</span>uni<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>windowHeight<span class="token operator">=</span>res<span class="token punctuation">.</span>windowHeight<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">onLoad</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//在 onLoad 中将URL参数赋值给本地变量，而不是直接修改可能作为prop注入的变量</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'到了视频界面'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>e<span class="token punctuation">.</span>videoUrl <span class="token operator">||</span> e<span class="token punctuation">.</span>videoUrl <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'非法视频'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 将URL参数赋值给本地变量</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>video_url <span class="token operator">=</span> e<span class="token punctuation">.</span>videoUrl<span class="token punctuation">;</span>
			
			<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>titleText <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
				uni<span class="token punctuation">.</span><span class="token function">setNavigationBarTitle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>titleText<span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
			
			<span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>poster<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>posterUrl <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>poster<span class="token punctuation">)</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'封面地址'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>posterUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token function">videoEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'视频播放完了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">fullscreenchange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当视频进入和退出全屏时触发'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">fullscreenclick</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'视频播放全屏播放时点击事件'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">controlstoggle</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'切换 controls 显示隐藏时触发'</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">loadedmetadata</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'视频元数据加载完成时触发'</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>detail<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
	<span class="token comment">/* #ifdef H5 */</span>
	<span class="token atrule"><span class="token rule">@import</span> <span class="token string">'/common/css/common.nvue.vue.css'</span><span class="token punctuation">;</span></span>
	<span class="token comment">/* #endif */</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="三、相册选择视频发送"><a href="#三、相册选择视频发送" class="header-anchor">#</a> 三、相册选择视频发送</h2> <h3 id="_1-聊天页加号菜单功能数据调整和代码分离"><a href="#_1-聊天页加号菜单功能数据调整和代码分离" class="header-anchor">#</a> 1. 聊天页加号菜单功能数据调整和代码分离</h3> <p>我们的<code>chat.nvue</code>页面代码太多了，可以采用mixins方法将页面代码分离一部分处理</p> <ol><li>新建js文件  <code>/pages/chat/plusIconAction.js</code></li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> UniPermission <span class="token keyword">from</span> <span class="token string">'@/common/mixins/uni_permission.js'</span><span class="token punctuation">;</span>

<span class="token comment">// H5端获取视频封面:videoPath 是视频地址</span>
<span class="token keyword">function</span> <span class="token function">getH5VideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// H5端直接使用视频路径创建video元素</span>
        <span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        video<span class="token punctuation">.</span>src <span class="token operator">=</span> videoPath<span class="token punctuation">;</span>
        video<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span>
        video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadeddata'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            video<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span> <span class="token comment">// 设置到0.1秒获取封面</span>
            
            video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'seeked'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> video<span class="token punctuation">.</span>videoWidth<span class="token punctuation">;</span>
                canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> video<span class="token punctuation">.</span>videoHeight<span class="token punctuation">;</span>
                <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// 获取封面图</span>
                <span class="token keyword">const</span> thumbnail <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>thumbnail<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">videoPlaceHolderPoster</span><span class="token operator">:</span><span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/video_placeholder.jpg'</span><span class="token punctuation">,</span>
			<span class="token literal-property property">recorderIcon</span><span class="token operator">:</span><span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/audio-icon/recorder.gif'</span><span class="token punctuation">,</span>
			<span class="token literal-property property">iconMenus</span><span class="token operator">:</span><span class="token punctuation">[</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;微笑&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;/static/tabbar/index.png&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;smile&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;嘿嘿&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😀&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;heihei&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;嗯，哼&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span> <span class="token string">&quot;https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/iconMenus/en.gif&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span> <span class="token string">&quot;image&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span> <span class="token string">&quot;enheng&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;嘻嘻&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😁&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;xixi&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;笑哭了&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😂&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;xiaokule&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;哈哈&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😃&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;haha&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;大笑&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😄&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;daxiao&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;苦笑&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😅&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;kuxiao&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;斜眼笑&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😆&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;xieyanxiao&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;微笑天使&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😇&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;weixiaotianshi&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;眨眼&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😉&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;zhayan&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;羞涩微笑&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;😊&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;xiuseweixiao&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;呵呵&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;🙂&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;hehe&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;倒脸&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;🙃&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;daolian&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;笑得满地打滚&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;🤣&quot;</span><span class="token punctuation">,</span>
				<span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;emoji&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;xiaodemandidagun&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token literal-property property">plusMenus</span><span class="token operator">:</span><span class="token punctuation">[</span> <span class="token comment">// 加号扩展菜单栏目</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;相册照片&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;uview&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			    <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;拍照片&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue62c&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;cameraPhoto&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			    <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;拍视频&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue682&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;cameraVideo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;相册视频&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue66d&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;video&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;位置&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;uview&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;map&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
			    <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;我的名片&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue69d&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;mingpian&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token comment">// { name:&quot;拍摄&quot;, icon:&quot;\ue62c&quot;, iconType:&quot;custom&quot;, eventType:&quot;camera&quot; },</span>
				<span class="token comment">// { name:&quot;我的名片&quot;, icon:&quot;\ue69d&quot;, iconType:&quot;custom&quot;, eventType:&quot;mingpian&quot; },</span>
				<span class="token comment">// { name:&quot;视频&quot;, icon:&quot;\ue66d&quot;, iconType:&quot;custom&quot;, eventType:&quot;video&quot; },</span>
				<span class="token comment">// { name:&quot;拍摄&quot;, icon:&quot;\ue62c&quot;, iconType:&quot;custom&quot;, eventType:&quot;camera&quot; },</span>
				<span class="token comment">// { name:&quot;我的名片&quot;, icon:&quot;\ue69d&quot;, iconType:&quot;custom&quot;, eventType:&quot;mingpian&quot; },</span>
				<span class="token comment">// { name:&quot;视频&quot;, icon:&quot;\ue66d&quot;, iconType:&quot;custom&quot;, eventType:&quot;video&quot; },</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span>
			<span class="token literal-property property">chatDataList</span><span class="token operator">:</span><span class="token punctuation">[</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'彦祖'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148439</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'老师你好，我想咨询一下本季课程，如果我不学习上一个季度，可以直接学习本季度吗？'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148449</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'同学你好，如果不学习上一个季度课程，如果你有vue的基础和js的基础知识，也可以学习本季度课程'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'彦祖'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148759</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'好的，我了解了，谢谢老师'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148859</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'不用谢'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'彦祖'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148879</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'ok'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'彦祖'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148879</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'哈哈哈'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'彦祖'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148879</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'嗯啦'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148889</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/kalong.mp3'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">otherData</span><span class="token operator">:</span><span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'audio'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148899</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/weixinYuYing.mp3'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">otherData</span><span class="token operator">:</span><span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'audio'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-06.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'彦祖'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148999</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/audio/kalong.mp3'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">otherData</span><span class="token operator">:</span><span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">43</span><span class="token punctuation">,</span> <span class="token comment">// 单位秒</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'audio'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148999</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">otherData</span><span class="token operator">:</span><span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token string">'1:18'</span><span class="token punctuation">,</span> <span class="token comment">// 视频时长</span>
						<span class="token literal-property property">poster</span><span class="token operator">:</span><span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg'</span><span class="token punctuation">,</span>
						<span class="token literal-property property">videoData</span><span class="token operator">:</span><span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4'</span><span class="token punctuation">,</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'video'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span>
										
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token comment">//点击加号扩展菜单的某一项</span>
		<span class="token keyword">async</span> <span class="token function">swiperItemClick</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> itemIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击菜单项处理'</span><span class="token punctuation">,</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 防止undefined错误</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">===</span> <span class="token string">'icon'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>iconType <span class="token operator">===</span> <span class="token string">'emoji'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">insertEmoji</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// emoji插入输入框</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'iconMenus'</span><span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 其他类型直接发送</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击加号扩展菜单的某一项'</span><span class="token punctuation">,</span>item<span class="token punctuation">.</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>eventType<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">case</span> <span class="token string">'photo'</span><span class="token operator">:</span>
					    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handlePermission</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
							<span class="token literal-property property">permission</span><span class="token operator">:</span><span class="token punctuation">{</span>
								<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'photo'</span><span class="token punctuation">,</span>
								<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'本功能需要您打开相册'</span><span class="token punctuation">,</span>
								<span class="token literal-property property">desc</span><span class="token operator">:</span><span class="token string">'需要访问您的相册来选择图片'</span><span class="token punctuation">,</span>
								<span class="token literal-property property">grantedText</span><span class="token operator">:</span><span class="token string">'用户已授权开启相册，可以选择照片了'</span><span class="token punctuation">,</span>
								<span class="token literal-property property">nograntedText</span><span class="token operator">:</span><span class="token string">'您没有授权开启相册，无法发图片'</span><span class="token punctuation">,</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token literal-property property">methodsName</span><span class="token operator">:</span><span class="token string">'chooseImage'</span><span class="token punctuation">,</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'video'</span><span class="token operator">:</span>
					    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handlePermission</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					    	<span class="token literal-property property">permission</span><span class="token operator">:</span><span class="token punctuation">{</span>
					    		<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'photo'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'本功能需要您打开相册'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">desc</span><span class="token operator">:</span><span class="token string">'需要访问您的相册来选择视频'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">grantedText</span><span class="token operator">:</span><span class="token string">'用户已授权开启相册，可以选择视频了'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">nograntedText</span><span class="token operator">:</span><span class="token string">'您没有授权开启相册，无法发视频'</span><span class="token punctuation">,</span>
					    	<span class="token punctuation">}</span><span class="token punctuation">,</span>
					    	<span class="token literal-property property">methodsName</span><span class="token operator">:</span><span class="token string">'chooseVideo'</span><span class="token punctuation">,</span>
					    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'map'</span><span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'camera'</span><span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'mingpian'</span><span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// 发相册图片|发相册视频 权限申请</span>
		<span class="token keyword">async</span> <span class="token function">handlePermission</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">try</span><span class="token punctuation">{</span>
			   <span class="token keyword">const</span> permission <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UniPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			   <span class="token keyword">const</span> granted <span class="token operator">=</span>  <span class="token keyword">await</span> permission<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
			   options<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>desc<span class="token punctuation">,</span>options<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
			   <span class="token keyword">if</span><span class="token punctuation">(</span>granted<span class="token punctuation">)</span><span class="token punctuation">{</span>
				   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>grantedText<span class="token punctuation">)</span><span class="token punctuation">;</span>
				   <span class="token keyword">this</span><span class="token punctuation">[</span>options<span class="token punctuation">.</span>methodsName<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			   <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
				   uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					  <span class="token literal-property property">title</span><span class="token operator">:</span> options<span class="token punctuation">.</span>permission<span class="token punctuation">.</span>nograntedText<span class="token punctuation">,</span>
					  <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span>
					  <span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
				   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			   <span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'权限申请异常：'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'权限申请失败：'</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
					<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">//选择相册视频发送</span>
		<span class="token keyword">async</span> <span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			uni<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token comment">// extension:['mp4'],</span>
				<span class="token literal-property property">compressed</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">maxDuration</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span>
				<span class="token literal-property property">camera</span><span class="token operator">:</span><span class="token string">'back'</span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'选择相册视频res'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token comment">// 发送视频到服务器或者第三方云存储（如：阿里云oss）</span>
						<span class="token comment">// 成功发送之后 由服务器或者第三方云存储返回信息如</span>
						<span class="token comment">// 视频地址、视频封面等</span>
						<span class="token comment">// 得到返回的信息进行页面渲染</span>
						<span class="token keyword">let</span> poster <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
						<span class="token keyword">let</span> durationFormatted <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
						<span class="token comment">// #ifdef H5</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// h5封面</span>
							poster <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getH5VideoThumbnail</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'H5获取封面失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						<span class="token comment">// #ifdef MP</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// 小程序封面</span>
							poster <span class="token operator">=</span> res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'小程序获取封面失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						<span class="token comment">// #ifdef APP</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// APP封面</span>
							<span class="token comment">//引入插件</span>
							<span class="token comment">// if(uni.getSystemInfoSync().platform === &quot;android&quot;){</span>
							<span class="token comment">// 	// 安卓手机获取封面</span>
							<span class="token comment">// 	const plug=uni.requireNativePlugin(&quot;Html5app-VideoCover&quot;);</span>
							<span class="token comment">// 	plug.setVideoPath({</span>
							<span class="token comment">// 		'url':res.tempFilePath,</span>
							<span class="token comment">// 		'time':1,</span>
							<span class="token comment">// 	},ret=&gt;{</span>
							<span class="token comment">// 		console.log('安卓手机获取封面的结果',ret);</span>
							<span class="token comment">// 	});</span>
							<span class="token comment">// }</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'APP封面获取失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						
						<span class="token comment">// 发视频</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
							<span class="token operator">...</span>res<span class="token punctuation">,</span>
							<span class="token literal-property property">videoPath</span><span class="token operator">:</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
							<span class="token literal-property property">poster</span><span class="token operator">:</span>poster<span class="token punctuation">,</span>
							<span class="token literal-property property">duration</span><span class="token operator">:</span>durationFormatted
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'选择视频失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">let</span> errorMsg <span class="token operator">=</span> <span class="token string">'选择视频失败'</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						errorMsg <span class="token operator">=</span> <span class="token string">'相册访问权限不足'</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 用户不授权不提示</span>
					<span class="token punctuation">}</span>
					uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">title</span><span class="token operator">:</span>errorMsg<span class="token punctuation">,</span><span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span><span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">//选择相册照片发送</span>
		<span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			uni<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">count</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span>
				<span class="token comment">//sizeType:['original','compressed'],</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'选择照片res'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePaths <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token comment">// 发送到服务器或者第三方云存储</span>
						<span class="token comment">// 页面效果渲染效果</span>
						<span class="token comment">//单张</span>
						<span class="token comment">//this.sendMessage('image',{path:res.tempFilePaths[0]});</span>
						<span class="token comment">// 多张</span>
						res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
							<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span>item<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'选择图片失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">let</span> errorMsg <span class="token operator">=</span> <span class="token string">'选择图片失败'</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						errorMsg <span class="token operator">=</span> <span class="token string">'相册访问权限不足'</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 用户不授权不提示</span>
					<span class="token punctuation">}</span>
					uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">title</span><span class="token operator">:</span>errorMsg<span class="token punctuation">,</span><span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span><span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">//预览多张图片</span>
		<span class="token function">previewImages</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'预览多张图片在页面'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			uni<span class="token punctuation">.</span><span class="token function">previewImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">urls</span><span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>previewImagesList<span class="token punctuation">,</span>
				<span class="token literal-property property">current</span><span class="token operator">:</span>e<span class="token punctuation">.</span>item<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
				<span class="token literal-property property">indicator</span><span class="token operator">:</span><span class="token string">'default'</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">//发送消息</span>
		<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">msgType<span class="token punctuation">,</span> option <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'发送消息'</span><span class="token punctuation">,</span>msgType<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">let</span> msg <span class="token operator">=</span> <span class="token punctuation">{</span>
				<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
				<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
				<span class="token literal-property property">type</span><span class="token operator">:</span>msgType<span class="token punctuation">,</span> <span class="token comment">//image,video</span>
				<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span>msgType<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">case</span> <span class="token string">'text'</span><span class="token operator">:</span>
				    msg<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageValue<span class="token punctuation">;</span>
				    <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token string">'iconMenus'</span><span class="token operator">:</span>
				    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'iconMenus的数据'</span><span class="token punctuation">,</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
				    msg<span class="token punctuation">.</span>data <span class="token operator">=</span> option<span class="token punctuation">.</span>icon<span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>dataType <span class="token operator">=</span> option<span class="token punctuation">.</span>iconType<span class="token punctuation">;</span>
				    <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token string">'image'</span><span class="token operator">:</span>
				    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'image的数据'</span><span class="token punctuation">,</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>data <span class="token operator">=</span> option<span class="token punctuation">.</span>path<span class="token punctuation">;</span>
				    <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token string">'audio'</span><span class="token operator">:</span>
				    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'audio的数据'</span><span class="token punctuation">,</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>data <span class="token operator">=</span> option<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>otherData <span class="token operator">=</span> <span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>option<span class="token punctuation">.</span>duration <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
					<span class="token punctuation">}</span>
				    <span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token keyword">case</span> <span class="token string">'video'</span><span class="token operator">:</span>
				    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'video的数据'</span><span class="token punctuation">,</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>data <span class="token operator">=</span> option<span class="token punctuation">.</span>poster<span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>otherData <span class="token operator">=</span> <span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span>option<span class="token punctuation">.</span>duration<span class="token punctuation">,</span> <span class="token comment">// 视频时长</span>
						<span class="token literal-property property">poster</span><span class="token operator">:</span>option<span class="token punctuation">.</span>poster<span class="token punctuation">,</span>
						<span class="token literal-property property">videoData</span><span class="token operator">:</span>option<span class="token punctuation">.</span>videoPath<span class="token punctuation">,</span>
					<span class="token punctuation">}</span><span class="token punctuation">;</span>
				    <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>chatDataList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 清空发送的内容然后还要滚动到底部</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>msgType <span class="token operator">==</span> <span class="token string">'text'</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageValue <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">//格式化视频时长</span>
		<span class="token function">formatVideoDuration</span><span class="token punctuation">(</span><span class="token parameter">duration</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 确保duration是数字类型</span>
			<span class="token keyword">const</span> seconds <span class="token operator">=</span> <span class="token keyword">typeof</span> duration <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">?</span> duration <span class="token operator">:</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> minutes <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>seconds <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">const</span> remainingSeconds <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>seconds <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>minutes<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remainingSeconds <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">?</span> <span class="token string">'0'</span> <span class="token operator">+</span> remainingSeconds <span class="token operator">:</span> remainingSeconds<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>页面 <code>/pages/chat/chat.nvue</code></li></ol> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 导航栏 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>聊天<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:fixed</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">:showPlus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:showUser</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">:showBack</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">navbarClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-light<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">:h5WeiXinNeedNavbar</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>h5WeiXinNeedNavbar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>right<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openMore<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
		    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe626;">&amp;#xe626;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
		    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar</span><span class="token punctuation">&gt;</span></span>
		
		<span class="token comment">&lt;!-- 聊天内容区域 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> <span class="token attr-name">scroll-y</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-light position-fixed left-0 right-0<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatContentStyle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:show-scrollbar</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@scroll</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onScroll<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">:scroll-into-view</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scrollIntoViewId<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 对话部分 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item,index) in chatDataList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">:id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">'</span>chat-item-'+index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-item</span> <span class="token attr-name">:item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">:prevTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index&gt;0 ? chatDataList[index-1].chat_time : 0<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatItem<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@previewImages</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>previewImages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-item</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 针对我们的app端点击聊天区域授权加号扩展菜单 --&gt;</span>
		<span class="token comment">&lt;!-- #ifdef APP --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessageMode == 'plus' || sendMessageMode == 'icon'<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-fixed left-0 right-0<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatContentStyle<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scrollViewClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- #endif --&gt;</span>
		
		
		<span class="token comment">&lt;!-- 底部聊天输入区域 --&gt;</span><span class="token comment">&lt;!-- 修改：添加ref获取textarea实例 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-fixed bottom-0 border-top
		flex flex-row align-center justify-between<span class="token punctuation">&quot;</span></span>
		<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">background-color</span><span class="token punctuation">:</span> #f7f7f7<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span> 750rpx<span class="token punctuation">;</span>
		<span class="token property">min-height</span><span class="token punctuation">:</span> 90rpx<span class="token punctuation">;</span><span class="token property">max-height</span><span class="token punctuation">:</span> 320rpx<span class="token punctuation">;</span>
		<span class="token property">padding-top</span><span class="token punctuation">:</span> 12rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
		<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatBottomStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex align-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- 切换发语音 --&gt;</span>
				<span class="token comment">&lt;!-- 键盘图标 --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessageMode == 'audio'<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeAudioOrText('text')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe644;">&amp;#xe644;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- 语音图标 --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span> <span class="token attr-name">v-else</span>
				<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeAudioOrText('audio')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe643;">&amp;#xe643;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex align-center font-sm px-2 py-1 border rounded<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[recorderStatus ? 'bg-hover-light' : 'bg-white']<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				    <span class="token comment">&lt;!-- 发语音  按住说话 --&gt;</span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessageMode == 'audio'<span class="token punctuation">&quot;</span></span>
					<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex flex-row align-center justify-center rounded<span class="token punctuation">&quot;</span></span>
					<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 440rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 60rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
					<span class="token attr-name">@touchstart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchstart<span class="token punctuation">&quot;</span></span>
					<span class="token attr-name">@touchend</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchend<span class="token punctuation">&quot;</span></span>
					<span class="token attr-name">@touchcancel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchcancel<span class="token punctuation">&quot;</span></span>
					<span class="token attr-name">@touchmove</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchmove<span class="token punctuation">&quot;</span></span>
					<span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font mr-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>按住<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>说话<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font mr-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>松开<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
				    <span class="token comment">&lt;!-- 发文字 --&gt;</span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">v-else</span>
					<span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textarea<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fixed</span> <span class="token attr-name">auto-height</span> <span class="token attr-name">:maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>-1<span class="token punctuation">&quot;</span></span>
					<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 440rpx<span class="token punctuation">;</span><span class="token property">min-height</span><span class="token punctuation">:</span> 60rpx<span class="token punctuation">;</span>
					<span class="token property">max-height</span><span class="token punctuation">:</span> 274rpx<span class="token punctuation">;</span><span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
					<span class="token property">text-align</span><span class="token punctuation">:</span> justify<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
					<span class="token attr-name">:adjust-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
					<span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>messageValue<span class="token punctuation">&quot;</span></span>
					<span class="token attr-name">@focus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textareaFocus<span class="token punctuation">&quot;</span></span>
					<span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onTextareaInput<span class="token punctuation">&quot;</span></span> 
					<span class="token attr-name">@blur</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onTextareaBlur<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 新增：监听失焦事件 --&gt;</span><span class="token comment">&lt;!-- 新增：监听输入事件 --&gt;</span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex align-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!messageValue<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openIcon<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe642;">&amp;#xe642;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!messageValue<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openPlus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe637;">&amp;#xe637;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>messageValue<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rounded bg-success px-2 py-1 mr-4<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">hover-class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-hover-success<span class="token punctuation">&quot;</span></span> 
				<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessage('text')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font text-white<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	
	
	     <span class="token comment">&lt;!-- 弹出菜单 --&gt;</span><span class="token comment">&lt;!-- 主要修改区域 --&gt;</span>
		 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-tooltip</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tooltipPlus<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:mask</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatTooltipMask<span class="token punctuation">&quot;</span></span> 
		 <span class="token attr-name">:maskTransparent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:isBottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> 
		 <span class="token attr-name">:tooltipWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>750<span class="token punctuation">&quot;</span></span>
		 <span class="token attr-name">:tooltipHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tooltipHeight<span class="token punctuation">&quot;</span></span>
		 <span class="token attr-name">transformOrigin</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span> <span class="token punctuation">&quot;</span>center bottom<span class="token punctuation">&quot;</span></span>
		 <span class="token attr-name">tooltipClass</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-light border-0 rounded-0<span class="token punctuation">&quot;</span></span>
		 <span class="token attr-name">@hideTooltip</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hideTooltip<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>border-top border-light-secondary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- 表情菜单 --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessageMode === 'icon'<span class="token punctuation">&quot;</span></span> 
				<span class="token attr-name">:indicator-dots</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>groupedIconMenus.length &gt; 1<span class="token punctuation">&quot;</span></span> 
				<span class="token attr-name">:duration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tooltipPlusMenuStyle<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>handleSwiperChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 添加分页切换事件 --&gt;</span>
					<span class="token comment">&lt;!-- 第一页：emoji表情（滚动显示） --&gt;</span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>emojiPageItems.length &gt; 0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scroll-view</span> <span class="token attr-name">scroll-y</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
							<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex flex-row flex-wrap justify-start<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item,itemIndex) in emojiPageItems<span class="token punctuation">&quot;</span></span> 
								<span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>itemIndex<span class="token punctuation">&quot;</span></span>
								<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex flex-column justify-center align-center<span class="token punctuation">&quot;</span></span>
								<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 12.5%<span class="token punctuation">;</span> <span class="token property">height</span><span class="token punctuation">:</span> 120rpx<span class="token punctuation">;</span> <span class="token property">padding</span><span class="token punctuation">:</span> 10rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
								<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>insertEmoji(item)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span> 50rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>{{item.icon}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
							<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scroll-view</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
					
					<span class="token comment">&lt;!-- 其他类型表情分页显示 --&gt;</span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(page,pageIndex) in otherPages<span class="token punctuation">&quot;</span></span> 
					<span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pageIndex<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex flex-row flex-wrap justify-start<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
							<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item,itemIndex) in page<span class="token punctuation">&quot;</span></span> 
							<span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pageIndex+itemIndex<span class="token punctuation">&quot;</span></span>
							<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-3 flex flex-column justify-center align-center<span class="token punctuation">&quot;</span></span>
							<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 260rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
							<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item ? swiperItemClick(item,itemIndex) : null<span class="token punctuation">&quot;</span></span>
							<span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 小程序添加空值检查 --&gt;</span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-white rounded-lg flex flex-row 
								align-center justify-center mb-2<span class="token punctuation">&quot;</span></span>
								<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>120rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 120rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u--image</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'image'<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspectFit<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120rpx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120rpx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">radius</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0rpx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u--image</span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'emoji'<span class="token punctuation">&quot;</span></span>
									<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> #222222<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>{{item.icon}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'custom'<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont<span class="token punctuation">&quot;</span></span>
									<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> #222222<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>{{item.icon}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u-icon</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'uview'<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">:name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#222222<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>26<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u-icon</span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-light-muted<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
							<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper</span><span class="token punctuation">&gt;</span></span>
				
				<span class="token comment">&lt;!-- 加号菜单（保持不变） --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper</span> <span class="token attr-name">v-else-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessageMode === 'plus'<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">:indicator-dots</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pageCount &gt; 1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:duration</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1000<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tooltipPlusMenuStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>swiper-item</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(page,index) in groupedPlusMenus<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex flex-row justify-start flex-wrap<span class="token punctuation">&quot;</span></span>
						<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>swiperItemStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
							<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-3 flex flex-column justify-center align-center<span class="token punctuation">&quot;</span></span>
							<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">height</span><span class="token punctuation">:</span> 260rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
							<span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>(item,itemIndex) in page<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>itemIndex<span class="token punctuation">&quot;</span></span>
							<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>swiperItemClick(item,itemIndex)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>bg-white rounded-lg 
								flex flex-row align-center justify-center mb-2<span class="token punctuation">&quot;</span></span>
								<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span>120rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 120rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u--image</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'image'<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspectFit<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120rpx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>120rpx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">radius</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0rpx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u--image</span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'emoji'<span class="token punctuation">&quot;</span></span>
									<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> #222222<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>{{item.icon}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'custom'<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont<span class="token punctuation">&quot;</span></span>
									<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">font-size</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span><span class="token property">color</span><span class="token punctuation">:</span> #222222<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>{{item.icon}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
									<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>u-icon</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.iconType == 'uview'<span class="token punctuation">&quot;</span></span>
									<span class="token attr-name">:name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.icon<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#222222<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>26<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>u-icon</span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
								<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-light-muted<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
							<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper-item</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>swiper</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-tooltip</span><span class="token punctuation">&gt;</span></span>	
		 
		 <span class="token comment">&lt;!-- 提示用户正在录音的界面 --&gt;</span>
		 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderStatus<span class="token punctuation">&quot;</span></span>
		 <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-fixed left-0 right-0 flex flex-row align-center justify-center<span class="token punctuation">&quot;</span></span>
		 <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>chatContentStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 400rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 400rpx<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.6<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
			 <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rounded-lg flex flex-column align-center justify-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderIcon<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 300rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 300rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>image</span><span class="token punctuation">&gt;</span></span>
				 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-white mt-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{isRecorderCancel ? '松开手指 取消发送' 
				 : '已录' + recorderDuration + '秒  手指上划 取消发送'}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		 
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">import</span> toolJs <span class="token keyword">from</span> <span class="token string">'@/common/mixins/tool.js'</span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> plusIconActionJs <span class="token keyword">from</span> <span class="token string">'@/pages/chat/plusIconAction.js'</span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> UniPermission <span class="token keyword">from</span> <span class="token string">'@/common/mixins/uni_permission.js'</span><span class="token punctuation">;</span>
	<span class="token keyword">import</span> <span class="token punctuation">{</span>mapState<span class="token punctuation">,</span>mapGetters<span class="token punctuation">,</span>mapMutations<span class="token punctuation">,</span>mapActions<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vuex'</span><span class="token punctuation">;</span>
	<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
		<span class="token literal-property property">mixins</span><span class="token operator">:</span><span class="token punctuation">[</span>toolJs<span class="token punctuation">,</span>plusIconActionJs<span class="token punctuation">]</span><span class="token punctuation">,</span>
		<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				
				<span class="token literal-property property">isRecorderCancel</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否取消录音发送</span>
				<span class="token literal-property property">recorderTouchstartY</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 录音开始手指纵坐标</span>
				<span class="token literal-property property">recorderStatus</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否正在录音</span>
				<span class="token literal-property property">cursorPos</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 新增：记录textarea光标位置</span>
				<span class="token literal-property property">h5WeiXinNeedNavbar</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// h5端微信上是否需要导航栏</span>
				<span class="token literal-property property">statusBarHeight</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//状态栏高度动态计算</span>
				<span class="token literal-property property">fixedHeight</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//占位：状态栏+导航栏</span>
				<span class="token literal-property property">bottomSafeAreaHeight</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 底部安全距离</span>
				<span class="token literal-property property">KeyboardHeight</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">//键盘高度</span>
				<span class="token literal-property property">scrollIntoViewId</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 滚动到指定的元素id</span>
				<span class="token literal-property property">messageValue</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 发送的内容信息</span>
				<span class="token literal-property property">tooltipHeight</span><span class="token operator">:</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token comment">// 加号弹出菜单的高度rpx</span>
				<span class="token literal-property property">sendMessageMode</span><span class="token operator">:</span><span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span><span class="token comment">//发送消息的情况：文字|语音|加号|表情</span>
				<span class="token comment">// #ifdef MP || H5</span>
				<span class="token literal-property property">chatTooltipMask</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token comment">// #endif</span>
				<span class="token comment">// #ifdef APP</span>
				<span class="token literal-property property">chatTooltipMask</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">let</span> info <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>statusBarHeight <span class="token operator">=</span> info<span class="token punctuation">.</span>statusBarHeight<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>fixedHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusBarHeight <span class="token operator">+</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>bottomSafeAreaHeight <span class="token operator">=</span> info<span class="token punctuation">.</span>safeAreaInsets<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
			<span class="token comment">// 监听键盘高度变化</span>
			uni<span class="token punctuation">.</span><span class="token function">onKeyboardHeightChange</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'键盘高度变化'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef H5 || MP</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight <span class="token operator">=</span> res<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token comment">// #ifdef APP</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'此时的输入模式'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">!=</span> <span class="token string">'plus'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">!=</span> <span class="token string">'icon'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight <span class="token operator">=</span> res<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// #endif</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 页面加载完了之后就应该滚动到底部</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			
			<span class="token comment">// 全局监听 全局注册一个发送语音的事件，然后全局</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">regSendMessage</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>isRecorderCancel<span class="token punctuation">)</span><span class="token punctuation">{</span>
					res<span class="token punctuation">.</span>duration <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recorderDuration <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'audio'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token function-variable function">recorderManager</span><span class="token operator">:</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>Audio<span class="token punctuation">.</span>recorderManager<span class="token punctuation">,</span>
				<span class="token function-variable function">recorderDuration</span><span class="token operator">:</span><span class="token parameter">state</span><span class="token operator">=&gt;</span>state<span class="token punctuation">.</span>Audio<span class="token punctuation">.</span>recorderDuration<span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token function">chatContentStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> pbottom <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottomSafeAreaHeight <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span>
				uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottomSafeAreaHeight<span class="token punctuation">;</span>
				<span class="token keyword">let</span> bottom <span class="token operator">=</span> pbottom <span class="token operator">+</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight<span class="token punctuation">;</span>
				<span class="token comment">//如果是h5端用微信打开并且不需要导航栏的时候</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isWeixinBrowser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>h5WeiXinNeedNavbar<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>fixedHeight <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusBarHeight <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">;</span>
					uni<span class="token punctuation">.</span><span class="token function">setNavigationBarTitle</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'阿祖'</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// #ifdef APP || MP</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>
					bottom <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">+</span> <span class="token number">12</span> <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// #endif</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">top:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>fixedHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;bottom:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>bottom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">chatBottomStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> pbottom <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottomSafeAreaHeight <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span>
				uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottomSafeAreaHeight<span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP || MP</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight<span class="token punctuation">)</span><span class="token punctuation">{</span>
					pbottom <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// #endif</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">padding-bottom: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pbottom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;bottom:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">//加号菜单每页的滑动样式</span>
			<span class="token function">tooltipPlusMenuStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> pbottom <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> height <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tooltipHeight <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> pbottom<span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP || MP</span>
				pbottom <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bottomSafeAreaHeight<span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">padding-bottom:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pbottom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;height:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">//加号菜单每页的布局样式</span>
			<span class="token function">swiperItemStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> pbottom <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> height <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tooltipHeight <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> pbottom<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">padding-bottom:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pbottom<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;height:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>height<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 加号菜单分页</span>
			<span class="token comment">// groupedPlusMenus(){</span>
			<span class="token comment">// 	const perPage = 8; // 每页8个</span>
			<span class="token comment">// 	const result = [];</span>
			<span class="token comment">// 	// 将数组plusMenus或者iconMenus每页8个分组</span>
			<span class="token comment">// 	for(let i=0;i&lt;this.tooltipPlusMenusOrIconMenus.length; i += perPage){</span>
			<span class="token comment">// 		result.push(this.tooltipPlusMenusOrIconMenus.slice(i, i + perPage))</span>
			<span class="token comment">// 	}</span>
			<span class="token comment">// 	return result;</span>
			<span class="token comment">// },</span>
			<span class="token comment">//计算总页数</span>
			<span class="token comment">// pageCount(){</span>
			<span class="token comment">// 	return Math.ceil(this.tooltipPlusMenusOrIconMenus.length / 8);</span>
			<span class="token comment">// },</span>
			<span class="token comment">// 扩展菜单或者表情包数据源</span>
			<span class="token function">tooltipPlusMenusOrIconMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">==</span> <span class="token string">'plus'</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">==</span> <span class="token string">'icon'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">Menus</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 修改：加号菜单分页计算</span>
			<span class="token function">groupedPlusMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">const</span> perPage <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// 每页8个（2行）</span>
				<span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>plusMenus<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> perPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					result<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>plusMenus<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> perPage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> result<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 修改：计算总页数（分别处理两种菜单）</span>
			<span class="token function">pageCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">===</span> <span class="token string">'plus'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>plusMenus<span class="token punctuation">.</span>length <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">===</span> <span class="token string">'icon'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>groupedIconMenus<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 新增：表情菜单计算属性</span>
			<span class="token function">emojiList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>iconMenus<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>iconType <span class="token operator">===</span> <span class="token string">'emoji'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">otherList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>iconMenus<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span>iconType <span class="token operator">!==</span> <span class="token string">'emoji'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">emojiPageItems</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>emojiList<span class="token punctuation">;</span> <span class="token comment">// 所有emoji表情放在第一页</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">otherPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">const</span> perPage <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token comment">// 每页8个（2行）</span>
				<span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>otherList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> perPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>otherList<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> i <span class="token operator">+</span> perPage<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> pages<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">groupedIconMenus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 总页数 = 1 (emoji页) + 其他类型页数</span>
				<span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>emojiPageItems<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					pages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>emojiPageItems<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 第一页放emoji</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">return</span> pages<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>otherPages<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 多图预览图片地址的数组集合</span>
			<span class="token function">previewImagesList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>chatDataList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'image'</span> <span class="token operator">||</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'iconMenus'</span> <span class="token operator">&amp;&amp;</span>
				       item<span class="token punctuation">.</span>dataType <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>dataType <span class="token operator">==</span> <span class="token string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> arr<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token operator">...</span><span class="token function">mapMutations</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'regSendMessage'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token comment">// 手指按上去</span>
			<span class="token keyword">async</span> <span class="token function">recorderTouchstart</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// 查看一下录音权限情况</span>
				<span class="token keyword">try</span><span class="token punctuation">{</span>
				   <span class="token keyword">const</span> permission <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UniPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				   <span class="token keyword">const</span> granted <span class="token operator">=</span>  <span class="token keyword">await</span> permission<span class="token punctuation">.</span><span class="token function">requestPermission</span><span class="token punctuation">(</span><span class="token string">'microphone'</span><span class="token punctuation">,</span>
				   <span class="token string">'需要您打开麦克风来录制语音'</span><span class="token punctuation">,</span><span class="token string">'本功能需要您打开麦克风'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				   <span class="token keyword">if</span><span class="token punctuation">(</span>granted<span class="token punctuation">)</span><span class="token punctuation">{</span>
					   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'用户已授权开启麦克风，可以录音了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'手指按上去'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					   <span class="token keyword">this</span><span class="token punctuation">.</span>recorderStatus <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
					   <span class="token comment">// #ifdef H5 || MP</span>
					   <span class="token keyword">this</span><span class="token punctuation">.</span>recorderTouchstartY <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>
					   <span class="token comment">// #endif</span>
					   <span class="token comment">// #ifdef APP</span>
					   <span class="token keyword">this</span><span class="token punctuation">.</span>recorderTouchstartY <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>screenY<span class="token punctuation">;</span>
					   <span class="token comment">// #endif</span>
					   
					   <span class="token comment">// 可能正在录音来电话了 isRecorderCancel为true,要改成false</span>
					   <span class="token keyword">this</span><span class="token punctuation">.</span>isRecorderCancel <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
					   <span class="token comment">// 开始录音</span>
					   <span class="token keyword">this</span><span class="token punctuation">.</span>recorderManager<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						   <span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">60000</span><span class="token punctuation">,</span> <span class="token comment">// 毫秒</span>
						   <span class="token literal-property property">format</span><span class="token operator">:</span><span class="token string">'mp3'</span><span class="token punctuation">,</span>
					   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					   
				   <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
					   uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'您没有授权打开麦克风，无法录制语音'</span><span class="token punctuation">,</span>
						  <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span>
						  <span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
					   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				   <span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'权限申请异常：'</span> <span class="token operator">+</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
					uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'权限申请失败：'</span> <span class="token operator">+</span> error<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
						<span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 手指松开了</span>
			<span class="token function">recorderTouchend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'手指松开了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>recorderStatus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				
				<span class="token comment">//停止录音</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>recorderManager<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 触摸取消 来点打断了 手机没电了</span>
			<span class="token function">recorderTouchcancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'触摸取消'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>recorderStatus <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>isRecorderCancel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token comment">//停止录音</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>recorderManager<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 手指移动</span>
			<span class="token function">recorderTouchmove</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'手指移动'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef H5 || MP</span>
				y <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>clientY<span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token comment">// #ifdef APP</span>
				y <span class="token operator">=</span> e<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>screenY<span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token comment">// 判断手指上移 移出录音区域的距离</span>
				<span class="token keyword">let</span> move <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>y <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recorderTouchstartY<span class="token punctuation">)</span><span class="token punctuation">;</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'手指上移距离'</span><span class="token punctuation">,</span>move<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>isRecorderCancel <span class="token operator">=</span> move <span class="token operator">&gt;</span> <span class="token number">55</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 切换文字输入或者语音</span>
			<span class="token function">changeAudioOrText</span><span class="token punctuation">(</span><span class="token parameter">sendMessageMode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">=</span> sendMessageMode<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 新增：textarea输入事件记录光标位置</span>
			<span class="token function">onTextareaInput</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// #ifdef H5 || APP</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>cursorPos <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>cursor<span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 新增：textarea失焦事件记录光标位置</span>
			<span class="token function">onTextareaBlur</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>cursorPos <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>cursor <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageValue<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
						
			<span class="token comment">// 新增：插入表情到textarea</span>
			<span class="token function">insertEmoji</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>item <span class="token operator">||</span> <span class="token operator">!</span>item<span class="token punctuation">.</span>icon<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
				
				<span class="token keyword">const</span> emoji <span class="token operator">=</span> item<span class="token punctuation">.</span>icon<span class="token punctuation">;</span>
				<span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageValue <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">;</span>
				
				<span class="token comment">// 插入到当前光标位置</span>
				<span class="token keyword">const</span> newText <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cursorPos<span class="token punctuation">)</span> <span class="token operator">+</span> 
							   emoji <span class="token operator">+</span> 
							   text<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cursorPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				<span class="token keyword">this</span><span class="token punctuation">.</span>messageValue <span class="token operator">=</span> newText<span class="token punctuation">;</span>
				
				<span class="token comment">// 更新光标位置（在插入的表情后面）</span>
				<span class="token keyword">const</span> newCursorPos <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cursorPos <span class="token operator">+</span> emoji<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>cursorPos <span class="token operator">=</span> newCursorPos<span class="token punctuation">;</span>
				
				<span class="token comment">// 设置光标位置（H5/APP支持）</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>textarea<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
					
					<span class="token keyword">let</span> textarea<span class="token punctuation">;</span>
					
					<span class="token comment">// 处理 H5 平台的特殊情况</span>
					<span class="token comment">// #ifdef H5</span>
					textarea <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>textarea<span class="token punctuation">.</span>$el<span class="token punctuation">;</span> <span class="token comment">// 获取原生 DOM 元素</span>
					<span class="token comment">// #endif</span>
					
					<span class="token comment">// #ifndef H5</span>
					textarea <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>textarea<span class="token punctuation">;</span>
					<span class="token comment">// #endif</span>
					
					<span class="token keyword">if</span> <span class="token punctuation">(</span>textarea<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// 尝试设置光标位置</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> textarea<span class="token punctuation">.</span>setSelectionRange <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">try</span> <span class="token punctuation">{</span>
								textarea<span class="token punctuation">.</span><span class="token function">setSelectionRange</span><span class="token punctuation">(</span>newCursorPos<span class="token punctuation">,</span> newCursorPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'设置光标位置失败'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
						
						<span class="token comment">// 确保输入框聚焦</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> textarea<span class="token punctuation">.</span>focus <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">try</span> <span class="token punctuation">{</span>
								textarea<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'聚焦输入框失败'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">handleSwiperChange</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'分页切换'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>current<span class="token punctuation">)</span><span class="token punctuation">;</span>
			    <span class="token comment">// 可以在这里处理分页切换逻辑</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">//点击聊天区域</span>
			<span class="token function">scrollViewClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// #ifdef APP</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击聊天区域'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				uni<span class="token punctuation">.</span><span class="token function">hideKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tooltipPlus<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">=</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 文本输入框聚焦</span>
			<span class="token function">textareaFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// #ifdef APP</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">=</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">//点击笑脸图标</span>
			<span class="token function">openIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击了笑脸'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">=</span> <span class="token string">&quot;icon&quot;</span><span class="token punctuation">;</span>
				uni<span class="token punctuation">.</span><span class="token function">hideKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token comment">// #ifdef H5 || MP</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">=</span> <span class="token string">&quot;icon&quot;</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tooltipPlus<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP || MP || H5</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tooltipHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">//点击了加号</span>
			<span class="token function">openPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击了加号'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">=</span> <span class="token string">&quot;plus&quot;</span><span class="token punctuation">;</span>
				uni<span class="token punctuation">.</span><span class="token function">hideKeyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token comment">// #ifdef H5 || MP</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">=</span> <span class="token string">&quot;plus&quot;</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tooltipPlus<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP || MP || H5</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">upx2px</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tooltipHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">// 弹出框隐藏了</span>
			<span class="token function">hideTooltip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'弹出框隐藏了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #ifdef APP || MP || H5</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>KeyboardHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			
			<span class="token comment">//点击了三个点图标</span>
			<span class="token function">openMore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击了三个点图标'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token comment">//聊天内容滚到到底部</span>
			<span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// #ifdef APP</span>
				<span class="token keyword">let</span> chatItems <span class="token operator">=</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>chatItem<span class="token punctuation">;</span>
				<span class="token keyword">let</span> lastIndex <span class="token operator">=</span> chatItems<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> chatItems<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token keyword">let</span> last <span class="token operator">=</span> chatItems<span class="token punctuation">[</span>lastIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">const</span> dom <span class="token operator">=</span>  weex<span class="token punctuation">.</span><span class="token function">requireModule</span><span class="token punctuation">(</span><span class="token string">'dom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				dom<span class="token punctuation">.</span><span class="token function">scrollToElement</span><span class="token punctuation">(</span>last<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// #endif</span>
				<span class="token comment">// #ifdef MP || H5</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chatDataList<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token keyword">const</span> lastIndex <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chatDataList<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>scrollIntoViewId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chat-item-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
				<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>scrollIntoViewId <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span>scrollIntoViewId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chat-item-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastIndex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">onScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'页面发生了滚动'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">watch</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token comment">// 监听聊天记录数据变化，自动滚动到底部</span>
			<span class="token literal-property property">chatDataList</span><span class="token operator">:</span><span class="token punctuation">{</span>
				<span class="token function">handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">chatContentToBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token literal-property property">deep</span><span class="token operator">:</span><span class="token boolean">true</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function">sendMessageMode</span><span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span>oldVal</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// #ifdef APP</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'监听发送模式'</span><span class="token punctuation">,</span>newVal<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>newVal <span class="token operator">!=</span> <span class="token string">'plus'</span> <span class="token operator">&amp;&amp;</span> newVal <span class="token operator">!=</span> <span class="token string">'icon'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>tooltipPlus<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// #endif</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token comment">/* #ifdef H5 */</span>
	<span class="token atrule"><span class="token rule">@import</span> <span class="token string">'/common/css/common.nvue.vue.css'</span><span class="token punctuation">;</span></span>
	<span class="token comment">/* #endif */</span>
	
	
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_2-获取视频封面图"><a href="#_2-获取视频封面图" class="header-anchor">#</a> 2. 获取视频封面图</h3> <p>一、正常方式是：<code>视频发送到服务器或者第三方云存储（如阿里云OSS）后，由服务器或者第三方云存储生成封面图、视频地址等数据，并返回给客户端进行显示</code> <br>
二、特殊需求：若希望在本地生成视频封面，可以参考以下方案：<br></p> <h3 id="_1-针对h5端-比较简单-采用video-canvas-即可"><a href="#_1-针对h5端-比较简单-采用video-canvas-即可" class="header-anchor">#</a> ① 针对H5端（比较简单，采用<code>video``canvas</code>）即可</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// H5端获取视频封面:videoPath 是视频地址</span>
<span class="token keyword">function</span> <span class="token function">getH5VideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// H5端直接使用视频路径创建video元素</span>
        <span class="token keyword">const</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        video<span class="token punctuation">.</span>src <span class="token operator">=</span> videoPath<span class="token punctuation">;</span>
        video<span class="token punctuation">.</span>crossOrigin <span class="token operator">=</span> <span class="token string">'anonymous'</span><span class="token punctuation">;</span>
        video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loadeddata'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            video<span class="token punctuation">.</span>currentTime <span class="token operator">=</span> <span class="token number">0.1</span><span class="token punctuation">;</span> <span class="token comment">// 设置到0.1秒获取封面</span>
            
            video<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'seeked'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">const</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                canvas<span class="token punctuation">.</span>width <span class="token operator">=</span> video<span class="token punctuation">.</span>videoWidth<span class="token punctuation">;</span>
                canvas<span class="token punctuation">.</span>height <span class="token operator">=</span> video<span class="token punctuation">.</span>videoHeight<span class="token punctuation">;</span>
                <span class="token keyword">const</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// 获取封面图</span>
                <span class="token keyword">const</span> thumbnail <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/jpeg'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>thumbnail<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-小程序端-在微信开发者工具上选择视频后-可直接返回视频封面-但是真机调试无法返回视频封面-有以下解决方案"><a href="#_2-小程序端-在微信开发者工具上选择视频后-可直接返回视频封面-但是真机调试无法返回视频封面-有以下解决方案" class="header-anchor">#</a> ② 小程序端（在微信开发者工具上选择视频后，可直接返回视频封面，但是真机调试无法返回视频封面），有以下解决方案：<br><br></h3> <p>方案1：在小程序真机环境中，我们可以使用<code>wx.getVideoInfo API</code>来获取</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//选择视频发送</span>
<span class="token keyword">async</span> <span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    uni<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compressed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxDuration</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
        <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token string">'back'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> poster <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> durationFormatted <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                
                <span class="token comment">// #ifdef MP</span>
                <span class="token comment">// 小程序端处理</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 开发者工具有封面</span>
                    poster <span class="token operator">=</span> res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 真机环境需要额外获取</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        <span class="token keyword">const</span> videoInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            wx<span class="token punctuation">.</span><span class="token function">getVideoInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token literal-property property">src</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
                                <span class="token literal-property property">success</span><span class="token operator">:</span> resolve<span class="token punctuation">,</span>
                                <span class="token literal-property property">fail</span><span class="token operator">:</span> reject
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        poster <span class="token operator">=</span> videoInfo<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'小程序获取视频信息失败:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// #endif</span>
                
                <span class="token comment">// ... 其他平台代码保持不变</span>
                
                <span class="token comment">// 发送视频消息</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    <span class="token operator">...</span>res<span class="token punctuation">,</span>
                    <span class="token literal-property property">videoPath</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
                    <span class="token literal-property property">poster</span><span class="token operator">:</span> poster<span class="token punctuation">,</span>
                    <span class="token literal-property property">duration</span><span class="token operator">:</span> durationFormatted
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 错误处理保持不变</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>方案2：使用<code>wx.createVideoContext</code>和<code>canvas</code>组合方案（页面组件）</p> <blockquote><p>① 小程序端封面获取方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 小程序端封面获取方法</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getMpVideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// #ifdef MP</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建隐藏video组件</span>
            <span class="token keyword">const</span> videoId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">video-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> video <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createVideoContext</span><span class="token punctuation">(</span>videoId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 创建canvas</span>
            <span class="token keyword">const</span> canvasId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">canvas-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> ctx <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span>canvasId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 监听视频首帧加载</span>
            video<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                video<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempImagePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'视频快照失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 临时创建video和canvas元素</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'_tempVideoId'</span><span class="token punctuation">,</span> videoId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'_tempCanvasId'</span><span class="token punctuation">,</span> canvasId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'小程序封面生成失败:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// #endif</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>② 修改<code>chooseVideo</code>方法整合</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 选择相册视频发送</span>
    uni<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">compressed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxDuration</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
        <span class="token literal-property property">camera</span><span class="token operator">:</span> <span class="token string">'back'</span><span class="token punctuation">,</span>
        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> poster <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> durationFormatted <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
                
                <span class="token comment">// 平台特定处理</span>
                <span class="token comment">// #ifdef MP</span>
                poster <span class="token operator">=</span> res<span class="token punctuation">.</span>thumbTempFilePath <span class="token operator">||</span> <span class="token keyword">await</span> <span class="token function">getMpVideoThumbnail</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// #endif</span>
                
                <span class="token comment">// #ifdef H5</span>
                <span class="token operator">...</span>
                <span class="token comment">// #endif</span>
                
                <span class="token comment">// #ifdef APP</span>
                <span class="token operator">...</span>
                <span class="token comment">// #endif</span>
                
                <span class="token comment">// 发送视频消息</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                    <span class="token operator">...</span>res<span class="token punctuation">,</span>
                    <span class="token literal-property property">videoPath</span><span class="token operator">:</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
                    <span class="token literal-property property">poster</span><span class="token operator">:</span> poster<span class="token punctuation">,</span>
                    <span class="token literal-property property">duration</span><span class="token operator">:</span> durationFormatted
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 错误处理保持不变</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>③ 在<code>chat.nvue</code>页面中添加隐藏元素支持</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 在template底部添加 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- ...其他内容... --&gt;</span>
  
  <span class="token comment">&lt;!-- 隐藏的小程序video和canvas --&gt;</span>
  <span class="token comment">&lt;!-- #ifdef MP --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> 
    <span class="token attr-name">:id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_tempVideoId<span class="token punctuation">&quot;</span></span> 
    <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tempVideoPath<span class="token punctuation">&quot;</span></span> 
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>1px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>1px<span class="token punctuation">;</span><span class="token property">opacity</span><span class="token punctuation">:</span>0<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
    <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tempVideoPath<span class="token punctuation">&quot;</span></span>
  <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> 
    <span class="token attr-name">:id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_tempCanvasId<span class="token punctuation">&quot;</span></span> 
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>1px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>1px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
  <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- #endif --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

//在data中添加临时变量
data() {
  return {
    // ...其他数据...
    _tempVideoId: '',
    _tempCanvasId: '',
    tempVideoPath: ''
  }
}
</code></pre></div></blockquote> <p>方案3：整合方案1和方案2</p> <blockquote><p>① 小程序封面获取方法 在 <code>plusIconAction.js</code> 中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 小程序端封面获取方法</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getMpVideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// #ifdef MP</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 方案1：尝试使用 wx.getVideoInfo</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> wx<span class="token punctuation">.</span>getVideoInfo <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                wx<span class="token punctuation">.</span><span class="token function">getVideoInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">src</span><span class="token operator">:</span> videoPath<span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 如果获取不到，使用默认封面</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'wx.getVideoInfo失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
            <span class="token comment">// 方案2：如果 wx.getVideoInfo 不可用，尝试使用 createVideoContext</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> wx<span class="token punctuation">.</span>createVideoContext <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 创建隐藏video组件</span>
                <span class="token keyword">const</span> videoId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">video-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">'_tempVideoId'</span><span class="token punctuation">,</span> videoId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>tempVideoPath <span class="token operator">=</span> videoPath<span class="token punctuation">;</span>
                
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> video <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createVideoContext</span><span class="token punctuation">(</span>videoId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
                    <span class="token comment">// 检查 snapshot 方法是否存在</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>video<span class="token punctuation">.</span>snapshot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 监听视频首帧加载</span>
                        video<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            video<span class="token punctuation">.</span><span class="token function">snapshot</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempImagePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'视频快照失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'snapshot方法不可用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 方案3：都不支持，使用默认封面</span>
            <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'小程序封面生成失败:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// #endif</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>② 修改 <code>chooseVideo</code> 方法中的小程序部分</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// #ifdef MP</span>
<span class="token comment">// 小程序端处理</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果 chooseVideo 返回了 thumbTempFilePath，直接使用</span>
    poster <span class="token operator">=</span> res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 否则调用 getMpVideoThumbnail</span>
    poster <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getMpVideoThumbnail</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// #endif</span>
</code></pre></div><p>③ 在 <code>plusIconAction.js</code> 的 data 中添加 tempVideoPath</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">_tempVideoId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">_tempCanvasId</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token literal-property property">tempVideoPath</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 添加这一行</span>
        <span class="token comment">// ...其他数据...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>④  在 <code>chat.nvue</code> 页面中修改隐藏的 video 组件</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token comment">&lt;!-- 隐藏的小程序video和canvas --&gt;</span>
<span class="token comment">&lt;!-- #ifdef MP --&gt;</span>
&lt;video 
    :id=&quot;_tempVideoId&quot; 
    :src=&quot;tempVideoPath&quot; 
    style=&quot;position:absolute;width:1px;height:1px;opacity:0;&quot;
    v-if=&quot;tempVideoPath&quot;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> 
    <span class="token attr-name">:id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_tempCanvasId<span class="token punctuation">&quot;</span></span> 
    <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">position</span><span class="token punctuation">:</span>absolute<span class="token punctuation">;</span><span class="token property">width</span><span class="token punctuation">:</span>1px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span>1px<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
<span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- #endif --&gt;</span>
</code></pre></div></blockquote> <p>方案4：使用<code>wx.createVideoContext</code>和<code>canvas</code>组合方案（js内动态创建组件和绘制）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 小程序端封面获取方法</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getMpVideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// #ifdef MP</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'开始获取小程序视频封面'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 1. 创建临时video组件</span>
        <span class="token keyword">const</span> videoId <span class="token operator">=</span> <span class="token string">'tempVideo_'</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> videoContext <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createVideoContext</span><span class="token punctuation">(</span>videoId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2. 动态添加video组件到页面</span>
        <span class="token keyword">const</span> systemInfo <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> videoId<span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">src</span><span class="token operator">:</span> videoPath<span class="token punctuation">,</span>
            <span class="token literal-property property">id</span><span class="token operator">:</span> videoId<span class="token punctuation">,</span>
            <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">position:absolute;left:-9999px;width:1px;height:1px;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">controls</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token literal-property property">autoplay</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token literal-property property">showCenterPlayBtn</span><span class="token operator">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'动态添加video组件到页面'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 3. 等待组件渲染完成</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 4. 监听视频加载完成事件</span>
            videoContext<span class="token punctuation">.</span><span class="token function">onLoadedMetadata</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'视频元数据加载完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// 5. 跳转到0.1秒位置</span>
                videoContext<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// 6. 监听跳转完成事件</span>
                videoContext<span class="token punctuation">.</span><span class="token function">onSeeked</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'视频跳转完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
                    <span class="token comment">// 7. 创建canvas绘制封面</span>
                    <span class="token keyword">const</span> canvasId <span class="token operator">=</span> <span class="token string">'tempCanvas_'</span> <span class="token operator">+</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">const</span> canvasContext <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">createCanvasContext</span><span class="token punctuation">(</span>canvasId<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
                    <span class="token comment">// 8. 绘制视频帧到canvas</span>
                    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        canvasContext<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        canvasContext<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'canvas绘制完成'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            
                            <span class="token comment">// 9. 获取临时文件路径</span>
                            wx<span class="token punctuation">.</span><span class="token function">canvasToTempFilePath</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                                <span class="token literal-property property">canvasId</span><span class="token operator">:</span> canvasId<span class="token punctuation">,</span>
                                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取封面成功'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    
                                    <span class="token comment">// 10. 清理临时组件</span>
                                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> videoId<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> canvasId<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                                <span class="token literal-property property">fail</span><span class="token operator">:</span> reject
                            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 11. 开始加载视频</span>
            videoContext<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// #endif</span>
        
        <span class="token comment">// 非小程序环境返回空字符串</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 调用</span>
<span class="token comment">// #ifdef MP</span>
<span class="token comment">// 小程序端获取封面和时长</span>
<span class="token keyword">try</span> <span class="token punctuation">{</span>
	poster <span class="token operator">=</span> res<span class="token punctuation">.</span>thumbTempFilePath <span class="token operator">||</span> 
	<span class="token keyword">await</span> <span class="token function">getMpVideoThumbnail</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
	durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'小程序获取封面失败:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
	poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
	durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// #endif</span>

<span class="token comment">//3. 在页面的 data 中添加一个用于存储临时组件的对象</span>
<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token literal-property property">tempComponents</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token comment">// 用于存储临时组件</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//4. 在页面中添加一个用于渲染临时组件的容器：</span>
<span class="token operator">&lt;</span>view v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">&quot;(comp, id) in tempComponents&quot;</span> <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;id&quot;</span> <span class="token operator">:</span>style<span class="token operator">=</span><span class="token string">&quot;comp.style&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>video v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;comp.id.includes('tempVideo')&quot;</span> 
           <span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;comp.id&quot;</span> 
           <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">&quot;comp.src&quot;</span> 
           <span class="token operator">:</span>controls<span class="token operator">=</span><span class="token string">&quot;comp.controls&quot;</span>
           <span class="token operator">:</span>autoplay<span class="token operator">=</span><span class="token string">&quot;comp.autoplay&quot;</span>
           <span class="token operator">:</span>show<span class="token operator">-</span>center<span class="token operator">-</span>play<span class="token operator">-</span>btn<span class="token operator">=</span><span class="token string">&quot;comp.showCenterPlayBtn&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>canvas v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;comp.id.includes('tempCanvas')&quot;</span> 
            <span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">&quot;comp.id&quot;</span> 
            canvas<span class="token operator">-</span>id<span class="token operator">=</span><span class="token string">&quot;comp.id&quot;</span> 
            style<span class="token operator">=</span><span class="token string">&quot;width:100px;height:100px;&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>canvas<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>

</code></pre></div><p>总结：以上方案可实现获取视频封面，但均存在兼容性问题，跟微信版本和uniapp版本有关，以上方法作为参考学习知识所用。</p> <h3 id="_3-针对app端"><a href="#_3-针对app端" class="header-anchor">#</a> ③ 针对app端</h3> <p>app端可尝试的方法 <br></p> <blockquote><p>① 先尝试使用<code>plus.media.getVideoInfo</code>获取封面</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// APP端获取视频封面</span>
<span class="token keyword">function</span> <span class="token function">getAppVideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1. 先尝试使用plus.media.getVideoInfo获取封面</span>
        plus<span class="token punctuation">.</span>media<span class="token punctuation">.</span><span class="token function">getVideoInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">filePath</span><span class="token operator">:</span> videoPath<span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'APP端使用plus.media.getVideoInfo获取视频信息成功:'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>cover <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>cover <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>cover<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'APP端获取视频信息成功，但没有封面，尝试createThumbnail'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 2. 如果没有封面，尝试使用createThumbnail创建缩略图</span>
                    <span class="token function">createVideoThumbnail</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cover</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">resolve</span><span class="token punctuation">(</span>cover <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'APP端使用plus.media.getVideoInfo获取视频信息失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 3. 如果getVideoInfo失败，直接尝试createThumbnail</span>
                <span class="token function">createVideoThumbnail</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">cover</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>cover <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>② 在①无效的情况下尝试<code>createThumbnail</code>创建缩略图</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// APP端创建视频缩略图</span>
<span class="token keyword">function</span> <span class="token function">createVideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        plus<span class="token punctuation">.</span>media<span class="token punctuation">.</span><span class="token function">createThumbnail</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">src</span><span class="token operator">:</span> videoPath<span class="token punctuation">,</span>
            <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 1秒处</span>
            <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
            <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'jpg'</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">thumb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'创建视频缩略图成功:'</span><span class="token punctuation">,</span> thumb<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>thumb<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'创建视频缩略图失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p><code>经测试以上方法在安卓某些机型上存在兼容问题</code><br></p> <blockquote><p>③ 在APP端使用HTML5的<code>&lt;video&gt;</code>和<code>&lt;canvas&gt;</code>方案</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// APP端封面获取方法</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getAppVideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// #ifdef APP</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 转换路径为可访问的URL</span>
            <span class="token keyword">const</span> convertedPath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                plus<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">resolveLocalFileSystemURL</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">toLocalURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'路径转换失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'视频转换路径为可访问的URL'</span><span class="token punctuation">,</span>convertedPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 创建临时webview获取封面</span>
            <span class="token keyword">const</span> webview <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'video-cover-webview'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">background</span><span class="token operator">:</span> <span class="token string">'transparent'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">'0px'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">'0px'</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            webview<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'loaded'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">const</span> cover <span class="token operator">=</span> <span class="token keyword">await</span> webview<span class="token punctuation">.</span><span class="token function">evalJS</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                        new Promise(resolve =&gt; {
                            const video = document.createElement('video');
                            video.src = &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>convertedPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;;
                            video.crossOrigin = 'anonymous';
                            
                            video.addEventListener('loadeddata', () =&gt; {
                                video.currentTime = 0.1;
                            });
                            
                            video.addEventListener('seeked', () =&gt; {
                                const canvas = document.createElement('canvas');
                                canvas.width = video.videoWidth;
                                canvas.height = video.videoHeight;
                                const ctx = canvas.getContext('2d');
                                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                                
                                // 获取封面图
                                const thumbnail = canvas.toDataURL('image/jpeg');
                                resolve(thumbnail);
                            });
                            
                            video.addEventListener('error', () =&gt; {
                                resolve('');
                            });
                        })
                    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    
                    <span class="token function">resolve</span><span class="token punctuation">(</span>cover <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'APP封面生成失败:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> webview<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            webview<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token string">'none'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'APP封面处理异常:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// #endif</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p><code>经测试以上方法在安卓某些机型上存在兼容问题</code><br></p> <blockquote><p>④ 在app端使用<code>5+App</code>的<code>plus.io.getVideoInfo</code> <a href="https://www.html5plus.org/doc/zh_cn/io.html#plus.io.getVideoInfo" target="_blank" rel="noopener noreferrer">https://www.html5plus.org/doc/zh_cn/io.html#plus.io.getVideoInfo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>但是在某些机型上没有返回封面图信息，然后在使用APP的<code>Webview</code>环境中<code>执行H5封面生成方法</code>
使用<code>plus.webview</code>和<code>plus.bridge</code>在原生和Webview间通信并包含本地文件路径转换逻辑，也就是③的方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app获取视频封面</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getAppVideoThumbnail</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// #ifdef APP</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 1. 尝试使用plus.io.getVideoInfo</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> plus<span class="token punctuation">.</span>io<span class="token punctuation">.</span>getVideoInfo <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                plus<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">getVideoInfo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                    <span class="token literal-property property">filePath</span><span class="token operator">:</span> videoPath<span class="token punctuation">,</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'plus.io.getVideoInfo成功:'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>res <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>coverPath<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>coverPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            <span class="token comment">// 尝试备选方案</span>
                            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tryAlternativeAppCover</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'plus.io.getVideoInfo失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 尝试备选方案</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tryAlternativeAppCover</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'plus.io.getVideoInfo不可用'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 尝试备选方案</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tryAlternativeAppCover</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'getAppVideoThumbnail异常:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tryAlternativeAppCover</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// #else</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// #endif</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 备选方案：使用H5方法（在APP的Webview环境中）</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">tryAlternativeAppCover</span><span class="token punctuation">(</span><span class="token parameter">videoPath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 转换路径为可访问的URL</span>
            <span class="token keyword">const</span> convertedPath <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">convertLocalFilePath</span><span class="token punctuation">(</span>videoPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 在APP的Webview环境中执行H5方法</span>
            <span class="token keyword">const</span> cover <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executeInWebviewContext</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
                new Promise(resolve =&gt; {
                    const video = document.createElement('video');
                    video.src = &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>convertedPath<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;;
                    video.crossOrigin = 'anonymous';
                    
                    video.addEventListener('loadeddata', () =&gt; {
                        video.currentTime = 0.1;
                    });
                    
                    video.addEventListener('seeked', () =&gt; {
                        const canvas = document.createElement('canvas');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                        
                        // 获取封面图
                        const thumbnail = canvas.toDataURL('image/jpeg');
                        resolve(thumbnail);
                    });
                    
                    video.addEventListener('error', () =&gt; {
                        resolve('');
                    });
                })
            </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token function">resolve</span><span class="token punctuation">(</span>cover <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'备选方案失败:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 转换本地文件路径为可访问的URL</span>
<span class="token keyword">function</span> <span class="token function">convertLocalFilePath</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// #ifdef APP</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>filePath<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'file://'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        plus<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">resolveLocalFileSystemURL</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">entry</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">toLocalURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'路径转换失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// #else</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// #endif</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 在Webview上下文中执行代码</span>
<span class="token keyword">function</span> <span class="token function">executeInWebviewContext</span><span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// #ifdef APP</span>
        <span class="token keyword">const</span> callbackId <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">callback_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> webview <span class="token operator">=</span> plus<span class="token punctuation">.</span>webview<span class="token punctuation">.</span><span class="token function">currentWebview</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 注册回调函数</span>
        plus<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span><span class="token function">callbackFromWebview</span><span class="token punctuation">(</span>webview<span class="token punctuation">.</span>id<span class="token punctuation">,</span> callbackId<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 执行脚本</span>
        webview<span class="token punctuation">.</span><span class="token function">evalJS</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
            (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>script<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)
            .then(result =&gt; {
                plus.bridge.callbackToWebview({
                    id: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callbackId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">',
                    data: result
                });
            })
            .catch(error =&gt; {
                console.error('Webview执行错误:', error);
                plus.bridge.callbackToWebview({
                    id: '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>callbackId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">',
                    data: ''
                });
            });
        </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// #else</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// #endif</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p><code>经测试在安卓某些机型上存在兼容问题</code>
以上方式虽然存在兼容问题，但是大家可以根据代码学习一下一些思路和解决方法<br></p> <p>⑤ app端获取视频封面的终极方案：<code>去uni-app插件市场选择一个插件引入即可</code>，在插件市场搜索：<code>视频封面</code> <a href="https://ext.dcloud.net.cn/search?q=%E8%A7%86%E9%A2%91%E5%B0%81%E9%9D%A2" target="_blank" rel="noopener noreferrer">https://ext.dcloud.net.cn/search?q=视频封面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ，但是有些插件好用却存在一些问题</p> <ol><li>比如，好用的插件收费（不收费的插件也有好用的，但需要自己找一下）</li> <li>如果插件下架，则影响到项目（虽然这种可能性很小）<br><br>
在线插件需要绑定包名，即需要申请安卓和ios证书先，因此为了教学，我直接给打开提供一个我自己编写的本地插件包，方便学习调试使用。</li></ol> <h3 id="_3-发视频-视频占位和视频封面配合使用"><a href="#_3-发视频-视频占位和视频封面配合使用" class="header-anchor">#</a> 3. 发视频：视频占位和视频封面配合使用</h3> <p>有同学课后提出，说老师如果我不想用插件获取封面图，就想用视频占位，可不可以将视频封面和视频配合使用呢？<br></p> <h4 id="_1-pages-chat-plusiconaction-js文件"><a href="#_1-pages-chat-plusiconaction-js文件" class="header-anchor">#</a> ① <code>/pages/chat/plusIconAction.js</code>文件</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>
<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token operator">...</span><span class="token punctuation">,</span>
			<span class="token literal-property property">chatDataList</span><span class="token operator">:</span><span class="token punctuation">[</span>
				<span class="token operator">...</span><span class="token punctuation">,</span>
				<span class="token punctuation">{</span>
					<span class="token literal-property property">avatar</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/avatar-07.png'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">nickname</span><span class="token operator">:</span> <span class="token string">'小二哥'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">chat_time</span><span class="token operator">:</span> <span class="token number">1750148999</span><span class="token punctuation">,</span>
					<span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">otherData</span><span class="token operator">:</span><span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token string">'1:18'</span><span class="token punctuation">,</span> <span class="token comment">// 视频时长</span>
						<span class="token literal-property property">poster</span><span class="token operator">:</span><span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemoPoster.jpg'</span><span class="token punctuation">,</span>
						<span class="token literal-property property">videoData</span><span class="token operator">:</span><span class="token string">'https://docs-51yrc-com.oss-cn-hangzhou.aliyuncs.com/chat/video/videoDemo.mp4'</span><span class="token punctuation">,</span>
						<span class="token literal-property property">showPoster</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token literal-property property">user_id</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
					<span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'video'</span><span class="token punctuation">,</span> <span class="token comment">//image,video</span>
					<span class="token literal-property property">isremove</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token punctuation">]</span><span class="token punctuation">,</span>
										
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token operator">...</span>
		<span class="token comment">//选择相册视频发送</span>
		<span class="token keyword">async</span> <span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			uni<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'album'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token comment">// extension:['mp4'],</span>
				<span class="token literal-property property">compressed</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">maxDuration</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span>
				<span class="token literal-property property">camera</span><span class="token operator">:</span><span class="token string">'back'</span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'选择相册视频res'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token comment">// 发送视频到服务器或者第三方云存储（如：阿里云oss）</span>
						<span class="token comment">// 成功发送之后 由服务器或者第三方云存储返回信息如</span>
						<span class="token comment">// 视频地址、视频封面等</span>
						<span class="token comment">// 得到返回的信息进行页面渲染</span>
						<span class="token keyword">let</span> poster <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
						<span class="token keyword">let</span> durationFormatted <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
						<span class="token keyword">let</span> showPoster <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 是否展示封面</span>
						<span class="token comment">// #ifdef H5</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// h5封面</span>
							poster <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getH5VideoThumbnail</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
							showPoster <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'H5获取封面失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						<span class="token comment">// #ifdef MP</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// 小程序封面</span>
							poster <span class="token operator">=</span> res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
							showPoster <span class="token operator">=</span> poster <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'小程序获取封面失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						<span class="token comment">// #ifdef APP</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// APP封面</span>
							<span class="token comment">//引入插件</span>
							<span class="token comment">// if(uni.getSystemInfoSync().platform === &quot;android&quot;){</span>
							<span class="token comment">// 	// 安卓手机获取封面</span>
							<span class="token comment">// 	const plug=uni.requireNativePlugin(&quot;Html5app-VideoCover&quot;);</span>
							<span class="token comment">// 	plug.setVideoPath({</span>
							<span class="token comment">// 		'url':res.tempFilePath,</span>
							<span class="token comment">// 		'time':1,</span>
							<span class="token comment">// 	},ret=&gt;{</span>
							<span class="token comment">// 		console.log('安卓手机获取封面的结果',ret);</span>
							<span class="token comment">// 	});</span>
							<span class="token comment">// }</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'APP封面获取失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						
						<span class="token comment">// 发视频</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
							<span class="token operator">...</span>res<span class="token punctuation">,</span>
							<span class="token literal-property property">videoPath</span><span class="token operator">:</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
							<span class="token literal-property property">poster</span><span class="token operator">:</span>poster<span class="token punctuation">,</span>
							<span class="token literal-property property">duration</span><span class="token operator">:</span>durationFormatted<span class="token punctuation">,</span>
							<span class="token literal-property property">showPoster</span><span class="token operator">:</span>showPoster<span class="token punctuation">,</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'选择视频失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">let</span> errorMsg <span class="token operator">=</span> <span class="token string">'选择视频失败'</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						errorMsg <span class="token operator">=</span> <span class="token string">'相册访问权限不足'</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 用户不授权不提示</span>
					<span class="token punctuation">}</span>
					uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">title</span><span class="token operator">:</span>errorMsg<span class="token punctuation">,</span><span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span><span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token operator">...</span>
		<span class="token comment">//发送消息</span>
		<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token parameter">msgType<span class="token punctuation">,</span> option <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token operator">...</span>
			<span class="token keyword">switch</span> <span class="token punctuation">(</span>msgType<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token operator">...</span>
				<span class="token keyword">case</span> <span class="token string">'video'</span><span class="token operator">:</span>
				    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'video的数据'</span><span class="token punctuation">,</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>data <span class="token operator">=</span> option<span class="token punctuation">.</span>poster<span class="token punctuation">;</span>
					msg<span class="token punctuation">.</span>otherData <span class="token operator">=</span> <span class="token punctuation">{</span>
						<span class="token literal-property property">duration</span><span class="token operator">:</span>option<span class="token punctuation">.</span>duration<span class="token punctuation">,</span> <span class="token comment">// 视频时长</span>
						<span class="token literal-property property">poster</span><span class="token operator">:</span>option<span class="token punctuation">.</span>poster<span class="token punctuation">,</span>
						<span class="token literal-property property">videoData</span><span class="token operator">:</span>option<span class="token punctuation">.</span>videoPath<span class="token punctuation">,</span>
						<span class="token literal-property property">showPoster</span><span class="token operator">:</span>option<span class="token punctuation">.</span>showPoster<span class="token punctuation">,</span> <span class="token comment">//是否显示封面</span>
					<span class="token punctuation">}</span><span class="token punctuation">;</span>
				    <span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token operator">...</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_2-组件-components-chat-item-video-poster-chat-item-video-poster-vue"><a href="#_2-组件-components-chat-item-video-poster-chat-item-video-poster-vue" class="header-anchor">#</a> ② 组件 <code>/components/chat-item-video-poster/chat-item-video-poster.vue</code></h4> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 视频封面占位 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.otherData.showPoster<span class="token punctuation">&quot;</span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-relative<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openVideoShow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 视频封面 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-item-image</span> <span class="token attr-name">:item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>index<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">imageClass</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>rounded<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">:maxWidth</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>300<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:maxHeight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>400<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-item-image</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 蒙版 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 right-0 top-0 bottom-0 rounded<span class="token punctuation">&quot;</span></span>
			<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 98<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.4<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 视频时长 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 right-0 top-0 bottom-0 rounded flex flex-row justify-end align-end mr-1 mb-1<span class="token punctuation">&quot;</span></span>   <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 99<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-white<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{item.otherData.duration}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 播放按钮 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 right-0 top-0 bottom-0 flex flex-row align-center justify-center<span class="token punctuation">&quot;</span></span>
			<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 100<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont text-white<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>videoPlayIconStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe710;">&amp;#xe710;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token comment">&lt;!-- 视频占位 --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-else</span>
		<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 200rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 350rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
		<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-relative<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">:src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.otherData.videoData<span class="token punctuation">&quot;</span></span>
			<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 200rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 350rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
			<span class="token attr-name">muted</span> <span class="token attr-name">autoplay</span>
			<span class="token attr-name">:initialTime</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:controls</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">object-fit</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>cover<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			   <span class="token comment">&lt;!-- #ifndef MP --&gt;</span>
			   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>cover-view</span> 
			   <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 right-0 top-0 bottom-0 flex flex-column align-center justify-center<span class="token punctuation">&quot;</span></span>
			   <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 98<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
			   <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openVideoShow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-white mb-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>视频已发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-white<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>50%<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>cover-view</span><span class="token punctuation">&gt;</span></span>
			   <span class="token comment">&lt;!-- #endif --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- #ifdef MP --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>position-absolute left-0 right-0 top-0 bottom-0 flex flex-column align-center justify-center<span class="token punctuation">&quot;</span></span>
			<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">z-index</span><span class="token punctuation">:</span> 98<span class="token punctuation">;</span><span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0.7<span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
			<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>openVideoShow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-white mb-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>视频已发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font-sm text-white<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>50%<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- #endif --&gt;</span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
	<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
		<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;chat-item-video-poster&quot;</span><span class="token punctuation">,</span>
		<span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token literal-property property">item</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
			<span class="token literal-property property">index</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token punctuation">{</span>
				<span class="token comment">// 播放视频图标大小默认70rpx</span>
				<span class="token literal-property property">videoPlayIcon</span><span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">computed</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token function">videoPlayIconStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">font-size: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>videoPlayIcon<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">rpx;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
			<span class="token function">openVideoShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// 打开视频</span>
				<span class="token keyword">const</span> videoUrl <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>videoData<span class="token punctuation">;</span>
				<span class="token keyword">const</span> title <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>title <span class="token operator">||</span> <span class="token string">'视频'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">const</span> poster <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>item<span class="token punctuation">.</span>otherData<span class="token punctuation">.</span>poster <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					<span class="token literal-property property">url</span><span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/pages/videoShow/videoShow?videoUrl=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>videoUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;title=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;poster=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>poster<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token literal-property property">animationType</span><span class="token operator">:</span><span class="token string">'zoom-fade-out'</span><span class="token punctuation">,</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
	<span class="token comment">/* #ifdef H5 */</span>
	<span class="token atrule"><span class="token rule">@import</span> <span class="token string">'/common/css/common.nvue.vue.css'</span><span class="token punctuation">;</span></span>
	<span class="token comment">/* #endif */</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="四、通过相机进行发图片、发视频"><a href="#四、通过相机进行发图片、发视频" class="header-anchor">#</a> 四、通过相机进行发图片、发视频</h2> <h3 id="_1-方法合并处理"><a href="#_1-方法合并处理" class="header-anchor">#</a> 1. 方法合并处理</h3> <p>在文件 <code>/pages/chat/plusIconAction.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">{</span>
	<span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token punctuation">{</span>
			<span class="token operator">...</span>		
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{</span>
		<span class="token comment">//点击加号扩展菜单的某一项</span>
		<span class="token keyword">async</span> <span class="token function">swiperItemClick</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> itemIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token operator">...</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sendMessageMode <span class="token operator">===</span> <span class="token string">'icon'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token operator">...</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'点击加号扩展菜单的某一项'</span><span class="token punctuation">,</span>item<span class="token punctuation">.</span>eventType<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>eventType<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token operator">...</span><span class="token punctuation">,</span>
					<span class="token keyword">case</span> <span class="token string">'cameraPhoto'</span><span class="token operator">:</span>
					    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handlePermission</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					    	<span class="token literal-property property">permission</span><span class="token operator">:</span><span class="token punctuation">{</span>
					    		<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'camera'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'本功能需要您打开摄像头'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">desc</span><span class="token operator">:</span><span class="token string">'需要访问您的摄像头来拍摄照片'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">grantedText</span><span class="token operator">:</span><span class="token string">'用户已授权打开摄像头，可以拍摄照片了'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">nograntedText</span><span class="token operator">:</span><span class="token string">'您没有授权打开摄像头，无法拍摄照片'</span><span class="token punctuation">,</span>
					    	<span class="token punctuation">}</span><span class="token punctuation">,</span>
					    	<span class="token literal-property property">methodsName</span><span class="token operator">:</span><span class="token string">'cameraPhoto'</span><span class="token punctuation">,</span>
					    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'cameraVideo'</span><span class="token operator">:</span>
					    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handlePermission</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
					    	<span class="token literal-property property">permission</span><span class="token operator">:</span><span class="token punctuation">{</span>
					    		<span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">'camera'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">title</span><span class="token operator">:</span><span class="token string">'本功能需要您打开摄像头'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">desc</span><span class="token operator">:</span><span class="token string">'需要访问您的摄像头来拍摄视频'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">grantedText</span><span class="token operator">:</span><span class="token string">'用户已授权打开摄像头，可以拍摄视频了'</span><span class="token punctuation">,</span>
					    		<span class="token literal-property property">nograntedText</span><span class="token operator">:</span><span class="token string">'您没有授权打开摄像头，无法拍摄视频'</span><span class="token punctuation">,</span>
					    	<span class="token punctuation">}</span><span class="token punctuation">,</span>
					    	<span class="token literal-property property">methodsName</span><span class="token operator">:</span><span class="token string">'cameraVideo'</span><span class="token punctuation">,</span>
					    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'map'</span><span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token keyword">case</span> <span class="token string">'mingpian'</span><span class="token operator">:</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// 拍照片发送</span>
		<span class="token function">cameraPhoto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendPhotoAlbumOrCamera</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">count</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token string">'camera'</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// 拍视频发送</span>
		<span class="token keyword">async</span> <span class="token function">cameraVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendVideoAlbumOrCamera</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token string">'camera'</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token operator">...</span><span class="token punctuation">,</span>
		<span class="token comment">//选择相册视频发送</span>
		<span class="token keyword">async</span> <span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendVideoAlbumOrCamera</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token string">'album'</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">//选择相册照片发送</span>
		<span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendPhotoAlbumOrCamera</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">count</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">,</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token string">'album'</span><span class="token punctuation">,</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// 发照片：相册或者相机</span>
		<span class="token function">sendPhotoAlbumOrCamera</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			uni<span class="token punctuation">.</span><span class="token function">chooseImage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">count</span><span class="token operator">:</span>option<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
				<span class="token comment">//sizeType:['original','compressed'],</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token punctuation">[</span>option<span class="token punctuation">.</span>sourceType<span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'选择照片res'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePaths <span class="token operator">&amp;&amp;</span> res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token comment">// 发送到服务器或者第三方云存储</span>
						<span class="token comment">// 页面效果渲染效果</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
							<span class="token comment">//单张</span>
							<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span>res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
							<span class="token comment">// 多张</span>
							res<span class="token punctuation">.</span>tempFilePaths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
								<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token literal-property property">path</span><span class="token operator">:</span>item<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'选择图片失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">let</span> errorMsg <span class="token operator">=</span> <span class="token string">'选择图片失败'</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						errorMsg <span class="token operator">=</span> <span class="token string">'相册访问权限不足'</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 用户不授权不提示</span>
					<span class="token punctuation">}</span>
					uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">title</span><span class="token operator">:</span>errorMsg<span class="token punctuation">,</span><span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span><span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// 发视频：相册或者相机</span>
		<span class="token keyword">async</span> <span class="token function">sendVideoAlbumOrCamera</span><span class="token punctuation">(</span><span class="token parameter">option</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			uni<span class="token punctuation">.</span><span class="token function">chooseVideo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
				<span class="token literal-property property">sourceType</span><span class="token operator">:</span><span class="token punctuation">[</span>option<span class="token punctuation">.</span>sourceType<span class="token punctuation">]</span><span class="token punctuation">,</span>
				<span class="token comment">// extension:['mp4'],</span>
				<span class="token literal-property property">compressed</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
				<span class="token literal-property property">maxDuration</span><span class="token operator">:</span><span class="token number">60</span><span class="token punctuation">,</span>
				<span class="token literal-property property">camera</span><span class="token operator">:</span><span class="token string">'back'</span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'选择相册视频res'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token comment">// 发送视频到服务器或者第三方云存储（如：阿里云oss）</span>
						<span class="token comment">// 成功发送之后 由服务器或者第三方云存储返回信息如</span>
						<span class="token comment">// 视频地址、视频封面等</span>
						<span class="token comment">// 得到返回的信息进行页面渲染</span>
						<span class="token keyword">let</span> poster <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
						<span class="token keyword">let</span> durationFormatted <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
						<span class="token keyword">let</span> showPoster <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token comment">// 是否显示封面</span>
						<span class="token comment">// #ifdef H5</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// h5封面</span>
							poster <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getH5VideoThumbnail</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
							showPoster <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'H5获取封面失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						<span class="token comment">// #ifdef MP</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// 小程序封面</span>
							poster <span class="token operator">=</span> res<span class="token punctuation">.</span>thumbTempFilePath<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
							showPoster <span class="token operator">=</span> poster <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'小程序获取封面失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						<span class="token comment">// #ifdef APP</span>
						<span class="token keyword">try</span><span class="token punctuation">{</span>
							<span class="token comment">// APP封面</span>
							<span class="token comment">//引入插件</span>
							<span class="token comment">// if(uni.getSystemInfoSync().platform === &quot;android&quot;){</span>
							<span class="token comment">// 	// 安卓手机获取封面</span>
							<span class="token comment">// 	const plug=uni.requireNativePlugin(&quot;Html5app-VideoCover&quot;);</span>
							<span class="token comment">// 	plug.setVideoPath({</span>
							<span class="token comment">// 		'url':res.tempFilePath,</span>
							<span class="token comment">// 		'time':1,</span>
							<span class="token comment">// 	},ret=&gt;{</span>
							<span class="token comment">// 		console.log('安卓手机获取封面的结果',ret);</span>
							<span class="token comment">// 	});</span>
							<span class="token comment">// }</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">formatVideoDuration</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>duration<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'APP封面获取失败'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							poster <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>videoPlaceHolderPoster<span class="token punctuation">;</span>
							durationFormatted <span class="token operator">=</span> <span class="token string">'0:00'</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token comment">// #endif</span>
						
						<span class="token comment">// 发视频</span>
						<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
							<span class="token operator">...</span>res<span class="token punctuation">,</span>
							<span class="token literal-property property">videoPath</span><span class="token operator">:</span>res<span class="token punctuation">.</span>tempFilePath<span class="token punctuation">,</span>
							<span class="token literal-property property">poster</span><span class="token operator">:</span>poster<span class="token punctuation">,</span>
							<span class="token literal-property property">duration</span><span class="token operator">:</span>durationFormatted<span class="token punctuation">,</span>
							<span class="token literal-property property">showPoster</span><span class="token operator">:</span>showPoster<span class="token punctuation">,</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
					console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'选择视频失败：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">let</span> errorMsg <span class="token operator">=</span> <span class="token string">'选择视频失败'</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'permission'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						errorMsg <span class="token operator">=</span> <span class="token string">'相册访问权限不足'</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// 用户不授权不提示</span>
					<span class="token punctuation">}</span>
					uni<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
						<span class="token literal-property property">title</span><span class="token operator">:</span>errorMsg<span class="token punctuation">,</span><span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">'none'</span><span class="token punctuation">,</span><span class="token literal-property property">duration</span><span class="token operator">:</span><span class="token number">3000</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token operator">...</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-针对h5端的处理"><a href="#_2-针对h5端的处理" class="header-anchor">#</a> 2. 针对H5端的处理</h3> <h4 id="_1-数据处理"><a href="#_1-数据处理" class="header-anchor">#</a> ① 数据处理</h4> <p>在文件 <code>/pages/chat/plusIconAction.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token literal-property property">plusMenus</span><span class="token operator">:</span><span class="token punctuation">[</span> <span class="token comment">// 加号扩展菜单栏目</span>
		<span class="token comment">// #ifndef H5</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;相册照片&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;uview&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;拍照片&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue62c&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;cameraPhoto&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;拍视频&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue682&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;cameraVideo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;相册视频&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue66d&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;video&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// #endif</span>
		<span class="token comment">// #ifdef H5</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;照片&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;uview&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;photo&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;视频&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue66d&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;video&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// #endif</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;位置&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;map&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;uview&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;map&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span><span class="token string">&quot;我的名片&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">icon</span><span class="token operator">:</span><span class="token string">&quot;\ue69d&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">iconType</span><span class="token operator">:</span><span class="token string">&quot;custom&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">eventType</span><span class="token operator">:</span><span class="token string">&quot;mingpian&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token comment">// { name:&quot;拍摄&quot;, icon:&quot;\ue62c&quot;, iconType:&quot;custom&quot;, eventType:&quot;camera&quot; },</span>
		<span class="token comment">// { name:&quot;我的名片&quot;, icon:&quot;\ue69d&quot;, iconType:&quot;custom&quot;, eventType:&quot;mingpian&quot; },</span>
		<span class="token comment">// { name:&quot;视频&quot;, icon:&quot;\ue66d&quot;, iconType:&quot;custom&quot;, eventType:&quot;video&quot; },</span>
		<span class="token comment">// { name:&quot;拍摄&quot;, icon:&quot;\ue62c&quot;, iconType:&quot;custom&quot;, eventType:&quot;camera&quot; },</span>
		<span class="token comment">// { name:&quot;我的名片&quot;, icon:&quot;\ue69d&quot;, iconType:&quot;custom&quot;, eventType:&quot;mingpian&quot; },</span>
		<span class="token comment">// { name:&quot;视频&quot;, icon:&quot;\ue66d&quot;, iconType:&quot;custom&quot;, eventType:&quot;video&quot; },</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h4 id="_2-页面处理"><a href="#_2-页面处理" class="header-anchor">#</a> ② 页面处理</h4> <p>在页面 <code>/pages/chat/chat.nvue</code></p> <div class="language-vue extra-class"><pre class="language-vue"><code>    <span class="token comment">&lt;!-- 底部聊天输入区域 --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">...</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex align-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 是H5端给一个返回按钮 --&gt;</span>
			<span class="token comment">&lt;!-- #ifdef H5 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span>
			<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>navigateBack<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe618;">&amp;#xe618;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- #endif --&gt;</span>
			<span class="token comment">&lt;!-- 不是H5端有录音功能 --&gt;</span>
			<span class="token comment">&lt;!-- #ifndef H5 --&gt;</span>
			<span class="token comment">&lt;!-- 切换发语音 --&gt;</span>
			<span class="token comment">&lt;!-- 键盘图标 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessageMode == 'audio'<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeAudioOrText('text')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe644;">&amp;#xe644;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- 语音图标 --&gt;</span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>chat-navbar-icon-button</span> <span class="token attr-name">v-else</span>
			<span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>changeAudioOrText('audio')<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>iconfont font-lg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token entity" title="&amp;#xe643;">&amp;#xe643;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>chat-navbar-icon-button</span><span class="token punctuation">&gt;</span></span>
			<span class="token comment">&lt;!-- #endif --&gt;</span>
			
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex align-center font-sm px-2 py-1 border rounded<span class="token punctuation">&quot;</span></span>
			<span class="token attr-name">:class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>[recorderStatus ? 'bg-hover-light' : 'bg-white']<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- 发语音  按住说话 --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessageMode == 'audio'<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex flex-row align-center justify-center rounded<span class="token punctuation">&quot;</span></span>
				<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 440rpx<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 60rpx<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
				<span class="token attr-name">@touchstart</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchstart<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@touchend</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchend<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@touchcancel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchcancel<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@touchmove</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderTouchmove<span class="token punctuation">&quot;</span></span>
				<span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font mr-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>按住<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>!recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>说话<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font mr-2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>松开<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>font<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>recorderStatus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发送<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
				<span class="token comment">&lt;!-- 发文字 --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">v-else</span>
				<span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textarea<span class="token punctuation">&quot;</span></span> <span class="token attr-name">fixed</span> <span class="token attr-name">auto-height</span> <span class="token attr-name">:maxlength</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>-1<span class="token punctuation">&quot;</span></span>
				<span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 440rpx<span class="token punctuation">;</span><span class="token property">min-height</span><span class="token punctuation">:</span> 60rpx<span class="token punctuation">;</span>
				<span class="token property">max-height</span><span class="token punctuation">:</span> 274rpx<span class="token punctuation">;</span><span class="token property">overflow-y</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
				<span class="token property">text-align</span><span class="token punctuation">:</span> justify<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span>
				<span class="token attr-name">:adjust-position</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>messageValue<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@focus</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>textareaFocus<span class="token punctuation">&quot;</span></span>
				<span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onTextareaInput<span class="token punctuation">&quot;</span></span> 
				<span class="token attr-name">@blur</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onTextareaBlur<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- 新增：监听失焦事件 --&gt;</span><span class="token comment">&lt;!-- 新增：监听输入事件 --&gt;</span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex align-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			...
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="五、加号扩展菜单功能"><a href="#五、加号扩展菜单功能" class="header-anchor">#</a> 五、加号扩展菜单功能</h2> <p>内容过多，在新页面打开，具体查看：<br></p> <ol><li><a href="/thirdless/w-b/06加号扩展菜单功能" target="_blank">聊天页输入区域：加号扩展菜单功能（发图片）</a></li> <li><a href="/thirdless/w-b/06发语音" target="_blank">聊天页输入区域：加号扩展菜单功能：语音功能（语音播放）</a></li> <li><a href="/thirdless/w-b/06发语音功能" target="_blank">聊天页输入区域：加号扩展菜单功能：语音功能（发语音）</a></li> <li><a href="/thirdless/w-b/06播放视频及发视频" target="_blank">聊天页输入区域：加号扩展菜单功能：播放视频及发视频</a></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2025年7月11日星期五上午10点20分</span></div></footer> <!----> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.4c1fa2f2.js" defer></script><script src="/assets/js/10.a1858127.js" defer></script><script src="/assets/js/2.641709ae.js" defer></script><script src="/assets/js/161.d4c19dfb.js" defer></script><script src="/assets/js/4.68f7b7e9.js" defer></script>
  </body>
</html>
