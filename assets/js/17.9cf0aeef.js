(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{419:function(t,s,a){"use strict";a.r(s);var e=a(24),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"eggjs-即时通讯功能后端部署上线"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#eggjs-即时通讯功能后端部署上线"}},[t._v("#")]),t._v(" eggjs + 即时通讯功能后端部署上线")]),t._v(" "),s("h3",{attrs:{id:"_1、解析一个域名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、解析一个域名"}},[t._v("#")]),t._v(" 1、解析一个域名")]),t._v(" "),s("blockquote",[s("p",[t._v("在阿里云或腾讯云，域名管理中，解析一个域名到线上服务器，本次演示域名： "),s("code",[t._v("eggjs.chat.51yrc.com")]),t._v("，轻量应用服务器在域名栏目绑定域名。"),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_2、创建网站"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、创建网站"}},[t._v("#")]),t._v(" 2、创建网站")]),t._v(" "),s("blockquote",[s("p",[t._v("在宝塔面板中， "),s("code",[t._v("网站")]),t._v("-"),s("code",[t._v("PHP项目")]),t._v("-"),s("code",[t._v("添加站点")]),t._v("-"),s("code",[t._v("传统项目")]),t._v(" "),s("br")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("域名")]),t._v("：eggjs.chat.51yrc.com "),s("br"),t._v(" "),s("code",[t._v("备注")]),t._v("：eggjs.chat.51yrc.com (自动生成)"),s("br"),t._v(" "),s("code",[t._v("根目录")]),t._v("：/www/wwwroot/eggjs.chat.51yrc.com  (自动生成)"),s("br"),t._v(" "),s("code",[t._v("FTP")]),t._v("：不创建"),s("br"),t._v(" "),s("code",[t._v("数据库")]),t._v("：MySQL---字符集：utf8mb4（存表情包），数据库账号、密码自动生成"),s("br"),t._v(" "),s("code",[t._v("PHP版本")]),t._v("：这里选择 "),s("code",[t._v("纯静态")]),s("br"),t._v(" "),s("code",[t._v("网站分类")]),t._v("：默认分类"),s("br"),t._v(" "),s("code",[t._v("确定")]),t._v("--\x3e 点击域名看默认站点是否可以打开")])])]),t._v(" "),s("h3",{attrs:{id:"_3、上传代码到服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、上传代码到服务器"}},[t._v("#")]),t._v(" 3、上传代码到服务器")]),t._v(" "),s("blockquote",[s("p",[t._v("群文件下载源码 （或私信老师获取源码）"),s("br"),t._v("\n打开网站根目录，上传源码压缩包，解压 "),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_4、面板环境安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、面板环境安装"}},[t._v("#")]),t._v(" 4、面板环境安装")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("查看是否安装了"),s("code",[t._v("PM2管理器")]),t._v("："),s("code",[t._v("软件商店")]),t._v("- "),s("code",[t._v("已安装")]),t._v("-查看是否安装了"),s("code",[t._v("PM2管理器")]),t._v("，没有则搜索安装；"),s("br")]),t._v(" "),s("li",[t._v("切换node版本到最新版本："),s("code",[t._v("PM2管理器")]),t._v(" -> "),s("code",[t._v("设置")]),t._v(" -> "),s("code",[t._v("Node版本")]),t._v(" -> "),s("code",[t._v("选择一个新版本")]),t._v(" -> "),s("code",[t._v("确定")]),t._v(" "),s("br")]),t._v(" "),s("li",[t._v("检查安装Redis: "),s("code",[t._v("软件商店")]),t._v("- "),s("code",[t._v("已安装")]),t._v("-查看是否安装了"),s("code",[t._v("Redis")]),t._v("，没有则搜索安装；之后，记得启动"),s("code",[t._v("Redis服务")]),s("br")])])]),t._v(" "),s("h3",{attrs:{id:"_5、命令行工具执行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、命令行工具执行"}},[t._v("#")]),t._v(" 5、命令行工具执行")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("打开终端")])]),t._v(" "),s("blockquote",[s("p",[t._v("可以在面板对应的网站根目录下，"),s("code",[t._v("终端")]),t._v(" -> 输入命令 "),s("br"),t._v("\n也可以在阿里云或者腾讯云控制台，找到服务器的"),s("code",[t._v("远程连接")]),t._v("打开命令终端")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("切换root账号： "),s("code",[t._v("su root")]),t._v(" "),s("br")]),t._v(" "),s("li",[t._v("输入密码 （服务器的"),s("code",[t._v("远程连接")]),t._v("密码，忘了可以重新设置密码再输入）")])])])]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("切换到对应项目的根目录，如本项目： "),s("code",[t._v("cd /www/wwwroot/eggjs.chat.51yrc.com")]),s("br")]),t._v(" "),s("li",[t._v("安装依赖： "),s("code",[t._v("npm install")]),t._v(" 我们知道安装依赖包，需要找到npm镜像源：")])]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("如果你是国内服务器，我们会使用淘宝镜像源 "),s("code",[t._v("npm config set registry https://registry.npmmirror.com/")]),t._v(" ， 通过命令查看npm镜像源："),s("code",[t._v("npm config get registry")]),t._v(" "),s("br")]),t._v(" "),s("li",[t._v("如果是中国香港或者国外服务器，则不用切换镜像源，因为它本身就很快 "),s("br"),t._v("\n执行："),s("code",[t._v("npm install")]),t._v("安装依赖包"),s("br"),t._v("\n注意：可能由于npm版本或者其他原因，导致 "),s("code",[t._v("npm install")]),t._v("安装依赖 "),s("code",[t._v("失败")]),t._v("，可尝试以下解决方法：")])]),t._v(" "),s("blockquote",[s("p",[t._v("通过 "),s("code",[t._v("yarn")]),t._v("命令安装依赖：")]),t._v(" "),s("blockquote",[s("p",[t._v("安装yarn："),s("code",[t._v("npm install -g yarn")]),t._v(" "),s("br"),t._v("\n安装依赖："),s("code",[t._v("yarn install")]),s("br")])])])])]),t._v(" "),s("h3",{attrs:{id:"_6、安装数据库迁移工具【可选项】"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、安装数据库迁移工具【可选项】"}},[t._v("#")]),t._v(" 6、安装数据库迁移工具【可选项】")]),t._v(" "),s("blockquote",[s("p",[t._v("【可选项、可省略，直接导入数据库也可以】"),s("a",{attrs:{href:"/secondless/w-d/网站代码上线调试.html#八、安装数据库迁移工具-执行迁移命令",target:"_blank"}},[t._v("（第二期第四季课程有详细讲解）")])])]),t._v(" "),s("h3",{attrs:{id:"_7、修改配置信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7、修改配置信息"}},[t._v("#")]),t._v(" 7、修改配置信息")]),t._v(" "),s("blockquote",[s("p",[s("code",[t._v("config/config.default.js")]),t._v(" 修改数据库连接： "),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("修改数据库连接配置:数据库名称database，数据库用户名username，数据库密码password  "),s("br")])]),t._v(" "),s("p",[s("code",[t._v("另外就是OSS云存储配置记得修改对应的：")])]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oss "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("client")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("accessKeyId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//你的accessKeyId")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("accessKeySecret")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//你的accessKeySecret")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("bucket")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//你的bucket")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("endpoint")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'xxx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//你的endpoint")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("timeout")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'60s'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("code",[t._v("database/config.json")]),t._v(" "),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("数据库相关信息，建议全部改一下,改成当前数据库名，用户名，密码 "),s("br")])])]),t._v(" "),s("h3",{attrs:{id:"_8、导入数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8、导入数据库"}},[t._v("#")]),t._v(" 8、导入数据库")]),t._v(" "),s("blockquote",[s("p",[t._v("导入代码中的数据库到服务器数据库")])]),t._v(" "),s("h3",{attrs:{id:"_9、端口占用问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9、端口占用问题"}},[t._v("#")]),t._v(" 9、端口占用问题")]),t._v(" "),s("blockquote",[s("p",[t._v("若服务器不止一个项目，则修改配置换一个端口在启动，在 package.json 文件加上：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//加上别的端口号,如：7008")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"scripts"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"start"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"egg-scripts start --daemon --title=egg-server-mssql --sticky --port=7008"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n     "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])])]),t._v(" "),s("h3",{attrs:{id:"_10、启动项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10、启动项目"}},[t._v("#")]),t._v(" 10、启动项目")]),t._v(" "),s("blockquote",[s("p",[t._v("启动项目："),s("code",[t._v("npm start")]),t._v(" "),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_11、添加反向代理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_11、添加反向代理"}},[t._v("#")]),t._v(" 11、添加反向代理")]),t._v(" "),s("blockquote",[s("p",[t._v("找到对应网站 -> "),s("code",[t._v("设置")]),t._v(" -> "),s("code",[t._v("反向代理")]),t._v(" -> "),s("code",[t._v("添加反向代理")])]),t._v(" "),s("blockquote",[s("p",[t._v("代理名称 : "),s("code",[t._v("api")]),t._v(" "),s("br"),t._v("\n目标URL : "),s("code",[t._v("http://localhost:7008")]),t._v(" 对应启动端口 "),s("br"),t._v("\n发送域名 : "),s("code",[t._v("localhost")]),t._v(" "),s("br"),t._v("\n还需要添加一个配置，主要针对 websocket "),s("br"),t._v(" "),s("code",[t._v("添加反向代理")]),t._v("之后 --\x3e "),s("code",[t._v("配置文件")]),t._v("--\x3e底部写入下面代码：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("location "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("ws\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    proxy_pass http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7008")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_http_version "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header Upgrade $http_upgrade"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header Connection "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Upgrade"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    proxy_set_header "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("X")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("IP")]),t._v(" $remote_addr"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("修改前端项目的 /common/lib/config.js和manifest.json里面的域名即可")])])]),t._v(" "),s("p",[t._v("试一下："),s("a",{attrs:{href:"http://eggjs.chat.51yrc.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://eggjs.chat.51yrc.com/"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);