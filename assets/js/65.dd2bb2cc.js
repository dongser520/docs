(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{469:function(t,s,a){"use strict";a.r(s);var e=a(24),n=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"一、安装thinkphp及配置项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一、安装thinkphp及配置项目"}},[t._v("#")]),t._v(" 一、安装thinkphp及配置项目")]),t._v(" "),s("blockquote",[s("p",[t._v("我们以thinkphp6为例给大家进行讲解。")])]),t._v(" "),s("h3",{attrs:{id:"_1、配置php的环境变量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1、配置php的环境变量"}},[t._v("#")]),t._v(" 1、配置php的环境变量")]),t._v(" "),s("blockquote",[s("p",[t._v("①、可以在"),s("code",[t._v("UPUPWANK")]),t._v("快捷图标->"),s("code",[t._v("右键属性")]),t._v("-> "),s("code",[t._v("快捷方式")]),t._v("-> "),s("code",[t._v("打开文件所在的位置")]),t._v("；"),s("br"),t._v("\n② "),s("code",[t._v("Modules")]),t._v("->"),s("code",[t._v("PHPX")]),t._v("->"),s("code",[t._v("PHP72")]),t._v("->"),s("code",[t._v("复制整个路径：D:\\UPUPW_ANK_W64\\Modules\\PHPX\\PHP72")]),t._v("；"),s("br"),t._v("\n③ "),s("code",[t._v("我的电脑")]),t._v("->"),s("code",[t._v("属性")]),t._v("->"),s("code",[t._v("高级系统设置(更改设置)")]),t._v("->"),s("code",[t._v("高级")]),t._v("->"),s("code",[t._v("环境变量")]),t._v("->"),s("code",[t._v("系统变量")]),t._v("；"),s("br"),t._v("\n④ 在"),s("code",[t._v("系统变量")]),t._v("中，找到"),s("code",[t._v("Path")]),t._v(" -> "),s("code",[t._v("编辑(双击也可以)")]),t._v(" -> "),s("code",[t._v("新建")]),t._v(" -> "),s("code",[t._v("粘贴路径：D:\\UPUPW_ANK_W64\\Modules\\PHPX\\PHP72")]),t._v(" -> "),s("code",[t._v("确定")]),t._v("；"),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("测试环境变量是否正常："),s("br"),t._v("\n① "),s("code",[t._v("win + R")]),t._v("（"),s("code",[t._v("开始")]),t._v("->"),s("code",[t._v("运行")]),t._v("） -> "),s("code",[t._v("cmd")]),t._v(" -> "),s("code",[t._v("php -v")]),t._v(" -> "),s("code",[t._v("回车")]),t._v(" -> "),s("code",[t._v("查看php版本号")]),t._v("（若有打印结果即配置成功）；"),s("br")])])]),t._v(" "),s("h3",{attrs:{id:"_2、安装composer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装composer"}},[t._v("#")]),t._v(" 2、安装composer")]),t._v(" "),s("blockquote",[s("p",[t._v("具体安装参考："),s("a",{attrs:{href:"https://www.runoob.com/w3cnote/composer-install-and-usage.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.runoob.com/w3cnote/composer-install-and-usage.html"),s("OutboundLink")],1),t._v(" "),s("br")]),t._v(" "),s("blockquote",[s("ol",[s("li",[t._v("下载 "),s("code",[t._v("Composer-Setup.exe")]),t._v(" 然后一步一步安装即可。")])])])]),t._v(" "),s("h3",{attrs:{id:"_3、创建项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3、创建项目"}},[t._v("#")]),t._v(" 3、创建项目")]),t._v(" "),s("blockquote",[s("h3",{attrs:{id:"thinkphp6-0-tp框架-文档说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#thinkphp6-0-tp框架-文档说明"}},[t._v("#")]),t._v(" ThinkPHP6.0（tp框架）文档说明"),s("br")])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://www.kancloud.cn/manual/thinkphp6_0/1037481",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.kancloud.cn/manual/thinkphp6_0/1037481"),s("OutboundLink")],1),t._v(" "),s("br")]),t._v(" "),s("blockquote",[s("blockquote",[s("ol",[s("li",[t._v("国外的网站连接速度很慢,因此安装的时间可能会比较长，我们建议使用国内镜像,类似于我们node环境的npm切换到淘宝镜像一个意思："),s("br")])]),t._v(" "),s("blockquote",[s("p",[t._v("打开命令行窗口（windows用户）或控制台（Linux、Mac 用户）并执行如下命令：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//阿里云：")]),t._v("\ncomposer config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g repo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("packagist composer https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mirrors"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("aliyun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("composer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//华为云：")]),t._v("\ncomposer config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g repo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("packagist composer https"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("huaweicloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("repository"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("php"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("\n")])])])]),t._v(" "),s("h4",{attrs:{id:"_2-创建一个站点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建一个站点"}},[t._v("#")]),t._v(" 2. 创建一个站点")]),t._v(" "),s("blockquote",[s("p",[t._v("打开本地环境 "),s("code",[t._v("UPUPWANK")]),t._v(" -> "),s("code",[t._v("全局首页")]),t._v(" -> "),s("code",[t._v("+ 号")]),t._v(" -> 创建一个站点 "),s("br"),t._v(" "),s("code",[t._v("网站名称")]),t._v(": "),s("code",[t._v("thinkphp.shop")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("网站路径")]),t._v(": 默认 "),s("br"),t._v(" "),s("code",[t._v("网站端口")]),t._v(": 80 "),s("br"),t._v(" "),s("code",[t._v("主要域名")]),t._v(": "),s("code",[t._v("thinkphp.shop")]),t._v(" "),s("br"),t._v(" "),s("code",[t._v("额外域名")]),t._v(":  "),s("br"),t._v(" "),s("code",[t._v("PHP")]),t._v(": "),s("code",[t._v("7.2X")]),t._v(" -- "),s("code",[t._v("提交保存")]),s("br"),s("br"),t._v(" "),s("br"),s("br"),t._v("\n然后来到 "),s("code",[t._v("功能扩展")]),t._v(" -> "),s("code",[t._v("Hosts重定向")]),t._v(" -> 域名；"),s("code",[t._v("thinkphp.shop")]),t._v(" 点击 "),s("code",[t._v("+号添加")]),t._v(" -> "),s("code",[t._v("提交保存")]),t._v(";")])]),t._v(" "),s("h4",{attrs:{id:"_3-安装项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装项目"}},[t._v("#")]),t._v(" 3. 安装项目")]),t._v(" "),s("p",[t._v("来到我们的 "),s("code",[t._v("UPUPWANK")]),t._v(" -> "),s("code",[t._v("全局首页")]),t._v(" ->  "),s("code",[t._v("点击UPUPWANK上面的笔（编辑）")]),t._v("-> 找到刚刚创建的站点 -> 打开站点目录（中间的文件夹图标） -> "),s("code",[t._v("当前文件夹路径选中输入cmd打开命令行工具")]),t._v("（命令行工具也会定位到当前的网站路径）"),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("如果你是第一次安装的话，在命令行下面，切换到你的WEB根目录下面并执行下面的命令："),s("br")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("composer create"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("project topthink"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("think tp\n")])])])]),t._v(" "),s("h4",{attrs:{id:"_4-切换到tp目录下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-切换到tp目录下"}},[t._v("#")]),t._v(" 4. 切换到tp目录下")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v(" cd tp  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//切换到tp目录下:D:\\UPUPW_ANK_W64\\WebRoot\\Vhosts\\thinkphp.shop\\tp>")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("运行命令进行更新：")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[t._v("composer update topthink"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("framework\n")])])])]),t._v(" "),s("h4",{attrs:{id:"_5-修改项目根目录到-public-文件夹下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-修改项目根目录到-public-文件夹下"}},[t._v("#")]),t._v(" 5. 修改项目根目录到 public 文件夹下")]),t._v(" "),s("ol",[s("li",[t._v("默认创建项目的根目录是："),s("code",[t._v("D:\\UPUPW_ANK_W64\\WebRoot\\Vhosts\\thinkphp.shop")]),t._v(",我们的项目代码放在了"),s("code",[t._v("tp")]),t._v("目录下，运行目录是"),s("code",[t._v("tp/public")]),t._v("目录，因此，先复制路径："),s("code",[t._v("D:\\UPUPW_ANK_W64\\WebRoot\\Vhosts\\thinkphp.shop\\tp\\public")]),t._v(" "),s("br")]),t._v(" "),s("li",[t._v("来到我们的 "),s("code",[t._v("UPUPWANK")]),t._v(" -> "),s("code",[t._v("编辑（笔的图标）")]),t._v(" -> 找到项目（点击项目的笔图标）-> 修改"),s("code",[t._v("网站路径")]),t._v("为"),s("code",[t._v("D:\\UPUPW_ANK_W64\\WebRoot\\Vhosts\\thinkphp.shop\\tp\\public")]),t._v(" -> "),s("code",[t._v("提交保存")]),t._v("(运行信息里面显示重载成功，可以看一下网站是否正常访问) "),s("br")])])])]),t._v(" "),s("h3",{attrs:{id:"_4、运行及配置项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4、运行及配置项目"}},[t._v("#")]),t._v(" 4、运行及配置项目")]),t._v(" "),s("blockquote",[s("p",[t._v("将项目tp文件夹拖进我们的VScode编辑器 "),s("br")]),t._v(" "),s("h4",{attrs:{id:"_1-修改-example-env-文件名为-env"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-修改-example-env-文件名为-env"}},[t._v("#")]),t._v(" 1. 修改 "),s("code",[t._v(".example.env")]),t._v(" 文件名为  "),s("code",[t._v(".env")]),t._v(" "),s("br")]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("来到路由 "),s("code",[t._v("route/app.php")]),t._v(" （类似eggjs项目的"),s("code",[t._v("app/router.js")]),t._v("）, 分析我们首页访问的内容是哪里的？")])]),t._v(" "),s("blockquote",[s("p",[t._v("学过我们前面eggjs课程的同学应该很容易想到，访问的内容是 "),s("code",[t._v("app/controller/index.php")]),t._v("这个里面的方法 "),s("code",[t._v("index")]),t._v(", 你可以改一下这个方法返回的内容进行测试 （thinkphp和我们的eggjs框架有很多相似之处，只是他们编写的语言不同）"),s("br"),t._v("\n验证路径里面的hello方法："),s("code",[t._v("http://thinkphp.shop/hello/迪丽热巴")]),t._v(" 但发现访问失败，因此这里又跟egg.js有些区别"),s("br"),t._v("\n正确访问路径是："),s("code",[t._v("http://thinkphp.shop/index.php/hello/迪丽热巴")]),t._v(",需要加上"),s("code",[t._v("index.php")]),t._v(" "),s("br"),t._v("\n也就是我们需要加上一个入口文件："),s("code",[t._v("index.php")]),t._v("，它的位置在 "),s("code",[t._v("/public/index.php")]),t._v(" "),s("br")])]),t._v(" "),s("h4",{attrs:{id:"_3-简化入口文件-index-php"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-简化入口文件-index-php"}},[t._v("#")]),t._v(" 3. 简化入口文件："),s("code",[t._v("index.php")])]),t._v(" "),s("blockquote",[s("p",[t._v("来到我们的 "),s("code",[t._v("UPUPWANK")]),t._v(" -> "),s("code",[t._v("找到当前项目(编辑，笔的符号)")]),t._v("-> "),s("code",[t._v("伪静态配置")]),s("br"),t._v("\n说明：我们的"),s("code",[t._v("UPUPWANK")]),t._v("虽然是N模式，但是运行的是Apache的服务，因此，我们需要配置Apache的伪静态规则，来简化我们的入口文件，"),s("br")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IfModule mod_rewrite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  Options "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("FollowSymlinks "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Multiviews\n  RewriteEngine On\n\n  RewriteCond "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REQUEST_FILENAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("d\n  RewriteCond "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REQUEST_FILENAME")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f\n  RewriteRule "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$1 "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("QSA")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("L")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("IfModule"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])])])])]),t._v(" "),s("h3",{attrs:{id:"_5、统一api接口返回格式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5、统一api接口返回格式"}},[t._v("#")]),t._v(" 5、统一API接口返回格式")]),t._v(" "),s("blockquote",[s("p",[t._v("我们在eggjs项目统一了接口返回格式，因此，我们在thinkphp中也统一一下 "),s("br"),t._v("\n示例： "),s("code",[t._v("app/controller/index.php")]),t._v(" "),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("比如：希望接口返回以下数据：")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"msg"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ok"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"data"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"name"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"迪丽热巴"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"age"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("可在vscode中安装扩展："),s("code",[t._v("PHP Intelephense")]),t._v("有语法提示，方便开发"),s("br")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return '迪丽热巴';")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//使用关联数组形式")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msg'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ok'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'name'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'迪丽热巴'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'age'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n    $data = (object) [\n        'msg' => 'ok',\n        'data' => (object) [\n            'name' => '迪丽热巴',\n            'age' => 18\n       ]\n    ];\n    return json($data);\n    */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("h4",{attrs:{id:"统一接口返回-类似eggjs中的app-extend-context-js中的apisuccess方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统一接口返回-类似eggjs中的app-extend-context-js中的apisuccess方法"}},[t._v("#")]),t._v(" 统一接口返回（类似eggjs中的"),s("code",[t._v("app/extend/context.js")]),t._v("中的"),s("code",[t._v("apiSuccess方法")]),t._v("）"),s("br")]),t._v(" "),s("p",[t._v("在thinkphp中写在 "),s("code",[t._v("app/common.php")]),s("br")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//api接口形式成功提示,命名随便showSuccess,apiSuccess都可以")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apiSuccess")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$data "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$msg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ok'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msg'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" $msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" $data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//api接口形式失败提示 ,命名随便showError,apiFail都可以")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apiFail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$msg"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fail'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msg'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" $msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$code"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("示例： "),s("code",[t._v("app/controller/index.php")]),t._v(" "),s("br")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return '迪丽热巴';")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n    return apiSuccess([\n        'name' => '迪丽热巴',\n        'age' => 18\n    ]);\n    */")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*\n    return apiFail('数据不存在');\n    */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])]),t._v(" "),s("h3",{attrs:{id:"_6、异常处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6、异常处理"}},[t._v("#")]),t._v(" 6、异常处理")]),t._v(" "),s("h4",{attrs:{id:"_1-如何抛出一个异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-如何抛出一个异常"}},[t._v("#")]),t._v(" ① 如何抛出一个异常")]),t._v(" "),s("blockquote",[s("p",[t._v("在"),s("code",[t._v("app/controller/index.php")]),t._v("中，我们抛出一个异常，如下：")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 比如用户被限制登录，此时后面的程序不能在执行可以抛出一个异常")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// tp框架提供了一个助手函数 abort()")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'你已被限制登录'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return '迪丽热巴';")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apiSuccess")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"迪丽热巴"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// return apiFail("请求失败"); ')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),s("h4",{attrs:{id:"_2-异常提示不友好-在app-exceptionhandle-php中对-render函数进行扩展-来统一异常-如下"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-异常提示不友好-在app-exceptionhandle-php中对-render函数进行扩展-来统一异常-如下"}},[t._v("#")]),t._v(" ② 异常提示不友好，在"),s("code",[t._v("app/ExceptionHandle.php")]),t._v("中对 "),s("code",[t._v("render")]),t._v("函数进行扩展，来统一异常，如下：")]),t._v(" "),s("blockquote",[s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("$request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Throwable $e")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Response\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调试模式")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'APP_DEBUG'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 其他错误交给系统处理")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parent")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 检查是否有 getHeaders 方法")]),t._v("\n        $headers "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("method_exists")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'getHeaders'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" $e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getHeaders")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        $statusCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("method_exists")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'getStatusCode'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" $e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getStatusCode")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("json")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'msg'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" $e"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMessage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'errorCode'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" $statusCode\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isset")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'statusCode'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" $headers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'statusCode'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" $statusCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])]),t._v(" "),s("p",[t._v("将"),s("code",[t._v(".env")]),t._v("文件中的"),s("code",[t._v("APP_DEBUG")]),t._v("改为"),s("code",[t._v("false")]),t._v("，访问首页，发现异常提示友好了。"),s("br")])]),t._v(" "),s("h4",{attrs:{id:"_3-也可以在-app-common-php-封装一个apiexception方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-也可以在-app-common-php-封装一个apiexception方法"}},[t._v("#")]),t._v(" ③ 也可以在  "),s("code",[t._v("app/common.php")]),t._v(" 封装一个"),s("code",[t._v("ApiException")]),t._v("方法："),s("br")]),t._v(" "),s("blockquote",[s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 抛出异常")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ApiException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$msg "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请求错误'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$errorCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("$statusCode "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("abort")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("$errorCode"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" $msg"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'statusCode'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" $statusCode\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("在"),s("code",[t._v("app/controller/index.php")]),t._v("中 调用 "),s("code",[t._v("ApiException")]),t._v("方法")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 比如用户被限制登录，此时后面的程序不能在执行可以抛出一个异常")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// tp框架提供了一个助手函数 abort()")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// abort(20000, '你已被限制登录');")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ApiException")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'你已被限制登录'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// return '迪丽热巴';")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("apiSuccess")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"迪丽热巴"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"age"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("18")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// return apiFail("请求失败"); ')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])])]),t._v(" "),s("h2",{attrs:{id:"二、创建及配置数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#二、创建及配置数据库"}},[t._v("#")]),t._v(" 二、创建及配置数据库")]),t._v(" "),s("blockquote",[s("p",[t._v("我们在前面的课程做项目准备的时候，已经告诉大家如何将数据库导入mysql了，大家打开"),s("code",[t._v("phpMyAdmin")]),t._v("，数据库"),s("code",[t._v("myegg")]),t._v("就是我们项目的数据库。"),s("br"),t._v("\n使用thinkphp的同学，来配置一下数据库连接："),s("br"),t._v("\n打开"),s("code",[t._v(".env")]),t._v("文件：")]),t._v(" "),s("blockquote",[s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATABASE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("TYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mysql\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOSTNAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DATABASE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" myegg\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("USERNAME")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("PASSWORD")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" root\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("HOSTPORT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("CHARSET")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" utf8\n"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEBUG")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"三、管理员板块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#三、管理员板块"}},[t._v("#")]),t._v(" 三、管理员板块")]),t._v(" "),s("h3",{attrs:{id:"_1-管理员表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-管理员表"}},[t._v("#")]),t._v(" 1. 管理员表")]),t._v(" "),s("blockquote",[s("p",[t._v("其实数据库中有一个管理员表，这里为了方便两个技术栈同学学习，我们统一再创建一个管理员表 "),s("code",[t._v("shop_manager")]),s("br"),t._v("\n具体"),s("code",[t._v("shop_manager")]),t._v("表设计，"),s("a",{attrs:{href:"/web/mysql/shop_manager",target:"_blank"}},[t._v("点击查看")]),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_2-创建管理员"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建管理员"}},[t._v("#")]),t._v(" 2. 创建管理员")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.管理员板块",target:"_blank"}},[t._v("点击查看")]),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_3-修改管理员"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-修改管理员"}},[t._v("#")]),t._v(" 3. 修改管理员")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.修改管理员",target:"_blank"}},[t._v("点击查看")]),s("br")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.修改管理员.html#二、字段唯一性验证处理"}},[t._v("字段唯一性验证处理")]),s("br"),t._v(" "),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.修改管理员.html#三、验证场景写成函数"}},[t._v("验证场景写成函数")]),s("br")])])]),t._v(" "),s("h3",{attrs:{id:"_4-删除管理员"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-删除管理员"}},[t._v("#")]),t._v(" 4. 删除管理员")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.修改管理员.html#五、删除管理员",target:"_blank"}},[t._v("点击查看")]),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_5-管理员角色表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-管理员角色表"}},[t._v("#")]),t._v(" 5. 管理员角色表")]),t._v(" "),s("blockquote",[s("p",[t._v("正常来说，应该叫"),s("code",[t._v("角色表：role")]),t._v("，这里为了方便大家更容易理解这个表，因此称它为 "),s("code",[t._v("管理员角色表")]),t._v("。事实上，这张表不仅可以包含管理员的各种角色，还可以设定用户的角色。"),s("br"),s("br"),t._v("\n说明："),s("br"),t._v("正常来说，我们的"),s("code",[t._v("管理员表")]),t._v("："),s("code",[t._v("shop_manager")]),t._v("有一个字段叫："),s("code",[t._v("role_id")]),t._v(",它这个字段实际上是"),s("code",[t._v("角色表：role")]),t._v("的id值，而到目前为止，我们数据库还不存在"),s("code",[t._v("角色表：role")]),t._v("，因此我们还需要创建一张"),s("code",[t._v("角色表：role")]),t._v("。"),s("br"),s("br"),t._v(" "),s("span",{staticStyle:{color:"#ff6600"}},[t._v("重点说明：")]),s("br"),t._v("\n正常来说，我们管理员表里面存在"),s("code",[t._v("role_id")]),t._v("这个字段，对应的是角色表"),s("code",[t._v("role")]),t._v("的id值，那么，首先应该创建角色表"),s("code",[t._v("角色表：role")]),t._v("，然后再创建管理员表"),s("code",[t._v("shop_manager")]),t._v("，但是由于本套课程涉及到两套框架"),s("code",[t._v("thinkphp")]),t._v("/"),s("code",[t._v("egg.js")]),t._v("，为了方便讲解及融合两天框架，因此我们先以管理员表为例，讲解了管理员表的"),s("code",[t._v("新增")]),t._v("、"),s("code",[t._v("修改")]),t._v("、"),s("code",[t._v("删除")]),t._v("，方便大家先了解"),s("code",[t._v("thinkphp")]),t._v("框架，接下来，由于需要讲到管理员列表，这里涉及到多表（角色表、管理员表）的模型关联、不管是"),s("code",[t._v("thinkphp")]),t._v("/"),s("code",[t._v("egg.js")]),t._v(" 都存在模型关联，因此再讲管理员列表功能之前，我们需要创建一下"),s("code",[t._v("角色表：role")]),t._v("。"),s("br"),t._v(" "),s("br"),t._v("\n具体"),s("code",[t._v("角色表：role")]),t._v("设计，"),s("a",{attrs:{href:"/web/mysql/role",target:"_blank"}},[t._v("点击查看")]),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_6-新增-分类表category的角色表-rolecategory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-新增-分类表category的角色表-rolecategory"}},[t._v("#")]),t._v(" 6. [新增]分类表"),s("code",[t._v("category")]),t._v("的角色表 "),s("code",[t._v("rolecategory")])]),t._v(" "),s("p",[t._v("重要说明："),s("br")]),t._v(" "),s("blockquote",[s("p",[t._v("本节课讲的分类表"),s("code",[t._v("category")]),t._v("的角色表 "),s("code",[t._v("rolecategory")]),t._v("，本不属于"),s("code",[t._v("管理员板块")]),t._v("的内容，主要是受我们上一节的影响，因此临时插入了这节课，因为我们分类表"),s("code",[t._v("category")]),t._v("的角色表 "),s("code",[t._v("rolecategory")]),t._v("，它的字段跟我们上节课讲的管理员角色表 "),s("code",[t._v("role")]),t._v("，字段是一样的，这样大家理解起来非常容易，只不过这张表"),s("code",[t._v("rolecategory")]),t._v("是充当的分类的角色。"),s("br"),s("br"),t._v("\n本节课是一节综合课，两种技术栈"),s("code",[t._v("thinkphp")]),t._v("和我们"),s("code",[t._v("egg.js")]),t._v("同学都学习操作一下。"),s("br"),s("br"),t._v("\n这张分类表"),s("code",[t._v("category")]),t._v("的角色表 "),s("code",[t._v("rolecategory")]),t._v("，主要是将来用于区别后台系统里面，不同的分类系统用的，比如，我们可以有一个大的综合性后台，这个后台可以管理："),s("code",[t._v("普通企业网站的后台")]),t._v("、"),s("code",[t._v("商城后台")]),t._v("、"),s("code",[t._v("直播后台")]),t._v("等等，而这些后台分类，就可以用我们这张表"),s("code",[t._v("rolecategory")]),t._v("，目前大家先把这张表创建起来，后面我们学到了在详细讲这张表。"),s("br"),s("br"),t._v("\n具体"),s("code",[t._v("分类表角色表：rolecategory")]),t._v("设计，"),s("a",{attrs:{href:"/web/mysql/rolecategory",target:"_blank"}},[t._v("点击查看")]),s("br")])]),t._v(" "),s("h3",{attrs:{id:"_7-管理员列表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-管理员列表"}},[t._v("#")]),t._v(" 7. 管理员列表")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.管理员列表",target:"_blank"}},[t._v("点击查看")]),s("br")])]),t._v(" "),s("h2",{attrs:{id:"四、管理员登录和退出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#四、管理员登录和退出"}},[t._v("#")]),t._v(" 四、管理员登录和退出")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.管理员登录退出",target:"_blank"}},[t._v("点击查看")]),s("br")]),t._v(" "),s("blockquote",[s("p",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.管理员登录退出.html#三、完成管理员登录功能后-创建中间件-完善之前和之后的api请求-需要进行权限验证"}},[t._v("完成管理员登录功能后，创建中间件，完善之前和之后的API请求，需要进行权限验证")]),s("br")])])]),t._v(" "),s("h2",{attrs:{id:"五、管理员角色管理和状态设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#五、管理员角色管理和状态设置"}},[t._v("#")]),t._v(" 五、管理员角色管理和状态设置")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.管理员角色管理和状态设置",target:"_blank"}},[t._v("点击查看")])]),t._v(" "),s("blockquote",[s("ol",[s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.管理员角色管理和状态设置.html#四、角色列表数据中-包含该角色对应的权限",target:"_blank"}},[t._v("注意第四点：获取角色列表数据中，包含该角色对应的权限")]),s("br")]),t._v(" "),s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.管理员角色管理和状态设置.html#二、角色列表",target:"_blank"}},[t._v("【角色列表】")]),s("br")]),t._v(" "),s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.角色管理",target:"_blank"}},[t._v("【创建角色】")]),s("br")]),t._v(" "),s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.角色管理.html#二、修改角色",target:"_blank"}},[t._v("【修改角色】")]),s("br")]),t._v(" "),s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.角色管理.html#三、修改角色状态",target:"_blank"}},[t._v("【修改角色状态】")]),s("br")]),t._v(" "),s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.角色管理.html#四、删除角色",target:"_blank"}},[t._v("【删除角色】")]),s("br")]),t._v(" "),s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp.角色管理.html#五、给角色role配置权限rule",target:"_blank"}},[t._v("【给角色role配置权限rule】")]),s("br"),s("br"),t._v("\n角色表"),s("code",[t._v("role")]),t._v("所有接口，"),s("a",{attrs:{href:"/web/mysql/role表接口.html",target:"_blank"}},[t._v("点击查看")])])])])]),t._v(" "),s("h2",{attrs:{id:"六、权限管理板块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#六、权限管理板块"}},[t._v("#")]),t._v(" 六、权限管理板块")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.权限管理",target:"_blank"}},[t._v("点击查看")]),s("br"),s("br"),t._v("\n权限表"),s("code",[t._v("rule")]),t._v("所有接口，"),s("a",{attrs:{href:"/web/mysql/rule表接口.html",target:"_blank"}},[t._v("点击查看")])])]),t._v(" "),s("h2",{attrs:{id:"七、管理员板块所有接口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#七、管理员板块所有接口"}},[t._v("#")]),t._v(" 七、管理员板块所有接口")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/web/mysql/shop_manager表接口.html",target:"_blank"}},[t._v("点击查看")]),s("br")])]),t._v(" "),s("h2",{attrs:{id:"八、图片管理板块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#八、图片管理板块"}},[t._v("#")]),t._v(" 八、图片管理板块")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.图片管理板块",target:"_blank"}},[t._v("图片管理板块")]),s("br"),t._v("\n特别说明：")]),t._v(" "),s("blockquote",[s("ol",[s("li",[s("a",{attrs:{href:"/fourthless/w-a/thinkphp文件上传说明",target:"_blank"}},[t._v("上传图片")]),s("br")])])])]),t._v(" "),s("h2",{attrs:{id:"九、商品管理板块"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#九、商品管理板块"}},[t._v("#")]),t._v(" 九、商品管理板块")]),t._v(" "),s("blockquote",[s("p",[t._v("具体查看，"),s("a",{attrs:{href:"/fourthless/w-a/thinkphp.商品管理板块",target:"_blank"}},[t._v("商品管理板块")]),s("br")])])])}),[],!1,null,null,null);s.default=n.exports}}]);